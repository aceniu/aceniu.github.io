<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Git删除暂存区或版本库中的文件</title>
      <link href="/posts/317ae1f5.html"/>
      <url>/posts/317ae1f5.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p>我们知道Git有三大区（工作区、暂存区、版本库）以及几个状态（untracked、unstaged、uncommited），下面只是简述下Git的大概工作流程。</p><ol><li><p>打开你的项目文件夹，除了隐藏的.git文件夹，其他项目文件位于的地方便是工作区，工作区的文件需要添加到Git的暂存区（git add），随后再提交到Git的版本库（git commit）。</p></li><li><p>首次新建的文件都是untracked状态（未跟踪），此时需要git add到暂存区，Git便会在暂存区中生成一个该文件的索引，文件此时处于uncommited状态，需要git commit生成版本库。添加到了版本库之后，再对文件进行修改，那么文件的状态会变为unstaged状态。</p></li></ol><h1 id="1）删除错误添加到暂存区的文件">1）删除错误添加到暂存区的文件</h1><p>有时你在工作区新建了文件，并且已经将它添加到了暂存区，git会告知，现有有一个文件未提交到版本库。</p><p>此时你想撤销错误添加到暂存区里的文件，可以输入以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">rm</span> --cache 文件名</span><br></pre></td></tr></table></figure><p>上面的命令仅仅删除暂存区的文件而已，不会影响工作区的文件，此时输入下面命令，git会告知有一个未跟踪的文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br></pre></td></tr></table></figure><h1 id="2）删除暂存区和工作区的文件">2）删除暂存区和工作区的文件</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">rm</span> -f 文件名</span><br></pre></td></tr></table></figure><h1 id="3）删除错误提交的commit">3）删除错误提交的commit</h1><p>有时，不仅添加到了暂存区，而且commit到了版本库，这个时候就不能使用git rm了，需要使用git reset命令。</p><p>错误提交到了版本库，此时无论工作区、暂存区，还是版本库，这三者的内容都是一样的，所以在这种情况下，只是删除了工作区和暂存区的文件，下一次用该版本库回滚那个误添加的文件还会重新生成。</p><p>这个时候，我们必须撤销版本库的修改才能解决问题！</p><p>git reset有三个选项，–hard、–mixed、–soft。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#仅仅只是撤销已提交的版本库，不会修改暂存区和工作区</span></span><br><span class="line">$ git reset --soft 版本库ID</span><br><span class="line"><span class="comment">#仅仅只是撤销已提交的版本库和暂存区，不会修改工作区</span></span><br><span class="line">$ git reset --mixed 版本库ID</span><br><span class="line"><span class="comment">#彻底将工作区、暂存区和版本库记录恢复到指定的版本库</span></span><br><span class="line">$ git reset --hard 版本库ID</span><br></pre></td></tr></table></figure><p>那我们到底应该用哪个选项好呢？</p><ol><li><p>如果你是在提交了后，对工作区的代码做了修改，并且想保留这些修改，那么可以使用git reset --mixed 版本库ID，注意这个版本库ID应该不是你刚刚提交的版本库ID，而是刚刚提交版本库的上一个版本库。</p></li><li><p>如果不想保留这些修改，可以直接使用彻底的恢复命令，git reset --hard 版本库ID。</p></li><li><p>为什么不使用–soft呢，因为它只是恢复了版本库，暂存区仍然存在你错误提交的文件索引，还需要进一步使用上一节的删除错误添加到暂存区的文件，详细见上文。</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Git如何回滚代码?</title>
      <link href="/posts/70fb250c.html"/>
      <url>/posts/70fb250c.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p>我们从本地向Github或Gitlab、Gitee等远程仓库push代码时，有时候会因为一些细节或者在push之前，没有pull拉取远程仓库中最新的内容，导致push远程仓库之后，项目生产环境异常，或者无法正常部署！！！</p><h1 id="1）查看commit-hash值">1）查看commit hash值</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">或者</span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure><h1 id="2）执行回滚">2）执行回滚</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#回滚到上一个版本</span></span><br><span class="line">$ git reset --hard xxxx</span><br></pre></td></tr></table></figure><h1 id="3）执行远程回滚命令">3）执行远程回滚命令</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#强制提交到github远程仓库</span></span><br><span class="line">$ git push -f</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat 学习笔记</title>
      <link href="/posts/c1c5e0d7.html"/>
      <url>/posts/c1c5e0d7.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="Tomcat">Tomcat</h1><p>Tomcat最初是由Sun的软件架构师詹姆斯·邓肯·戴维森开发的。后来他帮助将其变为开源项目，并由Sun贡献给Apache软件基金会。因为Tomcat 技术先进、性能稳定，而且免费，因而深受Java 爱好者的喜爱并得到了部分软件开发商的认可，成为比较流行的Web 应用服务器。</p><p>目前企业中的 Tomcat 服务器，主流版本还是 7.x 和 8.x。</p><h2 id="1）安装">1）安装</h2><ol><li><p>下载 tomcat</p><p><a href="https://tomcat.apache.org/">官网</a></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230114002845365.png" alt="image-20230114002845365"></p></li><li><p>依赖安装</p><p>tomcat默认依赖jdk，需要按照工作需求安装指定版本的jdk。</p></li><li><p>安装 tomcat (apache-tomcat-8.5.84.tar.gz以下以此版本为例)</p><p>将安装包上传到服务器，解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tar -zxvf apache-tomcat-8.5.84.tar.gz -C /usr/local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">名字太长了 建立软链接</span></span><br><span class="line">[root@localhost ~]# ln -s /usr/local/apache-tomcat-8.5.84.tar.gz /usr/local/tomcat8</span><br></pre></td></tr></table></figure></li><li><p>放开 8080 端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br></pre></td></tr></table></figure></li><li><p>tomcat 控制命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /usr/local/tomcat8/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动 tomcat</span></span><br><span class="line">[root@localhost ~]# ./startup.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭 tomcat</span></span><br><span class="line">[root@localhost ~]# ./shutdown.sh</span><br></pre></td></tr></table></figure></li><li><p>配置开机自启动（可以不配，在服务中配置即可）</p><p>众所周知，在Linux中设置开机自启动的服务，需要在/etc/rcX.d下挂载。除此之外还需要在/etc/init.d下些启动脚本。其实很简单，先export出所需要的环境变量，例如JAVA_HOME，JRE_HOME, CATALINA_HOME, CATALINA_BASE什么的，然后再直接调用$CATALINA_HOME/bin/startup.sh就能成功启动。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/init.d/tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">description: Tomcat8 Start Stop Restart</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">processname: tomcat8</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 345 99 10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CATALINA_HOME=/usr/local/tomcat8</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">        start)</span><br><span class="line">                sh $CATALINA_HOME/bin/startup.sh</span><br><span class="line">                ;;</span><br><span class="line">        stop)</span><br><span class="line">                sh $CATALINA_HOME/bin/shutdown.sh</span><br><span class="line">                ;;</span><br><span class="line">        restart)</span><br><span class="line">                sh $CATALINA_HOME/bin/shutdown.sh</span><br><span class="line">                sh $CATALINA_HOME/bin/startup.sh</span><br><span class="line">                ;;</span><br><span class="line">        *)</span><br><span class="line">                echo &#x27;please use : tomcat &#123;start | stop | restart&#125;&#x27;</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# chmod 755 /etc/init.d/tomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时可以使用</span></span><br><span class="line">[root@localhost ~]# service start tomcat</span><br></pre></td></tr></table></figure><p>在 chkconfig 添加</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">向chkconfig添加 tomcat 服务的管理</span></span><br><span class="line">[root@localhost ~]# chkconfig --add tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置tomcat服务自启动</span></span><br><span class="line">[root@localhost ~]# chkconfig tomcat on</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看tomcat的启动状态</span></span><br><span class="line">[root@localhost ~]# chkconfig --list | grep tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">状态如下：</span></span><br><span class="line">[root@localhost ~]# chkconfig –list | grep tomcat</span><br><span class="line"></span><br><span class="line">tomcat 0:off 1:off 2:on 3:on 4:on 5:on 6:off</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭tomcat服务自启动：</span></span><br><span class="line">[root@localhost ~]# chkconfig tomcat off</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除tomcat服务在chkconfig上的管理：</span></span><br><span class="line">[root@localhost ~]# chkconfig –del tomcat</span><br></pre></td></tr></table></figure></li></ol><h2 id="2）目录结构">2）目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(tomcat/) --&gt; B1(bin/)</span><br><span class="line">A--&gt; B2(conf/)</span><br><span class="line">A--&gt; B3(logs/)</span><br><span class="line">A--&gt; B4(webapps/)</span><br><span class="line">A--&gt; B5(lib/)</span><br><span class="line">A--&gt; B6(temp/)</span><br><span class="line">A--&gt; B7(work/)</span><br><span class="line">subgraph *存放管理脚本*</span><br><span class="line">B1 --&gt; |启动| b1-1(startup.sh)</span><br><span class="line">B1 --&gt; |关闭| b1-2(shutdown.sh)</span><br><span class="line">B1 --&gt; |tomcat核心脚本| b1-3(catalina.sh)</span><br><span class="line">end</span><br><span class="line">subgraph *配置文件*</span><br><span class="line">B2 --&gt; |主配置文件|b2-1(server.xml)</span><br><span class="line">B2 --&gt; |内置tomcat内置功能| b2-2(web.xml)</span><br><span class="line">B2 --&gt; |属性| b2-3(logging.properties)</span><br><span class="line">B2 --&gt; |管理端配置文件--&#x27;线上环境关闭&#x27;--| b2-4(tomcat-users.xml)</span><br><span class="line">end</span><br><span class="line">subgraph *日志*</span><br><span class="line">B3  --&gt; |主要日志|b3-1(catalina.out)</span><br><span class="line">B3  --&gt; |切割日志|b3-2(catalina.2023-01-14.log)</span><br><span class="line">B3  --&gt; |访问日志|b3-3(localhost_access_log.2023-01-14.txt)</span><br><span class="line">end</span><br><span class="line">    subgraph *站点目录*</span><br><span class="line">B4</span><br><span class="line">end</span><br><span class="line">subgraph 依赖</span><br><span class="line">B5</span><br><span class="line">end</span><br><span class="line">subgraph 临时目录</span><br><span class="line">B6</span><br><span class="line">end</span><br><span class="line">subgraph 运行代码的编译临时目录</span><br><span class="line">B7</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="3）基本使用">3）基本使用</h2><h3 id="3-1-部署app方式">3.1 部署app方式</h3><ol><li><p><strong>war包</strong></p><p>将打包好的war包上传到tomcat服务器的webapps目录,Tomcat服务器自动解压缩xxxx.war包。</p><p>检查一下tomcat服务器是否自动在conf目录下创建了Catalina/localhost目录，在看看localhost目录下是否有tomcat服务器自动创建的xxxx.xml文件。</p></li><li><p><strong>jar包</strong></p><p>默认java打包好后，自带了tomcat环境。</p><p>只需要执行：（前台运行）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar xxxx.jar</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-2-查看日志">3.2 查看日志</h3><ol><li><p>进入logs文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd usr/local/tomcat8/logs/</span><br></pre></td></tr></table></figure></li><li><p>实时查看tomcat日志信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tail -f catalina.out</span><br></pre></td></tr></table></figure><p>注意查看错误关键字： <code>error</code> <code>failed</code> <code>exception</code></p></li></ol><h3 id="3-3-添加服务">3.3 添加服务</h3><ul><li><p>systemctl 通过 <code> /usr/lib/systemd/system/xxxx.service</code> 配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建一个配置文件</span></span><br><span class="line">[root@localhost ~]# vim /usr/lib/systemd/system/tomcat.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-----------------------</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Apache Tomcat 8# 注释、描述</span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Environment=<span class="string">&quot;JAVA_HOME=/usr/lib/jvm/openJDK8/&quot;</span> <span class="comment"># yum 安装的jdk可以省略环境</span></span></span><br><span class="line">ExecStart=/usr/local/tomcat8/bin/startup.sh</span><br><span class="line">ExecStop=/usr/local/tomcat8/bin/shutdown.sh</span><br><span class="line">ExecReload=/usr/local/tomcat8/bin/shutdown.sh &amp;&amp; sleep 2 &amp;&amp; /usr/local/tomcat8/bin/startup.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">usually, tomcat service will be killed with exit_code 143.</span></span><br><span class="line">SuccessExitStatus=143</span><br><span class="line">PrivateTmp=true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">User=root</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Group=root</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p>重新载入 systemctl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl daemon-reload</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-4-管理端">3.4 管理端</h3><p><span style="color:red">**※ 注意！！！**生产环境中，监控时可以设置下内网访问下，通常处于关闭状态（存在安全隐患）。</span></p><p>当我们部署了tomcat之后 用浏览器打开ip:8080端口之后会看到如下界面在界面的又上角可以看到三个按钮Serve Status、Manager APP 和HostManager。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230114222425802.png" alt="image-20230114222425802"></p><p><span style="color:red"><strong>tomcat8.5之后对ip进行了限制，仅允许本地登入 解决方法：</strong></span></p><ol><li><p>编辑tomcat安装路径下的tomcat-users.xm文件。</p><p><code>vim /usr/local/tomcat/conf/tomcat-users.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot;</span><br><span class="line">              xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">              xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span><br><span class="line">              version=&quot;1.0&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;role rolename=&quot;admin-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;admin-script&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-script&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-jmx&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;manager-status&quot;/&gt;</span><br><span class="line">&lt;user username=&quot;niu&quot; password=&quot;niu&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-script,admin-gui&quot;/&gt;</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure><ul><li><p>配置解释：前4个是开启前两个按钮(Serve Status、Manager APP)的角色，后面两个是开启第三个按钮(HostManager)的角色</p><p>manager-gui - 访问HTML界面。</p><p>manager-status - 只能访问“服务器状态”页面。</p><p>manager-script - 这个权限是指可以执行url命令后面会演示</p><p>manager-jmx - 访问JMX代理接口并访问“服务器状态”页面</p><p>admin-gui host-manager的web管理界面</p><p>admin-script host-manager的文本管理角色</p></li></ul></li><li><p>新建文件并添加如下内容，默认没有，这一步也是为了开启前两个按钮(Serve Status、Manager APP)配置。</p><p><code>vim /usr/local/tomcat8/conf/Catalina/localhost/manager.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Context privileged=&quot;true&quot; antiResourceLocking=&quot;false&quot;&gt;</span><br><span class="line">    &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot; allow=&quot;^.*$&quot; /&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure></li><li><p>修改如下原有文件，这一步是为了开启第二个按钮(Manager)配置。</p><p><code>vim /usr/local/tomcat8/webapps/manager/META-INF</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Context antiResourceLocking=&quot;false&quot; privileged=&quot;true&quot; &gt;</span><br><span class="line">  &lt;CookieProcessor className=&quot;org.apache.tomcat.util.http.Rfc6265CookieProcessor&quot;</span><br><span class="line">                   sameSiteCookies=&quot;strict&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span><br><span class="line">         allow=&quot;^.*$&quot; /&gt;</span><br><span class="line">  &lt;Manager sessionAttributeValueClassNameFilter=&quot;java\.lang\.(?:Boolean|Integer|Long|Number|String)|org\.apache\.catalina\.filters\.CsrfPreventionFilter\$LruCache(?:\$1)?|java\.util\.(?:Linked)?HashMap&quot;/&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure></li><li><p>修改如下原有文件，这一步是为了开启第三个按钮(HostManager)配置。</p><p><code>vim /usr/local/tomcat8/webapps/host-manager/META-INF/context.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;Context antiResourceLocking=&quot;false&quot; privileged=&quot;true&quot; &gt;</span><br><span class="line">  &lt;CookieProcessor className=&quot;org.apache.tomcat.util.http.Rfc6265CookieProcessor&quot;</span><br><span class="line">                   sameSiteCookies=&quot;strict&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span><br><span class="line">         allow=&quot;^.*$&quot; /&gt;</span><br><span class="line">  &lt;Manager sessionAttributeValueClassNameFilter=&quot;java\.lang\.(?:Boolean|Integer|Long|Number|String)|org\.apache\.catalina\.filters\.CsrfPreventionFilter\$LruCache(?:\$1)?|java\.util\.(?:Linked)?HashMap&quot;/&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart tomcat</span><br></pre></td></tr></table></figure><p>现在可以根据设置的账号密码进行使用。</p></li></ol><h2 id="4）配置">4）配置</h2><h3 id="4-1-主配置文件-server-xml">4.1 主配置文件 server.xml</h3><p><code>vim /usr/local/tomcat8/conf/server.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- port: 接收shutdown指令的端口，默认仅允许通过本机访问，默认为8005；</span><br><span class="line">     shutdown：发往此Server用于实现关闭tomcat实例的命令字符串，默认为SHUTDOWN；</span><br><span class="line">     使用方式：telnet localhost 8005， 输入SHUTDOWN即可关闭tomcat   </span><br><span class="line">  </span><br><span class="line">     如果你不配置这两个属性，Tomcat的这种关闭机制还是会运行的。你不想暴露这种关闭机制的</span><br><span class="line">     话，可以将端口设置成poer=-1，shutdown设置成一个复杂的字符串，比如shutdown=&quot;xscdeww#12&quot;</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</span><br><span class="line">  &lt;!-- 默认配置的Listener --&gt;</span><br><span class="line">  &lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&gt;</span><br><span class="line">  &lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;on&quot; /&gt;</span><br><span class="line">  &lt;Listener className=&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot; /&gt;</span><br><span class="line">  &lt;Listener className=&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot; /&gt;</span><br><span class="line">  &lt;Listener className=&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 应用于整个服务器的JNDI映射，此可以避免每个Web应用程序都需要在各自的web.xml创建，这在web应用程序        以WAR的形式存在时尤为有用。</span><br><span class="line">   --&gt;</span><br><span class="line">    </span><br><span class="line">  &lt;!-- GlobalNamingResources 是管理端页面的配置，工作环境请注释</span><br><span class="line">   --&gt;  </span><br><span class="line">  &lt;GlobalNamingResources&gt;</span><br><span class="line">    &lt;Resource name=&quot;UserDatabase&quot; auth=&quot;Container&quot;</span><br><span class="line">              type=&quot;org.apache.catalina.UserDatabase&quot;</span><br><span class="line">              description=&quot;User database that can be updated and saved&quot;</span><br><span class="line">              factory=&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;</span><br><span class="line">              pathname=&quot;conf/tomcat-users.xml&quot; /&gt;</span><br><span class="line">  &lt;/GlobalNamingResources&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- Service是多个Connector和单个Container的组合。Container是一个抽象的概念，由Engine, Realm,        Valve和Hosts主组组成。</span><br><span class="line">       在server.xml配置文件中可以同时配置多个Service标签</span><br><span class="line">   --&gt;</span><br><span class="line">  &lt;Service name=&quot;Catalina&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--The connectors can use a shared executor, you can define one or more named thread         pools</span><br><span class="line">     --&gt; </span><br><span class="line">    &lt;!-- 默认情况下，每个连接器connector会使用自己创建的线程池，我们也可以配置多个线程池让连接器共享--&gt;</span><br><span class="line">    &lt;!-- 如果想让连接器connector组件使用这个线程池，需要在连接器组件中配置executor属性.</span><br><span class="line">         另外，Executor元素的配置应该放在Connector配置的前面，这样才会先加载Executor的配置。</span><br><span class="line">        </span><br><span class="line">         Executor的主要属性包括：</span><br><span class="line">          - name：该线程池的名称id</span><br><span class="line">          - maxThreads：线程池中最大活跃线程数，默认值200（Tomcat7和8都是）</span><br><span class="line">          - minSpareThreads：线程池中保持的最小线程数，最小值是25</span><br><span class="line">          - maxIdleTime：线程空闲的最大时间，当空闲超过该值时关闭线程（除非线程数小于</span><br><span class="line">                         minSpareThreads），单位是ms，默认值60000（1分钟）</span><br><span class="line">          - daemon：是否后台线程，默认值true</span><br><span class="line">          - threadPriority：线程优先级，默认值5</span><br><span class="line">          - namePrefix：线程名字的前缀，线程池中线程名字为：namePrefix+线程编号</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;Executor name=&quot;tomcatThreadPool&quot; namePrefix=&quot;catalina-exec-&quot;</span><br><span class="line">              maxThreads=&quot;150&quot; minSpareThreads=&quot;4&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- A &quot;Connector&quot; represents an endpoint by which requests are received</span><br><span class="line">         and responses are returned. Documentation at :</span><br><span class="line">         Java HTTP Connector: /docs/config/http.html</span><br><span class="line">         Java AJP  Connector: /docs/config/ajp.html</span><br><span class="line">         APR (HTTP/AJP) Connector: /docs/apr.html</span><br><span class="line">         Define a non-SSL/TLS HTTP/1.1 Connector on port 8080</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!-- Connector是Tomcat中请求接收和响应返回的端点，Tomcat中支持HTTP、AJP和APR等协议。</span><br><span class="line">         下面的配置定义了一个支持Http协议的连接器，监听8080端口</span><br><span class="line"></span><br><span class="line">         Connector组件支持以下组件的配置：</span><br><span class="line">          - address：指定连接器监听的地址，默认为所有地址，即0.0.0.0；</span><br><span class="line">          - port：监听的端口，默认为0；</span><br><span class="line">          - protocol：连接器使用的协议，默认为HTTP/1.1，定义AJP协议时通常为AJP/1.3；</span><br><span class="line">          - connectionTimeout：等待客户端发送请求的超时时间，单位为毫秒，默认为60000，即1分钟；</span><br><span class="line">          - maxThreads：支持的最大并发连接数，默认为200；</span><br><span class="line">          - redirectPort：如果某连接器支持的协议是HTTP，当接收客户端发来的HTTPS请求时，</span><br><span class="line">                          则转发至此属性定义的端口；</span><br><span class="line">          - enableLookups：是否通过request.getRemoteHost()进行DNS查询以获取客户端的主机名；</span><br><span class="line">                           默认为true；</span><br><span class="line">          - acceptCount：设置等待队列的最大长度；</span><br><span class="line">          - executor：指定共享的线程池组件；</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; </span><br><span class="line">               connectionTimeout=&quot;20000&quot;</span><br><span class="line">               redirectPort=&quot;8443&quot;</span><br><span class="line">               executor=&quot;tomcatThreadPool&quot; /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 下面是进行支持Https的配置 --&gt;</span><br><span class="line">    &lt;!-- Define an SSL/TLS HTTP/1.1 Connector on port 8443</span><br><span class="line">         This connector uses the NIO implementation. The default</span><br><span class="line">         SSLImplementation will depend on the presence of the APR/native</span><br><span class="line">         library and the useOpenSSL attribute of the</span><br><span class="line">         AprLifecycleListener.</span><br><span class="line">         Either JSSE or OpenSSL style configuration may be used regardless of</span><br><span class="line">         the SSLImplementation selected. JSSE style configuration is used below.</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    &lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span><br><span class="line">               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot;&gt;</span><br><span class="line">        &lt;SSLHostConfig&gt;</span><br><span class="line">            &lt;Certificate certificateKeystoreFile=&quot;conf/localhost-rsa.jks&quot;</span><br><span class="line">                         type=&quot;RSA&quot; /&gt;</span><br><span class="line">        &lt;/SSLHostConfig&gt;</span><br><span class="line">    &lt;/Connector&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!-- Define an SSL/TLS HTTP/1.1 Connector on port 8443 with HTTP/2</span><br><span class="line">         This connector uses the APR/native implementation which always uses</span><br><span class="line">         OpenSSL for TLS.</span><br><span class="line">         Either JSSE or OpenSSL style configuration may be used. OpenSSL style</span><br><span class="line">         configuration is used below.</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    &lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot;</span><br><span class="line">               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; &gt;</span><br><span class="line">        &lt;UpgradeProtocol className=&quot;org.apache.coyote.http2.Http2Protocol&quot; /&gt;</span><br><span class="line">        &lt;SSLHostConfig&gt;</span><br><span class="line">            &lt;Certificate certificateKeyFile=&quot;conf/localhost-rsa-key.pem&quot;</span><br><span class="line">                         certificateFile=&quot;conf/localhost-rsa-cert.pem&quot;</span><br><span class="line">                         certificateChainFile=&quot;conf/localhost-rsa-chain.pem&quot;</span><br><span class="line">                         type=&quot;RSA&quot; /&gt;</span><br><span class="line">        &lt;/SSLHostConfig&gt;</span><br><span class="line">    &lt;/Connector&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    &lt;Connector protocol=&quot;AJP/1.3&quot;</span><br><span class="line">               address=&quot;::1&quot;</span><br><span class="line">               port=&quot;8009&quot;</span><br><span class="line">               redirectPort=&quot;8443&quot; /&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    &lt;!-- Tomcat内部有4个级别的容器，分别是Engine、Host、Context和Wrapper。Engine代表全局Servlet引          擎，每个Service组件只能包含一个Engine容器组件，但Engine组件可以包含若干Host容器组件 </span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;!-- An Engine represents the entry point (within Catalina) that processes</span><br><span class="line">         every request.  The Engine implementation for Tomcat stand alone</span><br><span class="line">         analyzes the HTTP headers included with the request, and passes them</span><br><span class="line">         on to the appropriate Host (virtual host).</span><br><span class="line">         Documentation at /docs/config/engine.html --&gt;</span><br><span class="line">      </span><br><span class="line">    &lt;!-- You should set jvmRoute to support load-balancing via AJP ie :</span><br><span class="line">    &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;jvm1&quot;&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--For clustering, please take a look at documentation at:</span><br><span class="line">          /docs/cluster-howto.html  (simple how to)</span><br><span class="line">          /docs/config/cluster.html (reference documentation) --&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      &lt;Cluster className=&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;/&gt;</span><br><span class="line">      --&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- Use the LockOutRealm to prevent attempts to guess user passwords</span><br><span class="line">           via a brute-force attack --&gt;</span><br><span class="line">      &lt;Realm className=&quot;org.apache.catalina.realm.LockOutRealm&quot;&gt;</span><br><span class="line">        &lt;!-- This Realm uses the UserDatabase configured in the global JNDI</span><br><span class="line">             resources under the key &quot;UserDatabase&quot;.  Any edits</span><br><span class="line">             that are performed against this UserDatabase are immediately</span><br><span class="line">             available for use by the Realm.  --&gt;</span><br><span class="line">        &lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;</span><br><span class="line">               resourceName=&quot;UserDatabase&quot;/&gt;</span><br><span class="line">      &lt;/Realm&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 配置虚拟主机，可以配置多个--&gt;</span><br><span class="line">      &lt;!-- 一个Host下面可以有多个Context，也就是可以部署多个Webapp应用,一个webapp对应一个Context,用不同的ContextPath区分 </span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;</span><br><span class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- SingleSignOn valve, share authentication between web applications</span><br><span class="line">             Documentation at: /docs/config/valve.html --&gt;</span><br><span class="line">        &lt;!--</span><br><span class="line">        &lt;Valve className=&quot;org.apache.catalina.authenticator.SingleSignOn&quot; /&gt;</span><br><span class="line">        --&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Access log processes all example.</span><br><span class="line">             Documentation at: /docs/config/valve.html</span><br><span class="line">             Note: The pattern used is equivalent to using pattern=&quot;common&quot; --&gt;</span><br><span class="line">        &lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</span><br><span class="line">               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;</span><br><span class="line">               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Host下面也可以配置Context相关的配置 --&gt;</span><br><span class="line">      &lt;/Host&gt;</span><br><span class="line">    &lt;/Engine&gt;</span><br><span class="line">  &lt;/Service&gt;</span><br><span class="line">&lt;/Server&gt;</span><br></pre></td></tr></table></figure><h3 id="4-2-访问日志配置">4.2 访问日志配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># tomcat 默认&lt;value&gt;</span><br><span class="line">&lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</span><br><span class="line">               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;</span><br><span class="line">               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b&quot; /&gt;</span><br></pre></td></tr></table></figure><blockquote><p>具体的日志产生样式说明如下(从官方文档中摘录)：<br>%a - 远端IP地址<br>%A - 本地IP地址<br>%b - 发送的字节数，不包括HTTP头，如果为0，使用&quot;－&quot;<br>%B - 发送的字节数，不包括HTTP头<br>%h - 远端主机名(如果resolveHost=false，远端的IP地址）<br>%H - 请求协议<br>%l - 从identd返回的远端逻辑用户名（总是返回 ‘-’）<br>%m - 请求的方法（GET，POST，等）<br>%p - 收到请求的本地端口号<br>%q - 查询字符串(如果存在，以 ‘?‘开始)<br>%r - 请求的第一行，包含了请求的方法和URI<br>%s - 响应的状态码<br>%S - 用户的session ID<br>%t - 日志和时间，使用通常的Log格式<br>%u - 认证以后的远端用户（如果存在的话，否则为’-’）<br>%U - 请求的URI路径<br>%v - 本地服务器的名称<br>%D - 处理请求的时间，以毫秒为单位<br>%T - 处理请求的时间，以秒为单位另外还可以将cookie, 客户端请求中带的HTTP头(incoming header), 会话(session)或是ServletRequest中的数据都写到Tomcat的访问日志中，你可以用下面的语法来引用。<br>%{xxx}i – 记录客户端请求中带的HTTP头xxx(incoming headers)<br>%{xxx}c – 记录特定的cookie xxx<br>%{xxx}r – 记录ServletRequest中的xxx属性(attribute)<br>%{xxx}s – 记录HttpSession中的xxx属性(attribute)</p></blockquote><h4 id="span-style-color-red-※-工作环境-优化-日志记录-※-span"><span style="color:red;">※&lt;工作环境&gt; 优化-日志记录 ※</span></h4><ul><li><p>这里设置的是 localhost_access_log.Y-M-D.txt 的格式。</p><p><code>vim /usr/local/tomcat8/conf/server.xml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;</span><br><span class="line">               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;</span><br><span class="line">               pattern=&quot;%h %l %u %t &amp;quot;%r&amp;quot; %s %b &amp;quot;%&#123;Referer&#125;i&amp;quot; &amp;quot;%&#123;User-Agent&#125;i&amp;quot; &amp;quot;%&#123;X-Forwarded-For&#125;i&amp;quot; %T&quot; /&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&amp;quot;</code> 为双引号</li></ul></li></ul><h3 id="4-3-虚拟主机">4.3 虚拟主机</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Nginx 学习笔记</title>
      <link href="/posts/c1020521.html"/>
      <url>/posts/c1020521.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="Nginx">Nginx</h1><h2 id="1）概述">1）概述</h2><ul><li><p>Nginx 四个发行版</p><ol><li><p>Nginx 开源版</p><p><a href="https://nginx.org">https://nginx.org</a></p></li><li><p>Nginx 商业版</p><p><a href="https://www.nginx.com/">https://www.nginx.com/</a></p></li><li><p>Openresty</p><p><a href="https://openresty.org/">https://openresty.org/</a></p></li><li><p>Tengine</p><p><a href="https://tengine.taobao.org/">https://tengine.taobao.org/</a></p></li></ol></li></ul><h2 id="2）安装">2）安装</h2><h3 id="2-1-yum安装">2.1 yum安装</h3><ol><li><p>添加yum源并执行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加yum源</span></span><br><span class="line">[root@localhost ~]# rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看yum源</span></span><br><span class="line">[root@localhost ~]# yum repolist</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有nginx版本</span></span><br><span class="line">[root@localhost ~]# yum list nginx --showduplicates</span><br></pre></td></tr></table></figure></li><li><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定版本安装（举例）</span></span><br><span class="line">[root@localhost ~]# yum -y install nginx-1.18.0-2.el7.ngx</span><br></pre></td></tr></table></figure></li><li><p>服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开机自启</span></span><br><span class="line">[root@localhost ~]# systemctl enable nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">[root@localhost ~]# systemctl start nginx</span><br></pre></td></tr></table></figure></li><li><p>防火墙放行端口：(22端口记得放开)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">放行80端口</span></span><br><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新载入防火墙</span></span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-2-编译安装">2.2 编译安装</h3><ol><li><p>安装依赖</p><p>a.安装 c语言编译器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提示</span></span><br><span class="line">checking for OS</span><br><span class="line">+ Linux 3.10.0-693.el7.x86_64 x86_64</span><br><span class="line">checking for C compiler ... not found</span><br><span class="line">./configure: error: C compiler cc is not found</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y gcc</span><br></pre></td></tr></table></figure><p>b.安装perl库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either disable the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure><p>c.安装zlib库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class="line">You can either disable the module by using --without-http_gzip_module</span><br><span class="line">option, or install the zlib library into the system, or build the zlib library</span><br><span class="line">statically from the source with nginx by using --with-zlib=&lt;path&gt; option.</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure></li><li><p>下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget http://nginx.org/download/nginx-1.8.0.tar.gz</span><br><span class="line">[root@localhost ~]# tar -zxvf nginx-1.8.0.tar.gz &amp;&amp; cd nginx-1.8.0</span><br></pre></td></tr></table></figure></li><li><p>配置安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.8.0]# ./configure --prefix=/usr/local/nginx</span><br><span class="line">[root@localhost nginx-1.8.0]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li><li><p>创建服务脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /usr/lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx - web server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/local/nginx/logs/nginx.pid</span><br><span class="line">ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">ExecQuit=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>重新加载系统服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl daemon-reload</span><br></pre></td></tr></table></figure></li><li><p>防火墙放行端口：(22端口记得放开)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">放行80端口</span></span><br><span class="line">[root@localhost ~]# firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新载入防火墙</span></span><br><span class="line">[root@localhost ~]# firewall-cmd --reload</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-3-Docker安装">2.3 Docker安装</h3><h2 id="3）控制命令">3）控制命令</h2><p>创建脚本服务前，需进入安装的目录 <code>/usr/local/nginx/sbin</code>去启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /usr/local/nginx/sbin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">[root@localhost sbin]# ./nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">快速停止</span></span><br><span class="line">[root@localhost sbin]# ./nginx -s stop</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">优雅关闭，在退出前完成已经接受的连接请求</span></span><br><span class="line">[root@localhost sbin]# ./nginx -s quit</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载配置</span></span><br><span class="line">[root@localhost sbin]# ./nginx -s reload</span><br></pre></td></tr></table></figure><p>配置服务后可以直接用systemctl控制</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动nginx</span></span><br><span class="line">[root@localhost ~]# systemctl start nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开机自启</span></span><br><span class="line">[root@localhost ~]# systemctl enable nginx</span><br></pre></td></tr></table></figure><h2 id="4）文件结构">4）文件结构</h2><ul><li><p>进入nginx的主目录下</p><ul><li>yum安装在 <code>/etc/nginx</code></li><li>编译安装一般设置在 <code>/usr/local/nginx</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Nginx] --&gt;  B1[conf];</span><br><span class="line">    A[Nginx] --&gt;  B2[html];</span><br><span class="line">    A[Nginx] --&gt;  B3[sbin];</span><br><span class="line">    subgraph 用来存放配置相关文件</span><br><span class="line">    B1 --&gt; |主配置文件|C1[nginx.conf]</span><br><span class="line">    B1 --&gt; C2[conf.d] --&gt; D1[default.conf]</span><br><span class="line">    end</span><br><span class="line">    subgraph 用来存放静态文件的默认目录</span><br><span class="line">    B2 --&gt; C4[html]</span><br><span class="line">    B2 --&gt; C5[css]</span><br><span class="line">    end</span><br><span class="line">    subgraph Nginx的主程序</span><br><span class="line">    B3 --&gt; C3[nginx]</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="5）基本运行原理">5）基本运行原理</h2><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230111210829971.png" alt="image-20230111210829971"></p><h2 id="6）基本配置">6）基本配置</h2><p><code>/etc/nginx/ngnix.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>  nginx;</span><br><span class="line"><span class="comment"># 为1时，表示开启一个业务进程。相当使用一个进程。</span></span><br><span class="line"><span class="attribute">worker_processes</span>  auto;</span><br><span class="line"></span><br><span class="line"><span class="attribute">error_log</span>  /var/log/nginx/<span class="literal">error</span>.log <span class="literal">notice</span>;</span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="comment"># 单个业务进程可接受连接数</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment"># 引入http mime类型</span></span><br><span class="line">    <span class="attribute">include</span>       /etc/nginx/mime.types;</span><br><span class="line">    <span class="comment"># 如果mime类型没匹配上，默认使用二进制流的方式传输。</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span>  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用linux的sendfile(socket, file, len) 高效网络传输，也就是数据0拷贝。</span></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/conf.d/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="comment"># 监听端口号</span></span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># 主机名</span></span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  /var/log/nginx/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配路径</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="comment"># 文件根目录</span></span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">        <span class="comment"># 默认页名称</span></span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">    <span class="comment"># 报错编码对应页面</span></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">    <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">    <span class="comment">#    root           html;</span></span><br><span class="line">    <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">    <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">    <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">    <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">    <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">    <span class="comment">#    deny  all;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>servername</p><ul><li><p>我们可以在同一servername中匹配多个域名，以空格分隔</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server_name www.xxx.com vlog.xyz.com;</span><br></pre></td></tr></table></figure></li><li><p>通配符匹配</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> <span class="regexp">*.xxx.com</span> <span class="regexp">vlog.*</span>;</span><br></pre></td></tr></table></figure></li><li><p>正则匹配</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">server_name</span> ~^[<span class="number">0</span>-<span class="number">9</span>]+\.mmban\.com$;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="7）反向代理">7）反向代理</h2><ul><li><p>概念</p><p>反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器，即用户直接访问反向代理服务器就可以获得目标服务器的资源。同时，用户不需要知道目标服务器的地址，也无须在用户端作任何设定。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230111230501485.png" alt="image-20230111230501485"></p></li><li><p>语法</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> &lt;协议&gt;://&lt;地址 | 域名&gt;[:port];</span><br></pre></td></tr></table></figure></li><li><p>eg.</p><p><span style="color:red;"><strong>注意：反向代理时要把协议写全<code>https://</code></strong></span></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>https://baidu.com;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">    <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>同宿主机下不同容器的代理</p><p>在容器中使用时应该进入容器中查看<code>cat /etc/hosts</code>下的地址（docker为容器创建的地址）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker_test conf.d]# docker exec -it tomcat /bin/bash</span><br><span class="line">root@d69eb116a23c:/usr/local/tomcat# cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.3      d69eb116a23c# 此地址就是docker为tomcat容器创建的地址</span><br></pre></td></tr></table></figure><p>改为<code>proxy_pass172.17.0.3:8080;</code>即可生效。</p></li></ul><p>​</p></li><li><p>基于反向代理的负载均衡</p><p>配置一组服务器 httpds 对应了 proxy_pass 里的字符，意思是给这组服务器取个别名</p><p><u>默认情况</u>下使用<span style="color:blue;">轮询</span>方式，逐一转发，这种方式适用于无状态请求。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> httpds &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.206.101:80</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.206.102:80</span>;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span>https://httpds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">    <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>负载均衡策略</p><p>a.<strong>weight</strong> 权重</p><p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p><p><span style="color:grey;"><em>down、backup 其实实际运用中是很少使用的。</em></span></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> httpds &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.206.101:80</span> weight=<span class="number">5</span> down;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.206.102:80</span> weight=<span class="number">3</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.206.103:80</span> weight=<span class="number">2</span> backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>down：表示此服务器下线，不参与负载均衡。（用于临时服务器有故障时，手动停止）</p></li><li><p>backup：表示只作为备用。</p></li></ol><p><em>b.ip_hash (不常用)</em></p><p><em>指定负载均衡器按照基于客户端IP的分配方式，这个方法确保了相同的客户端的请求一直发送到相同的服务器，以保证session会话。这样每个访客都固定访问一个后端服务器，可以解决session不能跨服务器的问题。</em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backserver &#123;</span><br><span class="line">ip_hash;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.206.101:80</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.206.102:80</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>注意：</em></p><ol><li><em>在nginx版本1.3.1之前，不能在ip_hash中使用权重（weight）。</em></li><li><em>ip_hash不能与backup同时使用。</em></li><li><em>此策略适合有状态服务，比如session。当有服务器需要剔除，必须手动down掉。</em></li></ol><p><em>c.least_conn (不常用)</em></p><p><em>把请求转发给连接数较少的后端服务器。轮询算法是把请求平均的转发给各个后端，使它们的负载大致相同；但是，有些请求占用的时间很长，会导致其所在的后端负载较高。这种情况下，least_conn这种方式就可以达到更好的负载均衡效果。</em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#动态服务器组</span></span><br><span class="line"><span class="section">upstream</span> dynamic_zuoyu &#123;</span><br><span class="line">least_conn; <span class="comment">#把请求转发给连接数较少的后端服务器</span></span><br><span class="line"><span class="attribute">server</span> localhost:<span class="number">8080</span> weight=<span class="number">2</span>; <span class="comment">#tomcat 7.0</span></span><br><span class="line"><span class="attribute">server</span> localhost:<span class="number">8081</span>; <span class="comment">#tomcat 8.0</span></span><br><span class="line"><span class="attribute">server</span> localhost:<span class="number">8082</span> backup; <span class="comment">#tomcat 8.5</span></span><br><span class="line"><span class="attribute">server</span> localhost:<span class="number">8083</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">20s</span>; <span class="comment">#tomcat 9.0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>注意：此负载均衡策略适合请求处理时间长短不一造成服务器过载的情况。</em></p><p><em>d.url_hash (不常用)</em></p><p><em>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backend &#123;</span><br><span class="line"><span class="attribute">hash</span> &amp;request_uri;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9001</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9002</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.200.146:9003</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">8083</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="section">location</span> /&#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>e.fair（第三方） (不常用)</em></p><p><em>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</em></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> backserver &#123;</span><br><span class="line"><span class="attribute">server</span> server1;</span><br><span class="line"><span class="attribute">server</span> server2;</span><br><span class="line">fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><span style="color:orange;"><strong>反向代理时遇到的问题</strong></span></p><ol><li><p>在部署 tomcat 时，Apache可能不能链接网络导致不能实现代理。</p><p>修改SElinux策略</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">错误</span></span><br><span class="line">*140 connect() to 127.0.0.1:8080 failed (13: Permission denied) while connecting to upstream, client: 192.168.128.1, server: 192.168.128.130, request: &quot;GET / HTTP/1.1&quot;, upstream: &quot;http://127.0.0.1:8080/&quot;, host: &quot;192.168.128.130&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解决办法 也可以关闭SElinux</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-P 为写入配置文件</span></span><br><span class="line">setsebool -P httpd_can_network_connect 1</span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="8）动静分离">8）动静分离</h2><ul><li><p>概念</p><p>在Web开发中，通常来说，动态资源其实就是指那些后台资源，而静态资源就是指HTML，JavaScript，CSS，img等文件。</p><p>一般来说，都需要将动态资源和静态资源分开，将静态资源部署在Nginx上，当一个请求来的时候，如果是静态资源的请求，就直接到nginx配置的静态资源目录下面获取资源，如果是动态资源的请求，nginx利用反向代理的原理，把请求转发给后台应用去处理，从而实现动静分离。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/a2de4b09c680cebff8e64030329f95d1.jpeg@wm_2,t_55m+5a625Y+3L+e+suWSjOaXtuS7ow==,fc_ffffff,ff_U2ltSGVp,sz_22,x_14,y_14" alt="img"></p></li><li><p>语法</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass</span> &lt;协议&gt;://&lt;ip&gt;[:port];</span><br></pre></td></tr></table></figure></li><li><p>eg.</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置反向代理</span></span><br><span class="line"><span class="comment"># 把主页的html挂载在tomcat上</span></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://127.0.0.1:8080;<span class="comment"># tomcat 的服务端口8080</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动静分离</span></span><br><span class="line"><span class="comment"># 把 css、img、js 放到本地nginx上</span></span><br><span class="line"><span class="section">location</span> ~*/(css|img|js) &#123;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="9）URL-Rewrite">9）URL Rewrite</h2><ul><li><p>概念</p><p>URL Rewrite即URL重写，就是把传入Web的请求重定向到其他URL的过程。URL Rewrite最常见的应用是URL伪静态化，是将动态页面显示为静态页面方式的一种技术。比如<code>http://www.123.com/news/index.asp?id=123</code> 使用UrlRewrite转换后可以显示为<code>http://www.123.com/news/123.html</code>。</p></li><li><p>语法</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rewrite</span> &lt;regex&gt; &lt;replacement&gt; [flag];</span><br></pre></td></tr></table></figure><ul><li><p>flag标记说明：</p><p>last #本条规则匹配完成后，继续向下匹配新的location URI规则。<br><strong>break #本条规则匹配完成即终止，不再匹配后面的任何规则。</strong><br>redirect #返回302临时重定向，浏览器地址会显示跳转后的URL地址。<br>permanent #返回301永久重定向，浏览器地址栏会显示跳转后的URL地址。</p></li></ul></li><li><p>eg.</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^/([0-9]+).html$</span> /index.jsp?pageNum=<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://127.0.0.1:8080;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>​</p><h2 id="10）防盗链">10）防盗链</h2><ul><li><p>概念</p><p>盗链是指服务提供商自己不提供服务的内容，通过技术手段绕过其它有利益的最终用户界面（如广告），直接在自己的网站上向最终用户提供其它服务提供商的服务内容，骗取最终用户的浏览和点击率。受益者不提供资源或提供很少的资源，而真正的服务提供商却得不到任何的收益。</p></li><li><p>refer模块防盗</p><p>Nginx 用于实现防盗链功能的模块为 refer 模块,其依据的原理是: 如果网站盗用了你的图片，那么用户在点击或者查看这个盗链内容时，发送 http 请求的头部中的 referer 字段将为该盗版网站的 url。这样我们通过获取这个头部信息，知道 http 发起请求的页面，然后判断这个地址是否是我们的合法页面，不是则判断为盗链。</p><ul><li><p>语法</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> 域名<span class="number">1</span>[ 域名<span class="number">2</span>][ 域名...];</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>valid_referers 指令，它后面可以带上多个参数，表示多个 referer 头都是有效的。它的参数形式有:</p><ul><li>none: 允许缺失 referer 头部的请求访问。</li><li>blocked: 有 referer 这个字段，但是其值被防火墙或者是代理给删除了。</li><li>server_names: 若 referer 中的站点域名和 server_names 中的某个域名匹配，则允许访问。</li><li>任意字符或者正则表达式。</li></ul></li></ul></li><li><p>secure_link模块防盗 <a href="https://zhuanlan.zhihu.com/p/463197529">参考文献</a></p><p>前面这种简单检查 referer 头部值的防盗链方法过于脆弱，盗用者很容易通过伪造 referer 的值轻而易举跳过防盗措施。在 Nginx 中有一种更为高级的防盗方式，即基于 secure_link 模块，该模块能够检查请求链接的权限以及是否过期，多用于下载服务器防盗链。这个模块默认未编译进 Nginx，需要在源码编译时候使用 --with-secure_link_module 添加。</p><p>该模块的通过验证 URL 中的哈希值的方式防盗链。它的防盗过程如下：</p><ul><li><p>由服务器或者 Nginx 生成安全的加密后的 URL, 返回给客户端。</p></li><li><p>客户端使用安全的 URL 访问 Nginx，获取图片等资源，由 Nginx 的 secure_link 变量判断是否验证通过。</p></li><li><p>eg.</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~* .(gif|jpg|png|swf|flv|mp4)$</span>  &#123;</span><br><span class="line">    <span class="attribute">secure_link</span> <span class="variable">$arg_md5</span>,<span class="variable">$arg_expires</span>;</span><br><span class="line">    <span class="attribute">secure_link_md5</span> <span class="string">&quot;<span class="variable">$secure_link_expires</span><span class="variable">$uri</span><span class="variable">$remote_addr</span> secret&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 空字符串，校验不通过</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$secure_link</span> = <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 时间过期</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$secure_link</span> = <span class="string">&quot;0&quot;</span>) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">410</span> <span class="string">&quot;URL过期，请重新生成&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">root</span> /root/test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="11）高可用性">11）高可用性</h2><p><strong>Keepalived</strong></p><ul><li><p>概念</p><p>**“高可用性”（High Availability）通常来描述一个系统经过专门的设计，从而减少停工时间，而保持其服务的高度可用性。Nginx配合Keepalived可以实现高可用，实现双机热备+自动切换。**这种操作在现在的集群系统中，比较的常见，通过keepalived和redis实现热备份的；和mysql实现的，类似的案例挺多。</p></li><li><p>安装</p><ul><li><p>yum安装</p><ol><li><p>安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y keepalived</span><br></pre></td></tr></table></figure></li></ol></li><li><p>编译安装</p><ol><li><p>下载并上传到服务器：</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.keepalived.org%2Fdownload.html">https://www.keepalived.org/download.html</a></p></li><li><p>按实际版本解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tar -zxvf keepalived-2.0.18.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configure: error:</span><br><span class="line">!!! OpenSSL is not properly installed on your system. !!!</span><br><span class="line">!!! Can not include OpenSSL headers files. !!!</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install openssl-devel</span><br></pre></td></tr></table></figure></li><li><p>安装三部曲</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到解压的文件中</span></span><br><span class="line">[root@localhost ~]# ./configure</span><br><span class="line">[root@localhost ~]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p>eg. 主从模式</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/12b5b907846745f29ad5b466dc86b01a.png" alt="在这里插入图片描述"></p><blockquote><p>试验场景说明：</p><p>1）在两台服务器上分别安装 nginx 和 keepalived</p><p>2）本次主要配置 nginx 高可用(主从模式)，只考虑 nginx 存活及访问问题</p><p>3）实际访问时使用 keepalived 虚拟 IP进行访问</p></blockquote><ol><li><p>准备测试机器</p><table><thead><tr><th><strong>主机</strong></th><th><strong>ip</strong></th><th><strong>环境</strong></th></tr></thead><tbody><tr><td>Nginx01 (maste)</td><td>192.168.169.151</td><td>CentOS Linux release 7.9.2009 (Core)<br/>keepalived-1.3.5<br/>nginx/1.8.1</td></tr><tr><td>Nginx02 (backup)</td><td>192.168.169.152</td><td>CentOS Linux release 7.9.2009 (Core)<br/>keepalived-1.3.5<br/>nginx/1.8.1</td></tr><tr><td>web</td><td>192.168.169.150</td><td>tomcat</td></tr></tbody></table></li><li><p>两台机器上都安装keepalived</p></li><li><p>修改主机(master)配置文件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 Keepalived 配置文件，将原本的 keepalived.conf 文件备份，新建 keepalived.conf 文件加入如下内容</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/keepalived/keepalived.conf</span></span><br><span class="line"><span class="comment"># 注意：这个是 master(主机) 的配置文件</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived<span class="comment"># 这一行为注释</span></span><br><span class="line">global_defs &#123; </span><br><span class="line">router_id nginx01<span class="comment"># router_id 机器标识，通常使用 hostname，相对具有唯一性，和备机区分开，不能使用同一个标识</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;<span class="comment"># 定义一个检测脚本，在global_defs之外配置</span></span><br><span class="line">  script <span class="string">&quot;/etc/keepalived/check_nginx.sh&quot;</span><span class="comment"># 自己写的监测脚本</span></span><br><span class="line">  interval <span class="number">2</span><span class="comment"># 每2s监测一次</span></span><br><span class="line">  weight <span class="number">10</span><span class="comment"># 该参数用于指定当监测失效时，该设备的优先级会减少的值，该值为负表示减少</span></span><br><span class="line">  fall <span class="number">2</span>        <span class="comment"># 尝试两次都成功才成功</span></span><br><span class="line">  rise <span class="number">2</span>        <span class="comment"># 尝试两次都失败才失败</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;<span class="comment"># 定义一个vrrp_install实例，名称为VI_1</span></span><br><span class="line">state MASTER<span class="comment"># 表示该实例的角色状态，有MASTER和BACKUP两种主备状态</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ens33</span># 对外提供服务的网络接口，注意修改为自己的网卡名称，如 <span class="title">ens33</span>,<span class="title">eth0</span>,<span class="title">eth1</span></span></span><br><span class="line"><span class="class"><span class="title">virtual_router_id</span> 51# 虚拟路由<span class="title">ID</span>标识，主备服务器配置中相同实例的<span class="title">ID</span>必须一致</span></span><br><span class="line"><span class="class"><span class="title">priority</span> 150# <span class="title">priority</span>表示实例优先级，数字越大，优先级越高。<span class="title">master</span> 的优先级必须大于 <span class="title">backup</span></span></span><br><span class="line"><span class="class"><span class="title">advert_int</span> 1# 设定 <span class="title">master</span> 与 <span class="title">backup</span> 负载均衡器之间同步检查的时间间隔，默认是秒</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">authentication</span> </span>&#123;<span class="comment"># 权限认证配置</span></span><br><span class="line">auth_type PASS<span class="comment"># 主要有 PASS 和 AH 两种</span></span><br><span class="line">auth_pass <span class="number">1111</span><span class="comment"># 验证密码，同一个 vrrp_instance 下 MASTER 和 BACKUP 密码必须相同</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line"><span class="number">192.168</span>.<span class="number">169.200</span><span class="comment"># 虚拟IP地址；可以配置多个IP，每个IP占一行。注意，这里的IP就是在工作中访问 zabbix server 需要和域名绑定的ip</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">track_script &#123;<span class="comment"># 调用自定义的脚本</span></span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">notify_master /etc/keepalived/to_master.sh<span class="comment"># 指定当切换到 master 时，执行的脚本，即切换到 master 时要将 backup 的 server 关掉</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>主机切换脚本 <code>to_master.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/keepalived/to_master.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定当切换到 master 时，执行的脚本，即切换到 master 时要将 backup 的 server 关掉</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">sshpass -p 0 ssh -o StrictHostKeyChecking=no root@192.168.169.152 &quot;nginx -s stop&quot;</span><br><span class="line"></span><br><span class="line">nginx</span><br></pre></td></tr></table></figure></li></ul></li><li><p>备用机配置</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：这个是 master(备机) 的配置文件</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/keepalived/keepalived.conf</span></span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived<span class="comment"># 这一行为注释</span></span><br><span class="line">global_defs &#123; </span><br><span class="line">router_id nginx02<span class="comment"># router_id 机器标识，通常使用 hostname，相对具有唯一性，和主机区分开，不能使用同一个标识</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_script chk_nginx &#123;<span class="comment"># 定义一个检测脚本，在global_defs之外配置</span></span><br><span class="line">  script <span class="string">&quot;/etc/keepalived/check_nginx.sh&quot;</span><span class="comment"># 自己写的监测脚本</span></span><br><span class="line">  interval <span class="number">2</span><span class="comment"># 每2s监测一次</span></span><br><span class="line">  weight <span class="number">10</span><span class="comment"># 该参数用于指定当监测失效时，该设备的优先级会减少的值，该值为负表示减少</span></span><br><span class="line">  fall <span class="number">2</span>        <span class="comment"># 尝试两次都成功才成功</span></span><br><span class="line">  rise <span class="number">2</span>        <span class="comment"># 尝试两次都失败才失败</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;<span class="comment"># 定义一个vrrp_install实例，名称为VI_1</span></span><br><span class="line">state BACKUP<span class="comment"># 表示该实例的角色状态，有MASTER和BACKUP两种主备状态</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ens33</span># 对外提供服务的网络接口，注意修改为自己的网卡名称，如 <span class="title">ens33</span>,<span class="title">eth0</span>,<span class="title">eth1</span></span></span><br><span class="line"><span class="class"><span class="title">virtual_router_id</span> 51# 虚拟路由<span class="title">ID</span>标识，主备服务器配置中相同实例的<span class="title">ID</span>必须一致</span></span><br><span class="line"><span class="class"><span class="title">priority</span> 149# <span class="title">priority</span>表示实例优先级，数字越大，优先级越高。<span class="title">master</span> 的优先级必须大于 <span class="title">backup</span></span></span><br><span class="line"><span class="class"><span class="title">advert_int</span> 1# 设定 <span class="title">master</span> 与 <span class="title">backup</span> 负载均衡器之间同步检查的时间间隔，默认是秒</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">authentication</span> </span>&#123;<span class="comment"># 权限认证配置</span></span><br><span class="line">auth_type PASS<span class="comment"># 主要有 PASS 和 AH 两种</span></span><br><span class="line">auth_pass <span class="number">1111</span><span class="comment"># 验证密码，同一个 vrrp_instance 下 MASTER 和 BACKUP 密码必须相同</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_ipaddress &#123;</span><br><span class="line"><span class="number">192.168</span>.<span class="number">169.200</span><span class="comment"># 虚拟IP地址；可以配置多个IP，每个IP占一行。注意，这里的IP就是在工作中访问 zabbix server 需要和域名绑定的ip</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">track_script &#123;<span class="comment"># 调用自定义的脚本</span></span><br><span class="line">        chk_nginx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">notify_master /etc/keepalived/to_backup.sh<span class="comment"># 指定当切换到 backup 时，执行的脚本，切换到 backup 时将 master 的 server 关掉</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>备机切换脚本 <code>to_backup.sh</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/keepalived/to_backup.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定当切换到 backup 时，执行的脚本，切换到 backup 时将 master 的 server 关掉</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">sshpass -p 0 ssh -o StrictHostKeyChecking=no root@192.168.169.151 &quot;nginx -s stop&quot;</span><br><span class="line"></span><br><span class="line">nginx</span><br></pre></td></tr></table></figure></li></ul></li><li><p>服务器检查脚本（主从上都需添加）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/keepalived/chk_nginx.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span> </span><br><span class="line"></span><br><span class="line">A=`ps -C nginx --no-header |wc -l` </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断nginx是否宕机，如果宕机了，尝试重启</span> </span><br><span class="line">if [ $A -eq 0 ];then </span><br><span class="line">  /usr/local/nginx/sbin/nginx </span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">等待一小会再次检查nginx，如果没有启动成功，则停止keepalived，使其启动备用机</span> </span><br><span class="line">  sleep 3 </span><br><span class="line">  if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then </span><br><span class="line">    killall keepalived </span><br><span class="line">  fi </span><br><span class="line">fi</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加运行权限</span></span><br><span class="line">[root@localhost ~]# chmod +x /etc/keepalived/chk_nginx.sh</span><br></pre></td></tr></table></figure></li><li><p>服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart keepalived</span><br><span class="line">[root@localhost ~]# systemctl enable keepalived</span><br></pre></td></tr></table></figure></li><li><p>修改主备 nginx 配置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"><span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line"><span class="attribute">server_name</span>  <span class="number">192.168.169.200</span>;<span class="comment"># 这里是使用虚拟 IP 访问</span></span><br><span class="line"></span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span>  http://192.168.169.150:8080;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ul><h2 id="12）Https-证书配置">12）Https 证书配置</h2><ul><li><p>概念</p><p>SSL 证书，也称为 SSL 服务器证书，是遵守 SSL 协议的一种数字证书，由全球信任的证书颁发机构 (CA) 验证服务器身份后颁发，将 SSL 证书安装在网站服务器上，会激活挂锁和 https 协议。SSL 证书解决了网民登录网站的信任问题，网民可以通过 SSL 证书轻松识别网站的是否受到保护、是否安全的。</p></li><li><p>配置</p><ol><li><p>申请、下载证书</p><p>（申请略）</p><p>下载后的证书包含：</p><ul><li>pem：证书文件。PEM文件的扩展名为CRT格式。</li><li>key：证书的密钥文件。申请证书时如果未选择自动创建CRS，则下载的证书文件压缩包中不会包含.key文件，需要您将自己手动常见的私钥文件拷贝到cert目录下。</li></ul></li><li><p>上传证书到ssl目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd usr/local/nginx/conf</span><br><span class="line">[root@localhost ~]# mkdir cert</span><br></pre></td></tr></table></figure></li><li><p>更改nginx.conf设置</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="attribute">localhost</span> ~]<span class="comment"># vi nginx.conf</span></span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost; <span class="comment">#localhost修改为证书绑定的域名</span></span><br><span class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> https://<span class="variable">$&#123;server_name&#125;</span><span class="variable">$1</span> <span class="literal">permanent</span>; <span class="comment">#设置http自动转发https</span></span><br><span class="line">&#125;</span><br><span class="line">server&#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;<span class="comment">#设置SSL功能</span></span><br><span class="line">    <span class="attribute">server_name</span> localhost;  <span class="comment">#localhost修改为证书绑定的域名</span></span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> cert/xxxx.pem;   <span class="comment">#证书的文件名</span></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> cert/domain name.key;   <span class="comment">#证书的密钥文件名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl restart nginx</span><br></pre></td></tr></table></figure></li></ol></li></ul><p>p51 <a href="https://www.bilibili.com/video/BV1yS4y1N76R?p=51&amp;vd_source=dbe149b93870e38dfa3d70bb07d82b6e">https://www.bilibili.com/video/BV1yS4y1N76R?p=51&amp;vd_source=dbe149b93870e38dfa3d70bb07d82b6e</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Redis 学习笔记</title>
      <link href="/posts/fa17c65a.html"/>
      <url>/posts/fa17c65a.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="Redis">Redis</h1><h2 id="一、Redis-入门">一、Redis 入门</h2><p>redis是一个key-value存储系统（键值数据库）。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set --有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。</p><h3 id="1-认识NoSQL">1.认识NoSQL</h3><h4 id="1-1-什么是NoSQL">1.1 什么是NoSQL</h4><ul><li>NoSQL最常见的解释是&quot;<code>non-relational</code>&quot;， 很多人也说它是&quot;<em><strong>Not Only SQL</strong></em>&quot;</li><li>NoSQL仅仅是一个概念，泛指<strong>非关系型的数据库</strong></li><li>区别于关系数据库，它们不保证关系数据的ACID特性</li><li>NoSQL是一项全新的数据库革命性运动，提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入</li><li>常见的NoSQL数据库有：<code>Redis</code>、<code>MemCache</code>、<code>MongoDB</code>等</li></ul><h4 id="1-2-NoSQL与SQL-的差异">1.2 NoSQL与SQL 的差异</h4><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230122163012631.png" alt="image-20230122163012631"></p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">SQL</th><th style="text-align:center">NoSQL</th></tr></thead><tbody><tr><td style="text-align:center">数据结构</td><td style="text-align:center">结构化</td><td style="text-align:center">非结构化</td></tr><tr><td style="text-align:center">数据关联</td><td style="text-align:center">关联的</td><td style="text-align:center">无关联的</td></tr><tr><td style="text-align:center">查询方式</td><td style="text-align:center">SQL查询</td><td style="text-align:center">非SQL</td></tr><tr><td style="text-align:center">事务特性</td><td style="text-align:center">ACID</td><td style="text-align:center">BASE</td></tr><tr><td style="text-align:center">存储方式</td><td style="text-align:center">磁盘</td><td style="text-align:center">内存</td></tr><tr><td style="text-align:center">扩展性</td><td style="text-align:center">垂直</td><td style="text-align:center">水平</td></tr><tr><td style="text-align:center">使用场景</td><td style="text-align:center">1）数据结构固定 <br />2）相关业务对数据安全性、一致性要求较高</td><td style="text-align:center">1）数据结构不固定 <br />2）对一致性、安全性要求不高 <br />3）对性能要求</td></tr></tbody></table><h3 id="2-认识Redis">2.认识Redis</h3><blockquote><p>Redis诞生于2009年全称是Remote Dictionary Server，远程词典服务器，是一个基于内存的键值型NoSQL数据库。</p></blockquote><p><strong>Redis 的特征：</strong></p><ul><li>键值（<code>key-value</code>）型，value支持多种不同数据结构，功能丰富</li><li>单线程，每个命令具备原子性</li><li>低延迟，速度快（基于内存、IO多路复用、良好的编码）。</li><li>支持数据持久化</li><li>支持主从集群、分片集群</li><li>支持多语言客户端</li></ul><h3 id="3-安装Redis">3.安装Redis</h3><h4 id="3-1-前置准备">3.1 前置准备</h4><blockquote><p>本次安装Redis是基于Linux系统下安装的，因此需要一台Linux服务器或者虚拟机。</p><p>请提前开放<code>6379</code>端口，避免后续出现的莫名其妙的错误！</p></blockquote><p>官网 <a href="https://redis.io/">https://redis.io/</a></p><h4 id="3-2-安装Redis依赖">3.2 安装Redis依赖</h4><p>Redis是基于C语言编写的，因此首先需要安装Redis所需要的gcc依赖</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc tcl</span><br></pre></td></tr></table></figure><h4 id="3-3-安装Redis">3.3 安装Redis</h4><p>把<code>redis-6.2.6.tar.gz</code>压缩包放入<code>/usr/local/</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/</span><br><span class="line">tar -zxvf redis-6.2.6.tar.gz</span><br><span class="line"><span class="built_in">cd</span> redis-6.2.6</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>(小知识:<code>make PREFIX=/usr/local/redis-6.2.6/bin install</code>.这里多了一个关键字 <strong><code>PREFIX=</code></strong> 这个关键字的作用是编译的时候用于指定程序存放的路径，假设不添加该关键字Linux会将可执行文件存放在/usr/local/bin目录。)</p><p><strong>安装成功后打开/usr/local/bin目录（该目录为Redis默认的安装目录）</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]<span class="comment"># cd /usr/local/bin</span></span><br><span class="line">[root@loaclhost bin]<span class="comment"># ls</span></span><br><span class="line">redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server</span><br></pre></td></tr></table></figure><p>该目录已经默认配置到环境变量，因此可以在任意目录下运行Redis命令</p><h3 id="4-配置Redis">4.配置Redis</h3><p><strong>备份并格式化配置文件：</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis配置简化</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cp /usr/local/redis-6.2.6/redis.conf /usr/local/redis-6.2.6/redis.conf.bak</span></span><br><span class="line">[root@localhost ~]<span class="comment"># sed  -i  &#x27;/^#/d; /^$/d&#x27; /usr/local/redis-6.2.6/redis.conf      #把配置文件中#和空格删除掉</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /mydata/redis</span></span><br></pre></td></tr></table></figure><p><strong>Redis配置更改：</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /usr/local/redis-6.2.6/redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0<span class="comment"># 允许访问的地址，默认是127.0.0.1，会导致只能在本地访问。修改为0.0.0.0则可以在任意IP访问。生产环境,尽量不要监听所有网卡ip(0.0.0.0)</span></span><br><span class="line">port 6379<span class="comment"># 监听的端口</span></span><br><span class="line"><span class="built_in">dir</span> /mydata/redis<span class="comment"># 工作目录，默认是当前目录，也就是运行redis-server时的命令，日志、持久化等文件会保存在这个目录</span></span><br><span class="line">pidfile <span class="string">&quot;redis.pid&quot;</span></span><br><span class="line">logfile <span class="string">&quot;redis.log&quot;</span><span class="comment"># 日志文件，默认为空，不记录日志，可以指定日志文件名</span></span><br><span class="line">daemonize <span class="built_in">yes</span><span class="comment"># 守护进程，修改为yes后即可后台运行 </span></span><br><span class="line">databases 16<span class="comment"># 数据库数量，设置为1，代表只使用1个库，默认有16个库，编号0~15</span></span><br><span class="line"><span class="comment">#maxmemory 512mb# 设置redis能够使用的最大内存</span></span><br><span class="line">requirepass 000588<span class="comment"># 密码，设置后访问Redis必须输入密码</span></span><br></pre></td></tr></table></figure><p>Redis启动的系统参数调整:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调整最大文件打开数（文件句柄)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/security/limits.conf</span></span><br><span class="line">* - nofile 65535        退出终端重新登录生效</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内核参数修改</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line">net.core.somaxconn = 10240          <span class="comment">#调大somaxconn参数</span></span><br><span class="line">vm.overcommit_memory = 1           <span class="comment">#这个如果没修改，可能会引起redis的数据丢失，参数很重要</span></span><br><span class="line"><span class="comment"># 然后运行sysctl -p 刷新生效</span></span><br></pre></td></tr></table></figure><h3 id="5-启动Redis">5.启动Redis</h3><h4 id="5-1前台启动（不推荐）">5.1前台启动（不推荐）</h4><blockquote><p><strong>这种启动属于前台启动，会阻塞整个会话窗口，窗口关闭或者按下<code>CTRL + C</code>则Redis停止。不推荐使用。</strong></p></blockquote><p><strong>安装完成后，在任意目录输入<code>redis-server</code>命令即可启动Redis</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20220524191137983.png" alt="image-20220524191137983"></p><h4 id="5-2后台启动（不推荐）">5.2后台启动（不推荐）</h4><blockquote><p><strong>如果要让Redis以后台方式启动，则必须修改Redis配置文件，配置文件所在目录就是之前我们解压的安装包下</strong></p></blockquote><ul><li><p><strong>启动Redis</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于配置文件启动</span></span><br><span class="line">redis-server /usr/local/redis-6.2.6/redis.conf</span><br></pre></td></tr></table></figure></li><li><p><strong>停止Redis服务</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br><span class="line"><span class="comment"># 通过kill命令直接杀死进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 redis进程<span class="built_in">id</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用redis-cli来执行 shutdown 命令，即可停止 Redis 服务，</span></span><br><span class="line"><span class="comment"># 因为之前配置了密码，因此需要通过 -a 来指定密码</span></span><br><span class="line">redis-cli -a 132537 shutdown</span><br></pre></td></tr></table></figure></li></ul><h4 id="5-3开机自启（推荐）">5.3开机自启（推荐）</h4><ul><li><p><strong>新建一个系统服务文件</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/systemd/system/redis.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/redis-server /usr/local/redis-6.2.6/redis.conf</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li><li><p><strong>重载系统服务</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></li><li><p><strong>服务命令</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> redis</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">systemctl start redis</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">systemctl stop redis</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">systemctl restart redis</span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure></li></ul><h2 id="二、Redis-客户端">二、Redis 客户端</h2><h3 id="1-命令行客户端">1.命令行客户端</h3><ul><li><strong>Redis安装完成后就自带了命令行客户端：<code>redis-cli</code>，使用方式如下：</strong></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [options] [commonds]</span><br></pre></td></tr></table></figure><p><strong>其中常见的<code>options</code>有：</strong></p><ul><li><code>-h 127.0.0.1</code>：指定要连接的redis节点的IP地址，默认是127.0.0.1</li><li><code>-p 6379</code>：指定要连接的redis节点的端口，默认是6379</li><li><code>-a 000588</code>：指定redis的访问密码（如何未指定-a可以交互时使用<code>auth 000588</code>）</li></ul><p><strong>其中的<code>commonds</code>就是Redis的操作命令，例如：</strong></p><ul><li><code>ping</code>：与redis服务端做心跳测试，服务端正常会返回<code>pong</code></li></ul><p>不指定commond时，会进入<code>redis-cli</code>的交互控制台：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20220524201258092.png" alt="image-20220524201258092"></p><h3 id="2-图形化客户端">2.图形化客户端</h3><p><a href="https://github.com/qishibo/AnotherRedisDesktopManager">AnotherRedisDesktopManager</a></p><h2 id="三、Redis-常见命令">三、Redis 常见命令</h2><p><a href="http://www.redis.cn/commands.html">Redis的中文文档</a>  <a href="https://www.runoob.com/redis/redis-keys.html">菜鸟教程官网</a></p><h3 id="1-Redis数据结构介绍">1.Redis数据结构介绍</h3><p><strong>Redis是一个key-value的数据库，key一般是String类型，不过value的类型多种多样</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20220524205926164.png" alt="image-20220524205926164"></p><h3 id="2-通用命令">2.通用命令</h3><p><strong>通用指令是部分数据类型的，都可以使用的指令，常见的有如下表格所示</strong></p><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">KEYS</td><td style="text-align:center">查看符合模板的所有key，不建议在生产环境设备上使用</td></tr><tr><td style="text-align:center">DEL</td><td style="text-align:center">删除一个指定的key</td></tr><tr><td style="text-align:center">EXISTS</td><td style="text-align:center">判断key是否存在</td></tr><tr><td style="text-align:center">EXPIRE</td><td style="text-align:center">给一个key设置有效期，有效期到期时该key会被自动删除</td></tr><tr><td style="text-align:center">TTL</td><td style="text-align:center">查看一个KEY的剩余有效期</td></tr></tbody></table><p><strong>可以通过<code>help [command] </code>查看命令的具体用法</strong></p><h3 id="3-String类型">3.String类型</h3><p><strong>String类型，也就是字符串类型，是Redis中最简单的存储类型。</strong></p><p>其value是字符串，不过根据字符串的格式不同，又可以分为3类：</p><ul><li><code>string</code>：普通字符串</li><li><code>int</code>：整数类型，可以做自增、自减操作</li><li><code>float</code>：浮点类型，可以做自增、自减操作</li></ul><p>不管是哪种格式，底层都是字节数组形式存储，只不过是编码方式不同。字符串类型的最大空间不能超过<strong>512m</strong>.</p><ul><li><p><strong>String的常见命令有如下表格所示</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">SET</td><td style="text-align:center">添加或者修改已经存在的一个String类型的键值对</td></tr><tr><td style="text-align:center">GET</td><td style="text-align:center">根据key获取String类型的value</td></tr><tr><td style="text-align:center">MSET</td><td style="text-align:center">批量添加多个String类型的键值对</td></tr><tr><td style="text-align:center">MGET</td><td style="text-align:center">根据多个key获取多个String类型的value</td></tr><tr><td style="text-align:center">INCR</td><td style="text-align:center">让一个整型的key自增1</td></tr><tr><td style="text-align:center">INCRBY</td><td style="text-align:center">让一个整型的key自增并指定步长，例如：incrby num 2 让num值自增2</td></tr><tr><td style="text-align:center">INCRBYFLOAT</td><td style="text-align:center">让一个浮点类型的数字自增并指定步长</td></tr><tr><td style="text-align:center">SETNX</td><td style="text-align:center">添加一个String类型的键值对，前提是这个key不存在，否则不执行</td></tr><tr><td style="text-align:center"><strong>SETEX</strong></td><td style="text-align:center">添加一个String类型的键值对，并且指定有效期</td></tr></tbody></table></li><li><p><strong>key的结构</strong></p><p><strong>Redis的key允许有多个单词形成层级结构，多个单词之间用” ：“隔开，格式如下：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">项目名:业务名:类型:id</span><br></pre></td></tr></table></figure><p>这个格式并非固定，也可以根据自己的需求来删除或添加词条。</p><p>例如我们的项目名称叫 <code>niurou</code>，有<code>user</code>和<code>product</code>两种不同类型的数据，我们可以这样定义key：</p><ul><li><strong>user</strong>相关的key：<code>niurou:user:1</code></li><li><strong>product</strong>相关的key：<code>niurou:product:1</code></li></ul><p>如果Value是一个Java对象，例如一个User对象，则可以将对象序列化为JSON字符串后存储</p><table><thead><tr><th style="text-align:center">KEY</th><th style="text-align:center">VALUE</th></tr></thead><tbody><tr><td style="text-align:center">niurou:user:1</td><td style="text-align:center">{“id”:1, “name”: “Jack”, “age”: 21}</td></tr><tr><td style="text-align:center">niurou:product:1</td><td style="text-align:center">{“id”:1, “name”: “小米11”, “price”: 4999}</td></tr></tbody></table></li></ul><p>​<img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230123013931744.png" alt="image-20230123013931744"></p><h3 id="4-Hash类型">4.Hash类型</h3><p><strong>Hash类型，也叫散列，其value是一个无序字典，类似于Java中的<code>HashMap</code>结构。</strong></p><ul><li><p><strong>Hash结构可以将对象中的每个字段独立存储，可以针对单个字段做CRUD</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230123012220605.png" alt="image-20230123012220605"></p></li><li><p><strong>Hash的常见命令有：</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">HSET key field value</td><td style="text-align:center">添加或者修改hash类型key的field的值</td></tr><tr><td style="text-align:center">HGET key field</td><td style="text-align:center">获取一个hash类型key的field的值</td></tr><tr><td style="text-align:center">HMSET</td><td style="text-align:center">hmset 和 hset 效果相同 ，4.0之后hmset可以弃用了</td></tr><tr><td style="text-align:center">HMGET</td><td style="text-align:center">批量获取多个hash类型key的field的值</td></tr><tr><td style="text-align:center">HGETALL</td><td style="text-align:center">获取一个hash类型的key中的所有的field和value</td></tr><tr><td style="text-align:center">HKEYS</td><td style="text-align:center">获取一个hash类型的key中的所有的field</td></tr><tr><td style="text-align:center">HVALS</td><td style="text-align:center">获取一个hash类型的key中的所有的value</td></tr><tr><td style="text-align:center">HINCRBY</td><td style="text-align:center">让一个hash类型key的字段值自增并指定步长</td></tr><tr><td style="text-align:center">HSETNX</td><td style="text-align:center">添加一个hash类型的key的field值，前提是这个field不存在，否则不执行</td></tr></tbody></table><p>hset 命令:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; hset niurou:user:3 age 21</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><p>图形化界面：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230123014206566.png" alt="image-20230123014206566"></p></li></ul><h3 id="5-List类型">5.List类型</h3><p><strong>Redis中的List类型与Java中的LinkedList类似，可以看做是一个双向链表结构。既可以支持正向检索和也可以支持反向检索。</strong></p><p><strong>特征也与<code>LinkedList</code>类似：</strong></p><ul><li>有序</li><li>元素可以重复</li><li>插入和删除快</li><li>查询速度一般</li></ul><p>常用来存储一个有序数据，例如：朋友圈点赞列表，评论列表等。</p><p><strong>List的常见命令有:</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">LPUSH key element …</td><td style="text-align:center">向列表左侧插入一个或多个元素</td></tr><tr><td style="text-align:center">LPOP key</td><td style="text-align:center">移除并返回列表左侧的第一个元素，没有则返回nil</td></tr><tr><td style="text-align:center"><strong>RPUSH key element …</strong></td><td style="text-align:center">向列表右侧插入一个或多个元素</td></tr><tr><td style="text-align:center">RPOP key</td><td style="text-align:center">移除并返回列表右侧的第一个元素</td></tr><tr><td style="text-align:center">LRANGE key star end</td><td style="text-align:center">返回一段角标范围内的所有元素</td></tr><tr><td style="text-align:center">BLPOP和BRPOP</td><td style="text-align:center">与LPOP和RPOP类似，只不过在没有元素时等待指定时间，而不是直接返回nil</td></tr></tbody></table><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/new.gif" alt="new"></p><p><strong>思考：</strong></p><ul><li><strong>如何利用List结构模拟一个栈?</strong><ul><li>先进后出，入口和出口在同一边</li></ul></li><li><strong>如何利用List结构模拟一个队列?</strong><ul><li>先进先出，入口和出口在不同边</li></ul></li><li><strong>如何利用List结构模拟一个阻塞队列?</strong><ul><li>入口和出口在不同边</li><li>出队时采用BLPOP或BRPOP</li></ul></li></ul><h3 id="6-Set类型">6.Set类型</h3><p><strong>Redis的Set结构与Java中的HashSet类似，可以看做是一个value为null的HashMap。因为也是一个hash表，</strong></p><p><strong>因此具备与HashSet类似的特征：</strong></p><ul><li><p>无序</p></li><li><p>元素不可重复</p></li><li><p>查找快</p></li><li><p>支持交集、并集、差集等功能</p></li></ul><p><strong>Set的常见命令有：</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">SADD key member …</td><td style="text-align:center">向set中添加一个或多个元素</td></tr><tr><td style="text-align:center">SREM key member …</td><td style="text-align:center">移除set中的指定元素</td></tr><tr><td style="text-align:center">SCARD key</td><td style="text-align:center">返回set中元素的个数</td></tr><tr><td style="text-align:center">SISMEMBER key member</td><td style="text-align:center">判断一个元素是否存在于set中</td></tr><tr><td style="text-align:center">SMEMBERS</td><td style="text-align:center">获取set中的所有元素</td></tr><tr><td style="text-align:center">SINTER key1 key2 …</td><td style="text-align:center">求key1与key2的交集</td></tr><tr><td style="text-align:center">SDIFF key1 key2 …</td><td style="text-align:center">求key1与key2的差集</td></tr><tr><td style="text-align:center">SUNION key1 key2 …</td><td style="text-align:center">求key1和key2的并集</td></tr></tbody></table><p><strong>交集、差集、并集图示</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20220525112632214.png" alt="image-20220525112632214"></p><h3 id="7-SortedSet类型">7.SortedSet类型</h3><p><strong>Redis的SortedSet是一个可排序的set集合，与Java中的TreeSet有些类似，但底层数据结构却差别很大。SortedSet中的每一个元素都带有一个score属性，可以基于score属性对元素排序，底层的实现是一个跳表（SkipList）加 hash表。</strong></p><p><strong>SortedSet具备下列特性：</strong></p><ul><li>可排序</li><li>元素不重复</li><li>查询速度快</li></ul><p>因为SortedSet的可排序特性，经常被用来实现排行榜这样的功能。</p><p><strong>SortedSet的常见命令有：</strong></p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">ZADD key score member</td><td style="text-align:center">添加一个或多个元素到sorted set ，如果已经存在则更新其score值</td></tr><tr><td style="text-align:center">ZREM key member</td><td style="text-align:center">删除sorted set中的一个指定元素</td></tr><tr><td style="text-align:center">ZSCORE key member</td><td style="text-align:center">获取sorted set中的指定元素的score值</td></tr><tr><td style="text-align:center">ZRANK key member</td><td style="text-align:center">获取sorted set 中的指定元素的排名</td></tr><tr><td style="text-align:center">ZCARD key</td><td style="text-align:center">获取sorted set中的元素个数</td></tr><tr><td style="text-align:center">ZCOUNT key min max</td><td style="text-align:center">统计score值在给定范围内的所有元素的个数</td></tr><tr><td style="text-align:center">ZINCRBY key increment member</td><td style="text-align:center">让sorted set中的指定元素自增，步长为指定的increment值</td></tr><tr><td style="text-align:center">ZRANGE key min max</td><td style="text-align:center">按照score排序后，获取指定排名范围内的元素</td></tr><tr><td style="text-align:center">ZRANGEBYSCORE key min max</td><td style="text-align:center">按照score排序后，获取指定score范围内的元素</td></tr><tr><td style="text-align:center">ZDIFF、ZINTER、ZUNION</td><td style="text-align:center">求差集、交集、并集</td></tr></tbody></table><p><strong>注意：所有的排名默认都是升序，如果要降序则在命令的Z后面添加<code>REV</code>即可</strong></p><h2 id="四、切换数据库">四、切换数据库</h2><p>redis有16个数据库(0-15)，默认使用第一个<code>数据库 0</code>，不同的数据库可以存不同数据。</p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">select 编号</td><td style="text-align:center">使用第三个数据库</td></tr><tr><td style="text-align:center">dbsize</td><td style="text-align:center">查看数据库大小</td></tr><tr><td style="text-align:center">flushdb</td><td style="text-align:center">清除当前数据库</td></tr><tr><td style="text-align:center">flushall</td><td style="text-align:center">清除全部数据库</td></tr></tbody></table><h2 id="五、Redis-运维">五、Redis 运维</h2><h3 id="1-Redis端口与进程">1.Redis端口与进程</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># netstat -anput |grep 6379</span></span><br><span class="line">tcp        0      0 0.0.0.0:6379            0.0.0.0:*               LISTEN      17820/redis-server  </span><br><span class="line">[root@localhost ~]<span class="comment"># ps -ef |grep redis</span></span><br><span class="line">root      17820      1  0 12:17 ?        00:00:00 /usr/local/bin/redis-server 0.0.0.0:6379</span><br></pre></td></tr></table></figure><h3 id="2-Redis日志">2.Redis日志</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># tail -f /mydata/redis/redis.log </span></span><br><span class="line">17820:C 08 Nov 2022 12:17:25.366 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">17820:C 08 Nov 2022 12:17:25.366 <span class="comment"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=17820, just started</span></span><br><span class="line">17820:C 08 Nov 2022 12:17:25.366 <span class="comment"># Configuration loaded</span></span><br><span class="line">17820:M 08 Nov 2022 12:17:25.367 * Increased maximum number of open files to 10032 (it was originally <span class="built_in">set</span> to 1024).</span><br><span class="line">17820:M 08 Nov 2022 12:17:25.367 * monotonic clock: POSIX clock_gettime</span><br><span class="line">17820:M 08 Nov 2022 12:17:25.368 * Running mode=standalone, port=6379.</span><br><span class="line">17820:M 08 Nov 2022 12:17:25.368 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">17820:M 08 Nov 2022 12:17:25.368 <span class="comment"># Server initialized</span></span><br><span class="line">17820:M 08 Nov 2022 12:17:25.368 <span class="comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then reboot or run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span></span><br><span class="line">17820:M 08 Nov 2022 12:17:25.368 * Ready to accept connections</span><br></pre></td></tr></table></figure><h3 id="3-查看key">3.查看key</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;RANDOMKEY<span class="comment">#随机获取一个key</span></span><br><span class="line">&gt;KEYS *<span class="comment">#查看所有key，注意阻塞,如果key量特别大时候，容易卡死阻塞，上千万上百万时候容易阻塞</span></span><br><span class="line">&gt;SCAN 0<span class="comment">#建议使用,每次获取11个key，可以循环获取，直到获取所有key。从编号0开始，中间会有一个编号提示（类似索引编号),按编号提示依次循环获取，直到编号为0即表示获取完所有的key</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用Shell批量写入数据并获取</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> -w 50);<span class="keyword">do</span> redis-cli -a 000588 <span class="built_in">set</span> name<span class="variable">$&#123;i&#125;</span> <span class="built_in">test</span><span class="variable">$&#123;i&#125;</span>; redis-cli -a redispwd get name<span class="variable">$&#123;i&#125;</span>; <span class="keyword">done</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><h3 id="4-监控命令">4.监控命令</h3><h4 id="1-监控Redis状态">1.<strong>监控Redis状态</strong></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># redis-cli -a redispwd --stat</span></span><br><span class="line">------- data ------ --------------------- load -------------------- - child -</span><br><span class="line">keys       mem      clients blocked requests            connections          </span><br><span class="line">5          875.34K  2       0       2690 (+0)           55          </span><br><span class="line">5          875.34K  2       0       2691 (+1)           55  </span><br><span class="line"><span class="comment">#显示多少个key(是把所有数据库的key都加起来)  内存占用多少   客户端有多少   redis的requests请求数是多少   connections是多少连接</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># redis-cli -a redispwd monitor                                 #监控数据操作</span></span><br><span class="line"><span class="comment">#交互式阻塞状态，当有对数据进行操作时候会记录</span></span><br><span class="line"><span class="comment">#操作的命令，增加，删除数据等都会监控到</span></span><br></pre></td></tr></table></figure><h4 id="2-监控数据操作">2.<strong>监控数据操作</strong></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># redis-cli -a redispwd monitor</span></span><br><span class="line"><span class="comment">#交互式阻塞状态，当有对数据进行操作时候会记录</span></span><br><span class="line"><span class="comment">#操作的命令，增加，删除数据等都会监控到</span></span><br></pre></td></tr></table></figure><h4 id="3-监控系统可通过info获取数据">3.<strong>监控系统可通过info获取数据</strong></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># redis-cli -a redispwd info</span></span><br><span class="line"><span class="comment"># Server    ＃Redis 服务器的信息</span></span><br><span class="line">redis_version:2.8.13    ＃redis版本</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:ba7e0c54ae404843</span><br><span class="line">redis_mode:standalone   ＃redis运行模式</span><br><span class="line">os:Linux 2.6.32-504.16.2.el6.x86_64 x86_64  ＃操作系统版本</span><br><span class="line">arch_bits:64    ＃操作系统架构</span><br><span class="line">multiplexing_api:epoll  ＃Redis 所使用的事件处理机制</span><br><span class="line">gcc_version:4.4.7   ＃gcc版本</span><br><span class="line">process_id:5221     ＃当前运行进程ID</span><br><span class="line">run_id:62765912921734d0b192e4c7dec5bdeb92cf5af7 ＃ Redis 服务器的随机标识符（用于 Sentinel 和集群）</span><br><span class="line">tcp_port:6382       ＃当前监听端口</span><br><span class="line">uptime_in_seconds:267366    ＃运行时间，单位是秒</span><br><span class="line">uptime_in_days:3            ＃运行时间，单位是天</span><br><span class="line">hz:10</span><br><span class="line">lru_clock:12856621  ＃以分钟为单位进行自增的时钟，用于 LRU 管理</span><br><span class="line">config_file:/opt/codis/gopath/src/github.com/wandoulabs/codis/sample/./redis_conf/6382.conf ＃使用的配置文件的绝对路径</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clients   ＃记录了已连接客户端的信息</span></span><br><span class="line">connected_clients:3     ＃已经连接的客户端数量，只包括直接连接的客户端，不包括连接到从节点的客户端</span><br><span class="line">client_longest_output_list:0    ＃ 当前连接的客户端当中，最长的输出列表</span><br><span class="line">client_biggest_input_buf:0      ＃ 当前连接的客户端当中，最大输入缓存</span><br><span class="line">blocked_clients:0               ＃ 正在等待阻塞命令（BLPOP、BRPOP、BRPOPLPUSH）的客户端的数量</span><br><span class="line"></span><br><span class="line"><span class="comment"># Memory                    ＃记录了服务器的内存信息</span></span><br><span class="line">used_memory:20195844128     ＃当前redis已经分配的内存数量，单位byte</span><br><span class="line">used_memory_human:18.81G    ＃当前redis已经分配的内存数量，常用方便读取的单位</span><br><span class="line">used_memory_rss:20550877184 ＃从操作系统的角度，返回 Redis 已分配的内存总量（俗称常驻集大小）。这个值和 top 、 ps 等命令的输出一致。</span><br><span class="line">used_memory_peak:21053144288    <span class="comment">#内存使用峰值</span></span><br><span class="line">used_memory_peak_human:19.61G   ＃内存使用峰值的友好读取数量</span><br><span class="line">used_memory_lua:33792           ＃Lua 引擎所使用的内存大小，单位byte</span><br><span class="line">mem_fragmentation_ratio:1.02    <span class="comment"># used_memory_rss 和 used_memory 之间的比率,即20550877184／20195844128=1.0175795106约为1.02。这个比值比1高一点点比较理想，比值太高说明有大量碎片，小于1时说明部分redis内存已经被操作系统交换到swap了，可能会影响响应时间。</span></span><br><span class="line">//当 Redis 释放内存时，分配器可能会，也可能不会，将内存返还给操作系统。如果 Redis 释放了内存，却没有将内存返还给操作系统，那么 used_memory 的值可能和操作系统显示的 Redis 内存占用并不一致。查看 used_memory_peak 的值可以验证这种情况是否发生。</span><br><span class="line">mem_allocator:jemalloc-3.6.0    ＃在编译时指定的， Redis 所使用的内存分配器。可以是 libc 、 jemalloc 或者 tcmalloc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistence               ＃ RDB 持久化和 AOF 持久化有关的信息</span></span><br><span class="line">loading:0                   ＃ 一个标志值，记录了服务器是否正在载入持久化文件</span><br><span class="line">rdb_changes_since_last_save:13652713    ＃最后一次持久化到现在的时间，单位秒</span><br><span class="line">rdb_bgsave_in_progress:0    ＃一个标志值，表示是否正在创建RDB文件</span><br><span class="line">rdb_last_save_time:1455590116   ＃最后一次创建RDB文件的UNIX时间戳，可以使用data -d @1455590116查看具体时间，如[t@bjb0541 ~]$ <span class="built_in">date</span> -d @1455590116   Tue Feb 16 10:35:16 CST 2016</span><br><span class="line">rdb_last_bgsave_status:ok       ＃最近一次创建RDB成功还是失败</span><br><span class="line">rdb_last_bgsave_time_sec:202    ＃最近一次创建RDB的耗时，单位秒</span><br><span class="line">rdb_current_bgsave_time_sec:-1  ＃如果服务器当前正在写入RDB，这个时间就是已经操作耗费的时间。</span><br><span class="line">aof_enabled:0                   ＃是否启用了aof</span><br><span class="line">aof_rewrite_in_progress:0       <span class="comment">#一个标记，当前是否正在创建AOF</span></span><br><span class="line">aof_rewrite_scheduled:0         ＃一个标志值，记录了在 RDB 文件创建完毕之后，是否需要执行预约的 AOF 重写操作。</span><br><span class="line">aof_last_rewrite_time_sec:-1    ＃最近一次AOF的耗费的时间</span><br><span class="line">aof_current_rewrite_time_sec:-1 ＃如果当前正在写AOF，已经操作的时候值</span><br><span class="line">aof_last_bgrewrite_status:ok    ＃最近一次AOF后台的成功或失败</span><br><span class="line">aof_last_write_status:ok        ＃最近一次的AOF的成功或失败</span><br><span class="line"></span><br><span class="line"><span class="comment"># Stats                     ＃状态</span></span><br><span class="line">total_connections_received:88378    ＃已经接收的请求数</span><br><span class="line">total_commands_processed:35467619   ＃已经执行的命令数</span><br><span class="line">instantaneous_ops_per_sec:165       ＃每秒执行的操作数</span><br><span class="line">rejected_connections:0              ＃因为最大客户端数量限制而被拒绝的连接请求数量</span><br><span class="line">sync_full:5                         ＃完全同步次数（我猜测的）</span><br><span class="line">sync_partial_ok:0                   </span><br><span class="line">sync_partial_err:0</span><br><span class="line">expired_keys:120                    ＃因为过期而被删除的键数</span><br><span class="line">evicted_keys:0                      ＃因为最大内存容量限制而被驱逐（evict）的键数量</span><br><span class="line">keyspace_hits:15287495              ＃查找命中的次数</span><br><span class="line">keyspace_misses:0                   ＃查找失败的次数</span><br><span class="line">pubsub_channels:0                   ＃订阅的频道数</span><br><span class="line">pubsub_patterns:0                   ＃订阅的模式数</span><br><span class="line">latest_fork_usec:23562              ＃最近一次FOCK所用的时间</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication                   ＃主从复制信息</span></span><br><span class="line">role:slave                      ＃主机角色</span><br><span class="line">master_host:192.168.171.139     ＃主服务器IP</span><br><span class="line">master_port:6381                ＃主服务器端口</span><br><span class="line">master_link_status:up           ＃主服务器状态，UP正常，DOWN已经断开</span><br><span class="line">master_last_io_seconds_ago:0    ＃距离最近一次与主服务器进行通信已经过去了多少秒。</span><br><span class="line">master_sync_in_progress:0       ＃标记值，表示当前是否正在进行主从复制。</span><br><span class="line">slave_repl_offset:83184763601   </span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0              ＃已连接的从服务器数量</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:281559737</span><br><span class="line">repl_backlog_histlen:1048576</span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU                           ＃CPU信息</span></span><br><span class="line">used_cpu_sys:1939.74            ＃耗费系统CPU</span><br><span class="line">used_cpu_user:4148.13           ＃耗费用户CPU</span><br><span class="line">used_cpu_sys_children:101.03    ＃后台进程耗费的系统CPU</span><br><span class="line">used_cpu_user_children:900.62   ＃后台进程耗费的用户CPU</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cluster</span></span><br><span class="line">cluster_enabled:1 <span class="comment">#是否启用集群</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Keyspace  ＃部分记录了数据库相关的统计信息，比如数据库的键数量、设置有过期时间的key的数量等。对于每个数据库，这个部分都会添加一行以下格式的信息：</span></span><br><span class="line">db0:keys=16839997,expires=16061394,avg_ttl=560458485 </span><br></pre></td></tr></table></figure><h3 id="5-Redis配置动态更新和写入">5.Redis配置动态更新和写入</h3><p><code>config</code> <strong>查看或设置配置项</strong></p><ol><li><p><strong>Redis更新配置的两种方式:</strong><br>a.重启更新，需要修改配置文件，然后重启<br>b.实时更新，不需要重启</p></li><li><p><strong>静态更新的方法：（以修改密码为例）：</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vim /usr/local/redis-6.2.6/redis.conf</span></span><br><span class="line">requirepass new_redispwd</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl restart redis</span></span><br></pre></td></tr></table></figure></li><li><p><strong>动态更新的方法：</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;config get requirepass<span class="comment">#查询密码</span></span><br><span class="line">&gt;config <span class="built_in">set</span> requirepass new_redispwd<span class="comment">#动态修改密码</span></span><br><span class="line">&gt;config rewrite<span class="comment">#动态更新只能临时设定密码，要执行`config rewrite`才能把动态更新的内容写入配置文件</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="6-Redis多用户管理">6.Redis多用户管理</h3><p>老版本没有用户名，只有密码。Redis6已经有用户名，<strong>默认用户名<code>default</code></strong>。</p><p>1.<strong>列出所有用户</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ACL LIST<span class="comment">#列出所有用户，默认用户是default</span></span><br><span class="line">1) <span class="string">&quot;user default on #d8dd7b3fa6948180c03593f628b145d5a15cf5bb8009feb0a8ee1a6121008b99 ~* &amp;* +@all&quot;</span></span><br></pre></td></tr></table></figure><p>2.<strong>查看用户的相关信息</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ACL GETUSER default<span class="comment">#查看default用户的相关信息， default对所有key，所有命令均有权限，最高权限，是默认用户</span></span><br><span class="line"> 1) <span class="string">&quot;flags&quot;</span></span><br><span class="line"> 2) 1) <span class="string">&quot;on&quot;</span></span><br><span class="line">    2) <span class="string">&quot;allkeys&quot;</span><span class="comment">#所有的key都有权限</span></span><br><span class="line">    3) <span class="string">&quot;allchannels&quot;</span></span><br><span class="line">    4) <span class="string">&quot;allcommands&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;passwords&quot;</span></span><br><span class="line"> 4) 1) <span class="string">&quot;d8dd7b3fa6948180c03593f628b145d5a15cf5bb8009feb0a8ee1a6121008b99&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;commands&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;+@all&quot;</span><span class="comment">#所有的命令都有权限</span></span><br><span class="line"> 7) <span class="string">&quot;keys&quot;</span></span><br><span class="line"> 8) 1) <span class="string">&quot;*&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;channels&quot;</span></span><br><span class="line">10) 1) <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure><p>3.<strong>查看能赋予用户的所有的权限</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; ACL CAT                               <span class="comment">#查看所有的权限</span></span><br><span class="line"> 1) <span class="string">&quot;keyspace&quot;</span></span><br><span class="line"> 2) <span class="string">&quot;read&quot;</span></span><br><span class="line"> 3) <span class="string">&quot;write&quot;</span></span><br><span class="line"> 4) <span class="string">&quot;set&quot;</span></span><br><span class="line"> 5) <span class="string">&quot;sortedset&quot;</span></span><br><span class="line"> 6) <span class="string">&quot;list&quot;</span></span><br><span class="line"> 7) <span class="string">&quot;hash&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;string&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;bitmap&quot;</span></span><br><span class="line">10) <span class="string">&quot;hyperloglog&quot;</span></span><br><span class="line">11) <span class="string">&quot;geo&quot;</span></span><br><span class="line">12) <span class="string">&quot;stream&quot;</span></span><br><span class="line">13) <span class="string">&quot;pubsub&quot;</span></span><br><span class="line">14) <span class="string">&quot;admin&quot;</span></span><br><span class="line">15) <span class="string">&quot;fast&quot;</span></span><br><span class="line">16) <span class="string">&quot;slow&quot;</span></span><br><span class="line">17) <span class="string">&quot;blocking&quot;</span></span><br><span class="line">18) <span class="string">&quot;dangerous&quot;</span></span><br><span class="line">19) <span class="string">&quot;connection&quot;</span></span><br><span class="line">20) <span class="string">&quot;transaction&quot;</span></span><br><span class="line">21) <span class="string">&quot;scripting&quot;</span></span><br></pre></td></tr></table></figure><p>4.<strong>创建用户并给用户授权</strong></p><p>创建用户赋给所有权限：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; ACL SETUSER test1 on &gt;test1pwd ~* +@all<span class="comment">#用户名:test1  密码:test1pwd,赋予所有权限（超级用户）</span></span><br><span class="line">&gt; ACL GETUSER test1<span class="comment">#查看test1用户的所有权限</span></span><br><span class="line"></span><br><span class="line">&gt; ACL SETUSER test2 on &gt;test2pwd ~* +@all -config<span class="comment">#用户名:test2  密码:test2pwd，赋予除config以外所有权限</span></span><br></pre></td></tr></table></figure><p>案例：创建test用户只给一个get命令权限、读权限、并且只能get是name开头的key: name*</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用default默认用户登录redis：</span></span><br><span class="line"><span class="comment"># redis-cli -a redispwd</span></span><br><span class="line">&gt; <span class="built_in">set</span> name1 n1</span><br><span class="line">&gt; <span class="built_in">set</span> name2 n2</span><br><span class="line">&gt; <span class="built_in">set</span> name3 n3</span><br><span class="line">&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">&gt; ACL SETUSER <span class="built_in">test</span> on &gt;testpwd ~name* +get                <span class="comment">#创建test用户，密码：testpwd   赋给get命令的权限，只对name开头的有get权限</span></span><br><span class="line">&gt; ACL SETUSER <span class="built_in">test</span> on &gt;testpwd ~name* +@<span class="built_in">read</span>             <span class="comment">#给test用户增加read权限，设置只对name开头的key有read权限</span></span><br><span class="line">&gt; ACL getuser <span class="built_in">test</span>                                        <span class="comment">#查看test用户的相关信息</span></span><br><span class="line"></span><br><span class="line">&gt; ACL SETUSER t1 on &gt;t1pwd ~* +get                        <span class="comment">#对所有key都有get权限</span></span><br><span class="line">&gt; ACL SETUSER t1 on &gt;t1pwd ~* +@<span class="built_in">read</span>                      <span class="comment">#对所有key都有read权限</span></span><br><span class="line">&gt; ACL getuser t1</span><br><span class="line"></span><br><span class="line"><span class="comment">#认证登录，验证权限:</span></span><br><span class="line">&gt; auth <span class="built_in">test</span> testpwd</span><br><span class="line"><span class="comment"># redis-cli --user test --pass testpwd</span></span><br><span class="line"></span><br><span class="line">&gt; get name1</span><br><span class="line"><span class="string">&quot;n1&quot;</span></span><br><span class="line">&gt; get name2</span><br><span class="line"><span class="string">&quot;n2&quot;</span></span><br><span class="line">&gt; get k1</span><br><span class="line">(error) NOPERM this user has no permissions to access one of the keys used as arguments</span><br><span class="line">&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">(error) NOPERM this user has no permissions to run the <span class="string">&#x27;set&#x27;</span> <span class="built_in">command</span> or its subcommand</span><br></pre></td></tr></table></figure><p>5.<strong>删除用户</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ACL DELUSER <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h3 id="7-Redis慢日志">7.Redis慢日志</h3><p>redis慢日志是用于记录某些命令在执行时超过了预设定的时间，只要超过了一定的时间，redis就会将该条命令记录到redis-slowlog中。</p><p><strong>如果有人反馈redis慢，如何进行排查？</strong></p><ul><li>系统资源情况</li><li>查看慢日志情况</li></ul><p><strong>案例</strong></p><p>1.查看慢日志的配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; CONFIG GET slow*                     <span class="comment">#查看慢日志的配置                  </span></span><br><span class="line">1) <span class="string">&quot;slowlog-max-len&quot;</span></span><br><span class="line">2) <span class="string">&quot;128&quot;</span>                                      <span class="comment">#最多记录128个</span></span><br><span class="line">3) <span class="string">&quot;slowlog-log-slower-than&quot;</span></span><br><span class="line">4) <span class="string">&quot;10000&quot;</span>                                  <span class="comment">#默认超过10毫秒就会记录</span></span><br></pre></td></tr></table></figure><p>2.<strong>设置慢日志的时间是1毫秒，查询超过1毫秒就为慢日志</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; config <span class="built_in">set</span> slowlog-log-slower-than 1000     <span class="comment">#设置慢日志的时间是1毫秒,查询超过1毫秒就为慢日志</span></span><br><span class="line">&gt; CONFIG GET slow*                                 <span class="comment">#查看</span></span><br><span class="line">1) <span class="string">&quot;slowlog-max-len&quot;</span></span><br><span class="line">2) <span class="string">&quot;128&quot;</span></span><br><span class="line">3) <span class="string">&quot;slowlog-log-slower-than&quot;</span></span><br><span class="line">4) <span class="string">&quot;1000&quot;</span>                                               <span class="comment">#1毫秒为慢日志</span></span><br></pre></td></tr></table></figure><p>3.使用Shell批量写入数据并获取，多写入些数据，方便我们查询数据大的时候产生慢日志</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for i in $(seq -w 100000);do redis-cli -a redispwd set name$&#123;i&#125; test$&#123;i&#125;; redis-cli -a redispwd get name$&#123;i&#125;; done 2&gt;/dev/null</span></span><br></pre></td></tr></table></figure><p>4.产生慢日志</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; KEYS *                        <span class="comment">#查询一次，当操作时间大于1毫秒，就会产生一条慢日志</span></span><br><span class="line">&gt; KEYS * </span><br><span class="line">&gt; KEYS * </span><br><span class="line">....可以多查询几次，多获取几条慢日志</span><br></pre></td></tr></table></figure><p>5.查询慢日志</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; SLOWLOG get<span class="comment">#默认获取最近10条</span></span><br><span class="line">&gt; SLOWLOG get 5<span class="comment">#获取5条</span></span><br><span class="line">&gt; SLOWLOG len<span class="comment">#慢日志量，查看慢日志的条数</span></span><br><span class="line">&gt; SLOWLOG reset<span class="comment">#清空慢日志</span></span><br></pre></td></tr></table></figure><p>6.Slowlog各字段意思</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SLOWLOG get</span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 115<span class="comment">#慢日志的id，从0开始，第115个id</span></span><br><span class="line">   2) (<span class="built_in">integer</span>) 1668215297<span class="comment">#时间戳，慢日志产生的时间点，可以通过 date -d @1668215297   获取慢日志产生的时间</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 69284<span class="comment">#慢日志运行的时间69毫秒</span></span><br><span class="line">   4) 1) <span class="string">&quot;keys&quot;</span><span class="comment">#产生慢日志的命令，一般是当数据量太多时候，运行keys *命令会比较慢</span></span><br><span class="line">      2) <span class="string">&quot;*&quot;</span></span><br><span class="line">   5) <span class="string">&quot;127.0.0.1:60014&quot;</span></span><br><span class="line">   6) <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="8-Redis-key生存时间">8.Redis key生存时间</h3><ul><li>概念</li></ul><p>​<strong>生存时间（Time To Live，TTL）</strong>：在经过指定的秒数或者毫秒数之后，服务器就会自动删除生存时间为0的键</p><p>​<strong>过期时间（expire time）</strong>：是一个UNIX<a href="https://so.csdn.net/so/search?q=%E6%97%B6%E9%97%B4%E6%88%B3&amp;spm=1001.2101.3001.7020">时间戳</a>，当键的过期时间来临时，服务器就会自动从数据库中删除这个键</p><ul><li><p>语法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置生存时间</span><br><span class="line">EXPIRE &lt;key&gt; &lt;ttl&gt;：用于将键key的生存时间设置为ttl秒</span><br><span class="line">PEXPIRE &lt;key&gt; &lt;ttl&gt;：用于将键key的生存时间设置为ttl毫秒</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置过期时间</span><br><span class="line">EXPIREAT &lt;key&gt; &lt;timestamp&gt;：用于将键key的过期时间设置为timestamp所指定的秒数时间戳</span><br><span class="line">PEXPIREAT &lt;key&gt; &lt;timestamp&gt;：用于将键key的过期时间设置为timestamp所指定的毫秒数时间戳</span><br></pre></td></tr></table></figure><p>EXPIRE、PEXPIRE、EXPIREAT这几个命令的<strong>内部最终使用的都是PEXPIREAT</strong></p></li><li><p>eg.</p><p>给Redis的key设置有效期,<strong>-1表示永久,-2代表Redis回收了</strong>（key已经自动删除)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> name test1<span class="comment">#默认设置的key是永久有效的</span></span><br><span class="line">&gt; get name</span><br><span class="line"><span class="string">&quot;test1&quot;</span></span><br><span class="line">&gt; ttl name                      <span class="comment">#查看key的状态，生命周期，-1表示永久有效</span></span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br><span class="line">&gt; expire name 20<span class="comment">#方法1: 给key设置有效期，单位:秒，设置有效期是20s       </span></span><br><span class="line">&gt; <span class="built_in">set</span> name2 test02 EX 20<span class="comment">#方法2: 再创建key时候直接给key设置有效期:20s</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="9-Redis禁用危险命令">9.Redis禁用危险命令</h3><ul><li><p>Redis 的危险命令主要有：</p><ul><li>flushdb，清空数据库</li><li>flushall，清空所有记录，数据库</li><li>config，客户端连接后可配置服务器</li><li>keys，客户端连接后可查看所有存在的键，当 redis key 很多时，非常危险，建议使用 scan 命令代替</li></ul><p>可以禁用以上命令来使服务器更加安全。禁用方法是：在配置文件 <code>redis.conf</code> 中 <code>SECURITY</code> 区域中，新增以下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rename-command FLUSHALL &quot;&quot;</span><br><span class="line">rename-command FLUSHDB &quot;&quot;</span><br><span class="line">rename-command CONFIG &quot;&quot;</span><br><span class="line">rename-command KEYS &quot;&quot;</span><br></pre></td></tr></table></figure><p>如果想要保留命令，但是不能轻易使用，可以重命名命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rename-command FLUSHALL XXXXXXXXXXXXXX</span><br><span class="line">rename-command FLUSHDB XXXXXXXXXXXXXX</span><br><span class="line">rename-command CONFIG XXXXXXXXXXXXXX</span><br><span class="line">rename-command KEYS XXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure><p><code>XXXXXXXXXXXXXX</code> 用新命令代替</p><p>配置完后重启 Redis 服务生效。如果禁用 <code>FLUSHALL</code> 命令，需要设置配置文件中 <code>appendonly no</code>，否则服务无法启动。</p></li></ul><h3 id="10-压测工具">10.压测工具</h3><p>Redis 自带了一个叫 redis-benchmark 的工具来模拟 N 个客户端同时发出 M 个请求。（类似于 Apache ab 程序）。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; redis-benchmark --<span class="built_in">help</span></span><br><span class="line">-c &lt;clients&gt;       Number of parallel connections (default 50)<span class="comment">#默认的并发是50个</span></span><br><span class="line">-n &lt;requests&gt;      Total number of requests (default 100000)<span class="comment">#默认有10万个请求</span></span><br></pre></td></tr></table></figure><p>压测工具，基本对redis里的每一个命令都会进行测试一遍</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; redis-benchmark -a redispwd<span class="comment">#用默认的并发50个，一共10万个请求对redis进行压测</span></span><br><span class="line">&gt; redis-benchmark -a redispwd | <span class="built_in">tee</span> /tmp/a.log<span class="comment">#将测试的结果输出到一个log文件</span></span><br></pre></td></tr></table></figure><ul><li><p>参数</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-h <hostname></td><td>指定服务器主机名 (默认 127.0.0.1)</td></tr><tr><td>-p <port></td><td>指定服务器端口 (默认 6379)</td></tr><tr><td>-s <socket></td><td>指定服务器 socket</td></tr><tr><td>-a <password> Redis 认证密码</td><td></td></tr><tr><td>-c <clients></td><td>指定并发连接数 (默认 50)</td></tr><tr><td>-n <requests></td><td>指定请求数 (默认 100000)</td></tr><tr><td>-d <size></td><td>以字节的形式指定 SET/GET 值的数据大小 (默认 2)</td></tr><tr><td>–dbnum <db></td><td>选择指定的数据库号 (默认 0)</td></tr><tr><td>-k <boolean></td><td>1=keep alive 0=reconnect (默认 1)</td></tr><tr><td>-r <keyspacelen></td><td>SET/GET/INCR 使用随机 key, SADD 使用随机值</td></tr><tr><td>-P <numreq></td><td>通过管道传输 <numreq> 请求 (no pipeline)</td></tr><tr><td>-q</td><td>退出，仅显示 query/sec 值</td></tr><tr><td>–csv</td><td>以 CSV 格式输出</td></tr><tr><td>-l</td><td>生成循环，永久执行测试</td></tr><tr><td>-t <tests></td><td>仅运行以逗号分隔的测试命令列表</td></tr><tr><td>-I</td><td>Idle 模式，仅打开 N 个 idle 连接并等待</td></tr></tbody></table></li></ul><p>日常输出的一个简介</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /tmp/a.log</span></span><br><span class="line">PING_INLINE:                                                                      测试PING</span><br><span class="line">  100000 requests completed <span class="keyword">in</span> 1.10 seconds                          一共处理了10万个PING请求，在1.1秒中完成</span><br><span class="line">  50 parallel clients                                                               50个并发</span><br><span class="line">  3 bytes payload                                                                 每个请求数据量是3个字节</span><br><span class="line">  ......</span><br><span class="line">100.000% &lt;= 2.527 milliseconds (cumulative count 100000)    测试PING的一个延时，&lt;2.5毫秒的有100%</span><br><span class="line"></span><br><span class="line">SET:                                                                                   测试SET命令</span><br><span class="line">  100000 requests completed <span class="keyword">in</span> 1.07 seconds                         一共执行了10万次SET操作，在1.07秒中完成</span><br><span class="line">  50 parallel clients                                                              50个并发</span><br><span class="line">  3 bytes payload                                                                每个请求数据量是3个字节  </span><br><span class="line">  ......</span><br><span class="line">23.353% &lt;= 0.207 milliseconds (cumulative count 23353)       %23.353的命令执行时间小于0.207毫秒</span><br><span class="line">69.820% &lt;= 0.303 milliseconds (cumulative count 69820)       %69.820的命令执行时间小于0.303毫秒</span><br><span class="line">100.000% &lt;= 2.183 milliseconds (cumulative count 100000)    %100的命令执行时间小于2.183毫秒</span><br><span class="line">Summary:</span><br><span class="line">  throughput summary: 93370.68 requests per second             redis每秒可以处理93370.68次<span class="built_in">set</span>请求</span><br><span class="line">  latency summary (msec):</span><br><span class="line">          avg       min       p50       p95       p99       max</span><br><span class="line">        0.302     0.072     0.247     0.599     1.111     2.183</span><br><span class="line"></span><br><span class="line">GET:                                                                                 测试GET命令</span><br><span class="line">  100000 requests completed <span class="keyword">in</span> 1.12 seconds                        一共执行了10万次GET操作，在1.12秒中完成</span><br><span class="line">  50 parallel clients                                                              50个并发</span><br><span class="line">  3 bytes payload                                                                每个请求数据量是3个字节 </span><br><span class="line">  ......</span><br><span class="line">50.000% &lt;= 0.255 milliseconds (cumulative count 52277)        %50的命令执行时间小于0.255毫秒</span><br><span class="line">75.000% &lt;= 0.375 milliseconds (cumulative count 75710)        %75的命令执行时间小于0.375毫秒</span><br><span class="line">100.000% &lt;= 2.447 milliseconds (cumulative count 100000)     %100的命令执行时间小于2.447毫秒</span><br><span class="line">Summary:</span><br><span class="line">  throughput summary: 89445.44 requests per second               redis每秒可以处理89445.44次get请求    </span><br><span class="line">  latency summary (msec):</span><br><span class="line">          avg       min       p50       p95       p99       max</span><br><span class="line">        0.326     0.048     0.255     0.687     1.311     2.447</span><br></pre></td></tr></table></figure><h2 id="六、Redis持久化">六、Redis持久化</h2><p>redis提供了两种持久化的方式，分别是RDB（Redis DataBase）和AOF（Append Only File）</p><ul><li>RDB，简而言之，就是在不同的时间点，将redis存储的数据生成快照并存储到磁盘等介质上；</li><li>AOF，则是换了一个角度来实现持久化，那就是将redis执行过的所有写指令记录下来，在下次redis重新启动时，只要把这些写指令从前到后再重复执行一遍，就可以实现数据恢复了。</li></ul><p>其实RDB和AOF两种方式也可以同时使用，在这种情况下，如果redis重启的话，则会优先采用AOF方式来进行数据恢复，这是因为AOF方式的数据恢复完整度更高。</p><p>如果你没有数据持久化的需求，也完全可以关闭RDB和AOF方式，这样的话，redis将变成一个纯内存数据库，就像memcache一样。</p><h3 id="1-RDB持久化">1.RDB持久化</h3><p>RDB（Redis DataBase）持久化是把当前Redis中全部数据生成快照保存在硬盘上。RDB持久化可以手动触发，也可以自动触发。</p><ul><li><p><strong>开启、关闭 RDB</strong></p><p>通过修改配置文件开、关RDB持久化: （推荐）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim redis.conf</span></span><br><span class="line"><span class="comment"># 时间策略</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment"># 文件名称</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="comment"># 文件保存路径</span></span><br><span class="line"><span class="built_in">dir</span> /mydata/redis</span><br><span class="line"><span class="comment"># 如果持久化出错，主进程是否停止写入</span></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 是否压缩</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 导入时是否检查</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>如果是关闭RDB,添加<code>save &quot;&quot;</code>并注释完相应配置后要删除 <code>/mydata/redis/dump.rdb</code> ，在重启服务。</p><p>也可以：(使用<code>config</code>关闭 (用rewrite发现貌似不能写入配置文件)(不推荐)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;config <span class="built_in">set</span> save <span class="string">&quot;&quot;</span>                       <span class="comment">#关闭rdb快照持久化存储,测试的不好使</span></span><br><span class="line">&gt;config rewrite                            <span class="comment">#写入配置文件，永久设置                           </span></span><br><span class="line">&gt;config <span class="built_in">set</span> rdbcompression no      <span class="comment">#rdb文件需不需要压缩，当磁盘空间比较大时候，可以设置不用压缩</span></span><br></pre></td></tr></table></figure></li><li><p><strong>手动触发</strong></p><p><code>save</code>和<code>bgsave</code>命令都可以手动触发RDB持久化。</p></li><li><p><strong>save命令</strong></p><p>执行<code>save</code>命令会手动触发RDB持久化，但是<code>save</code>命令会阻塞Redis服务，直到RDB持久化完成。当Redis服务储存大量数据时，会造成较长时间的阻塞，不建议使用。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>执行后，Redis的日志中记录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* DB saved on disk</span><br></pre></td></tr></table></figure></li><li><p><strong>bgsave命令</strong></p><p>执行bgsave命令也会手动触发RDB持久化，和save命令不同是：Redis服务一般不会阻塞。Redis进程会执行fork操作创建子进程，RDB持久化由子进程负责，不会阻塞Redis服务进程。Redis服务的阻塞只发生在fork阶段，一般情况时间很短。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; bgsave</span><br><span class="line">Background saving started</span><br></pre></td></tr></table></figure><p>执行后，Redis的日志中记录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* Background saving started by pid 2645</span><br><span class="line">* DB saved on disk</span><br><span class="line">* RDB: 0 MB of memory used by copy-on-write</span><br><span class="line">* Background saving terminated with success</span><br></pre></td></tr></table></figure><p><code>bgsave</code>命令的具体流程:</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1f9d0b79e335393d7825fca8637cafe1.png" alt="img"></p><blockquote><p>图片中的 5 个步骤所进行的操作如下：</p><ol><li><p>Redis 父进程首先判断：当前是否在执行 save，或 bgsave/bgrewriteaof 的子进程，如果在执行则 bgsave 命令直接返回。bgsave/bgrewriteaof 的子进程不能同时执行，主要是基于性能方面的考虑：两个并发的子进程同时执行大量的磁盘写操作，可能引起严重的性能问题。</p></li><li><p>父进程执行 fork 操作创建子进程，这个过程中父进程是阻塞的，Redis 不能执行来自客户端的任何命令</p></li><li><p>父进程 fork 后，bgsave 命令返回”Background saving started”信息并不再阻塞父进程，并可以响应其他命令</p></li><li><p>子进程创建 RDB 文件，根据父进程内存快照生成临时快照文件，完成后对原有文件进行原子替换</p></li><li><p>子进程发送信号给父进程表示完成，父进程更新统计信息</p></li></ol></blockquote></li><li><p><strong>RDB 文件格式</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/89aa18a36a490ad5dfd8df5e5587501c.png" alt="img"></p><blockquote><p>其中各个字段的含义说明如下：</p><ol><li><p>REDIS：常量，保存着”REDIS”5 个字符。</p></li><li><p>db_version：RDB 文件的版本号，注意不是 Redis 的版本号。</p></li><li><p>SELECTDB 0 pairs：表示一个完整的数据库(0 号数据库)，同理 SELECTDB 3 pairs 表示完整的 3 号数据库；只有当数据库中有键值对时，RDB 文件中才会有该数据库的信息(上图所示的 Redis 中只有 0 号和 3 号数据库有键值对)；如果 Redis 中所有的数据库都没有键值对，则这一部分直接省略。其中：SELECTDB 是一个常量，代表后面跟着的是数据库号码；0 和 3 是数据库号码；pairs 则存储了具体的键值对信息，包括 key、value 值，及其数据类型、内部编码、过期时间、压缩信息等等。</p></li><li><p>EOF：常量，标志 RDB 文件正文内容结束。</p></li><li><p>check_sum：前面所有内容的校验和；Redis 在载入 RBD 文件时，会计算前面的校验和并与 check_sum 值比较，判断文件是否损坏。</p></li></ol></blockquote></li><li><p><strong>启动时加载</strong></p><p>RDB 文件的载入工作是在服务器启动时自动执行的，并没有专门的命令。但是由于 AOF 的优先级更高，因此当 AOF 开启时，Redis 会优先载入 AOF 文件来恢复数据；只有当 AOF 关闭时，才会在 Redis 服务器启动时检测 RDB 文件，并自动载入。<strong>服务器载入 RDB 文件期间处于阻塞状态，直到载入完成为止。</strong></p><p>Redis 载入 RDB 文件时，会对 RDB 文件进行校验，如果文件损坏，则日志中会打印错误，Redis 启动失败。</p></li><li><p><strong>关闭 RDB</strong></p><p>使用<code>config</code>关闭 (用rewrite发现貌似不能写入配置文件)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;config <span class="built_in">set</span> save <span class="string">&quot;&quot;</span>                       <span class="comment">#关闭rdb快照持久化存储,测试的不好使</span></span><br><span class="line">&gt;config rewrite                            <span class="comment">#写入配置文件，永久设置                           </span></span><br><span class="line">&gt;config <span class="built_in">set</span> rdbcompression no      <span class="comment">#rdb文件需不需要压缩，当磁盘空间比较大时候，可以设置不用压缩</span></span><br></pre></td></tr></table></figure><p>通过修改配置文件关闭rdb持久化: （推荐）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/redis.conf</span></span><br><span class="line">save <span class="string">&quot;&quot;</span>                                      <span class="comment">#添加</span></span><br><span class="line"><span class="comment">#注释下面的：</span></span><br><span class="line"><span class="comment">#save 3600 1</span></span><br><span class="line"><span class="comment">#save 300 100</span></span><br><span class="line"><span class="comment">#save 60 10000</span></span><br></pre></td></tr></table></figure><p>执行完后要删除 <code>/mydata/redis/dump.rdb</code> ，在重启服务。</p></li></ul><h3 id="2-AOF持久化">2.AOF持久化</h3><p>RDB 持久化是将进程数据写入文件，而 AOF 持久化(即 Append Only File 持久化)，则是将 Redis 执行的每次写命令记录到单独的日志文件中；当 Redis 重启时再次执行 AOF 文件中的命令来恢复数据。</p><p>与 RDB 相比，AOF 的实时性更好，因此已成为主流的持久化方案。</p><ul><li><p><strong>开启、关闭AOF</strong></p><p>修改配置文件<code>redis.conf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置文件，把no改为 yes</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"><span class="comment">#确定存储文件名是否正确</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"><span class="comment">#重写</span></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb <span class="comment">#表示触发AOF重写的最小文件体积,大于或等于64MB自动触发。</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>AOF 的执行流程包括：</p><ul><li>命令追加(append)：将 Redis 的写命令追加到缓冲区 aof_buf；</li><li>文件写入(write)和文件同步(sync)：根据不同的同步策略将 aof_buf 中的内容同步到硬盘；</li><li>文件重写(rewrite)：定期重写 AOF 文件，达到压缩的目的。</li></ul></blockquote><ul><li><p><strong>命令追加(append)</strong></p><p>Redis 先将写命令追加到缓冲区，而不是直接写入文件，主要是为了避免每次有写命令都直接写入硬盘，导致硬盘 IO 成为 Redis 负载的瓶颈。</p><p>命令追加的格式是 Redis 命令请求的协议格式，它是一种纯文本格式，具有兼容性好、可读性强、容易处理、操作简单避免二次开销等优点。在 AOF 文件中，除了用于指定数据库的 select 命令是由 Redis 添加的，其他都是客户端发送来的写命令。</p></li><li><p><strong>文件写入(write)和文件同步(sync)</strong></p><p>Redis 提供了多种 AOF 缓存区的同步文件策略，策略涉及到操作系统的 write 函数和 fsync 函数，说明如下：</p><p>为了提高文件写入效率，在现代操作系统中，当用户调用 write 函数将数据写入文件时，操作系统通常会将数据暂存到一个内存缓冲区里，当缓冲区被填满或超过了指定时限后，才真正将缓冲区的数据写入到硬盘里。这样的操作虽然提高了效率，但也带来了安全问题：如果计算机停机，内存缓冲区中的数据会丢失；因此系统同时提供了 fsync、fdatasync 等同步函数，可以强制操作系统立刻将缓冲区中的数据写入到硬盘里，从而确保数据的安全性。</p><p>AOF 缓存区的同步文件策略由参数 appendfsync 控制，各个值的含义如下：</p><ul><li>always：命令写入 aof_buf 后立即调用系统 fsync 操作同步到 AOF 文件，fsync 完成后线程返回。这种情况下，每次有写命令都要同步到 AOF 文件，硬盘 IO 成为性能瓶颈，Redis 只能支持大约几百 TPS 写入，严重降低了 Redis 的性能；即便是使用固态硬盘（SSD），每秒大约也只能处理几万个命令，而且会大大降低 SSD 的寿命。</li><li>no：命令写入 aof_buf 后调用系统 write 操作，不对 AOF 文件做 fsync 同步；同步由操作系统负责，通常同步周期为 30 秒。这种情况下，文件同步的时间不可控，且缓冲区中堆积的数据会很多，数据安全性无法保证。</li><li>everysec：命令写入 aof_buf 后调用系统 write 操作，write 完成后线程返回；fsync 同步文件操作由专门的线程每秒调用一次。<strong>everysec 是前述两种策略的折中，是性能和数据安全性的平衡，因此是 Redis 的默认配置，也是我们推荐的配置。</strong></li></ul></li><li><p><strong>文件重写(rewrite)</strong></p><p>随着时间流逝，Redis 服务器执行的写命令越来越多，AOF 文件也会越来越大；过大的 AOF 文件不仅会影响服务器的正常运行，也会导致数据恢复需要的时间过长。</p><p>文件重写是指定期重写 AOF 文件，减小 AOF 文件的体积。需要注意的是，<strong>AOF 重写是把 Redis 进程内的数据转化为写命令，同步到新的 AOF 文件；不会对旧的 AOF 文件进行任何读取、写入操作!</strong></p><p>关于文件重写需要注意的另一点是：对于 AOF 持久化来说，文件重写虽然是强烈推荐的，但并不是必须的；即使没有文件重写，数据也可以被持久化并在 Redis 启动的时候导入；因此在一些实现中，会关闭自动的文件重写，然后通过定时任务在每天的某一时刻定时执行。</p><p>文件重写之所以能够压缩 AOF 文件，原因在于：</p><ul><li>过期的数据不再写入文件</li><li>无效的命令不再写入文件：如有些数据被重复设值(set mykey v1, set mykey v2)、有些数据被删除了(sadd myset v1, del myset)等等</li><li>多条命令可以合并为一个：如 sadd myset v1, sadd myset v2, sadd myset v3 可以合并为 sadd myset v1 v2 v3。不过为了防止单条命令过大造成客户端缓冲区溢出，对于 list、set、hash、zset 类型的 key，并不一定只使用一条命令；而是以某个常量为界将命令拆分为多条。这个常量在 redis.h/REDIS_AOF_REWRITE_ITEMS_PER_CMD 中定义，不可更改，3.0 版本中值是 64。</li></ul><p>通过上述内容可以看出，由于重写后 AOF 执行的命令减少了，文件重写既可以减少文件占用的空间，也可以加快恢复速度。</p><ul><li><p>文件重写的触发</p><p>文件重写的触发，分为手动触发和自动触发：</p><p><strong>手动触发</strong>：直接调用 <code>bgrewriteaof</code> 命令，该命令的执行与 bgsave 有些类似：都是 fork 子进程进行具体的工作，且都只有在 fork 时阻塞。</p><p><strong>自动触发</strong>：根据 <code>auto-aof-rewrite-min-size</code> 和 <code>auto-aof-rewrite-percentage</code> 参数，以及 <code>aof_current_size</code> 和 <code>aof_base_size</code> 状态确定触发时机。</p><ul><li><code>auto-aof-rewrite-min-size</code>：执行 AOF 重写时，文件的最小体积，默认值为 64MB。</li><li><code>auto-aof-rewrite-percentage</code>：执行 AOF 重写时，当前 AOF 大小(即 aof_current_size)和上一次重写时 AOF 大小(aof_base_size)的比值。</li></ul><p>只有当 <code>auto-aof-rewrite-min-size</code> 和 <code>auto-aof-rewrite-percentage</code> 两个参数同时满足时，才会自动触发 AOF 重写，即 bgrewriteaof 操作。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/890fafa81323d9958582d5902d413e70.png" alt="img"></p><blockquote><p>关于文件重写的流程，有两点需要特别注意：(1)重写由父进程 fork 子进程进行；(2)重写期间 Redis 执行的写命令，需要追加到新的 AOF 文件中，为此 Redis 引入了 aof_rewrite_buf 缓存。</p><p>对照上图，文件重写的流程如下：</p><ol><li><p>Redis 父进程首先判断当前是否存在正在执行 bgsave/bgrewriteaof 的子进程，如果存在则 bgrewriteaof 命令直接返回，如果存在 bgsave 命令则等 bgsave 执行完成后再执行。</p></li><li><p>父进程执行 fork 操作创建子进程，这个过程中父进程是阻塞的。</p></li></ol><p>3.1) 父进程 fork 后，bgrewriteaof 命令返回”Background append only file rewrite started”信息并不再阻塞父进程，并可以响应其他命令。<strong>Redis 的所有写命令依然写入 AOF 缓冲区，并根据 appendfsync 策略同步到硬盘，保证原有 AOF 机制的正确。</strong></p><p>3.2) 由于 fork 操作使用写时复制技术，子进程只能共享 fork 操作时的内存数据。<strong>由于父进程依然在响应命令，因此 Redis 使用 AOF 重写缓冲区(图中的 aof_rewrite_buf)保存这部分数据，防止新 AOF 文件生成期间丢失这部分数据。也就是说，bgrewriteaof 执行期间，Redis 的写命令同时追加到 aof_buf 和 aof_rewirte_buf 两个缓冲区。</strong></p><ol start="4"><li>子进程根据内存快照，按照命令合并规则写入到新的 AOF 文件。</li></ol><p>5.1) 子进程写完新的 AOF 文件后，向父进程发信号，父进程更新统计信息，具体可以通过 info persistence 查看。</p><p>5.2) 父进程把 AOF 重写缓冲区的数据写入到新的 AOF 文件，这样就保证了新 AOF 文件所保存的数据库状态和服务器当前状态一致。</p><p>5.3) 使用新的 AOF 文件替换老文件，完成 AOF 重写。</p></blockquote></li></ul></li></ul><p>​注意：自动触发重写在业务高峰压力大，如果采用自动触发重写，有可能会影响业务，可选择在压力小的时候脚本运行BGREWRITEAOF</p><ul><li><p><strong>启动时加载</strong></p><p>前面提到过，当 AOF 开启时，Redis 启动时会优先载入 AOF 文件来恢复数据；只有当 AOF 关闭时，才会载入 RDB 文件恢复数据。</p><p>当 AOF 开启，但 AOF 文件不存在时，即使 RDB 文件存在也不会加载(更早的一些版本可能会加载，但 3.0 不会)</p></li><li><p><strong>文件校验</strong></p><p>与载入 RDB 文件类似，Redis 载入 AOF 文件时，会对 AOF 文件进行校验，如果文件损坏，则日志中会打印错误，Redis 启动失败。但如果是 AOF 文件结尾不完整(机器突然宕机等容易导致文件尾部不完整)，且 aof-load-truncated 参数开启，则日志中会输出警告，Redis 忽略掉 AOF 文件的尾部，启动成功。aof-load-truncated 参数默认是开启的。</p></li><li><p><strong>AOF策略配置</strong></p><p>在上述介绍写入机制的过程中，如果遇到宕机前，缓存内的数据未能写入到磁盘中，那么数据仍然会有丢失的风险。服务器宕机时，丢失命令的数量，取决于命令被写入磁盘的时间，越早地把命令写入到磁盘中，发生意外时丢失的数据就会越少，否则越多。</p><p>Redis 为数据的安全性考虑，同样为 AOF 持久化提供了策略配置，打开 Redis 配置文件，如下图所示：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1609113Z8-0.gif" alt="Redis AOF持久化"></p><blockquote><p>上述配置策略说明如下：</p><ul><li>Always：服务器每写入一个命令，就调用一次 fsync 函数，将缓冲区里面的命令写入到硬盘。这种模式下，服务器出现故障，也不会丢失任何已经成功执行的命令数据，但是其执行速度较慢；</li><li>Everysec（默认）：服务器每一秒调用一次 fsync 函数，将缓冲区里面的命令写入到硬盘。这种模式下，服务器出现故障，最多只丢失一秒钟内的执行的命令数据，通常都使用它作为 AOF 配置策略；</li><li>No：服务器不主动调用 fsync 函数，由操作系统决定何时将缓冲区里面的命令写入到硬盘。这种模式下，服务器遭遇意外停机时，丢失命令的数量是不确定的，所以这种策略，不确定性较大，不安全。</li></ul></blockquote><p>由于是 fsync 是磁盘 IO 操作，所以它很慢！如果 Redis 执行一条指令就要 fsync 一次（Always），那么 Redis 高性能将严重受到影响。</p><p>在生产环境的服务器中，Redis 通常是每隔 1s 左右执行一次 fsync 操作（ Everysec），这样既保持了高性能，也让数据尽可能的少丢失。最后一种策略（No），让操作系统来决定何时将数据同步到磁盘，这种策略存在许多不确定性，所以不建议使用。</p><p>从三种策略的运行速度来看，Always 的速度最慢，而 Everysec 和 No 都很快。</p></li></ul><h3 id="3-AOF和RDB对比">3.AOF和RDB对比</h3><table><thead><tr><th>RDB持久化</th><th>AOF持久化</th></tr></thead><tbody><tr><td>全量备份，一次保存整个数据库。</td><td>增量备份，一次只保存一个修改数据库的命令。</td></tr><tr><td>每次执行持久化操作的间隔时间较长。</td><td>保存的间隔默认为一秒钟（Everysec）</td></tr><tr><td>数据保存为二进制格式，其还原速度快。</td><td>使用文本格式还原数据，所以数据还原速度一般。</td></tr><tr><td>执行 SAVE 命令时会阻塞服务器，但手动或者自动触发的 BGSAVE 不会阻塞服务器</td><td>AOF持久化无论何时都不会阻塞服务器。</td></tr></tbody></table><ul><li><p>RDB 和 AOF 各有优缺点：</p><ul><li><p><strong>RDB 持久化</strong></p><p>优点：RDB 文件紧凑，体积小，网络传输快，适合全量复制；恢复速度比 AOF 快很多。当然，与 AOF 相比，RDB 最重要的优点之一是对性能的影响相对较小。</p><p>缺点：RDB 文件的致命缺点在于其数据快照的持久化方式决定了必然做不到实时持久化，而在数据越来越重要的今天，数据的大量丢失很多时候是无法接受的，因此 AOF 持久化成为主流。此外，RDB 文件需要满足特定格式，兼容性差（如老版本的 Redis 不兼容新版本的 RDB 文件）。</p></li><li><p><strong>AOF 持久化</strong></p><p>与 RDB 持久化相对应，AOF 的优点在于支持秒级持久化、兼容性好，缺点是文件大、恢复速度慢、对性能影响大。</p></li></ul></li></ul><h3 id="4-持久化策略选择">4.持久化策略选择</h3><p>对于 RDB 持久化，一方面是 bgsave 在进行 fork 操作时 Redis 主进程会阻塞，另一方面，子进程向硬盘写数据也会带来 IO 压力；对于 AOF 持久化，向硬盘写数据的频率大大提高(everysec 策略下为秒级)，IO 压力更大，甚至可能造成 AOF 追加阻塞问题，此外，AOF 文件的重写与 RDB 的 bgsave 类似，会有 fork 时的阻塞和子进程的 IO 压力问题。相对来说，由于 AOF 向硬盘中写数据的频率更高，因此对 Redis 主进程性能的影响会更大。</p><p>在实际生产环境中，根据数据量、应用对数据的安全要求、预算限制等不同情况，会有各种各样的持久化策略；如完全不使用任何持久化、使用 RDB 或 AOF 的一种，或同时开启 RDB 和 AOF 持久化等。此外，持久化的选择必须与 Redis 的主从策略一起考虑，因为主从复制与持久化同样具有数据备份的功能，而且主机 master 和从机 slave 可以独立的选择持久化方案。</p><h2 id="七、Redis主从模式">七、Redis主从模式</h2><ul><li>如果服务器发生了宕机，由于数据恢复是需要点时间，那么这个期间是无法服务新的请求的；</li><li>如果这台服务器的硬盘出现了故障，可能数据就都丢失了。</li></ul><p>要避免这种单点故障，最好的办法是将数据备份到其他服务器上，让这些服务器也可以对外提供服务，这样即使有一台服务器出现了故障，其他服务器依然可以继续提供服务。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/22c7fe97ce5d3c382b08d83a4d8a5b96.png" alt="图片"></p><p>Redis 提供了<strong>主从复制模式</strong>，来避免服务器之间的数据不一致性。这个模式可以保证多台服务器的数据一致性，且主从服务器之间采用的是「读写分离」的方式。</p><p>主服务器可以进行读写操作，当发生写操作时自动将写操作同步给从服务器，而从服务器一般是只读，并接受主服务器同步过来写操作命令，然后执行这条命令。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2b7231b6aabb9a9a2e2390ab3a280b2d.png" alt="图片"></p><ul><li><p>主从复制配置方法</p><p>在从服务器中配置<code>redis.conf</code>文件新增</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;<span class="comment">#指定主redis的ip和端口 </span></span><br><span class="line">masterauth <span class="string">&quot;redispwd&quot;</span><span class="comment">#指定主redis的密码</span></span><br></pre></td></tr></table></figure></li><li><p>查看节点角色 <code>info Replication</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">在主redis上登录查看：  （192.168.27.128）</span><br><span class="line">127.0.0.1:6379&gt; info Replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.27.129,port=6379,state=online,offset=3216,lag=1</span><br><span class="line">slave1:ip=192.168.27.130,port=6379,state=online,offset=3216,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:915141a4f68f3c12235c59bfc120b6041c9148a5</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:3216</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:3216</span><br><span class="line"></span><br><span class="line">在从1redis上登录查看：（192.168.27.129）</span><br><span class="line">127.0.0.1:6379&gt; info Replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.27.128</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:0</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:3300</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:915141a4f68f3c12235c59bfc120b6041c9148a5</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:3300</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:897</span><br><span class="line">repl_backlog_histlen:2404</span><br></pre></td></tr></table></figure></li></ul><h2 id="八、哨兵模式（高可用）">八、哨兵模式（高可用）</h2><ul><li><p>概述</p><p>主从切换技术：当主机宕机后，需要手动把一台从（slave）服务器切换为主服务器，这就需要人工干预，费时费力，还回造成一段时间内服务不可用，所以推荐哨兵架构（Sentinel）来解决这个问题。哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。<br><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/a9a46e8f72464c75947658754d17da33.png" alt="img"></p><p>这里哨兵模式有两个作用：通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器当哨兵监测到Redis主机宕机，会自动将slave切换成master，然后通过发布订阅模式通知其他服务器，修改配置文件，让他们换主机</p><p>当一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此可以使用哨兵进行监控， <strong>各个哨兵之间还会进行监控</strong>，这就形成了多哨兵模式。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/389c08b11d914b629bc9452c50d2b938.png" alt="img"></p><p>上图所示，多个哨兵之间也存在互相监控，这就形成了多哨兵模式，现在对该模式的工作过程进行讲解，介绍如下：</p><ol><li>主观下线</li></ol><p>主观下线，适用于主服务器和从服务器。如果在规定的时间内(配置参数：down-after-milliseconds)，Sentinel 节点没有收到目标服务器的有效回复，则判定该服务器为“主观下线”。比如 Sentinel1 向主服务发送了<code>PING</code>命令，在规定时间内没收到主服务器<code>PONG</code>回复，则 Sentinel1 判定主服务器为“主观下线”。</p><ol start="2"><li>客观下线</li></ol><p>客观下线，只适用于主服务器。 Sentinel1 发现主服务器出现了故障，它会通过相应的命令，询问其它 Sentinel 节点对主服务器的状态判断。如果超过半数以上的 Sentinel 节点认为主服务器 down 掉，则 Sentinel1 节点判定主服务为“客观下线”。</p><ol start="3"><li>投票选举</li></ol><p>投票选举，所有 Sentinel 节点会通过投票机制，按照谁发现谁去处理的原则，选举 Sentinel1 为领头节点去做 Failover（故障转移）操作。Sentinel1 节点则按照一定的规则在所有从节点中选择一个最优的作为主服务器，然后通过发布订功能通知其余的从节点（slave）更改配置文件，跟随新上任的主服务器（master）。至此就完成了主从切换的操作。</p><p>对上对述过程做简单总结：</p><p>Sentinel 负责监控主从节点的“健康”状态。当主节点挂掉时，自动选择一个最优的从节点切换为主节点。客户端来连接 Redis 集群时，会首先连接 Sentinel，通过 Sentinel 来查询主节点的地址，然后再去连接主节点进行数据交互。当主节点发生故障时，客户端会重新向 Sentinel 要地址，Sentinel 会将最新的主节点地址告诉客户端。因此应用程序无需重启即可自动完成主从节点切换。</p></li><li><p>配置文件详解</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sentinel监听端口，默认是26379，可以修改。</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="comment"># 守护进程</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel日志文件名</span></span><br><span class="line">logfile <span class="string">&quot;sentinel.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哨兵sentinel的工作目录</span></span><br><span class="line"><span class="built_in">dir</span> /mydata/redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line"><span class="comment"># 告诉sentinel去监听地址为ip:port的一个master，这里的master-name可以自定义，</span></span><br><span class="line"><span class="comment"># master-name只能包含英文字母，数字，和“.-_”这三个字符</span></span><br><span class="line"><span class="comment"># quorum是一个数字，指明当有多少个sentinel认为一个master失效时，master才算真正失效。</span></span><br><span class="line"><span class="comment"># 需要注意的是master-ip 要写真实的ip地址而不要用回环地址（127.0.0.1）。</span></span><br><span class="line">sentinel monitor mymaster 192.168.0.5 6379 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line"><span class="comment">#设置连接master和slave时的密码，注意的是sentinel不能分别为master和slave设置不同的密码，因此master和slave的密码应该设置相同。</span></span><br><span class="line">sentinel auth-pass mymaster 000588</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; </span></span><br><span class="line"><span class="comment"># 这个配置项指定了需要多少失效时间，一个master才会被这个sentinel主观地认为是不可用的。 单位是毫秒，默认为30秒</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt; </span></span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line"><span class="comment"># failover-timeout 可以用在以下这些方面： </span></span><br><span class="line"><span class="comment">#  1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#  2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#  3.当想要取消一个正在进行的failover所需要的时间。  </span></span><br><span class="line"><span class="comment">#  4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了。</span></span><br><span class="line">sentinel failover-timeout mymaster1 20000</span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; </span></span><br><span class="line"><span class="comment"># sentinel的notification-script和reconfig-script是用来配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment"># 若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment"># 若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment"># 如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="comment"># 一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span></span><br><span class="line"><span class="comment"># sentinel notification-script mymaster /var/redis/notify.sh</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment">#       &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”, &lt;role&gt;是“leader”或者“observer”中的一个。 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的。这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span></span><br></pre></td></tr></table></figure></li><li><p>启动哨兵</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel /etc/sentinel.conf      <span class="comment"># 指定配置文件启动</span></span><br><span class="line">ps -ef | grep sentinel                 <span class="comment"># 查看进程</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="九、集群搭建">九、集群搭建</h2><p>要让集群正常运作至少需要3个master节点，为了高可用，每个master节点至少要有一个slave节点，所以我们就用3个master节点+3个slave节点来搭建集群。</p><p>参考：<a href="https://baijiahao.baidu.com/s?id=1730440988136689035&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1730440988136689035&amp;wfr=spider&amp;for=pc</a></p><ul><li><p>搭建集群</p><p>修改redis.conf文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启集群模式</span></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 每一个节点需要有一个配置文件，需要6份。每个节点处于集群的角色都需要告知其他所有节点，彼此知道，这个文件用于存储集</span></span><br><span class="line">cluster-config-file nodes-6379.conf </span><br><span class="line"><span class="comment"># 超时时间，超时则认为master宕机，随后主备切换</span></span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"><span class="comment"># 开启AOF</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 学习笔记</title>
      <link href="/posts/520fef84.html"/>
      <url>/posts/520fef84.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p><a href="https://blog.51cto.com/liuyj/5536362">https://blog.51cto.com/liuyj/5536362</a></p><h1 id="MySQL">MySQL</h1><h2 id="1）数据库知识点">1）数据库知识点</h2><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-20_11-13-21.png" alt="Snipaste_2022-12-20_11-13-21"></p><h2 id="2）数据库相关概念">2）数据库相关概念</h2><table><thead><tr><th>名称</th><th>全程</th><th>简称</th></tr></thead><tbody><tr><td>数据库</td><td>存储数据的仓库，数据是有组织的进行存储</td><td>DataBase（BD）</td></tr><tr><td>数据库管理系统</td><td>操纵和管理数据库的大型软件</td><td>DataBase Management System（DBMS）</td></tr><tr><td>SQL</td><td>操作关系型数据库的编程语言，定义了一套操作关系型数据库统一标准</td><td>Structured Query Language（SQL）</td></tr></tbody></table><h2 id="3）MySQL数据库版本">3）MySQL数据库版本</h2><ul><li>社区版（MySQL Community Server）</li><li>商业版（MySQL Enterprise Edition）</li></ul><h2 id="4）概述">4）概述</h2><ul><li><p><strong>关系型数据库（RDBMS）</strong></p><p>概念：建立在关系模型基础上，由多张互相连接的二维表组成的数据库。</p><p>特点：</p><ol><li>使用表存储数据，格式统一，便于维护。</li><li>使用SQL语言操作，标准统一，使用方便。</li></ol></li><li><p>数据模型</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-20_20-52-27.png" alt="Snipaste_2022-12-20_20-52-27"></p></li></ul><h2 id="5）MySQL-下载、安装与卸载">5）MySQL 下载、安装与卸载</h2><h3 id="5-1-Linux">5.1 Linux</h3><ul><li><p>基于CentOS 7.6</p><ol><li><p>安装前检查（注意：此步骤至关重要！！）</p><p>（1）更新 yum</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br></pre></td></tr></table></figure><p>（2）需要删除mariadb,会与MySQL冲突</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要删除mariadb,会与MySQL冲突</span></span><br><span class="line"><span class="comment"># 查询版本</span></span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">rpm -e mariadb-libs... --nodeps</span><br></pre></td></tr></table></figure><p>（3）检查MySQL残留，有则删除</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mysql</span><br><span class="line"><span class="comment"># 如果有，则执行</span></span><br><span class="line">yum remove mysql-....</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没有则继续</span></span><br><span class="line">find / -name mysql</span><br><span class="line"><span class="comment"># 或 </span></span><br><span class="line">whereis mysql</span><br><span class="line"><span class="built_in">rm</span> -rf ...删除上面查找到的文件和文件夹</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/my.cnf</span><br><span class="line"><span class="built_in">rm</span> -rf /var/log/mysql*</span><br></pre></td></tr></table></figure><p>（4）检查服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br><span class="line"><span class="comment"># 如果是激活状态</span></span><br><span class="line">systemctl stop mysqld</span><br></pre></td></tr></table></figure></li><li><p>安装 MySQL</p><p>方法一：yum 安装</p><p>（1）配置Mysql 8.0安装源</p><p>查询最新版本的的方法 <a href="https://dev.mysql.com/downloads/repo/yum/">https://dev.mysql.com/downloads/repo/yum/</a></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-27_11-30-44.png" alt="Snipaste_2022-12-27_11-30-44"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 红框处修改命令中相应版本</span></span><br><span class="line">rpm -Uvh https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br></pre></td></tr></table></figure><p>（2）yum安装MySQL</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-server --nogpgcheck</span><br><span class="line"><span class="comment"># --nogpgcheck 是跳过公钥检查安装</span></span><br></pre></td></tr></table></figure><p>（3）启动服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><p>（4）查看临时密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;A temporary password&quot;</span> /var/log/mysqld.log</span><br></pre></td></tr></table></figure><p>方法二：编译安装（未整理）</p></li><li><p>卸载</p><p>一、yum 卸载</p><p>（1）卸载所有查询到的安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa |grep -i mysql</span><br></pre></td></tr></table></figure><p>（2）删除所有查找到的目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name mysql</span><br></pre></td></tr></table></figure><p>（3）删除日志</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /var/log/mysqld.log</span><br></pre></td></tr></table></figure></li><li><p>其他问题</p><p>（1）问题1：安装MySQL时提示：mysql-community-client-5.7.39-1.el7.x86_64.rpm 的<code>公钥</code>尚未安装。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2023130556677825144.png" alt="2023130556677825144"></p><p>解决方案：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br></pre></td></tr></table></figure><p>（2）问题2：查看内存不足或者缓存空间为0时可能启动不了服务。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看错误信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解决方案：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到mysql的配置都在my.cnf</span></span><br><span class="line">$ whereis my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑my.cnf</span></span><br><span class="line">$ vim /etc/my.cnf</span><br><span class="line"><span class="comment"># 添加或修改</span></span><br><span class="line">innodb_buffer_pool_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果不能启用服务请检查swap分区是否为0</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分配 1G空间给swap</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=1024</span><br><span class="line">mkswap /swapfile</span><br><span class="line">swapon /swapfile</span><br><span class="line"><span class="comment"># 添加这行 /swapfile swap swap defaults 0 0 到 /etc/fstab</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="5-2-MacOS（未整理）">5.2 MacOS（未整理）</h3><h3 id="5-3-Windows（未整理）">5.3 Windows（未整理）</h3><h3 id="5-4-Docker">5.4 Docker</h3><h2 id="基础">基础</h2><h3 id="1）SQL">1）SQL</h3><ul><li><p>SQL通用语法</p><ol><li>SQL语句可以单行或多行书写，以分号结尾。</li><li>SQL语句可以使用空格/缩进来增强语句的可读性。</li><li>MySQL数据库的SQL语句不区分大小写，关键字建议使用大写。</li><li>注释：<ol><li>单行注释： <code>--</code>注释内容 或 <code>#</code> 注释内容（MySQL特有）</li><li>多行注释：<code>/* 注释内容*/</code></li></ol></li></ol></li><li><p><strong>SQL分类</strong></p><table><thead><tr><th>分类</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td>DDL</td><td>Data Definition Language</td><td>数据定义语言，用来定义数据库对象（数据库、表、字段）</td></tr><tr><td>DML</td><td>Data Manipulation Language</td><td>数据库操作语言，用来对数据库表中的数据进行增、删、改</td></tr><tr><td>DQL</td><td>Data Query Language</td><td>数据查询语言，用来查询数据库中标的记录</td></tr><tr><td>DCL</td><td>Data Control Language</td><td>数据控制语言，用来创建数据库用户、控制数据库的访问权限</td></tr></tbody></table></li></ul><h3 id="2）DDL数据定义语言">2）DDL数据定义语言</h3><h4 id="2-1-数据库操作">2.1 数据库操作</h4><ul><li><p>查询数据库</p><p>查询所有数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure><p>查询当前使用的数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELSECT DATABASE();</span><br></pre></td></tr></table></figure></li><li><p>创建数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE [IF NOT EXISTS] 数据库名 [DEFAULT CHARSET 字符集] [COLLATE 排序规则];</span><br></pre></td></tr></table></figure><blockquote><p>[DEFAULT CHARSET 字符集]： <code>DEFAULT CHARSET utf8mb4</code></p></blockquote></li><li><p>删除数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE [IF EXISTS] 数据库名;</span><br></pre></td></tr></table></figure></li><li><p>使用数据库（切换至）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-2-表操作">2.2 表操作</h4><ul><li><p>查询表</p><p>查询当前数据库内所有表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES;</span><br></pre></td></tr></table></figure><p>查询表结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DESC 表名;</span><br><span class="line"># 或者</span><br><span class="line">DESCRIBE 表名;</span><br></pre></td></tr></table></figure><p>查询指定表的建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TABLE 表名;</span><br></pre></td></tr></table></figure></li><li><p>创建表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE 表名(</span><br><span class="line">字段1 字段1类型[COMMENT &#x27;字段1注释&#x27;],</span><br><span class="line">字段2 字段2类型[COMMENT &#x27;字段2注释&#x27;],</span><br><span class="line">...</span><br><span class="line">字段n 字段n类型[COMMENT &#x27;字段n注释&#x27;],</span><br><span class="line">)[COMMENT &#x27;表注释&#x27;];</span><br></pre></td></tr></table></figure><blockquote><p><strong>数据类型:</strong></p><ol><li><p>数值类型</p><table><thead><tr><th>类型</th><th>大小</th><th>范围（有符号）</th><th>范围（无符号）</th><th>用途</th></tr></thead><tbody><tr><td>TINYINT</td><td>1 Bytes</td><td>(-128，127)</td><td>(0，255)</td><td>小整数值</td></tr><tr><td>SMALLINT</td><td>2 Bytes</td><td>(-32 768，32 767)</td><td>(0，65 535)</td><td>大整数值</td></tr><tr><td>MEDIUMINT</td><td>3 Bytes</td><td>(-8 388 608，8 388 607)</td><td>(0，16 777 215)</td><td>大整数值</td></tr><tr><td>INT或INTEGER</td><td>4 Bytes</td><td>(-2 147 483 648，2 147 483 647)</td><td>(0，4 294 967 295)</td><td>大整数值</td></tr><tr><td>BIGINT</td><td>8 Bytes</td><td>(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td><td>(0，18 446 744 073 709 551 615)</td><td>极大整数值</td></tr><tr><td>FLOAT</td><td>4 Bytes</td><td>(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td><td>0，(1.175 494 351 E-38，3.402 823 466 E+38)</td><td>单精度浮点数值</td></tr><tr><td>DOUBLE</td><td>8 Bytes</td><td>(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td>0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td>双精度浮点数值</td></tr><tr><td>DECIMAL</td><td>对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td><td>依赖于M和D的值</td><td>依赖于M和D的值</td><td>小数值</td></tr></tbody></table><p>注意：</p><ol><li><p>如果是无符号的范围可以加上 <code>UNSIGNED</code> （例：<code>age TINYINY UNSIGNED</code>）</p></li><li><p>浮点数共四个字节，小数为1位 （例：<code>score DOUBLE(4,1)</code>）</p></li></ol></li><li><p>日期和时间类型</p><table><thead><tr><th>类型</th><th>大小( bytes)</th><th>范围</th><th>格式</th><th>用途</th></tr></thead><tbody><tr><td>DATE</td><td>3</td><td>1000-01-01/9999-12-31</td><td>YYYY-MM-DD</td><td>日期值</td></tr><tr><td>TIME</td><td>3</td><td>‘-838:59:59’/‘838:59:59’</td><td>HH:MM:SS</td><td>时间值或持续时间</td></tr><tr><td>YEAR</td><td>1</td><td>1901/2155</td><td>YYYY</td><td>年份值</td></tr><tr><td>DATETIME</td><td>8</td><td>‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td><td>YYYY-MM-DD hh:mm:ss</td><td>混合日期和时间值</td></tr><tr><td>TIMESTAMP</td><td>4</td><td>‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC<br />结束时间是第 2147483647 秒，北京时间 2038-1-19 11:14:07，格林尼治时间 2038年1月19日 凌晨 03:14:07</td><td>YYYY-MM-DD hh:mm:ss</td><td>混合日期和时间值，时间戳</td></tr></tbody></table></li><li><p>字符串类型</p><table><thead><tr><th>类型</th><th>大小</th><th>用途</th></tr></thead><tbody><tr><td>CHAR</td><td>0-255 bytes</td><td>定长字符串</td></tr><tr><td>VARCHAR</td><td>0-65535 bytes</td><td>变长字符串</td></tr><tr><td>TINYBLOB</td><td>0-255 bytes</td><td>不超过 255 个字符的二进制字符串</td></tr><tr><td>TINYTEXT</td><td>0-255 bytes</td><td>短文本字符串</td></tr><tr><td>BLOB</td><td>0-65 535 bytes</td><td>二进制形式的长文本数据</td></tr><tr><td>TEXT</td><td>0-65 535 bytes</td><td>长文本数据</td></tr><tr><td>MEDIUMBLOB</td><td>0-16 777 215 bytes</td><td>二进制形式的中等长度文本数据</td></tr><tr><td>MEDIUMTEXT</td><td>0-16 777 215 bytes</td><td>中等长度文本数据</td></tr><tr><td>LONGBLOB</td><td>0-4 294 967 295 bytes</td><td>二进制形式的极大文本数据</td></tr><tr><td>LONGTEXT</td><td>0-4 294 967 295 bytes</td><td>极大文本数据</td></tr></tbody></table><p>'变长’字符串会根据使用量来计算使用的空间，'定长’字符串会用空格来替代未使用的空间。但是两种方式当写入的数据超过指定的空间时都会报错。</p></li></ol></blockquote></li><li><p>修改表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 RENAME TO 新表名;</span><br></pre></td></tr></table></figure></li><li><p>删除表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE [IF EXISTS] 表名;</span><br></pre></td></tr></table></figure><p>删除指定表，并重新创建该表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE 表名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-字段操作">2.3 字段操作</h4><ul><li><p>添加字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT &#x27;注释&#x27;] [约束];</span><br></pre></td></tr></table></figure></li><li><p>修改</p><p>修改数据类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);</span><br></pre></td></tr></table></figure><p>修改字段名和字段类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT &#x27;注释&#x27;] [约束];</span><br></pre></td></tr></table></figure></li><li><p>删除字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 DROP 字段名;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3）DML数据操纵语言">3）DML数据操纵语言</h3><ul><li><p>添加数据</p><p>给指定字段添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 (字段名1, 字段名2,....) VALUES (值1, 值2,...);</span><br></pre></td></tr></table></figure><p>给全部字段添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 VALUES (值1, 值2,...);</span><br></pre></td></tr></table></figure><p>批量添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 (字段名1, 字段名2,....) VALUES (值1, 值2,...), (值1, 值2,...), ...;</span><br><span class="line">INSERT INTO 表名 VALUES (值1, 值2,...), (值1, 值2,...), ...;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li>插入数据时，指定的字段顺序需要与值的顺序是一一对应的。</li><li>字符串和日期数据应该包含在引号中。</li><li>插入的数据大小，应该在字段规定的范围内。</li></ol></blockquote></li><li><p>修改数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名 SET 字段名1 = 值1,字段名2 = 值2,... [WHERE 条件];</span><br></pre></td></tr></table></figure></li><li><p>删除数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM 表名 [WHERE 条件];</span><br></pre></td></tr></table></figure></li></ul><h3 id="4）DQL数据查询语言">4）DQL数据查询语言</h3><p>1.编写与执行（#）顺序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表# 4</span><br><span class="line">FROM 表名列表# 1</span><br><span class="line">WHERE 条件列表# 2</span><br><span class="line">GROUP BY 分组字段列表# 3</span><br><span class="line">HAVING 分组后条件列表</span><br><span class="line">ORDER BY 排序字段列表# 5</span><br><span class="line">LIMIT 分页参数# 6</span><br></pre></td></tr></table></figure><p>2.查询方式</p><ul><li><p>基础查询</p><p>查询多个字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段1, 字段2,... FROM 表名;</span><br><span class="line">SELECT * FROM 表名;    # 开发中尽量不使用*</span><br></pre></td></tr></table></figure><p>设置别名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段1 [AS &#x27;别名1&#x27;], 字段2 [AS &#x27;别名2&#x27;],... FROM 表名;</span><br><span class="line">SELECT 字段1 [&#x27;别名1&#x27;], 字段2 [&#x27;别名2&#x27;],... FROM 表名;    # 同上</span><br></pre></td></tr></table></figure><p>去除重复记录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT 字段列表 FROM 表名;</span><br></pre></td></tr></table></figure></li><li><p>条件查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 WHERE 条件列表;</span><br></pre></td></tr></table></figure><blockquote><p><strong>运算符:</strong></p><ol><li><p>比较运算符</p><table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td>&gt;</td><td>大于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt; 或 !=</td><td>不等于</td></tr><tr><td>BETWEEN…AND…</td><td>在某个范围之内（含最小、最大值）</td></tr><tr><td>IN(…,…,…)</td><td>在in之后的列表中的值，多选一</td></tr><tr><td>LIKE 占位符</td><td>模糊匹配（_匹配单个字符，%匹配任意个字符）</td></tr><tr><td>IS NULL</td><td>是NULL</td></tr></tbody></table></li><li><p>逻辑运算符</p><table><thead><tr><th>逻辑运算符</th><th>功能</th></tr></thead><tbody><tr><td>AND 或 &amp;&amp;</td><td>并且（多个条件同时成立）</td></tr><tr><td>OR 或</td><td></td></tr><tr><td>NOT 或 !</td><td>非，不是</td></tr></tbody></table></li></ol><hr><p>==条件查询中需要注意的例子==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># BETWEEN 最小值 AND 最大值 （最小、最大值的顺序固定不能变）</span><br><span class="line">SELECT * FROM table1 Where age BETWEEN 14 AND 20;</span><br><span class="line"></span><br><span class="line"># 查询年龄为 15，,20，,30的人</span><br><span class="line">SELECT * FROM table1 Where age IN(15, 20, 30);</span><br><span class="line"></span><br><span class="line"># 查询名字为两个字的人</span><br><span class="line">SELECT * FROM table1 Where name LIKE &#x27;__&#x27;;</span><br><span class="line"></span><br><span class="line"># 查询身份证号最后一位为X的人</span><br><span class="line">SELECT * FROM table1 Where idcard LIKE &#x27;%X&#x27;;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>分组查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 [WHERE 条件] GROUP BY 分组字段名 [HAVING 分组后过滤条件];</span><br></pre></td></tr></table></figure><blockquote><p>WHERE与HAVING区别:</p><ul><li>执行时机不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。</li><li>判断条件不同：where不能对聚合函数进行判断，而having可以。</li></ul><hr><p>==eg.==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 根据性别分组，统计男性员工和女性员工数量</span><br><span class="line">SELECT gender, COUNT(*) GROUP BY gender;</span><br><span class="line"></span><br><span class="line"># 根据性别分组，统计男性员工和女性员工的平均年龄</span><br><span class="line">SELECT gender, AVG(age) GROUP BY gender;</span><br><span class="line"></span><br><span class="line"># 查询年龄小于45的员工，并根据工作地址分组，获取员工数量大于等于3的工作地址</span><br><span class="line">SELECT workaddress, COUNT(*) WHERE age &lt;= 45 GROUP BY workaddress HAVING COUNT(*) &gt;= 3;</span><br></pre></td></tr></table></figure><p>注意：</p><p>执行顺序：where &gt; 聚合函数 &gt; having</p><p>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义。</p></blockquote></li><li><p>排序查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1,字段1 排序方式2,...;</span><br></pre></td></tr></table></figure><blockquote><p>排序方式</p><ul><li><code>ASC</code> 升序（默认）</li><li><code>DESC</code> 降序</li></ul></blockquote></li><li><p>分页查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 LIMIT 起始索引,查询记录数;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li><strong>起始索引从0开始</strong>，起始索引等于（查询页码-1）*每页显示记录数。</li><li>分页查询是数据库的方言，<strong>不同的数据库有不同的实现</strong>，MySQL中是LIMIT。</li><li>如果查询的是第一页数据，起始索引可以省略，直接简写为<code>LIMIT 10</code>。</li></ol></blockquote></li></ul><p>3.聚合函数</p><p>将一列数据作为一个整体，进行纵向计算。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 聚合函数(字段列表) FROM 表名;</span><br></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>count</td><td>统计数量</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>min</td><td>最小值</td></tr><tr><td>avg</td><td>平均值</td></tr><tr><td>sum</td><td>求和</td></tr></tbody></table><blockquote><p>注意：null 不参与聚合函数的运算</p></blockquote><h3 id="5）DCL数据控制语言">5）DCL数据控制语言</h3><h4 id="5-1-管理用户">5.1 管理用户</h4><ul><li><p>查询用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line">SELECT * FROM user;</span><br><span class="line"># 或者</span><br><span class="line">SELECT User FROM mysql.user;</span><br></pre></td></tr></table></figure></li><li><p>创建用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED BY &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>修改用户密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;新密码&#x27;</span><br></pre></td></tr></table></figure></li><li><p>删除用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意：</p><ul><li>主机名可以使用通配符<code>%</code>。</li><li>这类命令一般都是 DBA (Database Administrator 数据管理员) 使用。</li></ul></blockquote><h4 id="5-2-权限控制">5.2 权限控制</h4><ul><li><p>查询权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>授予权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># eg.</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">ON</span> database01.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user01&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>撤销权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 数据库.表名 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意：</p><ul><li>多个权限之间，使用逗号分隔。</li><li>授权时，数据库名和表名可以使用<code>*</code>进行通配，代表所有。</li></ul><hr><p>常用权限：</p><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>ALL,ALL PRIVILEGES</td><td>所有权限</td></tr><tr><td>SELECT</td><td>查询数据</td></tr><tr><td>INSERT</td><td>插入数据</td></tr><tr><td>UPDATE</td><td>修改数据</td></tr><tr><td>DELETE</td><td>删除数据</td></tr><tr><td>ALTER</td><td>修改表</td></tr><tr><td>DROP</td><td>删除数据库/表/视图</td></tr><tr><td>CREATE</td><td>创建数据库/表</td></tr></tbody></table></blockquote><h3 id="6）函数">6）函数</h3><p><strong>函数</strong>是指一段可以直接被另一端程序调用的程序或代码。（尽量不使用SQL去操作，提升性能。）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 函数;</span><br></pre></td></tr></table></figure><h4 id="6-1-字符串函数">6.1 字符串函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CONCAT(S1,S2,…,Sn)</td><td>字符串拼接</td></tr><tr><td>LOWER(str)</td><td>将字符串str全部转为小写</td></tr><tr><td>UPPER(str)</td><td>将字符串str全部转为大写</td></tr><tr><td>LPAD(str,n,pad)</td><td>左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td></tr><tr><td>RPAD(str,n,pad)</td><td>右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td></tr><tr><td>TRIM(str)</td><td>去掉字符串头部和尾部的空格</td></tr><tr><td>SUBSTRING(str,strart,len)</td><td>返回从字符串str从start位置起的len个长度的字符串</td></tr></tbody></table><ul><li><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将id补充至5位（注意id需为varchar类型否则不能在前面添加0）</span><br><span class="line">UPDATE table1 SET id = LPAD(id,5,&#x27;0&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-2-数值函数">6.2 数值函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>向上取整</td></tr><tr><td>FLOOR(x)</td><td>向下取整</td></tr><tr><td>MOD(x,y)</td><td>返回x/y的模</td></tr><tr><td>RAND()</td><td>返回0~1内的随机数</td></tr><tr><td>ROUND(x,y)</td><td>求参数x的四舍五入值，保留y位小数</td></tr></tbody></table><ul><li><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 生成6位随机验证码 随机数有可能生成小于6位的数字，所以用lapd左边补0</span><br><span class="line">select lpad(round(rand(),6) * 1000000,6,&#x27;0&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-3-日期函数">6.3 日期函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CURDATE()</td><td>返回当前日期</td></tr><tr><td>CURTIME()</td><td>返回当前时间</td></tr><tr><td>NOW()</td><td>返回当前日期和时间</td></tr><tr><td>YEAR(date)</td><td>获取指定date的年份</td></tr><tr><td>MONTH(date)</td><td>获取指定date的月份</td></tr><tr><td>DAY(date)</td><td>获取指定date的日份</td></tr><tr><td>DATE_ADD(date,INTERVAL expr type)</td><td>返回一个日期/时间值加上一个事件间隔expr后的时间值</td></tr><tr><td>DATEDIFF(date1,date2)</td><td>返回起始时间 date1 和 结束时间 date2 之间的天数</td></tr></tbody></table><h4 id="6-4-流程函数">6.4 流程函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>IF(vaule, t, f)</td><td>如果value为true，则返回t，否则返回f</td></tr><tr><td>IFNULL(vaule1, vaule2)</td><td>如果value1不为空，则返回value1，否则返回value2</td></tr><tr><td>CASE WHEN [val1] THEN [res1] … ELSE [default] END</td><td>如果val1为true，返回res1，否则返回default默认值</td></tr><tr><td>CASE [expr] WHEN [val1] THEN [res1] … ELSE [default] END</td><td>如果expr等于val1，返回res1，否则返回default默认值</td></tr></tbody></table><h3 id="7）约束">7）约束</h3><p>约束是作用于表中字段上的规则，用于限制储存在表中的数据。</p><p>目的：保证数据库中数据的正确、有效性和完整性。</p><p>约束分类：</p><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段的数据不能为null</td><td>NOT NULL</td></tr><tr><td>唯一约束</td><td>保证该字段的所有数据都是唯一、不重复的</td><td>UNIQUE</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯一</td><td>PRIMARY KEY</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段的值，则采用默认值</td><td>DEFAULT</td></tr><tr><td>检查约束(8.0.16版本之后)</td><td>保证字段值满足某一个条件</td><td>CHECK</td></tr><tr><td>自增约束</td><td>会在新记录插入表中时，生成一个唯一的数字</td><td>AUTO_INCREMENT</td></tr><tr><td><font style="color:red;">外键约束</font></td><td><font style="color:red;">用来让两张表的数据之间建立连接，保证数据的一致性和完整性</font></td><td><font style="color:red;">FOREIGN KEY</font></td></tr></tbody></table><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># id唯一且自增 </span><br><span class="line">CREATE TABLE user(id int PRIMARY KEY AUTO_INCREMENT);</span><br><span class="line"># name不为空且不重复</span><br><span class="line">ALTER TABLE user ADD name VARCHAR(10) NOT NULL UNIQUE;</span><br></pre></td></tr></table></figure><ul><li><p><strong>外键约束</strong>（大厂一般不使用外键约束）</p><p>概念：</p><p>外键的主要作用是保证数据的一致性和完整性，并且减少数据冗余。主要体现在以下两个方面：</p><p>1.阻止执行</p><p>◆ 从表插入新行，其外键值不是主表的主键值便阻止插入。<br>◆ 从表修改外键值，新值不是主表的主键值便阻止修改。<br>◆ 主表删除行，其主键值在从表里存在便阻止删除(要想删除，必须先删除从表的相关行)。<br>◆ 主表修改主键值，旧值在从表里存在便阻止修改(要想修改，必须先删除从表的相关行)。<br>2.级联执行</p><p>◆ 主表删除行，连带从表的相关行一起删除。<br>◆ 主表修改主键值，连带从表相关行的外键值一起修改。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_20-24-38.png" alt="Snipaste_2022-12-23_20-24-38"></p><p>注意：目前上述的两张表，在数据库层面，并未建立外键关联，所以是无法保证数据的一致性和完整性的。</p><ul><li><p>添加外键</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span><br><span class="line">字段名 数据类型,</span><br><span class="line">...</span><br><span class="line">[<span class="keyword">CONSTRAINT</span>] [外键名称] <span class="keyword">FOREIGN</span> KEY(外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名);</span><br></pre></td></tr></table></figure></li><li><p>删除外键</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键名称;</span><br></pre></td></tr></table></figure></li><li><p>删除/更新行为</p><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>NO ACTION</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。（与RESTRICT一致）。</td></tr><tr><td>RESTRICT</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。（与NO ACTION一致）。</td></tr><tr><td>CASCADE</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除/更新外键在子表中的记录。</td></tr><tr><td>SET NULL</td><td>当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null（这就要求外键允许取null）。</td></tr><tr><td>SET DEFAULT</td><td>父表有变更时，子表将外键列设置成一个默认的值（innodb不支持）</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>eg.</p><p>1.创建两张表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student</span><br><span class="line">(</span><br><span class="line">id int (11) primary key auto_increment,</span><br><span class="line">name char(255),</span><br><span class="line">    sex char(255),</span><br><span class="line">age int(11)</span><br><span class="line">)charset utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE student_score</span><br><span class="line">(</span><br><span class="line">id int (11) primary key auto_increment,</span><br><span class="line">class char(255),</span><br><span class="line">    score char(255),</span><br><span class="line">student_id int(11)</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure><p>2.创建外键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE student_score </span><br><span class="line">ADD CONSTRAINT s_id FOREIGN KEY (student_id) REFERENCES student (id);</span><br></pre></td></tr></table></figure><p>3.验证外键的作用</p><p>（1）先向主表中添加数据，再向从表中添加数据（从表中的外键已在主表中存在），正常运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#向 student 表中添加数据</span><br><span class="line">INSERT INTO student(NAME, sex, age) VALUES(&#x27;小明&#x27;, &#x27;男&#x27;, &#x27;20&#x27;);</span><br><span class="line"></span><br><span class="line">#向 student_score 表中添加数据</span><br><span class="line">INSERT INTO student_score (class, score, student_id) VALUES(&#x27;语文&#x27;, &#x27;100&#x27;, 1),(&#x27;数学&#x27;, &#x27;99&#x27;, 1),(&#x27;英语&#x27;, &#x27;98&#x27;, 1);</span><br></pre></td></tr></table></figure><p>数据插入正常，无报错、警告信息。</p><p>（2）触发限制使用默认值 <code>RESTRICT</code> 的情况下</p><p>&lt;&lt;&lt;&lt;1&gt;从表插入新行，外键值不在主表中，被阻止</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO student_score (class, score, student_id) VALUES(&#x27;语文&#x27;, &#x27;100&#x27;, 2);</span><br><span class="line">#[23000][1452] Cannot add or update a child row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>&lt;&lt;&lt;&lt;2&gt;从表修改外键值，新值不是主表的主键值，阻止修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE student_score</span><br><span class="line">SET student_id = 2 WHERE student_id = 1;</span><br><span class="line">#[23000][1452] Cannot add or update a child row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>（3）主表删除行，其主键值在从表里存在便阻止删除(要想删除，必须先删除从表的相关行)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM student WHERE id = 1;</span><br><span class="line">#[23000][1451] Cannot delete or update a parent row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>（4）主表修改主键值，旧值在从表里存在便阻止修改(要想修改，必须先删除从表的相关行)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE student SET id = 2 WHERE id = 1;</span><br><span class="line">#[23000][1451] Cannot delete or update a parent row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure></li></ul><h3 id="8）多表查询">8）多表查询</h3><h4 id="8-1-多表关系">8.1 多表关系</h4><p>项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：</p><p>1<strong>一对多(多对一)</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-39-11.png" alt="Snipaste_2022-12-23_23-39-11"></p><p>2.<strong>多对多</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-41-15.png" alt="Snipaste_2022-12-23_23-41-15"></p><p>SQL脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name varchar(10) comment &#x27;姓名&#x27;,</span><br><span class="line">    no   varchar(10) comment &#x27;学号&#x27;</span><br><span class="line">) comment &#x27;学生表&#x27;;</span><br><span class="line">insert into student</span><br><span class="line">values (null, &#x27;黛绮丝&#x27;, &#x27;2000100101&#x27;),</span><br><span class="line">       (null, &#x27;谢逊&#x27;, &#x27;2000100102&#x27;),</span><br><span class="line">       (null, &#x27;殷天正&#x27;, &#x27;2000100103&#x27;),</span><br><span class="line">       (null, &#x27;韦一笑&#x27;, &#x27;2000100104&#x27;);</span><br><span class="line">  </span><br><span class="line">create table course</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name varchar(10) comment &#x27;课程名称&#x27;</span><br><span class="line">) comment &#x27;课程表&#x27;;</span><br><span class="line">insert into course</span><br><span class="line">values (null, &#x27;Java&#x27;),</span><br><span class="line">       (null, &#x27;PHP&#x27;),</span><br><span class="line">       (null, &#x27;MySQL&#x27;),</span><br><span class="line">       (null, &#x27;Hadoop&#x27;);</span><br><span class="line"> </span><br><span class="line">create table student_course</span><br><span class="line">(</span><br><span class="line">    id        int auto_increment comment &#x27;主键&#x27; primary key,</span><br><span class="line">    studentid int not null comment &#x27;学生ID&#x27;,</span><br><span class="line">    courseid  int not null comment &#x27;课程ID&#x27;,</span><br><span class="line">    constraint fk_courseid foreign key (courseid) references course (id),</span><br><span class="line">    constraint fk_studentid foreign key (studentid) references student (id)</span><br><span class="line">) comment &#x27;学生课程中间表&#x27;;</span><br><span class="line">insert into student_course</span><br><span class="line">values (null, 1, 1),</span><br><span class="line">       (null, 1, 2),</span><br><span class="line">       (null, 1, 3),</span><br><span class="line">       (null, 2, 2),</span><br><span class="line">       (null, 2, 3),</span><br><span class="line">       (null, 3, 4);</span><br></pre></td></tr></table></figure><p>3.<strong>一对一</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-44-24.png" alt="Snipaste_2022-12-23_23-44-24"></p><p>SQL脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">create table tb_user</span><br><span class="line">(</span><br><span class="line">    id     int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name   varchar(10) comment &#x27;姓名&#x27;,</span><br><span class="line">    age    int comment &#x27;年龄&#x27;,</span><br><span class="line">    gender char(1) comment &#x27;1: 男 , 2: 女&#x27;,</span><br><span class="line">    phone  char(11) comment &#x27;手机号&#x27;</span><br><span class="line">) comment &#x27;用户基本信息表&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">create table tb_user_edu</span><br><span class="line">(</span><br><span class="line">    id            int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    degree        varchar(20) comment &#x27;学历&#x27;,</span><br><span class="line">    major         varchar(50) comment &#x27;专业&#x27;,</span><br><span class="line">    primaryschool varchar(50) comment &#x27;小学&#x27;,</span><br><span class="line">    middleschool  varchar(50) comment &#x27;中学&#x27;,</span><br><span class="line">    university    varchar(50) comment &#x27;大学&#x27;,</span><br><span class="line">    userid        int unique comment &#x27;用户ID&#x27;,</span><br><span class="line">    constraint fk_userid foreign key (userid) references tb_user (id)</span><br><span class="line">) comment &#x27;用户教育信息表&#x27;;</span><br><span class="line"> </span><br><span class="line">insert into tb_user(id, name, age, gender, phone)</span><br><span class="line">values (null, &#x27;黄渤&#x27;, 45, &#x27;1&#x27;, &#x27;18800001111&#x27;),</span><br><span class="line">       (null, &#x27;冰冰&#x27;, 35, &#x27;2&#x27;, &#x27;18800002222&#x27;),</span><br><span class="line">       (null, &#x27;码云&#x27;, 55, &#x27;1&#x27;, &#x27;18800008888&#x27;),</span><br><span class="line">       (null, &#x27;李彦宏&#x27;, 50, &#x27;1&#x27;, &#x27;18800009999&#x27;);</span><br><span class="line">insert into tb_user_edu(id, degree, major, primaryschool, middleschool, university, userid)</span><br><span class="line">values (null, &#x27;本科&#x27;, &#x27;舞蹈&#x27;, &#x27;静安区第一小学&#x27;, &#x27;静安区第一中学&#x27;, &#x27;北京舞蹈学院&#x27;, 1),</span><br><span class="line">       (null, &#x27;硕士&#x27;, &#x27;表演&#x27;, &#x27;朝阳区第一小学&#x27;, &#x27;朝阳区第一中学&#x27;, &#x27;北京电影学院&#x27;, 2),</span><br><span class="line">       (null, &#x27;本科&#x27;, &#x27;英语&#x27;, &#x27;杭州市第一小学&#x27;, &#x27;杭州市第一中学&#x27;, &#x27;杭州师范大学&#x27;, 3),</span><br><span class="line">       (null, &#x27;本科&#x27;, &#x27;应用数学&#x27;, &#x27;阳泉第一小学&#x27;, &#x27;阳泉区第一中学&#x27;, &#x27;清华大学&#x27;, 4);</span><br></pre></td></tr></table></figure><h4 id="8-2-多表查询">8.2 多表查询</h4><p>1.数据准备</p><p>创建emp表与dept表并插入测试数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">-- 创建dept表，并插入数据</span><br><span class="line">create table dept</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment comment &#x27;ID&#x27; primary key,</span><br><span class="line">    name varchar(50) not null comment &#x27;部门名称&#x27;</span><br><span class="line">) comment &#x27;部门表&#x27; charset utf8;</span><br><span class="line">INSERT INTO dept (id, name)</span><br><span class="line">VALUES (1, &#x27;研发部&#x27;),</span><br><span class="line">       (2, &#x27;市场部&#x27;),</span><br><span class="line">       (3, &#x27;财务部&#x27;),</span><br><span class="line">       (4, &#x27;销售部&#x27;),</span><br><span class="line">       (5, &#x27;总经办&#x27;),</span><br><span class="line">       (6, &#x27;人事部&#x27;);</span><br><span class="line"></span><br><span class="line">-- 创建emp表，并插入数据</span><br><span class="line">create table emp</span><br><span class="line">(</span><br><span class="line">    id        int auto_increment comment &#x27;ID&#x27; primary key,</span><br><span class="line">    name      varchar(50) not null comment &#x27;姓名&#x27;,</span><br><span class="line">    age       int comment &#x27;年龄&#x27;,</span><br><span class="line">    job       varchar(20) comment &#x27;职位&#x27;,</span><br><span class="line">    salary    int comment &#x27;薪资&#x27;,</span><br><span class="line">    entrydate date comment &#x27;入职时间&#x27;,</span><br><span class="line">    managerid int comment &#x27;直属领导ID&#x27;,</span><br><span class="line">    dept_id   int comment &#x27;部门ID&#x27;</span><br><span class="line">) comment &#x27;员工表&#x27; charset utf8;</span><br><span class="line"> </span><br><span class="line">-- 添加外键</span><br><span class="line">alter table emp</span><br><span class="line">    add constraint fk_emp_dept_id foreign key (dept_id) references dept (id);</span><br><span class="line">INSERT INTO emp (id, name, age, job, salary, entrydate, managerid, dept_id)</span><br><span class="line">VALUES (1, &#x27;金庸&#x27;, 66, &#x27;总裁&#x27;, 20000, &#x27;2000-01-01&#x27;, null, 5),</span><br><span class="line">       (2, &#x27;张无忌&#x27;, 20, &#x27;项目经理&#x27;, 12500, &#x27;2005-12-05&#x27;, 1, 1),</span><br><span class="line">       (3, &#x27;杨逍&#x27;, 33, &#x27;开发&#x27;, 8400, &#x27;2000-11-03&#x27;, 2, 1),</span><br><span class="line">       (4, &#x27;韦一笑&#x27;, 48, &#x27;开发&#x27;, 11000, &#x27;2002-02-05&#x27;, 2, 1),</span><br><span class="line">       (5, &#x27;常遇春&#x27;, 43, &#x27;开发&#x27;, 10500, &#x27;2004-09-07&#x27;, 3, 1),</span><br><span class="line">       (6, &#x27;小昭&#x27;, 19, &#x27;程序员鼓励师&#x27;, 6600, &#x27;2004-10-12&#x27;, 2, 1),</span><br><span class="line">       (7, &#x27;灭绝&#x27;, 60, &#x27;财务总监&#x27;, 8500, &#x27;2002-09-12&#x27;, 1, 3),</span><br><span class="line">       (8, &#x27;周芷若&#x27;, 19, &#x27;会计&#x27;, 48000, &#x27;2006-06-02&#x27;, 7, 3),</span><br><span class="line">       (9, &#x27;丁敏君&#x27;, 23, &#x27;出纳&#x27;, 5250, &#x27;2009-05-13&#x27;, 7, 3),</span><br><span class="line">       (10, &#x27;赵敏&#x27;, 20, &#x27;市场部总监&#x27;, 12500, &#x27;2004-10-12&#x27;, 1, 2),</span><br><span class="line">       (11, &#x27;鹿杖客&#x27;, 56, &#x27;职员&#x27;, 3750, &#x27;2006-10-03&#x27;, 10, 2),</span><br><span class="line">       (12, &#x27;鹤笔翁&#x27;, 19, &#x27;职员&#x27;, 3750, &#x27;2007-05-09&#x27;, 10, 2),</span><br><span class="line">       (13, &#x27;方东白&#x27;, 19, &#x27;职员&#x27;, 5500, &#x27;2009-02-12&#x27;, 10, 2),</span><br><span class="line">       (14, &#x27;张三丰&#x27;, 88, &#x27;销售总监&#x27;, 14000, &#x27;2004-10-12&#x27;, 1, 4),</span><br><span class="line">       (15, &#x27;俞莲舟&#x27;, 38, &#x27;销售&#x27;, 4600, &#x27;2004-10-12&#x27;, 14, 4),</span><br><span class="line">       (16, &#x27;宋远桥&#x27;, 40, &#x27;销售&#x27;, 4600, &#x27;2004-10-12&#x27;, 14, 4),</span><br><span class="line">       (17, &#x27;陈友谅&#x27;, 42, null, 2000, &#x27;2011-10-12&#x27;, 1, null);</span><br></pre></td></tr></table></figure><p>2.概述</p><p>多表查询就是指从多张表中查询数据。原来查询单表数据，执行的SQL形式为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp;</span><br></pre></td></tr></table></figure><p>要执行多表查询，就只需要使用逗号分隔多张表即可:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp, dept; </span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130212342006.png" alt="image-20230130212342006"></p><p>（忽略一些数据）此时,我们看到查询结果中包含了大量的结果集，总共102条记录，而这其实就是员工表emp所有的记录 (17) 与 部门表dept所有记录(6) 的所有组合情况，这种现象称之为笛卡尔积。</p><blockquote><p>《笛卡尔乘积》</p><p>笛卡尔乘积是指在数学中，两个集合A集合 和 B集合的所有组合情况。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-50-12.png" alt="Snipaste_2022-12-23_23-50-12"></p><p>在多表查询中，我们是需要消除无效的笛卡尔积的，只保留两张表关联部分的数据。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/ffed86c8ebe3447686f5bccebbd44155.png" alt="img"></p><p>在SQL语句中，如何来去除无效的笛卡尔积呢？ 我们可以给多表查询加上连接查询的条件即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp , dept where emp.dept_id = dept.id;</span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130212830125.png" alt="image-20230130212830125"></p><p>而由于id为17的员工，没有dept_id字段值，所以在多表查询时，根据连接查询的条件并没有查询到。</p></blockquote><h5 id="8-2-1-连接查询">8.2.1 连接查询</h5><ol><li><p>内连接：相当于查询A、B交集部分数据</p></li><li><p>外连接：</p><p>左外连接：查询左表所有数据，以及两张表交集部分数据</p><p>右外连接：查询右表所有数据，以及两张表交集部分数据</p></li><li><p>自连接：当前表与自身的连接查询，自连接必须使用表别名</p></li></ol><h6 id="1-内连接">1. 内连接</h6><p>相当于查询A、B交集部分数据</p><p>① 隐式内连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span>, 表<span class="number">2</span> <span class="keyword">WHERE</span> 条件...;</span><br></pre></td></tr></table></figure><p>② 显式内连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> [<span class="keyword">INNER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><ul><li><p>eg.</p><ol><li><p>查询每一个员工的姓名 , 及关联的部门的名称 (隐式内连接实现)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#表结构: emp , dept</span><br><span class="line">#连接条件: emp.dept_id = dept.id</span><br><span class="line"></span><br><span class="line">select emp.name, dept.name</span><br><span class="line">from emp,</span><br><span class="line">     dept</span><br><span class="line">where emp.dept_id = dept.id;</span><br><span class="line"># 为每一张表起别名,简化SQL编写</span><br><span class="line">select e.name,d.name from emp e , dept d where e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130213622166.png" alt="image-20230130213622166"></p></li><li><p>查询每一个员工的姓名 , 及关联的部门的名称 (显式内连接实现)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select e.name, d.name</span><br><span class="line">from emp e</span><br><span class="line">         inner join dept d on e.dept_id = d.id;</span><br><span class="line"># 为每一张表起别名,简化SQL编写</span><br><span class="line">select e.name, d.name</span><br><span class="line">from emp e</span><br><span class="line">         join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><blockquote><p>注意事项：</p><p>一旦为表起了别名，就不能再使用表名来指定对应的字段了，此时只能够使用别名来指定字段。</p></blockquote></li></ol></li></ul><h6 id="2-外连接">2. 外连接</h6><p>① 左外连接：查询左表所有数据，以及两张表交集部分数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 相当于查询表<span class="number">1</span>（左表）的所有数据 包含表<span class="number">1</span>和表<span class="number">2</span>交集部分的数据</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">LEFT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><p>② 右外连接：查询右表所有数据，以及两张表交集部分数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">RIGHT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><ul><li><p>eg.</p><ol><li><p><strong>查询emp表的所有数据, 和对应的部门信息</strong></p><p>由于需求中提到，要查询emp的所有数据，所以是不能内连接查询的，需要考虑使用外连接查询。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.*, d.name from emp e left outer join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130214721226.png" alt="image-20230130214721226"></p></li><li><p><strong>查询dept表的所有数据, 和对应的员工信息(右外连接)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select d.*, e.* from emp e right outer join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130214854779.png" alt="image-20230130214854779"></p></li></ol><blockquote><p>注意事项：</p><p>左外连接和右外连接是可以相互替换的，只需要调整在连接查询时SQL中，表结构的先后顺序就可以了。而我们在日常开发使用时，更偏向于左外连接。</p></blockquote></li></ul><h6 id="3-自连接">3. 自连接</h6><p>当前表与自身的链接查询，自链接必须使用表别名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表A 别名A JOIN 表B 别名B ON 条件...;</span><br></pre></td></tr></table></figure><blockquote><p>对于自连接查询，可以是内连接查询，也可以是外连接查询</p><p>注意事项:</p><p>在自连接查询中，必须要为表起别名，要不然我们不清楚所指定的条件、返回的字段，到底是哪一张表的字段。</p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询员工及其所属领导的名字</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.name, b.name from emp a, emp b where a.managerid = b.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130220003537.png" alt="image-20230130220003537"></p></li><li><p><strong>查询所有员工 emp 及其领导的名字 emp , 如果员工没有领导, 也需要查询出来</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.name &#x27;员工&#x27;, b.name &#x27;领导&#x27; from emp a left join emp b on a.managerid = b.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130220032095.png" alt="image-20230130220032095"></p></li></ol></li></ul><h5 id="8-2-2-联合查询">8.2.2 联合查询</h5><p>对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表A ... </span><br><span class="line">UNION [ALL] </span><br><span class="line">SELECT 字段列表 FROM 表B ....;</span><br></pre></td></tr></table></figure><p>1.对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致。</p><p>2.union all 会将全部的数据直接合并在一起，union 会对合并之后的数据去重。</p><ul><li><p>eg.</p><ol><li><p>将薪资低于 5000 的员工和年龄大于 50 岁的员工全部查询出来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE salary &lt; 5000</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT * FROM emp WHERE age &gt; 50;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130230029057.png" alt="image-20230130230029057"></p><blockquote><p>union all查询出来的结果，仅仅进行简单的合并，并未去重。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE salary &lt; 5000</span><br><span class="line">UNION</span><br><span class="line">SELECT * FROM emp WHERE age &gt; 50;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130230141485.png" alt="image-20230130230141485"></p><blockquote><p>union 联合查询，会对查询出来的结果进行去重处理。</p></blockquote></li></ol></li></ul><h5 id="8-2-3-子查询">8.2.3 子查询</h5><p>SQL语句中嵌套SELECT语句，称为嵌套查询，又称子查询。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t1 WHERE column = (SELECT column1 FROM t2);</span><br></pre></td></tr></table></figure><p>子查询外部的语句可以是INSERT / UPDATE / DELETE / SELECT 的任何一个。</p><ul><li><p>根据子查询结果不同，分为：</p><ul><li><p><strong>标量子查询</strong>（子查询结果为单个值）</p><blockquote><p>子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种查询称为标量子查询。</p><p>常用的操作符： <code>=</code> <code>&gt;</code> <code>≥</code> <code>&lt;</code> <code>≤</code> <code>&lt;&gt;</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询 “销售部” 的所有员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 先查询 “销售部” 部门ID</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from dept where name = &#x27;销售部&#x27;;</span><br></pre></td></tr></table></figure><p>② 根据 “销售部” 部门ID, 查询员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where dept_id = (select id from dept where name = &#x27;销售部&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询在 “方东白” 入职之后的员工信息</strong></p><p>① 完成这个需求时，我们也可以将需求分解为两步：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select entrydate from emp where name = &#x27;方东白&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询指定入职日期之后入职的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where entrydate &gt; (select entrydate from emp where name = &#x27;方东白&#x27;);</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>列子查询</strong>（子查询结果为一列）</p><blockquote><p>子查询返回的是一列（可以是多行的），这种查询称为列子查询。</p><p>常用操作符：<code>IN</code> <code>NOT IN</code> <code>ANY</code> <code>SOME</code> <code>ALL</code></p></blockquote><table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td>IN</td><td>在指定的集合范围之内，多选一</td></tr><tr><td>NOT IN</td><td>不在指定的集合范围之内</td></tr><tr><td>ANY</td><td>子查询返回列表中，有任意一个满足即可</td></tr><tr><td>SOME</td><td>与ANY等同，使用SOME的地方都可以使用ANY</td></tr><tr><td>ALL</td><td>子查询返回列表的所有值都必须满足</td></tr></tbody></table><ul><li><p>eg.</p><ol><li><p><strong>查询 “销售部” 和 “市场部” 的所有员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 查询 “销售部” 和 “市场部” 的部门ID</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM dept WHERE name = &#x27;销售部&#x27; or name = &#x27;市场部&#x27;;</span><br></pre></td></tr></table></figure><p>② 根据部门ID, 查询员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE dept_id in (SELECT id FROM dept WHERE name = &#x27;销售部&#x27; or name = &#x27;市场部&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询比 财务部 所有人工资都高的员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为三步：</p><p>① 查询财务部的id</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM dept WHERE name = &#x27;财务部&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询财务部所有人员的工资</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select salary</span><br><span class="line">from emp</span><br><span class="line">where dept_id = (select id from dept where name = &#x27;财务部&#x27;);</span><br></pre></td></tr></table></figure><p>③ 比财务部所有人工资都高的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where salary &gt; all (select salary from emp where dept_id = (select id from dept where name = &#x27;财务部&#x27;));</span><br></pre></td></tr></table></figure></li><li><p><strong>查询比研发部其中任意一人工资高的员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 查询研发部所有人工资</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select salary</span><br><span class="line">from emp</span><br><span class="line">where dept_id = (select id from dept where name = &#x27;研发部&#x27;);</span><br></pre></td></tr></table></figure><p>② 比研发部其中任意一人工资高的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where salary &gt; any (select salary from emp where dept_id = (select id from dept where name = &#x27;研发部&#x27;));</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>行子查询</strong>（子查询结果为一行）</p><blockquote><p>子查询返回的结果是一行（可以是多列），这种查询称为行子查询。</p><p>常用的操作符： <code>=</code> <code>&lt;&gt;</code> <code>IN</code> <code>NOT IN</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询与 “张无忌” 的薪资及直属领导相同的员工信息</strong></p><p>① 查询 “张无忌” 的薪资及直属领导</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select salary, managerid from emp where name = &#x27;张无忌&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询与 “张无忌” 的薪资及直属领导相同的员工信息 ;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where (salary, managerid) = (select salary, managerid from emp where name = &#x27;张无忌&#x27;);</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>表子查询</strong>（子查询结果为多行多列）</p><blockquote><p>子查询返回的结果是多行多列，这种查询称为表子查询。</p><p>常用的操作符：  <code>IN</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息</strong></p><p>① <strong>查询 “鹿杖客” , “宋远桥” 的职位和薪资</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select job, salary</span><br><span class="line">from emp</span><br><span class="line">where name = &#x27;鹿杖客&#x27;</span><br><span class="line">   or name = &#x27;宋远桥&#x27;;</span><br></pre></td></tr></table></figure><p>② <strong>查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where (job, salary) in (select job, salary from emp where name = &#x27;鹿杖客&#x27; or name = &#x27;宋远桥&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询入职日期是 “2006-01-01” 之后的员工信息 , 及其部门信息</strong></p><p>① 入职日期是 “2006-01-01” 之后的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where entrydate &gt; &#x27;2006-01-01&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询这部分员工, 对应的部门信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select e.*, d.*</span><br><span class="line">from (select * from emp where entrydate &gt; &#x27;2006-01-01&#x27;) e</span><br><span class="line">         left join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure></li></ol></li></ul></li></ul></li><li><p>根据子查询位置，分为:</p><ul><li>WHERE之后</li><li>FROM之后</li><li>SELECT之后</li></ul></li></ul><h3 id="9）事务">9）事务</h3><p>事务是一组操作的集合，它是一个不可分割的工作单位，事物会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p><p>默认MySQL的事务是自动提交的，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。</p><h4 id="9-1-事务的四大特性ACID">9.1 事务的四大特性ACID</h4><ul><li><p>原子性 (Atomicity):事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</p></li><li><p>一致性 (Consistency):事务完成时，必须使所有的数据都保持一致状态。</p></li><li><p>隔离性 (Isolation):数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</p></li><li><p>持久性 (Durability):事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</p><p><strong>注意：只有当前三条性质都满足了，才能保证事务的一致性</strong></p></li></ul><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2f0798cbce574f478c9f03ac813fff55.png" alt="在这里插入图片描述"></p><blockquote><p><strong>刷脏</strong>：Mysql为了保证存储效率，于是每次将要读写的文件是先存储在缓存池中，对于数据的操作是在缓存池中，而mysql将会定期的刷新到磁盘中。</p></blockquote><blockquote><p>1、如何保证原子性：</p><p>首先：对于A和B两操作要操作成功就一定需要更改到表的信息，如果如图所示A语句操作成功，而B语句操作时出现断电等其他情况终止了操作，所以此时两个事务没有操作成功，在没有提交事务之前，mysql会先记录跟新前的数据到undo log日志里面，当最终的因为操作不成功而发生事务回滚时，会从undo log日志里面先前存好的数据，重新对数据库的数据进行数据的回退。</p><p>undo log日志：（撤销回退的日志）主要存储数据库更新之前的数据，用于作备份</p><p>2、如何保证事务的持久性：</p><p>通过重做日志：redo log日志，对于用户将对发生了修改而为提交的数据存入了redo log日志中，当此时发生断电等其他异常时，可以根据redo log日志重新对数据做一个提交，做一个恢复。<br><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/e9263317bc3a4554b839a4efefbcf60d.png" alt="img"></p><p>3、隔离性：</p><blockquote><p>(1)事务的并发问题：</p><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另外一个事务还没有提交的数据。</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了‘’幻影‘’。</td></tr></tbody></table><ol><li><p>脏读（读未提交）</p><p>事务A读取到了事务已经修改但未提交的数据，这种数据就叫脏数据，是不正确的</p></li></ol><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/0e5ac64c906c4d13b6dbdecda01b5910.png" alt="在这里插入图片描述"></p><ol start="2"><li><p>读已提交：（不可重复读）</p><p>不可重复读：对于事务A多次读取同一个数据时，由于其他是事务也在访问这个数据，进行修改且提交，对于事务A，读取同一个数据时，有可能导致数据不一致，叫不可重复读</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2b755a18343a4122a434c5d955804492.png" alt="在这里插入图片描述"></p></li><li><p>可重复读：（幻读）</p><p>幻读：原因：因为mysql数据库读取数据时，是将数据放入缓存中，当事务B对数据库进行操作：例如删除所有数据且提交时，事务A同样能访问到数据，这就产生了幻读。问题：解决了可重复读，但是会产生一种问题，错误的读取数据，对于其他事务添加的数据也将访问不到</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/86be832bbeb348ea8b736e6331ec58c0.png" alt="在这里插入图片描述"></p></li><li><p>串行化</p><p>串行化：事务A和事务B同时访问时，在事务A修改了数据，而没有提交数据时，此时事务B想增加或修改数据时，只能等待事务A的提交，事务B才能够执行。</p><p>问题：用户的体验十分的差，因为每次访问时都要等待其他事务的提交才能操作</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/03fed1e189d940fb912068ca894f4f6e.png" alt="在这里插入图片描述"></p></li></ol></blockquote><blockquote><p>(2)事务的隔离等级:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看事务的隔离级别</span><br><span class="line">SELECT @@TRANSACTION_ISOLATION;</span><br><span class="line"># 或者</span><br><span class="line">select @@global.tx_isolation,@@tx_isolation;</span><br><span class="line"></span><br><span class="line"># 设置事物隔离级别 （SESSION 为当前窗口）</span><br><span class="line">SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL &#123;READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>隔离级别</th><th>中文</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td><code>Read uncommitted</code></td><td>读未提交</td><td>√</td><td>√</td><td>√</td></tr><tr><td><code>Read committed</code></td><td>读已提交</td><td>×</td><td>√</td><td>√</td></tr><tr><td><code>Repeatable Read</code></td><td>可重复读(默认)</td><td>×</td><td>×</td><td>√</td></tr><tr><td><code>Serializable</code></td><td>串行化</td><td>×</td><td>×</td><td>×</td></tr></tbody></table><ol><li><p>读未提交：事物A和事物B，事物A未提交的数据，事物B可以读取到。 这种隔离级别最低，这种级别一般是在理论上存在，数据库隔离级别一般都高于该级别。 <strong>三种并发问题都没解决。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure></li><li><p>读已提交：事务A只能读取到事务B提交的数据，这种级别可以避免“脏数据” ，这种隔离级别会导致“不可重复读取” ，<strong>Oracle默认隔离级别</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read committed;</span><br></pre></td></tr></table></figure></li><li><p>可重复读：- 事务A和事务B，事务A提交之后的数据，事务B读取不到 - 事务B是可重复读取数据 - 这种隔离级别高于读已提交 - 换句话说，对方提交之后的数据，我还是读取不到 - 这种隔离级别可以避免“不可重复读取”，达到可重复读取 - 比如1点和2点读到数据是同一个 - MySQL默认级别 - 虽然可以达到可重复读取，但是会导致“幻像读”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level repeatable read;</span><br></pre></td></tr></table></figure></li><li><p>串行化：事务A和事务B，事务A在操作数据库时，事务B只能排队等待 这种隔离级别很少使用，吞吐量太低，用户体验差 这种级别可以避免“幻像读”，每一次读取的都是数据库中真实存在数据，事务A与事务B串行， 而不并发</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level serializable;</span><br></pre></td></tr></table></figure></li></ol></blockquote><blockquote><p>(3)隔离级别的一致性的关系：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/fe8bf94eb677468da203a783d44ade6a.png" alt="在这里插入图片描述"></p></blockquote></blockquote><h4 id="9-2-事务操作">9.2 事务操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前事务是否自动</span><br><span class="line">SELECT @@autocommit;</span><br><span class="line"></span><br><span class="line"># 方法1</span><br><span class="line"># 查看/设置事务提交方式 1为自动提交 0为手动提交</span><br><span class="line">SET @@autocommit = 0;</span><br><span class="line"># 方法2</span><br><span class="line"># 开启事务</span><br><span class="line">START TRANSACTION 或 BEGIN;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line"># 回滚事务</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure><h2 id="进阶">进阶</h2><h3 id="1）存储引擎">1）存储引擎</h3><ol><li><p>MySQL体系结构</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200604182023796.png" alt="20200604182023796"></p><blockquote><ul><li><p>连接层</p><p>最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关的完全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p></li><li><p>服务层</p><p>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。</p></li><li><p>引擎层</p><p>存储引擎真正的负责了MySQL中数据的储存和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取核实的存储引擎。</p></li><li><p>存储层</p><p>主要是将数据存储在文件系统之上，并完成与储存引擎的交互。</p></li></ul></blockquote></li><li><p>存储引擎介绍</p><p>存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查询建表语句</span><br><span class="line">SHOW CREATE TABLE 表名;</span><br><span class="line"># ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line"></span><br><span class="line"># 创建表时，指定存储引擎</span><br><span class="line">CREATE TABLE 表名(</span><br><span class="line">字段1 字段1类型,</span><br><span class="line">....</span><br><span class="line">)ENGINE = 存储引擎 [COMMENT 表注释];</span><br><span class="line"></span><br><span class="line"># 查看当前数据库支持的存储引擎</span><br><span class="line">SHOW ENGINES;</span><br></pre></td></tr></table></figure></li><li><p>存储引擎特性</p><p>1.采用的是插拔式的插件方式；<br>2.存储引擎是指定在表之上的，即一个库中的每一个表都可以指定选择存储引擎；<br>3.不管表采用什么样的存储引擎，都会在数据区，产生对应的一个.frm文件（表结构定义描述文件，下文有介绍。好像是在MySQL 8.0中，.frm 文件已经不存在了，此处以MySQL5.7介绍）<br><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-25_13-35-18.png" alt="Snipaste_2022-12-25_13-35-18"></p></li></ol><blockquote><p><strong>Tips：以下所有内容，基于 MySQL 5.7.28 版本介绍（CSV、Archive、Memory、InnoDB、MyISAM。其它引擎就不过多介绍）</strong></p></blockquote><h4 id="10-1-InnoDB存储引擎-5-5后默认-重要">10.1 InnoDB存储引擎(5.5后默认)(重要)</h4><p>10.1.1 InnoDB介绍</p><p>InnoDB特点总结：</p><p>​DML操作遵循ACID模型，支持事务；</p><p>​行级锁，提高并发访问性能；</p><p>​支持外键FOREIGN KEY约束，保证数据的完整性和正确性。</p><blockquote><p>在 MySQL 5.5 及以后版本后，MySQL 选择使用 InnoDB为默认存储引擎。在创建数据库表时，不指定存储引擎时，使用的就是 InnoDB。如需使用其他存储引擎，可以手动来指定。</p><p>特点：</p><ol><li>InnoDB 支持事务操作；（每一条SQL都默认封装成事务，自动提交，会影响速度）</li><li>InnoDB 支持外键；</li><li>InnoDB 是聚集索引（聚簇索引）；</li><li>InnoDB 不保存表的总条数；</li><li>InnoDB 5.7版本之前不支持全文检索；</li><li>InnoDB 支持表级锁、行级锁，默认为行级锁；</li><li>InnoDB 表必须有主键（如果我们没有明确去指定创建主键索引。它会帮我们隐藏的生成一个 6 byte 的 int 型的索引作为主键索引）；</li><li>InnoDB 文件存储方式为.frm文件存储表结构，ibd文件存储数据内容。</li></ol><blockquote><p>名词解释：</p><p>什么是聚集(簇)索引？</p><p>聚簇索引的特点是叶子节点包含了完整的记录行，而非聚簇索引的叶子节点只有所以字段和主键ID。</p><p>MySQL 索引采用 B+Tree（不熟悉？来跳转链接了解：MySQL 索引底层为什么选择B+Tree）。InnoDB 和 MyISAM 作为 MySQL 中 B+Tree 索引的两种重要体现形式。</p><p>InnoDB 推荐以主键作为索引来组织数据进行存储，它认为主键是一个非常重要的属性。InnoDB 表数据文件本身就是按B+Tree组织的一个索引结构，聚簇索引就是按照每张表的主键来构造一个B+树，叶子节点中存放的就是整张表的数据。</p><p>一般建表会用一个自增主键做聚簇索引，没有的话MySQL会默认创建，但是这个主键如果更改代价较高，故建表时要考虑自增ID不能频繁 update 这一点。</p><p>（估计你还看不懂，哈哈。那就看看这里你就懂了----&gt;MySQL一张表，比如有id(主键)，name，age等字段。我们可以建很多个索引，MySQL除了主键索引外，都是非聚簇索引。即只有我们创建的主键id索引，我们可以叫他id索引，它别名又叫做聚簇索引，（因为只有id索引，叶子节点包含了完整的记录行）理解成一个别名的即可。如果我们再创建一个name索引，它就叫做非聚簇索引，或者辅助索引。）【也可参考：MyISAM 和 InnoDB 的区别 文中介绍的聚簇索引】</p><p>我们日常工作中，根据实际情况自行添加的索引都是辅助索引，辅助索引就是一个为了需找主键索引的二级索引，现在找到主键索引再通过主键索引找数据；</p></blockquote></blockquote><p>InnoDB 支持的一些特性，我们在此无法验证，你只需要记住就好了。现在我们有一个<strong>db_store库</strong>，库中我们创建一个 employee 表，我们来看一下它在硬盘中的存储情况。</p><p>10.1.2 使用InnoDB存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `employee` (</span><br><span class="line">  `employeeID` int(11) NOT NULL,</span><br><span class="line">  `userName` varchar(16) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `phoneNum` varchar(32) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `createTime` datetime DEFAULT NULL,</span><br><span class="line">  `lastUpdate` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`employeeID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br></pre></td></tr></table></figure><p>10.1.3 了解 InnoDB 硬盘存储方式</p><p>进入<code>/usr/local/mysql/data</code> 目录，再进入到 db_store 目录下，我们便能够很真实的看到数据库中的数据在硬盘中存储，它其实就是以两个文件（employee.frm、employee.ibd）的方式体现。(此处可以看到有employee 和 store 两个，说明 db_store 库下有两个表)</p><blockquote><p><strong>.frm 和 .ibd 格式文件介绍</strong></p><p><strong>.frm文件</strong>：保存的是表结构定义描述文件<br><strong>.ibd文件</strong>：保存的是employee表中的数据内容</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200605164659478.png" alt="在这里插入图片描述"></p></blockquote><h4 id="10-2-MyISAM存储引擎-早期默认">10.2 MyISAM存储引擎(早期默认)</h4><p>10.2.1 MyISAM介绍</p><p>MyISAM特点总结：</p><p>​不支持事务，不支持外键；</p><p>​支持表锁，不支持行锁；</p><p>​访问速度快。</p><blockquote><p>MyISAM 作为 MySQL 中 B+Tree 索引的另一种重要体现形式。</p><p>特点：</p><ol><li><p>MyISAM 是非聚集索引；</p></li><li><p>MyISAM 有一个变量专门来保存整个表的行数，查询count很快(注意不能加任何 where 条件)</p></li><li><p>MyISAM 支持全文索引；</p></li><li><p>MyISAM 可以被压缩后进行查询操作，节省空间容量；</p></li><li><p>MyISAM 支持表级锁，不支持行级锁；</p></li><li><p>MyISAM 中主键不是必须的；</p></li><li><p>MyISAM 文件存储方式为.frm文件存储表结构，.MYD文件存储数据内容，.MYI文件存储索引文件。</p></li></ol></blockquote><p>现在我们在<code>**db_store库**</code>，库中我们创建一个 employee_myisam 表，来看一下它在硬盘中的存储情况。</p><p>10.2.2 使用MyISAM存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `employee_myisam` (</span><br><span class="line">  `employeeID` int(11) NOT NULL,</span><br><span class="line">  `userName` varchar(16) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `phoneNum` varchar(32) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `createTime` datetime DEFAULT NULL,</span><br><span class="line">  `lastUpdate` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`employeeID`)</span><br><span class="line">) ENGINE=MyISAM CHARSET=utf8 COLLATE=utf8_bin;</span><br></pre></td></tr></table></figure><p>10.2.3 了解 MyIsam 硬盘存储方式</p><p>进入<code>/usr/local/mysql/data</code> 目录，再进入到 db_store 目录下，我们便能够很真实的看到数据库中的数据在硬盘中存储，它其实就是以**三个文件（xxx.frm、xxx.MYD、xxx.MYI）**的方式体现。</p><blockquote><p><strong>.frm | .MYD | .MYI 格式文件介绍</strong></p><p><strong>.frm文件</strong>：保存的是表结构定义描述文件<br><strong>.MYD文件</strong>：保存的是数据内容<br><strong>.MYI文件</strong>：保存的是索引内容</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200605171922206.png" alt="在这里插入图片描述"></p></blockquote><h4 id="10-MyISAM-和-InnoDB-的区别">10.- <a href="https://blog.csdn.net/lzb348110175/article/details/106575270">MyISAM 和 InnoDB 的区别</a></h4><h4 id="10-3-Memory存储引擎">10.3 Memory存储引擎</h4><p>表数据暂时存储在内存中，由于受硬件问题、断电的影响，只能将这些表作为临时表或缓存使用。</p><p>10.3.1 Memory介绍</p><p>特点：</p><p>​内存存放;</p><p>​hash索引（默认）。</p><blockquote><p>Memory存储引擎（在以往的版本中，又叫 Heap 存储引擎）。数据存储在内存中，在实际的应用场景中用到的很少，但是它与优化器查询有很大的关系，对临时表很有用。（不了解优化器查询？？请点击链接：不会MySQL调优？来来瞅瞅SQL的执行计划吧了解）</p><p>Memory中基于Hash索引，底层是 Hash 表，对于精确查询非常高效。即：在’='、'in’条件下高效，无法通过索引做区间查询。只能扫描全表。（范围查询、排序、组合索引效率不高）</p><p>特点：</p><ol><li>数据都是存储在内存中，IO效率比其他引擎高很多；（优点：效率高）</li><li>服务重启后数据会丢失，内存数据表默认只有16M（缺点：保证不了持久性）</li><li>支持 Hash索引，B Tree索引，默认为 Hash索引</li><li>不支持大数据存储类型，如 blog，text 等</li><li>表级锁</li></ol><blockquote><p>应用场景：</p><ol><li>等值查找热度较高数据；</li><li>查询结果在内存中进行计算，大多数都是采用这种存储引擎作为临时表存储需要计算的数据；</li></ol></blockquote></blockquote><p>工作中，使用内存管理这块，我们根本不需要考虑 Memory 这种存储引擎， Redis、Memcache 等它们不香吗？？Memory存储引擎更多的使用在 MySQL 优化器查询阶段。下面简单介绍一下：</p><p>在优化器查询阶段，会以生成一个 template 临时表的方式查询。它的内存数据表默认只有 16M，并不支持大数据类型的存储字段。在查询阶段，如果满足 Memory 存储引擎的所有条件，就会在优化器查询阶段使用 Memory 存储引擎。如果不满足条件，则会使用 MyISAM 引擎。</p><p>10.2.2 了解 Memory 硬盘存储方式</p><p>xxx.sdi：存储表结构信息</p><h4 id="10-4-Archive存储引擎">10.4 Archive存储引擎</h4><p>10.4.1 Archive介绍</p><blockquote><p>Archive存储引擎，是以<code>压缩协议</code>进行数据的存储</p><p><strong>特点：</strong></p><ol><li>只支持 insert 和 select 两种操作；<code>（缺点：不适用于对数据的处理操作）</code></li><li>只允许自增ID列建立索引<code>（缺点：还是不方便数据的处理）</code></li><li>支持行级锁</li><li>不支持事务</li><li>优点：数据占用磁盘少</li></ol><blockquote><p><strong>应用场景：</strong></p><ol><li>日志系统；</li><li>大量的设备数据采集；</li></ol></blockquote></blockquote><p>10.4.2 使用Archive存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `users_archive` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `address` varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE=Archive;</span><br></pre></td></tr></table></figure><p>10.4.3 Archive对比InnoDB，使用函数批量存储1w条数据</p><p>Archive比InnoDB可以节省95%的容量。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//批量添加函数:</span><br><span class="line">CREATE DEFINER=`root`@`%` PROCEDURE `users_archive_batchAdd`()</span><br><span class="line">begin</span><br><span class="line">    declare i int;</span><br><span class="line">    set i=1;</span><br><span class="line">    while i&lt;10000 do</span><br><span class="line">INSERT INTO users_archive(id,name,age,address) VALUES(i,concat(&#x27;James&#x27;,i),i,concat(&#x27;BeiJing&#x27;,i));</span><br><span class="line">        set i=i+1;</span><br><span class="line">     end while;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>10.4.3 查看数据所在硬盘位置</p><p>入到存储数据所在的硬盘下，便可以看到 users_archive 相关的表（<code>.frm</code> 为表结构文件；<code>.ARZ</code>为数据文件）</p><h4 id="10-5-CSV存储引擎">10.5 CSV存储引擎</h4><p>10.5.1 CSV介绍</p><blockquote><p>CSV存储引擎，数据是以CSV文件存储。</p><p>特点：</p><p>不能定义索引，列定义必须为NOT NULL，不能设置自增列；（缺点：不适用于大表或者数据查询、排序等处理操作）<br>CSV数据的存储需要用,逗号隔开，可直接编辑 CSV文件进行数据的编排（缺点：数据安全性低）可以对硬盘中保存的表文件数据进行直接编辑xxx.CSV文件，但是不能将该文件删除然后上传自己的同名.CSV文件(该文件中可能还有额外一些和表相关的数据)，我们只能对其中数据进行编辑操作。编辑之后，通过命令：flush table XXX表名的方式使其生效</p><blockquote><p><strong>应用场景：</strong></p><ol><li>数据的快速导入导出；</li><li>表格直接转换成CSV；</li></ol></blockquote></blockquote><p>10.5.2 使用CSV存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `users_csv` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `age` int(11) NOT NULL,</span><br><span class="line">  `address` varchar(255) NOT NULL</span><br><span class="line">) ENGINE=csv;</span><br></pre></td></tr></table></figure><p>10.5.3 查看数据所在硬盘位置</p><p>进入到存储数据所在的硬盘下，便可以看到 users_csv 相关的表（<code>.frm</code> 为表结构文件；<code>.CSV</code>为数据文件，<code>.CSM</code>不了解是干嘛的）</p><ol start="4"><li><p>存储引擎的选择</p><p>在选择存储引擎时，应该根据应用系统的特点选择核实的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p><ul><li>InnoDB：是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。</li><li>MyISAM：如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常适合的。</li><li>MEMORY：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。</li></ul></li></ol><h3 id="2）索引">2）索引</h3><p>索引（index）是帮助MySQL高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p><hr><h2 id="运维">运维</h2><h3 id="1）日志">1）日志</h3><h4 id="1-1-错误日志">1.1 错误日志</h4><p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任故障导致无法正常使用时，建议首先查看此日志。</p><p>该日志是默认开启的，默认存放目录<code>/var/log/</code>，默认的日志文件名为 mysqld.log 。</p><ul><li><p>查看日志位置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_error%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​<img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108172911709.png" alt="image-20230108172911709"></p><h4 id="1-2-二进制日志">1.2 二进制日志</h4><p>二进制日志（BINLOG）记录了所有的DDL（数据定义语言）语句和 DML (数据库操纵语言)语句，但不包括数据查询（SELECT、SHOW）语句。</p><ul><li><p>作用：</p><p>①灾难时的数据恢复；</p><p>②MySQL的主从复制；</p></li><li><p>查看日志位置：</p><p>在MySQL8版本中，默认二进制日志是开启着的，参数如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_bin%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​<img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108174925535.png" alt="image-20230108174925535"></p><ul><li><p>日志格式</p><ul><li><p>查看当前日志格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_format%&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108175118768.png" alt="image-20230108175118768"></p></li></ul><ul><li><p>修改日志格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改参数</span></span><br><span class="line">binlog_format=STATEMENT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><table><thead><tr><th>日志格式</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td>STATEMENT</td><td style="text-align:left">基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。</td></tr><tr><td>ROW</td><td style="text-align:left">基于行的日志记录，记录的是每一行的数据变更。（默认）</td></tr><tr><td>MIXED</td><td style="text-align:left">混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下回自动切换为ROW进行记录</td></tr></tbody></table></li></ul></li><li><p>日志查看</p><p>由于日志是以二进制方式存储的，不能直接读取，Linux 下需要通过二进制日志查询工具 mysqlbinlog 来查看，具体语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [参数选项] logfilename</span><br><span class="line"></span><br><span class="line">参数选项：</span><br><span class="line">-d 指定数据库名称，只列出指定的数据库相关操作</span><br><span class="line">-o 忽略掉日志中的前n行命令</span><br><span class="line">-v 将行事件（数据变更）重构为SQL语句</span><br><span class="line">-vv 将行事件（数据变更）重构为SQL语句，并输出注释信息</span><br></pre></td></tr></table></figure></li><li><p>日志删除</p><p>对于比较繁忙的业务系统，每天生成的binlog数据巨大，如果长时间不清除，将会占用大量磁盘空间。可以通过以下方式清理日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reset master    # 删除全部binlog日志，删除之后，日志编号，将从binlog.000001开始</span><br><span class="line">purge master logs to &#x27;binlog.******&#x27;   # 删除 ****** 编号之前的所有日志</span><br><span class="line">purge master logs before &#x27;yyyy-mm-dd hh24:mi:ss&#x27;   # 删除日之味&quot;yyy-mm-dd hh24:mi:ss&quot;之前产生的所有日志</span><br></pre></td></tr></table></figure><p>也可以在MySQL的配置文件中配置二进制日志的过期时间，设置了之后，二进制日志过期会自动删除。(默认单位为秒 30天)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_expire_logs_seconds%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​<img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108185211069.png" alt="image-20230108185211069"></p><h4 id="1-3-查询日志">1.3 查询日志</h4><p>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。默认情况下，查询日志是未开启的。如果需要开启查询日志，可以设置一下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108185524882.png" alt="image-20230108185524882"></p><p>修改MySQL的配置文件<code>/etc/my.cnf</code>，添加如下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该选项用来开启查询日志，可选值：0或1,0代表关闭。</span></span><br><span class="line">general_log=1</span><br><span class="line"><span class="comment"># 设置日志的文件名，如果没有指定，默认的文件名为 host_name.log</span></span><br><span class="line"><span class="comment"># general_log_file=mysql_query.log</span></span><br></pre></td></tr></table></figure><h4 id="1-4-慢查询日志">1.4 慢查询日志</h4><p>慢查询日志记录了所有执行事件超过参数 long_query_time 设置值并且扫描记录不小于 min_examined_row_limit 的所有的SQL语句日志，默认开启。  long_query_time 默认为10秒，最小为0，精度可以到微秒。</p><p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。可以使用 log_slow_admin_statements 和更改此行为 log_queries_not_using_indexes，如下所述。</p><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 慢查询日志</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment"># 执行时间参数(s)</span></span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 较少使用</span></span><br><span class="line"><span class="comment"># 记录执行较慢的管理语句</span></span><br><span class="line">log_slow_admin_statements=1</span><br><span class="line"><span class="comment"># 记录执行较慢的未使用索引的语句</span></span><br><span class="line">log_queries_not_using_indexes=1</span><br></pre></td></tr></table></figure><h3 id="2）主从复制">2）主从复制</h3><h4 id="2-1-概述">2.1 概述</h4><p>主从复制是指将主数据库的 DDL 和 DML 操作通过二进制日志传到从服务器中，然后再从库上对这些日志重新执行（也叫重做），从而使得从库和主库的数据保持同步。</p><p>MySQL支持一台主库同时向多台从库进行复制，从库同时也可以作为其他从服务器的主库，实现链状复制。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108195118263.png" alt="image-20230108195118263"></p><ul><li><p>MySQL 复制的优点主要包含以下三个方面：</p><ol><li><p>主库出现问题，可以快速切换到从库提供服务。</p></li><li><p>实现读写分离，降低主库的访问压力。</p></li><li><p>可以在从库中执行备份，以避免备份期间影响主库服务。</p></li></ol></li></ul><h4 id="2-2-原理">2.2 原理</h4><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108195630533.png" alt="image-20230108195630533"></p><p>从上图来看，复制分为三步：</p><ol><li><p>Master 主库在事务提交时，会把数据变更记录在二进制日志文件 Binlog 中。</p></li><li><p>从库读取主库的二进制日志文件 Binlog，写入到从库的中继日志 Relay Log。</p></li><li><p>slave 重做中继日志中的事件，将改变反应到它自己的数据。</p></li></ol><h4 id="2-3-搭建">2.3 搭建</h4><p>服务器准备：</p><ul><li><p>关闭防火墙：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><p>或生产环境中开放指定的 3306 端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3306/tcp -permanent</span><br><span class="line">firewall-cmd reload</span><br></pre></td></tr></table></figure></li><li><p>主库配置</p><ol><li><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 服务ID，保证整个集群环境中唯一，取值范围：1——(2^32-1),默认为1</span></span><br><span class="line">server-id=1</span><br><span class="line"><span class="comment"># 是否只读，1代表只读，0代表读写</span></span><br><span class="line">read-only=0</span><br><span class="line"><span class="comment"># 忽略的数据，指不需要同步的数据库</span></span><br><span class="line"><span class="comment"># binlog-ignore-db=mysql</span></span><br><span class="line"><span class="comment"># 指定同步的数据库</span></span><br><span class="line"><span class="comment"># binlog-do-db=db01</span></span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></li><li><p>登入mysql，创建远程连接的账号，并赋予主从复制的权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建niubb用户，并设置密码，该用户可以在热议主机连接该Mysql服务</span><br><span class="line">CREATE USER &#x27;niubb&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Root@123456&#x27;;</span><br><span class="line"># 为 &#x27;niubb&#x27;@&#x27;%&#x27; 用户分配主从复制权限</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#x27;niubb&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>通过指令，查看二进制日志坐标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108204046402.png" alt="image-20230108204046402"></p><p>字段的含义说明：</p><p>​file：从那个日志文件开始推送日志文件</p><p>​position： 从那个位置开始推送日志</p><p>​binlog_ignore_db：指定不需要同步的数据库</p></li></ol></li><li><p>从库配置</p><ol><li><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 服务ID，保证整个集群环境中唯一，取值范围：1——(2^32-1),和主库不一样即可</span></span><br><span class="line">server-id=2</span><br><span class="line"><span class="comment"># 是否只读，1代表只读，0代表读写</span></span><br><span class="line">read-only=1</span><br><span class="line"><span class="comment"># （这里是对普通用户只读，如果有超级用户权限还是可以读写）如需想让超管只读</span></span><br><span class="line"><span class="comment"># super-read-only=1</span></span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><pre><code>   3. 登入MySQL,设置主库配置</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE REPLICATION SOURCE TO SOURCE_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,SOURCE_USER=&#x27;xxx&#x27;,SOURCE_PASSWORD=&#x27;xxx&#x27;,SOURCE_LOG_FILE=&#x27;xxx&#x27;,SOURCE_LOG_POS=xxx;</span><br></pre></td></tr></table></figure><p>如果是8.0.23之前的版本，则执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER SOURCE TO MASTER_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,MASTER_USER=&#x27;xxx&#x27;,MASTER_PASSWORD=&#x27;xxx&#x27;,MASTER_LOG_FILE=&#x27;xxx&#x27;,MASTER_LOG_POS=xxx;</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th><th>8.0.23之前</th></tr></thead><tbody><tr><td>SOURCE_HOST</td><td>主库IP地址</td><td>MASTER_HOST</td></tr><tr><td>SOURCE_USER</td><td>连接主库的用户名</td><td></td></tr><tr><td>SOURCE_PASSWORD</td><td>连接主库的密码</td><td></td></tr><tr><td>SOURCE_LOG_FILE</td><td>binlog日志文件名</td><td></td></tr><tr><td>SOURCE_LOG_POS</td><td>binlog日志文件位置</td><td></td></tr></tbody></table><ul><li><p>ex.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE REPLICATION SOURCE TO SOURCE_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,SOURCE_USER=&#x27;niubb&#x27;,SOURCE_PASSWORD=&#x27;Root@123456&#x27;,SOURCE_LOG_FILE=&#x27;binlog.000004&#x27;,SOURCE_LOG_POS=663;</span><br></pre></td></tr></table></figure><pre><code>  4. 开启同步操作</code></pre></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start replica;# 8.0.22之后</span><br><span class="line">start slave;# 8.0.22之前</span><br></pre></td></tr></table></figure></li><li><p>查看主从状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show replica status\G;</span><br><span class="line">start slave status;# 8.0.22之前</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108210823388.png" alt="image-20230108210823388"></p></li></ol></li><li><p>最后在主库里测试下从库能否同步。</p></li><li><p>注意：如果主库一开始有数据，应该备份后在从库里恢复后在进行主从连接。</p></li></ul><h3 id="3）分库分表">3）分库分表</h3><h4 id="3-1-概述">3.1 概述</h4><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108224641250.png" alt="image-20230108224641250"></p><p>随着互联网及移动互联网的发展，应用系统的数据量也是成指数式增长，若采用单数据库进行数据存储，存在以下性能瓶颈：</p><ol><li>IO瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO,效率较低。请求数据太多，带宽不够，网络IO瓶颈。</li><li>CPU瓶颈：排序、分组、链接查询、聚合统计等SQL会耗费大量的CPU资源，请求数太多，CPU出现瓶颈。</li></ol><p>$\textcolor{red}{分库分表的中心思想是将数据分散存储，使得单一数据库/表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。}$</p><ul><li><p>拆分策略</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108225426011.png" alt="image-20230108225426011"></p><ul><li><p>$\textcolor{orange}{垂直拆分}$</p><ul><li><p>$\textcolor{green}{垂直分库}$：以表为依据，根据业务将不同表拆分到不同库中。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108225546860.png" alt="image-20230108225546860"></p><p>特点：</p><ol><li>每个库的表结构都不一样。</li><li>每个库的数据也不一样。</li><li>所有库的并集是全量数据。</li></ol></li><li><p>$\textcolor{green}{垂直分表}$：以字段为依据，根据字段属性将不同字段拆分到不同表中。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108230215756.png" alt="image-20230108230215756"></p><p>特点：</p><ol><li>每个表的结构都不一样。</li><li>每个表的数据也不一样，一般通过一列（主键/外键）关联。</li><li>所有表的并集是全量数据。</li></ol></li></ul></li><li><p>$\textcolor{orange}{水平拆分}$</p><ul><li><p>$\textcolor{green}{水平分库}$：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108230833971.png" alt="image-20230108230833971"></p><p>特点：</p><ol><li>每个库的表结构都一样。</li><li>每个库的数据都不一样。</li><li>所有库的并集是全量数据。</li></ol></li><li><p>$\textcolor{green}{水平分表}$：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108231035063.png" alt="image-20230108231035063"></p><p>特点：</p><ol><li>每个表的表结构都一样。</li><li>每个表的数据都不一样。</li><li>所有表的并集是全量数据。</li></ol></li></ul></li></ul></li><li><p>实现技术</p><ul><li>==shardingJDBC==：基于AOP原理，在应用程序中对本地执行的SQL进行拦截，解析、改写、路由处理。需要自行编码配置实现，只支持java语言，性能较高。</li><li>==MyCat==：数据库分库分表中间件，不用调整代码即可实现分库分表，支持多种语言，性能不及前者。</li></ul></li></ul><h4 id="3-2-MyCat">3.2 MyCat</h4><p>MyCat 是开源的、活跃的、基于 Java 语言编写的 MySQL 数据库中间件。（出自阿里巴巴）</p><p>优势：性能可靠稳定、强大的技术团队、体系完善、社区活跃</p><h5 id="3-2-1-安装-MyCat">3.2.1 安装 MyCat</h5><p><a href="http://mycat.org.cn/">MyCat官网</a></p><ol><li><p>安装 Java 环境</p><p>a. yum 安装 jdk ：（默认的安装目录 <code>/usr/lib/jvm/java-1.8.0/</code>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><p>b. 配置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>c. 添加以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#set java environment</span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0</span><br><span class="line">JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line">export JAVA_HOME JRE_HOME CLASS_PATH PATH</span><br></pre></td></tr></table></figure><p>d. 重新读取配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><p>e. 验证是否安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure></li><li><p>安装 MyCat</p><p>a.切换至opt目录，下载mycat安装包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget http://dl.mycat.org.cn/1.6.7.6/20210303094759/Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz</span><br></pre></td></tr></table></figure><p>b. 创建/apps文件夹，并解压mycat包至/apps下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /apps</span><br><span class="line">tar -zxvf Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz -C /apps/</span><br></pre></td></tr></table></figure><p>c. 设置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PATH=/apps/mycat/bin:$PATH&#x27;</span> &gt; /etc/profile.d/mycat.sh</span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/mycat.sh</span><br></pre></td></tr></table></figure><p>d. 启动mycat</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意内存小于2G 起不来</span></span><br><span class="line">mycat start</span><br></pre></td></tr></table></figure><p>e. 查看日志 启动成功日志末尾会出现successfully</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /apps/mycat/logs/wrapper.log</span><br></pre></td></tr></table></figure></li></ol><h5 id="3-2-2-概念">3.2.2 概念</h5><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109003624302.png" alt="image-20230109003624302"></p><h5 id="3-2-3-配置">3.2.3 配置</h5><p><a href="https://blog.csdn.net/huasan994520/article/details/125150929">参考1</a></p><p>修改 MyCat 配置文件 <code>/apps/mycat/conf/schema.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#vim  /apps/mycat/conf/schema.xml</span><br><span class="line">#删除所有内容，重新写入以下</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;DB01&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        #schema标签：数据库设置，此数据库为逻辑数据库，name与server.xml中schema对应。</span><br><span class="line">        #name:逻辑数据库名，与server.xml中的schema对应；</span><br><span class="line">        #checkSQLschema: 数据库前缀相关设置，这里为false；</span><br><span class="line">        #sqlMaxLimit:  select时默认的limit，避免查询全表，否则可能会遇到查询量特别大的情况造成卡 死；</span><br><span class="line">        #dataNode:表存储到哪些节点，多个节点用逗号分隔。节点为下文dataNode设置的name</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;TB_ORDER&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> /&gt;</span></span><br><span class="line">            #table标签: 逻辑表</span><br><span class="line">            #name: 逻辑表名</span><br><span class="line">            #dataNode:逻辑表关联的数据节点，表存储到哪些节点，多个节点用逗号分隔。节点为下文dataNode设置的name</span><br><span class="line">            #rule:分片规则</span><br><span class="line">    <span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line">        #dataNode标签: 定义mycat中的数据节点，也是通常说的数据分片，也就是分库相关配置</span><br><span class="line">        #name: 定义数据节点的名字，与table中dataNode对应</span><br><span class="line">        #datahost: 物理数据库名，与datahost中name对应，该属性用于定义该分片属于哪个数据库实例</span><br><span class="line">        #database: 物理数据库中数据库名，该属性用于定义该分片属性关联到物理数据库实例上的db01数据库</span><br><span class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        #dataHost标签： 物理数据库，真正存储数据的数据库</span><br><span class="line">        #name: 物理数据库名，与dataNode中dataHost对应</span><br><span class="line">        #maxCon属性指定每个读写实例连接池的最大连接。也就是说，标签内嵌套的writeHost、readHost标  签都会使用这个属性的值来实例化出连接池的最大连接数</span><br><span class="line">        #minCon属性指定每个读写实例连接池的最小连接，初始化连接池的大小</span><br><span class="line">        #balance: 均衡负载的方式</span><br><span class="line">        #writeType: 写入方式</span><br><span class="line">        #dbType: 数据库类型</span><br><span class="line">        #dbDriver指定连接后端数据库使用的 Driver，目前可选的值有 native 和 JDBC。用 native 的话，因为这个值执行的是二进制的 mysql 协议，所以可以使用 mysql 和maridb。其他类型的数据库则需要使用 JDBC 驱动来支持。</span><br><span class="line">        #switchType:  “-1” 表示不自动切换； “1” 默认值，自动切换； “2” 基于 MySQL主从同步的状态决定是否切换心跳语句为 show slave status； “3” 基于 MySQL galary cluster 的切换机制（适合集群）（1.4.1）心跳语句为 show status like ‘wsrep%’.</span><br><span class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">                #heartbeat: 心跳检测语句，注意语句结尾的分号要加</span><br><span class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;host1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.59.113:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">                #host：用于标识不同实例，一般 writeHost 我们使用*M1，readHost 我们用*S1。</span><br><span class="line">                #url：后端实例连接地址。Native：地址：端口 JDBC：jdbc的url</span><br><span class="line">                #user：后端存储实例需要的用户名字</span><br><span class="line">                #password:后端存储实例需要的密码</span><br><span class="line">                 <span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;host2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.59.112:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">#readHost标签:从服务器设置</span><br><span class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#schema.xml文件中有三点需要注意：balance=&quot;1&quot;，writeType=&quot;0&quot; ,switchType=&quot;1&quot; </span><br><span class="line">#schema.xml中的balance的取值决定了负载均衡对非事务内的读操作的处理。balance 属性负载均衡类型，目前的取值有 4 种：</span><br><span class="line">##balance=&quot;0&quot;：不开启读写分离机制，所有读操作都发送到当前可用的writeHost上,即读请求仅            发送到writeHost上</span><br><span class="line">##balance=&quot;1&quot;：一般用此模式，读请求随机分发到当前writeHost对应的readHost和standby的writeHost上。即全部的readHost与stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1 -&gt;S1 ， M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下， M2,S1, S2 都参与 select 语句的负载均衡</span><br><span class="line">##balance=&quot;2&quot;：读请求随机分发到当前dataHost内所有的writeHost和readHost上。即所有读操作都随机的在writeHost、 readhost 上分发</span><br><span class="line">##balance=&quot;3&quot;：读请求随机分发到当前writeHost对应的readHost上。即所有读请求随机的分发wiriterHost 对应的 readhost 执行, writerHost 不负担读压力，注意 balance=3 只在 1.4 及其以后版本有，1.3 没有</span><br><span class="line"></span><br><span class="line">###writeHost和readHost标签，这两个标签都指定后端数据库的相关配置给mycat，用于实例化后端连接池。唯一不同的是：writeHost指定写实例、readHost指定读实例，组着这些读写实例来满足系统的要求。在一个dataHost内可以定义多个writeHost和eadHost。但是，如果writeHost指定的后端数据库宕机，那么这个writeHost绑定的所有readHost都将不可用。另一方面，由于这个writeHost宕机系统会自动的检测到，并切换到备用的writeHost上去   </span><br><span class="line">               </span><br><span class="line">#PS：Mycat主从分离只是在读的时候做了处理，写入数据的时候，只会写入到writehost，需要通过mycat的主从复制将数据复制到readhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改 MyCat 配置文件 <code>/apps/mycat/conf/server.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#去掉44行行注释，对应的在51行行末注释，删除50行行末注释，5 * 60 * 1000L; //连接空&gt;    闲检查</span><br><span class="line"></span><br><span class="line">#修改45行端口号为3306</span><br><span class="line">45 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;serverPort&quot;</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#配置Mycat的连接信息(账号密码)，在110 和111行， 可以修改，这边不修改了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####参数解释说明####</span><br><span class="line">110         <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">111                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">112                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">113                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">116                 <span class="comment">&lt;!-- 表级 DML 权限设置 --&gt;</span></span><br><span class="line">117                 <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">118                 &lt;privileges check=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="comment">119                         &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</span></span><br><span class="line"><span class="comment">120                                 &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">121                                 &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">122                         &lt;/schema&gt;</span></span><br><span class="line"><span class="comment">123                 &lt;/privileges&gt;   </span></span><br><span class="line"><span class="comment">124                  --&gt;</span></span><br><span class="line"></span><br><span class="line">127         <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">128                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>user<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">129                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">130                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">131                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">user    用户配置节点</span><br><span class="line">name    逻辑用户名，客户端登录MyCAT的用户名，也就是客户端用来连接Mycat的用户名。</span><br><span class="line">password     客户端登录MyCAT的密码</span><br><span class="line">schemas      数据库名，这里会和schema.xml中的配置关联，可配置多个，多个用逗号分开，例如:db1,db2</span><br><span class="line">privileges   配置用户针对表的增删改查的权限</span><br><span class="line">readOnly mycat   逻辑库所具有的权限。true为只读，false为读写都有，默认为false</span><br><span class="line"></span><br><span class="line">##注意</span><br><span class="line">#server.xml文件里登录mycat的用户名和密码可以任意定义，这个账号和密码是为客户机登录mycat时使用的账号信息</span><br><span class="line">#逻辑库名(如上面的TESTDB，也就是登录mycat后显示的库名，切换这个库之后，显示的就是代理的真实mysql数据库的表)要在schema.xml里面也定义，否则会导致mycat服务启动失败！这里只定义了一个标签，所以把多余的都注释了。如果定义多个标签，即设置多个连接mycat的用户名和密码，那么就需要在schema.xml文件中定义多个对应的库！</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-2-4-启动服务">3.2.4 启动服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">mycat start</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">mycat stop</span><br></pre></td></tr></table></figure><p>MyCat启动之后，占用端口号 <code>8066</code> 。</p><h5 id="3-2-5-登入">3.2.5 登入</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -P8066 -uroot -p123456</span><br></pre></td></tr></table></figure><h5 id="3-2-6-配置文件详解">3.2.6 配置文件详解</h5><ul><li><p><strong>schema.xml</strong></p><ul><li><p><code>&lt;schema&gt;</code> 标签</p><p>用于定义 MyCat 实例中的逻辑库，一个 MyCat 实例中，可以有多个逻辑库，可以通过 schema 标签来划分不同的逻辑库。 MyCat中的逻辑库的概念，等同于 MySQL 中的database概念，需要操作某个逻辑库下的表时，也需要切换逻辑库(use xxx)。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109224721920.png" alt="image-20230109224721920"></p><ul><li>name：指定自定义的逻辑库库名。</li><li>checkSQLschema：在 SQL 语句操作时指定了数据库名称，执行时是否自动去除；true-自动去除，false-不自动去除。</li><li>sqlMaxLimit：如果未指定 limit 进行查询，列表查询模式查询多少条记录。</li></ul></li><li><p><code>&lt;table&gt;</code> 标签（schema 中的 ）</p><p>table 标签定义了 MyCat 中逻辑库 schema 下的逻辑表，所有需要拆分的表都需要在 table 标签中定义。</p><ul><li>name：定义逻辑表表名，在该逻辑库下唯一。</li><li>dataNode：定义逻辑表所属的 dataNode，该属性需要与 dataNode 标签中 name 对应；多个 dataNode 逗号分割。</li><li>rule：分片规则的名字，分片规则名字是在 rule.xml 中定义的。</li><li>primaryKey：逻辑表对应真实表的主键。</li><li>type：逻辑表的类型，目前逻辑表只有全局表和普通表，如果未配置，就是普通表；全局表配置为 global。</li></ul></li><li><p><code>&lt;dataNode&gt;</code> 标签</p><p>dataNode 标签中定义了 MyCat 中的数据节点，也就是我们通常说的数据分片。一个 dataNode 标签就是一个独立的数据分片。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109233001717.png" alt="image-20230109233001717"></p><ul><li>name：定义数据节点名称。</li><li>dataHost：数据库实例主机名称，引用自 dataHost 标签中 name 属性。</li><li>database： 定义分片所属数据库。</li></ul></li><li><p><code>&lt;datahost&gt;</code> 标签</p><p>该标签在 MyCat 逻辑库中作为底层标签存在，直接定义了具体的数据实例、读写分离、心跳语句。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109233711722.png" alt="image-20230109233711722"></p><ul><li><p>name：唯一标识，供上层标签使用。</p></li><li><p>maxCon/minCon：最大链接数/最小连接数。</p></li><li><p>balance：负载均衡策略，取值 0,1,2,3。</p></li><li><p>writeType：写操作分发方式（0：写操作妆发到第一个 writeHost，第一个挂了切换到第二个；1：写操作随机分发到配置的 writeHost）。</p></li><li><p>dbDriver：数据库驱动，支持 native、jdbc。</p></li></ul></li></ul></li><li><p><strong>rule.xml</strong></p><p>rule.xml 定义所有拆分表的规则，在使用过程中可以灵活的使用分片算法，或者对同一个分片算法使用不同的参数，它让分片过程可配置化。主要包含两类标签：tableRule、Function。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109235344485.png" alt="image-20230109235344485"></p></li><li><p><strong>server.xml</strong></p><p>server.xml 配置文件包含了 MyCat 的系统配置信息，主要有两个重要的标签：system、user。</p><ul><li><p><code>&lt;system&gt;</code> 标签</p><p>对应的系统配置项及其含义，参考资料。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230110000228552.png" alt="image-20230110000228552"></p></li><li><p><code>&lt;user&gt;</code> 标签</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230110000636587.png" alt="image-20230110000636587"></p></li></ul></li></ul><h5 id="3-2-7-分片">3.2.7 分片</h5><h3 id="4）读写分离">4）读写分离</h3><h4 id="4-1-基于MyCat的读写分离">4.1 基于MyCat的读写分离</h4><p>修改<dataHost>的balance(负载均衡)属性，通过此属性配置读写分离的类型</p><p><strong>balance(负载均衡)类型目前有4种：</strong></p><ul><li>balance=“0”：不开启读写分离机制，所有读操作都发送到当前可用的 writeHost上。</li><li>balance=“1”：全部的readHost与stand by writeHost参与select语句的负载均衡，简单的说，当双主双从 模式(M1-&gt;S1，M2-&gt;S2，并且M1与M2互为主备)，正常情况下，M2,S1,S2 都参与select语句的负载均衡。</li><li>balance=“2”：所有读操作都随机的在writeHost、readhost 上分发。</li><li>balance=“3”：所有读请求随机的分发到readhost执行，writerHost不负担读压力。</li></ul><h5 id="4-1-1-一主一从">4.1.1 一主一从</h5><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2547829c773c415f8c2424bc266f3e57.jpeg" alt="在这里插入图片描述"></p><ol><li>搭建主从复制的过程（略）</li></ol><table>  <thead>    <tr>      <th>编号</th>      <th>角色</th>      <th><code>IP</code>地址</th>      <th>机器名</th>    </tr>  </thead>  <tbody>    <tr>      <td>1</td>      <td><code>Master</code></td>      <td>192.168.110.146</td>      <td><code>ubuntu-mysql-master</code></td>    </tr>    <tr>      <td>2</td>      <td><code>Slaver</code></td>      <td>192.168.110.147</td>      <td><code>ubuntu-mysql-slaver</code></td>    </tr>  </tbody></table><ol start="2"><li>修改mycat配置文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;&gt;</span><br><span class="line">        &lt;/schema&gt;</span><br><span class="line">        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;testdb&quot; /&gt;</span><br><span class="line">        &lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot; writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.110.146:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.147:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">        &lt;/dataHost&gt;</span><br><span class="line">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure><h5 id="4-1-2-双主双从">4.1.2 双主双从</h5><blockquote><p>搭建参考：<a href="https://blog.csdn.net/qq_41779565/article/details/125375231">https://blog.csdn.net/qq_41779565/article/details/125375231</a></p></blockquote><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/f4d1c70368204ed0bedc2a7d1da18ca5.jpeg" alt="在这里插入图片描述"></p><ol><li>搭建主从复制的过程（略）</li></ol><table>  <thead>    <tr>      <th>编号</th>      <th>角色</th>      <th><code>IP</code>地址</th>      <th>机器名</th>    </tr>  </thead>  <tbody>    <tr>      <td>1</td>      <td><code>Master1</code></td>      <td>192.168.110.146</td>      <td><code>ubuntu-mysql-master</code></td>    </tr>    <tr>      <td>2</td>      <td><code>Slaver1</code></td>      <td>192.168.110.147</td>      <td><code>ubuntu-mysql-slaver</code></td>    </tr>    <tr>      <td>3</td>      <td><code>Master2</code></td>      <td>192.168.110.148</td>      <td><code>ubuntu-mysql-master2</code></td>    </tr>    <tr>      <td>4</td>      <td><code>Slaver2</code></td>      <td>192.168.110.149</td>      <td><code>ubuntu-mysql-slaver2</code></td>    </tr>  </tbody></table><ol start="2"><li>配置<code>Mycat</code>读写分离</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;&gt;</span><br><span class="line">        &lt;/schema&gt;</span><br><span class="line">        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;testdb&quot; /&gt;</span><br><span class="line">        &lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot; writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.110.146:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.147:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">               &lt;writeHost host=&quot;hostM2&quot; url=&quot;192.168.110.148:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.149:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">        &lt;/dataHost&gt;</span><br><span class="line">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure><blockquote><ul><li>writeType=0：所有写操作发送到配置的第一个writeHost，第一个挂了切到还生存的第二个。</li><li>writeType=1：所有写操作都随机的发送到配置的writeHost，1.5以后废弃不推荐。</li><li>writeHost：重新启动后以切换后的为准，切换记录在配置文件中：dnindex.properties 。</li><li>switchType：<ul><li>1 默认值，自动切换。</li><li>-1 表示不自动切换。</li><li>2 基于MySQL主从同步的状态决定是否切换。</li></ul></li></ul></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Shell编程 学习笔记</title>
      <link href="/posts/edc1b716.html"/>
      <url>/posts/edc1b716.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="Shell">Shell</h1><h2 id="1-Shell-脚本">1.Shell 脚本</h2><h3 id="1-第一个shell脚本">1.第一个shell脚本</h3><p>打开文本编辑器，新建一个文本文件，并命名为 <a href="http://test.sh">test.sh</a>。扩展名<code>sh</code>代表 shell，扩展名并不影响脚本执行，见名知意就好，如果你用 php 写 shell 脚本，扩展名就用<code>php</code>好了。</p><p>在 <a href="http://test.sh">test.sh</a> 中输入代码：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello World !&quot;</span>  <span class="comment">#这是一条语句</span></span><br></pre></td></tr></table></figure><blockquote><p>第 1 行的<code>#!</code>是一个约定的标记，它告诉系统这个脚本需要什么解释器来执行，即使用哪一种 Shell；后面的<code>/bin/bash</code>就是指明了解释器的具体位置。</p><p>第 2 行的 echo 命令用于向标准输出文件（Standard Output，stdout，一般就是指显示器）输出文本。在<code>.sh</code>文件中使用命令与在终端直接输入命令的效果是一样的。</p><p>第 2 行的<code>#</code>及其后面的内容是注释。Shell 脚本中所有以<code>#</code>开头的都是注释（当然以<code>#!</code>开头的除外）。写脚本的时候，多写注释是非常有必要的，以方便其他人能看懂你的脚本，也方便后期自己维护时看懂自己的脚本——实际上，即便是自己写的脚本，在经过一段时间后也很容易忘记。</p></blockquote><p>下面给出了一段稍微复杂的 Shell 脚本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Copyright (c) http://nb.com/shell/</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;What is your name?&quot;</span></span><br><span class="line"><span class="built_in">read</span> PERSON</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$PERSON</span>&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>第 5 行中表示从终端读取用户输入的数据，并赋值给 PERSON 变量。read 命令用来从标准输入文件（Standard Input，stdin，一般就是指键盘）读取用户输入的数据。</p><p>第 6 行表示输出变量 PERSON 的内容。注意在变量名前边要加上<code>$</code>，否则变量名会作为字符串的一部分处理。</p></blockquote><h3 id="2-执行Shell脚本">2.执行Shell脚本</h3><p>运行 Shell 脚本有两种方法，一种在新进程中运行，一种是在当前 Shell 进程中运行。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230203110803080.png" alt="image-20230203110803080"></p><ul><li><p><strong>在新进程中运行 Shell 脚本</strong></p><p>在新进程中运行 Shell 脚本有多种方法：</p><ol><li><p>将 Shell 脚本作为程序运行</p><p>Shell 脚本也是一种解释执行的程序，可以在终端直接调用（需要使用 chmod 命令给 Shell 脚本加上执行权限）如下所示:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo                <span class="comment">#切换到 test.sh 所在的目录</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">chmod</span> +x ./test.sh  <span class="comment">#给脚本添加执行权限</span></span><br><span class="line">[root@localhost demo]$ . ./test.sh           <span class="comment">#执行脚本文件</span></span><br><span class="line">Hello World !                                  <span class="comment">#运行结果</span></span><br></pre></td></tr></table></figure><blockquote><p>第 2 行中，<code>chmod +x</code>表示给 <a href="http://test.sh">test.sh</a> 增加执行权限。</p><p>第 3 行中，<code>./</code>表示当前目录，整条命令的意思是执行当前目录下的 <a href="http://test.sh">test.sh</a> 脚本。如果不写<code>./</code>，Linux 会到系统路径（由 PATH 环境变量指定）下查找 <a href="http://test.sh">test.sh</a>，而系统路径下显然不存在这个脚本，所以会执行失败。</p></blockquote><p>通过这种方式运行脚本，脚本文件第一行的<code>#!/bin/bash</code>一定要写对，好让系统查找到正确的解释器。</p></li><li><p>将 Shell 脚本作为参数传递给 Bash 解释器</p><p>你也可以直接运行 Bash 解释器，将脚本文件的名字作为参数传递给 Bash，如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo               <span class="comment">#切换到 test.sh 所在的目录</span></span><br><span class="line">[root@localhost demo]$ /bin/bash test.sh  <span class="comment">#使用Bash的绝对路径</span></span><br><span class="line">Hello World !                                 <span class="comment">#运行结果</span></span><br></pre></td></tr></table></figure><p>通过这种方式运行脚本，不需要在脚本文件的第一行指定解释器信息，写了也没用。</p><p>更加简洁的写法是运行 bash 命令。bash 是一个外部命令，Shell 会在 /bin 目录中找到对应的应用程序，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo</span><br><span class="line">[root@localhost demo]$ bash test.sh</span><br><span class="line">Hello World !</span><br></pre></td></tr></table></figure><p>这两种写法在本质上是一样的：第一种写法给出了绝对路径，会直接运行 Bash 解释器；第二种写法通过 bash 命令找到 Bash 解释器所在的目录，然后再运行，只不过多了一个查找的过程而已。</p></li></ol><p>◇ <u>检测是否开启了新进程</u></p><p>Linux 中的每一个进程都有一个唯一的 ID，称为 PID，使用<code>$$</code>变量就可以获取当前进程的 PID。<code>$$</code>是 Shell 中的特殊变量。</p><p>首先编写如下的脚本文件，并命名为 <a href="http://check.sh">check.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> $$  <span class="comment">#输出当前进程PID</span></span><br></pre></td></tr></table></figure><p>然后使用以上两种方式来运行 <a href="http://check.sh">check.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> $$</span><br><span class="line">2861  <span class="comment">#当前进程的PID</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">chmod</span> +x ./check.sh</span><br><span class="line">[root@localhost demo]$ ./check.sh</span><br><span class="line">4597  <span class="comment">#新进程的PID</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> $$</span><br><span class="line">2861  <span class="comment">#当前进程的PID</span></span><br><span class="line">[root@localhost demo]$ /bin/bash check.sh</span><br><span class="line">4584  <span class="comment">#新进程的PID</span></span><br></pre></td></tr></table></figure><p>你看，进程的 PID 都不一样，当然就是两个进程了。</p></li><li><p><strong>在当前进程中运行 Shell 脚本</strong></p><p>这里需要引入一个新的命令——source 命令。source 是 Shell 内置命令的一种，它会读取脚本文件中的代码，并依次执行所有语句。你也可以理解为，source 命令会强制执行脚本文件中的全部命令，而忽略脚本文件的权限。</p><p>source 命令的用法为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> filename</span><br><span class="line"><span class="comment"># 也可以简写为：</span></span><br><span class="line">. filename</span><br></pre></td></tr></table></figure><p>两种写法的效果相同。对于第二种写法，注意点号<code>.</code>和文件名中间有一个空格。</p><p>例如，使用 source 运行上节的 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo              <span class="comment">#切换到test.sh所在的目录</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">source</span> ./test.sh  <span class="comment">#使用source</span></span><br><span class="line">Hello World !</span><br><span class="line">[root@localhost demo]$ <span class="built_in">source</span> test.sh    <span class="comment">#使用source</span></span><br><span class="line">Hello World !</span><br><span class="line">[root@localhost demo]$ . ./test.sh       <span class="comment">#使用点号</span></span><br><span class="line">Hello World !</span><br><span class="line">[root@localhost demo]$ . test.sh         <span class="comment">#使用点号</span></span><br><span class="line">Hello World !</span><br></pre></td></tr></table></figure><p>你看，使用 source 命令不用给脚本增加执行权限，并且写不写<code>./</code>都行，是不是很方便呢？</p><p>◇ <u>检测是否在当前 Shell 进程中</u></p><p>我们仍然借助<code>$$</code>变量来输出进程的 PID，如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo</span><br><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> $$</span><br><span class="line">5169  <span class="comment">#当前进程PID</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">source</span> ./check.sh</span><br><span class="line">5169  <span class="comment">#Shell脚本所在进程PID</span></span><br><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> $$</span><br><span class="line">5169  <span class="comment">#当前进程PID</span></span><br><span class="line">[root@localhost demo]$ . ./check.sh</span><br><span class="line">5169  <span class="comment">#Shell脚本所在进程PID</span></span><br></pre></td></tr></table></figure><p>你看，进程的 PID 都是一样的，当然是同一个进程了。</p></li></ul><hr><h2 id="2-变量">2.变量</h2><p>变量是任何一种编程语言都必不可少的组成部分，变量用来存放各种数据。脚本语言在定义变量时通常不需要指明类型，直接赋值就可以，Shell 变量也遵循这个规则。</p><p>在 Bash shell 中，每一个变量的值都是字符串，无论你给变量赋值时有没有使用引号，值都会以字符串的形式存储。</p><p>这意味着，Bash shell 在默认情况下不会区分变量类型，即使你将整数和小数赋值给变量，它们也会被视为字符串，这一点和大部分的编程语言不同。例如在C语言或者 C++ 中，变量分为整数、小数、字符串、布尔等多种类型。</p><p>当然，如果有必要，你也可以使用 <code>Shell declare</code> 关键字显式定义变量的类型，但在一般情况下没有这个需求，Shell 开发者在编写代码时自行注意值的类型即可。</p><h3 id="1-定义变量">1.定义变量</h3><p>Shell 支持以下三种定义变量的方式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">variable=value</span><br><span class="line">variable=<span class="string">&#x27;value&#x27;</span></span><br><span class="line">variable=<span class="string">&quot;value&quot;</span></span><br></pre></td></tr></table></figure><p>variable 是变量名，value 是赋给变量的值。如果 value 不包含任何空白符（例如空格、Tab 缩进等），那么可以不使用引号；如果 value 包含了空白符，那么就必须使用引号包围起来。使用单引号和使用双引号也是有区别的，稍后我们会详细说明。</p><p><font style="color:red;">注意，赋值号<code>=</code>的周围不能有空格，这可能和你熟悉的大部分编程语言都不一样。</font></p><p>Shell 变量的命名规范和大部分编程语言都一样：</p><ul><li>变量名由数字、字母、下划线组成；</li><li>必须以字母或者下划线开头；</li><li>不能使用 Shell 里的关键字（通过 help 命令可以查看保留关键字）。</li></ul><p>变量定义举例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;http://niu.com/shell/&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$url</span></span><br><span class="line">name=<span class="string">&#x27;niu&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$name</span></span><br><span class="line">author=<span class="string">&quot;niu&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$author</span></span><br></pre></td></tr></table></figure><h3 id="2-使用变量">2.使用变量</h3><p>使用一个定义过的变量，只要在变量名前面加美元符号<code>$</code>即可，如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">author=<span class="string">&quot;niu&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$author</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;author&#125;</span></span><br></pre></td></tr></table></figure><p>变量名外面的花括号<code>&#123; &#125;</code>是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面这种情况：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">skill=<span class="string">&quot;Java&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I am good at <span class="variable">$&#123;skill&#125;</span>Script&quot;</span></span><br></pre></td></tr></table></figure><p>如果不给 skill 变量加花括号，写成<code>echo &quot;I am good at $skillScript&quot;</code>，解释器就会把 $skillScript 当成一个变量（其值为空），代码执行结果就不是我们期望的样子了。</p><p><font style="color:red;">推荐给所有变量加上花括号<code>&#123;&#125;</code>，这是个良好的编程习惯。</font></p><ul><li><p>修改变量的值</p><p>已定义的变量，可以被重新赋值，如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;http://niu.com&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url&#125;</span></span><br><span class="line">url=<span class="string">&quot;http://niu.com/shell/&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url&#125;</span></span><br></pre></td></tr></table></figure><p>第二次对变量赋值时不能在变量名前加<code>$</code>，只有在使用变量时才能加<code>$</code>。</p></li><li><p>单引号和双引号的区别</p><p>前面我们还留下一个疑问，定义变量时，变量的值可以由单引号<code>' '</code>包围，也可以由双引号<code>&quot; &quot;</code>包围，它们到底有什么区别呢？不妨以下面的代码为例来说明：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://niu.net&quot;</span></span><br><span class="line">website1=<span class="string">&#x27;niubb：$&#123;url&#125;&#x27;</span></span><br><span class="line">website2=<span class="string">&quot;niubb：<span class="variable">$&#123;url&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$website1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$website2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line">niubb：<span class="variable">$&#123;url&#125;</span></span><br><span class="line">niubb：niu.net</span><br></pre></td></tr></table></figure><p>以单引号<code>' '</code>包围变量的值时，单引号里面是什么就输出什么，即使内容中有变量和命令（命令需要反引起来）也会把它们原样输出。这种方式比较适合定义显示纯字符串的情况，即不希望解析变量、命令等的场景。</p><p>以双引号<code>&quot; &quot;</code>包围变量的值时，输出时会先解析里面的变量和命令，而不是把双引号中的变量名和命令原样输出。这种方式比较适合字符串中附带有变量和命令并且想将其解析后再输出的变量定义。</p><p><font style="color:red;">我的建议：如果变量的内容是数字，那么可以不加引号；如果真的需要原样输出就加单引号；其他没有特别要求的字符串等最好都加上双引号，定义变量时加双引号是最常见的使用场景。</font></p></li><li><p>将命令的结果赋值给变量</p><p>Shell 也支持将命令的执行结果赋值给变量，常见的有以下两种方式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">variable=`<span class="built_in">command</span>`</span><br><span class="line">variable=$(<span class="built_in">command</span>)</span><br></pre></td></tr></table></figure><p>第一种方式把命令用反引号<code> </code>（位于 Esc 键的下方）包围起来，反引号和单引号非常相似，容易产生混淆，所以不推荐使用这种方式；第二种方式把命令用<code>$()</code>包围起来，区分更加明显，所以推荐使用这种方式。</p><p>例如，我在 demo 目录中创建了一个名为 log.txt 的文本文件，用来记录我的日常工作。下面的代码中，使用 cat 命令将 log.txt 的内容读取出来，并赋值给一个变量，然后使用 echo 命令输出。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">cd</span> demo</span><br><span class="line">[root@localhost demo]$ <span class="built_in">log</span>=$(<span class="built_in">cat</span> log.txt)</span><br><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> <span class="variable">$log</span></span><br><span class="line">严长生正在编写Shell教程，教程地址：http://nb.com/shell/</span><br><span class="line">[root@localhost demo]$ <span class="built_in">log</span>=`<span class="built_in">cat</span> log.txt`</span><br><span class="line">[root@localhost demo]$ <span class="built_in">echo</span> <span class="variable">$log</span></span><br><span class="line">严长生正在编写Shell教程，教程地址：http://nb.com/shell/</span><br></pre></td></tr></table></figure></li><li><p>只读变量</p><p>使用 <strong>readonly</strong> 命令可以将变量定义为只读变量，只读变量的值不能被改变。</p><p>下面的例子尝试更改只读变量，结果报错：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">myUrl=<span class="string">&quot;http://nb.com/shell/&quot;</span></span><br><span class="line"><span class="built_in">readonly</span> myUrl</span><br><span class="line">myUrl=<span class="string">&quot;http://nb.com/shell/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行脚本，结果如下：</span></span><br><span class="line">bash: myUrl: This variable is <span class="built_in">read</span> only.</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-删除变量">3.删除变量</h3><p>使用 <strong>unset</strong> 命令可以删除变量。语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> variable_name</span><br></pre></td></tr></table></figure><p>变量被删除后不能再次使用；unset 命令不能删除只读变量。</p><p>举个例子：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">myUrl=<span class="string">&quot;http://nb.com/shell/&quot;</span></span><br><span class="line"><span class="built_in">unset</span> myUrl</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$myUrl</span></span><br></pre></td></tr></table></figure><p>上面的脚本没有任何输出。</p><h3 id="4-变量的作用域">4.变量的作用域</h3><p>Shell 变量的作用域可以分为三种：</p><p>有的变量只能在函数内部使用，这叫做局部变量（local variable）；有的变量可以在当前 Shell 进程中使用，这叫做全局变量（global variable）；而有的变量还可以在子进程中使用，这叫做环境变量（environment variable）。</p><ol><li><h4 id="局部变量">局部变量</h4><p>Shell 也支持自定义函数，但是 Shell 函数和 C++、Java、C# 等其他编程语言函数的一个不同点就是：在 Shell 函数中定义的变量默认也是全局变量，它和在函数外部定义变量拥有一样的效果。请看下面的代码：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]<span class="comment"># vim local.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#定义函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func</span></span>()&#123;</span><br><span class="line">a=99</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#调用函数</span></span><br><span class="line">func</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"></span><br><span class="line">[root@www ~]<span class="comment"># chmod o+x local.sh </span></span><br><span class="line">[root@www ~]<span class="comment"># ./local.sh </span></span><br><span class="line">99</span><br></pre></td></tr></table></figure><p>a 是在函数内部定义的，但是在函数外部也可以得到它的值，证明它的作用域是全局的，而不是仅限于函数内部。</p><p>要想变量的作用域仅限于函数内部，可以在定义时加上local命令，此时该变量就成了局部变量。请看下面的代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#定义函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func</span></span>()&#123;</span><br><span class="line">    <span class="built_in">local</span> a=99</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#调用函数</span></span><br><span class="line">func</span><br><span class="line"><span class="comment">#输出函数内部的变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br></pre></td></tr></table></figure><p>输出结果为空，表明变量 a 在函数外部无效，是一个局部变量。</p><p>Shell 变量的这个特性和 <code>JavaScript</code> 中的变量是类似的。在 <code>JavaScript</code> 函数内部定义的变量，默认也是全局变量，只有加上<code>var</code>关键字，它才会变成局部变量。</p></li><li><h4 id="全局变量">全局变量</h4><p>所谓全局变量，就是指变量在当前的整个 Shell 进程中都有效。每个 Shell 进程都有自己的作用域，彼此之间互不影响。在 Shell 中定义的变量，默认就是全局变量。</p><p>想要实际演示全局变量在不同 Shell 进程中的互不相关性，可在图形界面下同时打开两个 Shell，或使用两个终端远程连接到服务器（SSH）。</p><p>首先打开一个 Shell 窗口，定义一个变量 a 并赋值为 99，然后打印，这时在同一个 Shell 窗口中是可正确打印变量 a 的值的。然后再打开一个新的 Shell 窗口，同样打印变量 a 的值，但结果却为空，如图所示。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230203112522488.png" alt="image-20230203112522488"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230203112254433.png" alt="image-20230203112254433"></p><p>这说明全局变量 a 仅仅在定义它的第一个 Shell 进程中有效，对新的 Shell 进程没有影响。这很好理解，就像小王家和小徐家都有一部电视机（变量名相同），但是同一时刻小王家和小徐家的电视中播放的节目可以是不同的（变量值不同）。</p><p>需要强调的是，全局变量的作用范围是当前的 Shell 进程，而不是当前的 Shell 脚本文件，它们是不同的概念。打开一个 Shell 窗口就创建了一个 Shell 进程，打开多个 Shell 窗口就创建了多个 Shell 进程，每个 Shell 进程都是独立的，拥有不同的进程 ID。在一个 Shell 进程中可以使用 source 命令执行多个 Shell 脚本文件，此时全局变量在这些脚本文件中都有效。</p><p>例如，现在有两个 Shell 脚本文件，分别是 <a href="http://a.sh">a.sh</a> 和 <a href="http://b.sh">b.sh</a>。<a href="http://a.sh">a.sh</a> 的代码如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">b=200</span><br></pre></td></tr></table></figure><p><a href="http://b.sh">b.sh</a> 的代码如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$b</span></span><br></pre></td></tr></table></figure><p>打开一个 Shell 窗口，输入以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># a=99</span></span><br><span class="line">[root@localhost ~]<span class="comment"># . ./a.sh</span></span><br><span class="line">99</span><br><span class="line">[root@localhost ~]<span class="comment"># . ./b.sh</span></span><br><span class="line">200</span><br></pre></td></tr></table></figure><p>这三条命令都是在一个进程中执行的，从输出结果可以发现，在 Shell 窗口中以命令行的形式定义的变量 a，在 <a href="http://a.sh">a.sh</a> 中有效；在 <a href="http://a.sh">a.sh</a> 中定义的变量 b，在 <a href="http://b.sh">b.sh</a> 中也有效，变量 b 的作用范围已经超越了 <a href="http://a.sh">a.sh</a>。</p><p>注意，必须在当前进程中运行 Shell 脚本，不能在新进程中运行 Shell 脚本。</p></li><li><h4 id="Shell-环境变量">Shell 环境变量</h4></li></ol><p>全局变量只在当前 Shell 进程中有效，对其它 Shell 进程和子进程都无效。如果使用<code>export</code>命令将全局变量导出，那么它就在所有的子进程中也有效了，这称为“环境变量”。</p><p>环境变量被创建时所处的 Shell 进程称为父进程，如果在父进程中再创建一个新的进程来执行 Shell 命令，那么这个新的进程被称作 Shell 子进程。当 Shell 子进程产生时，它会继承父进程的环境变量为自己所用，所以说环境变量可从父进程传给子进程。不难理解，环境变量还可以传递给孙进程。</p><p>注意，两个没有父子关系的 Shell 进程是不能传递环境变量的，并且环境变量只能向下传递而不能向上传递，即“传子不传父”。</p><p>创建 Shell 子进程最简单的方式是运行 bash 命令，如图所示：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1-1Z41QJGN02.gif" alt="进入Shell子进程"></p><p>通过<code>exit</code>命令可以一层一层地退出 Shell。</p><p>下面演示一下环境变量的使用：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># a=22       #定义一个全局变量</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $a    #在当前Shell中输出a，成功</span></span><br><span class="line">22</span><br><span class="line">[root@localhost ~]<span class="comment"># bash       #进入Shell子进程</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $a    #在子进程中输出a，失败</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># exit       #退出Shell子进程，返回上一级Shell</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@localhost ~]<span class="comment"># export a   #将a导出为环境变量</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash       #重新进入Shell子进程</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo $a    #在子进程中再次输出a，成功</span></span><br><span class="line">22</span><br><span class="line">[root@localhost ~]<span class="comment"># exit       #退出Shell子进程</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@localhost ~]<span class="comment"># exit       #退出父进程，结束整个Shell会话</span></span><br></pre></td></tr></table></figure><p>可以发现，默认情况下，a 在 Shell 子进程中是无效的；使用 export 将 a 导出为环境变量后，在子进程中就可以使用了。</p><p><code>export a</code>这种形式是在定义变量 a 以后再将它导出为环境变量，如果想在定义的同时导出为环境变量，可以写作<code>export a=22</code>。</p><p>我们一直强调的是环境变量在 Shell 子进程中有效，并没有说它在所有的 Shell 进程中都有效；如果你通过终端创建了一个新的 Shell 窗口，那它就不是当前 Shell 的子进程，环境变量对这个新的 Shell 进程仍然是无效的。请看下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1-1Z41QKS3523.gif" alt="环境变量在不同的Shell窗口中无效"></p><p>第一个窗口中的环境变量 a 在第二个窗口中就无效。</p><p><strong>环境变量也是临时的</strong></p><p>通过 export 导出的环境变量只对当前 Shell 进程以及所有的子进程有效，如果最顶层的父进程被关闭了，那么环境变量也就随之消失了，其它的进程也就无法使用了，所以说环境变量也是临时的。</p><p>有读者可能会问，如果我想让一个变量在所有 Shell 进程中都有效，不管它们之间是否存在父子关系，该怎么办呢？</p><p>只有将变量写入 Shell 配置文件中才能达到这个目的！Shell 进程每次启动时都会执行配置文件中的代码做一些初始化工作，如果将变量放在配置文件中，那么每次启动进程都会定义这个变量。</p><h3 id="5-Shell特殊变量-、-、-、-、">5.Shell特殊变量 <code>$#、$*、$@、$?、$$</code></h3><table><thead><tr><th>变量</th><th>含义</th></tr></thead><tbody><tr><td>$0</td><td>当前脚本的文件名。</td></tr><tr><td>$n（n≥1）</td><td>传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是 $1，第二个参数是 $2。</td></tr><tr><td>$#</td><td>传递给脚本或函数的参数个数。</td></tr><tr><td>$*</td><td>传递给脚本或函数的所有参数。</td></tr><tr><td>$@</td><td>传递给脚本或函数的所有参数。当被双引号<code>&quot; &quot;</code>包含时，$@ 与 $* 稍有不同。</td></tr><tr><td>$?</td><td>上个命令的退出状态，或函数的返回值。</td></tr><tr><td>$$</td><td>当前 Shell 进程 ID。对于 Shell 脚本，就是这些脚本所在的进程 ID。</td></tr></tbody></table><ol><li><p>给脚本文件传递参数</p><p>编写下面的代码，并保存为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Process ID: $$&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;File Name: <span class="variable">$0</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;First Parameter : <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Second Parameter : <span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All parameters 1: <span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All parameters 2: $*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Total: <span class="variable">$#</span>&quot;</span></span><br></pre></td></tr></table></figure><p>运行 <a href="http://test.sh">test.sh</a>，并附带参数：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mozhiyan@localhost demo]$ . ./test.sh Shell Linux</span><br><span class="line">Process ID: 5943</span><br><span class="line">File Name: bash</span><br><span class="line">First Parameter : Shell</span><br><span class="line">Second Parameter : Linux</span><br><span class="line">All parameters 1: Shell Linux</span><br><span class="line">All parameters 2: Shell Linux</span><br><span class="line">Total: 2</span><br></pre></td></tr></table></figure></li><li><p>给函数传递参数</p><p>编写下面的代码，并保存为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Language: <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;URL: <span class="variable">$2</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;First Parameter : <span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Second Parameter : <span class="variable">$2</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;All parameters 1: <span class="variable">$@</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;All parameters 2: $*&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Total: <span class="variable">$#</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用函数</span></span><br><span class="line">func Java http://c.biancheng.net/java/</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果为：</span></span><br><span class="line">Language: Java</span><br><span class="line">URL: http://c.biancheng.net/java/</span><br><span class="line">First Parameter : Java</span><br><span class="line">Second Parameter : http://c.biancheng.net/java/</span><br><span class="line">All parameters 1: Java http://c.biancheng.net/java/</span><br><span class="line">All parameters 2: Java http://c.biancheng.net/java/</span><br><span class="line">Total: 2</span><br></pre></td></tr></table></figure></li></ol><ul><li><p><code>$*</code>和<code>$@</code>之间的区别</p><p><code>$*</code>和<code>$@</code>都表示传递给参数或者脚本全部参数。当<code>$*</code>和<code>$@</code>不加双引号时，两者没有任何区别，都表示将接收到的每一个参数当做每一份数据，每个参数之间用空格来分开。</p><p>当<code>$*</code>和<code>$@</code>加上双引号，则两者就存在一下区别：</p><p>​<code>&quot;$*&quot;</code> 表示将传入的多个参数从整体上当做一份数据，以<code>&quot;$1 $2 … $n&quot;</code>的形式输出所有参数。</p><p>​<code>&quot;$@&quot;</code> 表示仍然将传入的多个参数当做多份数据，空格区分，彼此之间独立，以<code>&quot;$1&quot; &quot;$2&quot; … &quot;$n</code>&quot; 的形式输出所有参数。</p><p>编写下面的代码，并保存为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;print each param from \&quot;\$*\&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="string">&quot;$*&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$var</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;print each param from \&quot;\$@\&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$var</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>运行 <a href="http://test.sh">test.sh</a>，并附带参数：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mozhiyan@localhost demo]$ . ./test.sh a b c d</span><br><span class="line"><span class="built_in">print</span> each param from <span class="string">&quot;$*&quot;</span></span><br><span class="line">a b c d</span><br><span class="line"><span class="built_in">print</span> each param from <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure><p>从运行结果可以发现，对于<code>&quot;$*&quot;</code>，只循环了 1 次，因为它只有 1 分数据；对于<code>&quot;$@&quot;</code>，循环了 5 次，因为它有 5 份数据。</p></li><li><p><code>$?</code></p><p><code>$?</code> 是一个特殊变量，用来获取上一个命令的退出状态，或者上一个函数的返回值。</p><p>所谓退出状态，就是上一个命令执行后的返回结果。退出状态是一个数字，一般情况下，大部分命令执行成功会返回 0，失败返回 1，这和C语言的 main() 函数是类似的。</p><p>不过，也有一些命令返回其他值，表示不同类型的错误。</p><ol><li><p><code>$?</code> 获取上一个命令的退出状态</p><p>编写下面的代码，并保存为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == 100 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">exit</span> 0  <span class="comment">#参数正确，退出状态为0</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">exit</span> 1  <span class="comment">#参数错误，退出状态1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><code>exit</code>表示退出当前 Shell 进程，我们必须在新进程中运行 <a href="http://test.sh">test.sh</a>，否则当前 Shell 会话（终端窗口）会被关闭，我们就无法取得它的退出状态了。</p><p>例如，运行 <a href="http://test.sh">test.sh</a> 时传递参数 100：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mozhiyan@localhost ~]$ <span class="built_in">cd</span> demo</span><br><span class="line">[mozhiyan@localhost demo]$ bash ./test.sh 100  <span class="comment">#作为一个新进程运行</span></span><br><span class="line">[mozhiyan@localhost demo]$ <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure><p>再如，运行 <a href="http://test.sh">test.sh</a> 时传递参数 89：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mozhiyan@localhost demo]$ bash ./test.sh 89  <span class="comment">#作为一个新进程运行</span></span><br><span class="line">[mozhiyan@localhost demo]$ <span class="built_in">echo</span> $?</span><br><span class="line">1</span><br></pre></td></tr></table></figure></li><li><p><code>$?</code> 获取函数的返回值</p><p>编写下面的代码，并保存为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#得到两个数相加的和</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">add</span></span>()&#123;</span><br><span class="line">    <span class="built_in">return</span> `<span class="built_in">expr</span> <span class="variable">$1</span> + <span class="variable">$2</span>`</span><br><span class="line">&#125;</span><br><span class="line">add 23 50  <span class="comment">#调用函数</span></span><br><span class="line"><span class="built_in">echo</span> $?  <span class="comment">#获取函数返回值</span></span><br></pre></td></tr></table></figure><p>运行结果：<br>73</p><p>有 C++、C#、Java 等编程经验的读者请注意：严格来说，Shell 函数中的 return 关键字用来表示函数的退出状态，而不是函数的返回值；Shell 不像其它编程语言，没有专门处理返回值的关键字。</p><p>以上处理方案在其它编程语言中没有任何问题，但是在 Shell 中是非常错误的，Shell 函数的返回值和其它编程语言大有不同，</p></li></ol></li></ul><hr><h2 id="3-命令">3.命令</h2><h3 id="1-命令替换">1.命令替换</h3><p>Shell 命令替换是指将命令的输出结果赋值给某个变量。比如，在某个目录中输入 ls 命令可查看当前目录中所有的文件，但如何将输出内容存入某个变量中呢？这就需要使用命令替换了，这也是 Shell 编程中使用非常频繁的功能。</p><p>Shell 中有两种方式可以完成命令替换，一种是反引号<code> </code>，一种是<code>$()</code>，使用方法如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">variable=`commands`</span><br><span class="line">variable=$(commands)</span><br></pre></td></tr></table></figure><p>其中，variable 是变量名，commands 是要执行的命令。commands 可以只有一个命令，也可以有多个命令，多个命令之间以分号<code>;</code>分隔。</p><p>例如，date 命令用来获得当前的系统时间，使用命令替换可以将它的结果赋值给一个变量。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">begin_time=`<span class="built_in">date</span>`    <span class="comment">#开始时间，使用``替换</span></span><br><span class="line"><span class="built_in">sleep</span> 20s            <span class="comment">#休眠20秒</span></span><br><span class="line">finish_time=$(<span class="built_in">date</span>)  <span class="comment">#结束时间，使用$()替换</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Begin time: <span class="variable">$begin_time</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Finish time: <span class="variable">$finish_time</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行脚本，20 秒后可以看到输出结果：</span></span><br><span class="line">Begin time: 2019年 04月 19日 星期五 09:59:58 CST</span><br><span class="line">Finish time: 2019年 04月 19日 星期五 10:00:18 CST</span><br></pre></td></tr></table></figure><p>使用 data 命令的<code>%s</code>格式控制符可以得到当前的 UNIX 时间戳，这样就可以直接计算脚本的运行时间了。UNIX 时间戳是指从 1970 年 1 月 1 日 00:00:00 到目前为止的秒数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">begin_time=`<span class="built_in">date</span> +%s`    <span class="comment">#开始时间，使用``替换</span></span><br><span class="line"><span class="built_in">sleep</span> 20s                <span class="comment">#休眠20秒</span></span><br><span class="line">finish_time=$(<span class="built_in">date</span> +%s)  <span class="comment">#结束时间，使用$()替换</span></span><br><span class="line">run_time=$((finish_time - begin_time))  <span class="comment">#时间差</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;begin time: <span class="variable">$begin_time</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;finish time: <span class="variable">$finish_time</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;run time: <span class="variable">$&#123;run_time&#125;</span>s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行脚本，20 秒后可以看到输出结果：</span></span><br><span class="line">begin time: 1555639864</span><br><span class="line">finish time: 1555639884</span><br><span class="line">run time: 20s</span><br></pre></td></tr></table></figure><p>第 6 行代码中的<code>(( ))</code>是 Shell 数学计算命令。和 <a href="http://c.biancheng.net/cplus/">C++</a>、<a href="http://c.biancheng.net/csharp/">C#</a>、<a href="http://c.biancheng.net/java/">Java</a> 等编程语言不同，在 Shell 中进行数据计算不那么方便，必须使用专门的数学计算命令，<code>(( ))</code>就是其中之一。</p><p>注意，如果被替换的命令的输出内容包括多行（也即有换行符），或者含有多个连续的空白符，那么在输出变量时应该将变量用双引号包围，否则系统会使用默认的空白符来填充，这会导致换行无效，以及连续的空白符被压缩成一个。请看下面的代码：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">LSL=`<span class="built_in">ls</span> -l`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$LSL</span>  <span class="comment">#不使用双引号包围</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------------------&quot;</span>  <span class="comment">#输出分隔符</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$LSL</span>&quot;</span>  <span class="comment">#使用引号包围</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果:</span></span><br><span class="line">total 8 drwxr-xr-x. 2 root root 21 7月 1 2016 abc -rw-rw-r--. 1 root root 147 10月 31 10:29 demo.sh -rw-rw-r--. 1 root root 35 10月 31 10:20 demo.sh~</span><br><span class="line">--------------------------</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x. 2 root     root      21 7月   1 2016 abc</span><br><span class="line">-rw-rw-r--. 1 root root 147 10月 31 10:29 demo.sh</span><br><span class="line">-rw-rw-r--. 1 root root  35 10月 31 10:20 demo.sh~</span><br></pre></td></tr></table></figure><p>所以，为了防止出现格式混乱的情况，我建议在输出变量时加上双引号。</p><p><strong>再谈反引号和 $()</strong></p><p>原则上讲，上面提到的两种变量替换的形式是等价的，可以随意使用；但是，反引号毕竟看起来像单引号，有时候会对查看代码造成困扰，而使用 $() 就相对清晰，能有效避免这种混乱。而且有些情况必须使用 $()：$() 支持嵌套，反引号不行。</p><p>下面的例子演示了使用计算 ls 命令列出的第一个文件的行数，这里使用了两层嵌套。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># Fir_File_Lines=$(wc -l $(ls | sed -n &#x27;1p&#x27;))</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo &quot;$Fir_File_Lines&quot;</span></span><br><span class="line">36 anaconda-ks.cfg</span><br></pre></td></tr></table></figure><p>要注意的是，$() 仅在 Bash Shell 中有效，而反引号可在多种 Shell 中使用。所以这两种命令替换的方式各有特点，究竟选用哪种方式全看个人需求。</p><h3 id="2-内置命令">2.内置命令</h3><p>所谓 Shell 内建命令，就是由 Bash 自身提供的命令，而不是文件系统中的某个可执行文件。</p><p>例如，用于进入或者切换目录的 cd 命令，虽然我们一直在使用它，但如果不加以注意很难意识到它与普通命令的性质是不一样的：该命令并不是某个外部文件，只要在 Shell 中你就一定可以运行这个命令。</p><p>可以使用 type 来确定一个命令是否是内建命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># type cd</span></span><br><span class="line"><span class="built_in">cd</span> is a Shell <span class="built_in">builtin</span></span><br><span class="line">[root@localhost ~]<span class="comment"># type ifconfig</span></span><br><span class="line">ifconfig is /sbin/ifconfig</span><br></pre></td></tr></table></figure><p>由此可见，cd 是一个 Shell 内建命令，而 ifconfig 是一个外部文件，它的位置是<code>/sbin/ifconfig</code>。</p><p>还记得系统变量 <a href="http://c.biancheng.net/view/962.html">$PATH</a> 吗？$PATH 变量包含的目录中几乎聚集了系统中绝大多数的可执行命令，它们都是外部命令。</p><p>通常来说，内建命令会比外部命令执行得更快，执行外部命令时不但会触发磁盘 I/O，还需要 fork 出一个单独的进程来执行，执行完成后再退出。而执行内建命令相当于调用当前 Shell 进程的一个函数。</p><ul><li><p>Bash Shell 中直接可用的内建命令:</p><table>  <caption>    Bash Shell 内建命令  </caption>  <tbody>    <tr>      <th>命令</th>      <th>说明</th>    </tr>    <tr>      <td>:</td>      <td>扩展参数列表，执行重定向操作</td>    </tr>    <tr>      <td>.</td>      <td>读取并执行指定文件中的命令（在当前 shell 环境中）</td>    </tr>    <tr>      <td>alias</td>      <td>为指定命令定义一个别名</td>    </tr>    <tr>      <td>bg</td>      <td>将作业以后台模式运行</td>    </tr>    <tr>      <td>bind</td>      <td>将键盘序列绑定到一个 readline 函数或宏</td>    </tr>    <tr>      <td>break</td>      <td>退出 for、while、select 或 until 循环</td>    </tr>    <tr>      <td>builtin</td>      <td>执行指定的 shell 内建命令</td>    </tr>    <tr>      <td>caller</td>      <td>返回活动子函数调用的上下文</td>    </tr>    <tr>      <td>cd</td>      <td>将当前目录切换为指定的目录</td>    </tr>    <tr>      <td>command</td>      <td>执行指定的命令，无需进行通常的 shell 查找</td>    </tr>    <tr>      <td>compgen</td>      <td>为指定单词生成可能的补全匹配</td>    </tr>    <tr>      <td>complete</td>      <td>显示指定的单词是如何补全的</td>    </tr>    <tr>      <td>compopt</td>      <td>修改指定单词的补全选项</td>    </tr>    <tr>      <td>continue</td>      <td>继续执行 for、while、select 或 until 循环的下一次迭代</td>    </tr>    <tr>      <td>declare</td>      <td>声明一个变量或变量类型。</td>    </tr>    <tr>      <td>dirs</td>      <td>显示当前存储目录的列表</td>    </tr>    <tr>      <td>disown</td>      <td>从进程作业表中刪除指定的作业</td>    </tr>    <tr>      <td>echo</td>      <td>将指定字符串输出到 STDOUT</td>    </tr>    <tr>      <td>enable</td>      <td>启用或禁用指定的内建shell命令</td>    </tr>    <tr>      <td>eval</td>      <td>将指定的参数拼接成一个命令，然后执行该命令</td>    </tr>    <tr>      <td>exec</td>      <td>用指定命令替换 shell 进程</td>    </tr>    <tr>      <td>exit</td>      <td>强制 shell 以指定的退出状态码退出</td>    </tr>    <tr>      <td>export</td>      <td>设置子 shell 进程可用的变量</td>    </tr>    <tr>      <td>fc</td>      <td>从历史记录中选择命令列表</td>    </tr>    <tr>      <td>fg</td>      <td>将作业以前台模式运行</td>    </tr>    <tr>      <td>getopts</td>      <td>分析指定的位置参数</td>    </tr>    <tr>      <td>hash</td>      <td>查找并记住指定命令的全路径名</td>    </tr>    <tr>      <td>help</td>      <td>显示帮助文件</td>    </tr>    <tr>      <td>history</td>      <td>显示命令历史记录</td>    </tr>    <tr>      <td>jobs</td>      <td>列出活动作业</td>    </tr>    <tr>      <td>kill</td>      <td>向指定的进程 ID(PID) 发送一个系统信号</td>    </tr>    <tr>      <td>let</td>      <td>计算一个数学表达式中的每个参数</td>    </tr>    <tr>      <td>local</td>      <td>在函数中创建一个作用域受限的变量</td>    </tr>    <tr>      <td>logout</td>      <td>退出登录 shell</td>    </tr>    <tr>      <td>mapfile</td>      <td>从 STDIN 读取数据行，并将其加入索引数组</td>    </tr>    <tr>      <td>popd</td>      <td>从目录栈中删除记录</td>    </tr>    <tr>      <td>printf</td>      <td>使用格式化字符串显示文本</td>    </tr>    <tr>      <td>pushd</td>      <td>向目录栈添加一个目录</td>    </tr>    <tr>      <td>pwd</td>      <td>显示当前工作目录的路径名</td>    </tr>    <tr>      <td>read</td>      <td>从 STDIN 读取一行数据并将其赋给一个变量</td>    </tr>    <tr>      <td>readarray</td>      <td>从 STDIN 读取数据行并将其放入索引数组</td>    </tr>    <tr>      <td>readonly</td>      <td>从 STDIN 读取一行数据并将其赋给一个不可修改的变量</td>    </tr>    <tr>      <td>return</td>      <td>强制函数以某个值退出，这个值可以被调用脚本提取</td>    </tr>    <tr>      <td>set</td>      <td>设置并显示环境变量的值和 shell 属性</td>    </tr>    <tr>      <td>shift</td>      <td>将位置参数依次向下降一个位置</td>    </tr>    <tr>      <td>shopt</td>      <td>打开/关闭控制 shell 可选行为的变量值</td>    </tr>    <tr>      <td>source</td>      <td>读取并执行指定文件中的命令（在当前 shell 环境中）</td>    </tr>    <tr>      <td>suspend</td>      <td>暂停 Shell 的执行，直到收到一个 SIGCONT 信号</td>    </tr>    <tr>      <td>test</td>      <td>基于指定条件返回退出状态码 0 或 1</td>    </tr>    <tr>      <td>times</td>      <td>显示累计的用户和系统时间</td>    </tr>    <tr>      <td>trap</td>      <td>如果收到了指定的系统信号，执行指定的命令</td>    </tr>    <tr>      <td>type</td>      <td>显示指定的单词如果作为命令将会如何被解释</td>    </tr>    <tr>      <td>typeset</td>      <td>声明一个变量或变量类型。</td>    </tr>    <tr>      <td>ulimit</td>      <td>为系统用户设置指定的资源的上限</td>    </tr>    <tr>      <td>umask</td>      <td>为新建的文件和目录设置默认权限</td>    </tr>    <tr>      <td>unalias</td>      <td>刪除指定的别名</td>    </tr>    <tr>      <td>unset</td>      <td>刪除指定的环境变量或 shell 属性</td>    </tr>    <tr>      <td>wait</td>      <td>等待指定的进程完成，并返回退出状态码</td>    </tr>  </tbody></table></li></ul><h3 id="3-alias-给命令创建别名">3.alias 给命令创建别名</h3><p>alisa 用来给命令创建一个别名。若直接输入该命令且不带任何参数，则列出当前 Shell 进程中使用了哪些别名。现在你应该能理解类似<code>ll</code>这样的命令为什么与<code>ls -l</code>的效果是一样的吧。</p><p>下面让我们来看一下有哪些命令被默认创建了别名：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ <span class="built_in">alias</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l.=<span class="string">&#x27;ls -d .* --color=tty&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -l --color=tty&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=tty&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">mv</span>=<span class="string">&#x27;mv -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">which</span>=<span class="string">&#x27;alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde&#x27;</span></span><br></pre></td></tr></table></figure><p>你看，为了让我们使用方便，Shell 会给某些命令默认创建别名。</p><ul><li><p>使用 alias 命令自定义别名</p><p>使用 alias 命令自定义别名的语法格式为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> new_name=<span class="string">&#x27;command&#x27;</span></span><br></pre></td></tr></table></figure><p>比如，一般的关机命令是<code>shutdown-h now</code>，写起来比较长，这时可以重新定义一个关机命令，以后就方便多了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> myShutdown=<span class="string">&#x27;shutdown -h now&#x27;</span></span><br></pre></td></tr></table></figure><p>再如，通过 date 命令可以获得当前的 UNIX 时间戳，具体写法为<code>date +%s</code>，如果你嫌弃它太长或者不容易记住，那可以给它定义一个别名。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> timestamp=<span class="string">&#x27;date +%s&#x27;</span></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">alias</span> timestamp=<span class="string">&#x27;date +%s&#x27;</span></span><br><span class="line">begin=`timestamp`  </span><br><span class="line"><span class="built_in">sleep</span> 20s</span><br><span class="line">finish=$(timestamp)</span><br><span class="line">difference=$((finish - begin))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;run time: <span class="variable">$&#123;difference&#125;</span>s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行脚本，20 秒后看到输出结果：</span></span><br><span class="line">run time: 20s</span><br></pre></td></tr></table></figure><p><strong>别名只是临时的</strong>，在代码中使用 alias 命令定义的别名只能在当前 Shell 进程中使用，在子进程和其它进程中都不能使用。当前 Shell 进程结束后，别名也随之消失。要想让别名对所有的 Shell 进程都有效，就得把别名写入 Shell 配置文件。Shell 进程每次启动时都会执行配置文件中的代码做一些初始化工作，将别名放在配置文件中，那么每次启动进程都会定义这个别名。</p></li><li><p>使用 unalias 命令删除别名</p><p>使用 unalias 内建命令可以删除当前 Shell 进程中的别名。unalias 有两种使用方法：</p><ul><li>第一种用法是在命令后跟上某个命令的别名，用于删除指定的别名。</li><li>第二种用法是在命令后接<code>-a</code>参数，删除当前 Shell 进程中所有的别名。</li></ul><p>同样，这两种方法都是在当前 Shell 进程中生效的。要想永久删除配置文件中定义的别名，只能进入该文件手动删除。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除 ll 别名</span></span><br><span class="line">[root@localhost ~]$ <span class="built_in">unalias</span> ll</span><br><span class="line"><span class="comment"># 再次运行该命令时，报“找不到该命令”的错误，说明该别名被删除了</span></span><br><span class="line">[root@localhost ~]$ ll</span><br><span class="line">-bash: ll: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure></li></ul><h3 id="4-echo-输出字符串">4.echo 输出字符串</h3><h3 id="5-read-读取从键盘输入的数据">5.read 读取从键盘输入的数据</h3><h3 id="6-exit-退出当前进程">6.exit 退出当前进程</h3><h3 id="7-declare-typeset-设置变量属性">7.declare(typeset) 设置变量属性</h3><p>declare 和 typeset 都是 Shell 内建命令，它们的用法相同，都用来设置变量的属性。不过 typeset 已经被弃用了，建议使用 declare 代替。</p><p>declare 命令的用法如下所示：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare [+/-] [aAfFgilprtux] [变量名=变量值]</span><br></pre></td></tr></table></figure><p>其中，<code>-</code>表示设置属性，<code>+</code>表示取消属性，<code>aAfFgilprtux</code>都是具体的选项，它们的含义如下表所示：</p><table><tbody><tr><th>选项</th><th>含义</th></tr><tr><td>-f [name]</td><td>列出之前由用户在脚本中定义的函数名称和函数体。</td></tr><tr><td>-F [name]</td><td>仅列出自定义函数名称。</td></tr><tr><td>-g name</td><td>在 Shell 函数内部创建全局变量。</td></tr><tr><td>-p [name]</td><td>显示指定变量的属性和值。</td></tr><tr><td>-a name</td><td>声明变量为普通数组。</td></tr><tr><td>-A name</td><td>声明变量为关联数组（支持索引下标为字符串）。</td></tr><tr><td>-i name&nbsp;</td><td>将变量定义为整数型。</td></tr><tr><td>-r name[=value]&nbsp;</td><td>将变量定义为只读（不可修改和删除），等价于 readonly name。</td></tr><tr><td>-x name[=value]</td><td>将变量设置为环境变量，等价于&nbsp;export name[=value]。</td></tr></tbody></table><p>【实例1】将变量声明为整数并进行计算。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -i m n ret  <span class="comment">#将多个变量声明为整数</span></span><br><span class="line">m=10</span><br><span class="line">n=30</span><br><span class="line">ret=<span class="variable">$m</span>+<span class="variable">$n</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line">40</span><br></pre></td></tr></table></figure><p>【实例2】将变量定义为只读变量。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[c.biancheng.net]$ <span class="built_in">declare</span> -r n=10</span><br><span class="line">[c.biancheng.net]$ n=20</span><br><span class="line">bash: n: 只读变量</span><br><span class="line">[c.biancheng.net]$ <span class="built_in">echo</span> <span class="variable">$n</span></span><br><span class="line">10</span><br></pre></td></tr></table></figure><p>【实例3】显示变量的属性和值。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[c.biancheng.net]$ <span class="built_in">declare</span> -r n=10</span><br><span class="line">[c.biancheng.net]$ <span class="built_in">declare</span> -p n</span><br><span class="line"><span class="built_in">declare</span> -r n=<span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure><h3 id="8-test-检测某个条件是否成立-a-id-test-anchor-a">8.test([ ]) 检测某个条件是否成立 <a id="test_anchor"> </a></h3><p>test 是 Shell 内置命令，用来检测某个条件是否成立。test 通常和 if 语句一起使用，并且大部分 if 语句都依赖 test。</p><p>test 命令有很多选项，可以进行数值、字符串和文件三个方面的检测。</p><p>Shell test 命令的用法为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> expression</span><br></pre></td></tr></table></figure><p>当 test 判断 expression 成立时，退出状态为 0，否则为非 0 值。</p><p>test 命令也可以简写为<code>[]</code>，它的用法为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ expression ]</span><br></pre></td></tr></table></figure><p>==注意<code>[]</code>和<code>expression</code>之间的空格，这两个空格是必须的，否则会导致语法错误。<code>[]</code>的写法更加简洁，比 test 使用频率高。==</p><p>例子：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> age</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$age</span> -le 2; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;婴儿&quot;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> <span class="variable">$age</span> -ge 3 &amp;&amp; <span class="built_in">test</span> <span class="variable">$age</span> -le 8; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;幼儿&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$age</span> -ge 9 ] &amp;&amp; [ <span class="variable">$age</span> -le 17 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;少年&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$age</span> -ge 18 ] &amp;&amp; [ <span class="variable">$age</span> -le 25 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> <span class="variable">$age</span> -ge 26 &amp;&amp; <span class="built_in">test</span> <span class="variable">$age</span> -le 40; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;青年&quot;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> <span class="variable">$age</span> -ge 41 &amp;&amp; [ <span class="variable">$age</span> -le 60 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;中年&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;老年&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>其中，<code>-le</code>选项表示小于等于，<code>-ge</code>选项表示大于等于，<code>&amp;&amp;</code>是逻辑与运算符。</p><p>学习 test 命令，重点是学习它的各种选项，下面我们就逐一讲解。</p><h4 id="1）与文件检测相关">1）与文件检测相关</h4><table>  <caption>    表1：test 文件检测相关选项列表  </caption>  <tbody>    <tr>      <th colspan="2">文件类型判断</th>    </tr>    <tr>      <th>选 项</th>      <th>作 用</th>    </tr>    <tr>      <td>-b filename</td>      <td>判断文件是否存在，并且是否为块设备文件。</td>    </tr>    <tr>      <td>-c filename</td>      <td>判断文件是否存在，并且是否为字符设备文件。</td>    </tr>    <tr>      <td>-d filename</td>      <td>判断文件是否存在，并且是否为目录文件。</td>    </tr>    <tr>      <td>-e filename</td>      <td>判断文件是否存在。</td>    </tr>    <tr>      <td>-f filename</td>      <td>判断文件是否存在，井且是否为普通文件。</td>    </tr>    <tr>      <td>-L filename</td>      <td>判断文件是否存在，并且是否为符号链接文件。</td>    </tr>    <tr>      <td>-p&nbsp;filename</td>      <td>判断文件是否存在，并且是否为管道文件。</td>    </tr>    <tr>      <td>-s filename</td>      <td>判断文件是否存在，并且是否为非空。</td>    </tr>    <tr>      <td>-S filename</td>      <td>判断该文件是否存在，并且是否为套接字文件。</td>    </tr>    <tr>      <th colspan="2">文件权限判断</th>    </tr>    <tr>      <th>选 项</th>      <th>作&nbsp;用</th>    </tr>    <tr>      <td>-r filename</td>      <td>判断文件是否存在，并且是否拥有读权限。</td>    </tr>    <tr>      <td>-w filename</td>      <td>判断文件是否存在，并且是否拥有写权限。</td>    </tr>    <tr>      <td>-x filename</td>      <td>判断文件是否存在，并且是否拥有执行权限。</td>    </tr>    <tr>      <td>-u filename</td>      <td>判断文件是否存在，并且是否拥有 SUID 权限。</td>    </tr>    <tr>      <td>-g filename</td>      <td>判断文件是否存在，并且是否拥有 SGID 权限。</td>    </tr>    <tr>      <td>-k filename</td>      <td>判断该文件是否存在，并且是否拥有 SBIT 权限。</td>    </tr>    <tr>      <th colspan="2">文件比较</th>    </tr>    <tr>      <th>选 项</th>      <th>作&nbsp;用</th>    </tr>    <tr>      <td>filename1 -nt filename2</td>      <td>判断 filename1 的修改时间是否比 filename2 的新。</td>    </tr>    <tr>      <td>filename -ot filename2</td>      <td>判断 filename1 的修改时间是否比 filename2 的旧。</td>    </tr>    <tr>      <td>filename1 -ef filename2</td>      <td>        判断 filename1 是否和 filename2 的 inode        号一致，可以理解为两个文件是否为同一个文件。这个判断用于判断硬链接是很好的方法      </td>    </tr>  </tbody></table><p>Shell test 文件检测举例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> filename</span><br><span class="line"><span class="built_in">read</span> url</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -w <span class="variable">$filename</span> &amp;&amp; <span class="built_in">test</span> -n <span class="variable">$url</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$url</span> &gt; <span class="variable">$filename</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;写入成功&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;写入失败&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在 Shell 脚本文件所在的目录新建一个文本文件并命名为 urls.txt，然后运行 Shell 脚本，运行结果为：</span></span><br><span class="line">urls.txt↙</span><br><span class="line">http://c.biancheng.net/shell/↙</span><br><span class="line">写入成功</span><br></pre></td></tr></table></figure><h4 id="2）与数值比较相关">2）与数值比较相关</h4><table>  <caption>    表2：test 数值比较相关选项列表  </caption>  <tbody>    <tr>      <th>选 项</th>      <th>作&nbsp;用</th>    </tr>    <tr>      <td>num1 -eq num2</td>      <td>判断 num1 是否和 num2 相等。</td>    </tr>    <tr>      <td>num1 -ne num2</td>      <td>判断 num1 是否和 num2 不相等。</td>    </tr>    <tr>      <td>num1 -gt num2</td>      <td>判断 num1 是否大于 num2 。</td>    </tr>    <tr>      <td>num1 -lt num2</td>      <td>判断 num1 是否小于 num2。</td>    </tr>    <tr>      <td>num1 -ge num2</td>      <td>判断 num1 是否大于等于 num2。</td>    </tr>    <tr>      <td>num1 -le num2</td>      <td>判断 num1 是否小于等于 num2。</td>    </tr>  </tbody></table><p>注意，test 只能用来比较整数，小数相关的比较还得依赖 <a href="#bc_anchor">bc 命令</a>。</p><p>Shell test 数值比较举例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> a b</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$a</span> -eq <span class="variable">$b</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个数相等&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个数不相等&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果1：</span></span><br><span class="line">10 10</span><br><span class="line">两个数相等</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果2：</span></span><br><span class="line">10 20</span><br><span class="line">两个数不相等</span><br></pre></td></tr></table></figure><h4 id="3）与字符串判断相关">3）与字符串判断相关</h4><table>  <caption>    表3：test 字符串判断相关选项列表  </caption>  <tbody>    <tr>      <th>选 项</th>      <th>作&nbsp;用</th>    </tr>    <tr>      <td>-z str</td>      <td>判断字符串 str 是否为空。</td>    </tr>    <tr>      <td>-n str</td>      <td>判断宇符串 str 是否为非空。</td>    </tr>    <tr>      <td>        str1 = str2<br />        str1 == str2      </td>      <td>        <code>=</code>和<code>==</code>是等价的，都用来判断 str1 是否和 str2        相等。      </td>    </tr>    <tr>      <td>str1 != str2</td>      <td>判断 str1 是否和 str2 不相等。</td>    </tr>    <tr>      <td>str1 \&gt; str2</td>      <td>        判断 str1 是否大于        str2。<code>\&gt;</code>是<code>&gt;</code>的转义字符，这样写是为了防止<code>&gt;</code>被误认为成重定向运算符。      </td>    </tr>    <tr>      <td>str1 \&lt; str2</td>      <td>判断 str1 是否小于 str2。同样，<code>\&lt;</code>也是转义字符。</td>    </tr>  </tbody></table><p><code>==、&gt;、&lt;</code> 在大部分编程语言中都用来比较数字，而在 Shell 中，它们只能用来比较字符串，不能比较数字，这是非常奇葩的，大家要习惯。</p><p>其次，不管是比较数字还是字符串，Shell 都不支持 &gt;= 和 &lt;= 运算符，切记。</p><p>Shell test 字符串比较举例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> str1</span><br><span class="line"><span class="built_in">read</span> str2</span><br><span class="line"><span class="comment">#检测字符串是否为空</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$str1</span>&quot;</span> ] || [ -z <span class="string">&quot;<span class="variable">$str2</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;字符串不能为空&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#比较字符串</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$str1</span> = <span class="variable">$str2</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个字符串相等&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个字符串不相等&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line">http://c.biancheng.net/</span><br><span class="line">http://c.biancheng.net/shell/</span><br><span class="line">两个字符串不相等</span><br></pre></td></tr></table></figure><p>变量 <code>$str1</code> 和 <code>$str2</code> 都被双引号包围起来，这样做是为了防止 <code>$str1</code> 或者 <code>$str2</code> 是空字符串时出现错误。</p><h4 id="4）与逻辑运算相关">4）与逻辑运算相关</h4><table>  <caption>    表4：test 逻辑运算相关选项列表  </caption>  <tbody>    <tr>      <th>选 项</th>      <th>作&nbsp;用</th>    </tr>    <tr>      <td>expression1 -a expression</td>      <td>        逻辑与，表达式 expression1 和 expression2 都成立，最终的结果才是成立的。      </td>    </tr>    <tr>      <td>expression1 -o expression2</td>      <td>        逻辑或，表达式 expression1 和 expression2 有一个成立，最终的结果就成立。      </td>    </tr>    <tr>      <td>!expression</td>      <td>逻辑非，对 expression 进行取反。</td>    </tr>  </tbody></table><p>改写上面的代码，使用逻辑运算选项：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> str1</span><br><span class="line"><span class="built_in">read</span> str2</span><br><span class="line"><span class="comment">#检测字符串是否为空</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$str1</span>&quot;</span> -o -z <span class="string">&quot;<span class="variable">$str2</span>&quot;</span> ]  <span class="comment">#使用 -o 选项取代之前的 ||</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;字符串不能为空&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#比较字符串</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$str1</span> = <span class="variable">$str2</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个字符串相等&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;两个字符串不相等&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>前面的代码我们使用两个<code>[]</code>命令，并使用<code>||</code>运算符将它们连接起来，这里我们改成<code>-o</code>选项，只使用一个<code>[]</code>命令就可以了。</p><ul><li><p>在 test 中使用变量建议用双引号包围起来</p><p>test 和 [] 都是命令，一个命令本质上对应一个程序或者一个函数。即使是一个程序，它也有入口函数，例如C语言程序的入口函数是 main()，运行C语言程序就从 main() 函数开始，所以也可以将一个程序等效为一个函数，这样我们就不用再区分函数和程序了，直接将一个命令和一个函数对应起来即可。</p><p>有了以上认知，就很容易看透命令的本质了：使用一个命令其实就是调用一个函数，命令后面附带的选项和参数最终都会作为实参传递给函数。</p><p>假设 test 命令对应的函数是 func()，使用<code>test -z $str1</code>命令时，会先将变量 $str1 替换成字符串：</p><ul><li>如果 $str1 是一个正常的字符串，比如 abc123，那么替换后的效果就是<code>test -z abc123</code>，调用 func() 函数的形式就是<code>func(&quot;-z abc123&quot;)</code>。test 命令后面附带的所有选项和参数会被看成一个整体，并作为实参传递进函数。</li><li>如果 $str1 是一个空字符串，那么替换后的效果就是<code>test -z</code>，调用 func() 函数的形式就是<code>func(&quot;-z &quot;)</code>，这就比较奇怪了，因为<code>-z</code>选项没有和参数成对出现，func() 在分析时就会出错。</li></ul><p>如果我们给 $str1 变量加上双引号，当 $str1 是空字符串时，<code>test -z &quot;$str1&quot;</code>就会被替换为<code>test -z &quot;&quot;</code>，调用 func() 函数的形式就是<code>func(&quot;-z \&quot;\&quot;&quot;)</code>，很显然，<code>-z</code>选项后面跟的是一个空字符串（<code>\&quot;</code>表示转义字符），这样 func() 在分析时就不会出错了。</p><p>所以，当你在 test 命令中使用变量时，我强烈建议将变量用双引号<code>&quot;&quot;</code>包围起来，这样能避免变量为空值时导致的很多奇葩问题。</p></li><li><p>总结</p><p>test 命令比较奇葩，&gt;、&lt;、== 只能用来比较字符串，不能用来比较数字，比较数字需要使用 -eq、-gt 等选项；不管是比较字符串还是数字，test 都不支持 &gt;= 和 &lt;=。有经验的程序员需要慢慢习惯 test 命令的这些奇葩用法。</p><p>对于整型数字的比较，我建议大家使用 (())。(()) 支持各种运算符，写法也符合数学规则，用起来更加方便，何乐而不为呢？</p><p>几乎完全兼容 test ，并且比 test 更加强大，比 test 更加灵活的是<code>[[ ]]</code>；<code>[[ ]]</code>不是命令，是关键字。</p></li></ul><h3 id="9-检测某个条件是否成立">9.[[ ]] 检测某个条件是否成立</h3><p><code>[[ ]]</code>是 Shell 内置==关键字==，放到命令中来讲是因为 text 功能相近，也用来检测某个条件是否成立。</p><p>test 能做到的，<code>[[ ]]</code> 也能做到，而且 <code>[[ ]]</code> 做的更好；test 做不到的，<code>[[ ]]</code> 还能做到。可以认为 <code>[[ ]]</code> 是 test 的升级版，对细节进行了优化，并且扩展了一些功能。</p><p>[[ ]] 的用法为：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ expression ]]</span><br></pre></td></tr></table></figure><p>当 <code>[[ ]]</code> 判断 expression 成立时，退出状态为 0，否则为非 0 值。注意<code>[[ ]]</code>和<code>expression</code>之间的空格，这两个空格是必须的，否则会导致语法错误。</p><h4 id="1）不需要注意某些细枝末节">1）不需要注意某些细枝末节</h4><p><code>[[ ]]</code> 是 Shell 内置关键字，不是命令，在使用时没有给函数传递参数的过程，所以 test 命令的某些注意事项在 <code>[[ ]]</code> 中就不存在了，具体包括：</p><ul><li>不需要把变量名用双引号<code>&quot;&quot;</code>包围起来，即使变量是空值，也不会出错。</li><li>不需要、也不能对 &gt;、&lt; 进行转义，转义后会出错。</li></ul><p>请看下面的演示代码：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> str1</span><br><span class="line"><span class="built_in">read</span> str2</span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="variable">$str1</span> ]] || [[ -z <span class="variable">$str2</span> ]]  <span class="comment">#不需要对变量名加双引号</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;字符串不能为空&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [[ <span class="variable">$str1</span> &lt; <span class="variable">$str2</span> ]]  <span class="comment">#不需要也不能对 &lt; 进行转义</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;str1 &lt; str2&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;str1 &gt;= str2&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line">http://c.biancheng.net/shell/</span><br><span class="line">http://data.biancheng.net/</span><br><span class="line">str1 &lt; str2</span><br></pre></td></tr></table></figure><h4 id="2）支持逻辑运算符">2）支持逻辑运算符</h4><p>对多个表达式进行逻辑运算时，可以使用逻辑运算符将多个 test 命令连接起来，例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ -z <span class="string">&quot;<span class="variable">$str1</span>&quot;</span> ] || [ -z <span class="string">&quot;<span class="variable">$str2</span>&quot;</span> ]</span><br></pre></td></tr></table></figure><p>你也可以借助选项把多个表达式写在一个 test 命令中，例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ -z <span class="string">&quot;<span class="variable">$str1</span>&quot;</span> -o -z <span class="string">&quot;<span class="variable">$str2</span>&quot;</span> ]</span><br></pre></td></tr></table></figure><p>但是，这两种写法都有点“别扭”，完美的写法是在一个命令中使用逻辑运算符将多个表达式连接起来。我们的这个愿望在 <code>[[ ]]</code> 中实现了，<code>[[ ]]</code> 支持 <code>&amp;&amp;</code>、<code>||</code> 和 <code>!</code> 三种逻辑运算符。</p><p>使用 <code>[[ ]]</code> 对上面的语句进行改进：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ -z <span class="variable">$str1</span> || -z <span class="variable">$str2</span> ]]</span><br></pre></td></tr></table></figure><p>这种写法就比较简洁漂亮了。</p><p>注意，<code>[[ ]]</code> 剔除了 test 命令的<code>-o</code>和<code>-a</code>选项，你只能使用 <code>||</code> 和 <code>&amp;&amp;</code>。这意味着，你不能写成下面的形式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ -z <span class="variable">$str1</span> -o -z <span class="variable">$str2</span> ]]</span><br></pre></td></tr></table></figure><p>当然，使用逻辑运算符将多个 [[ ]] 连接起来依然是可以的，因为这是 Shell 本身提供的功能，跟 [[ ]] 或者 test 没有关系，如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ -z <span class="variable">$str1</span> ]] || [[ -z <span class="variable">$str2</span> ]]</span><br></pre></td></tr></table></figure><table>  <caption>    该表总结了各种写法的对错  </caption>  <tbody>    <tr>      <th colspan="2">test 或&nbsp;[]</th>      <th colspan="2">[[ ]]</th>    </tr>    <tr>      <td>[ -z "$str1" ] || [ -z "$str2" ]</td>      <td>        <span style="color: #008000"><b>√</b></span>      </td>      <td>[[ -z $str1 ]] || [[ -z $str2 ]]</td>      <td>        <b><span style="color: #008000">√</span></b>      </td>    </tr>    <tr>      <td>[ -z "$str1" -o -z "$str2" ]</td>      <td>        <b><span style="color: #008000">√</span></b>      </td>      <td>[[ -z $str1 -o -z $str2 ]]</td>      <td>        <b><span style="color: #ff0000">×</span></b>      </td>    </tr>    <tr>      <td>[&nbsp;-z $str1 || -z $str2 ]</td>      <td>        <span style="color: #ff0000"><b>×</b></span>      </td>      <td>[[ -z $str1 || -z $str2 ]]</td>      <td>        <b><span style="color: #008000">√</span></b>      </td>    </tr>  </tbody></table><h4 id="3）支持正则表达式">3）支持正则表达式</h4><p>在 Shell <code>[[ ]]</code> 中，可以使用<code>=~</code>来检测字符串是否符合某个正则表达式，它的用法为：</p><p>str 表示字符串，regex 表示正则表达式。</p><p>下面的代码检测一个字符串是否是手机号：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> tel</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$tel</span> =~ ^1[0-9]&#123;10&#125;$ ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;你输入的是手机号码&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;你输入的不是手机号码&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果1：</span></span><br><span class="line">13203451100</span><br><span class="line">你输入的是手机号码</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果2：</span></span><br><span class="line">132034511009</span><br><span class="line">你输入的不是手机号码</span><br></pre></td></tr></table></figure><blockquote><p>对<code>^1[0-9]&#123;10&#125;$</code>的说明：</p><ul><li><code>^</code>匹配字符串的开头（一个位置）；</li><li><code>[0-9]&#123;10&#125;</code>匹配连续的十个数字；</li><li><code>$</code>匹配字符串的末尾（一个位置）。</li></ul></blockquote><ul><li><p>总结</p><p>有了 <code>[[ ]]</code>，你还有什么理由使用 <code>test</code> 或者 <code>[ ]</code>，<code>[[ ]]</code> 完全可以替代之，而且更加方便，更加强大。</p><p>但是 <code>[[ ]]</code> 对数字的比较仍然不友好，所以我建议，以后大家使用 if 判断条件时，==用 <code>(())</code> 来处理整型数字，用 <code>[[ ]]</code> 来处理字符串或者文件==。</p></li></ul><hr><h2 id="4-位置参数">4.位置参数</h2><p>Shell 脚本文件时我们可以给它传递一些参数，这些参数在脚本文件内部可以使用<code>$n</code>的形式来接收，例如，$1 表示第一个参数，$2 表示第二个参数，依次类推。</p><p>同样，在调用函数时也可以传递参数。Shell 函数参数的传递和其它编程语言不同，没有所谓的形参和实参，在定义函数时也不用指明参数的名字和数目。换句话说，定义 Shell 函数时不能带参数，但是在调用函数时却可以传递参数，这些传递进来的参数，在函数内部就也使用<code>$n</code>的形式接收，例如，$1 表示第一个参数，$2 表示第二个参数，依次类推。</p><p>这种通过<code>$n</code>的形式来接收的参数，在 Shell 中称为位置参数。</p><p>变量的名字必须以字母或者下划线开头，不能以数字开头；但是位置参数却偏偏是数字，这和变量的命名规则是相悖的，所以我们将它们视为“特殊变量”。</p><p>除了 <code>$n</code>，Shell 中还有 <code>$#、$*、$@、$?、$$</code> 几个特殊参数。</p><h3 id="1-给脚本文件传递位置参数">1.给脚本文件传递位置参数</h3><p>请编写下面的代码，并命名为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Language: <span class="variable">$1</span>&quot;</span><span class="built_in">echo</span> <span class="string">&quot;URL: <span class="variable">$2</span>&quot;</span></span><br></pre></td></tr></table></figure><p>运行 <a href="http://test.sh">test.sh</a>，并附带参数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ cd demo</span><br><span class="line">[root@localhost demo]$ . ./test.sh Shell http://nb.com/shell/</span><br><span class="line">Language: Shell</span><br><span class="line">URL: http://nb.com/shell/</span><br></pre></td></tr></table></figure><p>其中<code>Shell</code>是第一个位置参数，<code>http://nb.com/shell/</code>是第二个位置参数，两者之间以空格分隔。</p><h3 id="2-给函数传递位置参数">2.给函数传递位置参数</h3><p>请编写下面的代码，并命名为 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">#定义函数</span><br><span class="line">function func()&#123;</span><br><span class="line">echo &quot;Language: $1&quot;</span><br><span class="line">    echo &quot;URL: $2&quot;&#125;</span><br><span class="line">    </span><br><span class="line">#调用函数</span><br><span class="line">func C++ http://nb.com/cplus/</span><br></pre></td></tr></table></figure><p>运行 <a href="http://test.sh">test.sh</a>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]$ cd demo</span><br><span class="line">[root@localhost demo]$ . ./test.sh</span><br><span class="line">Language: C++</span><br><span class="line">URL: http://nb.com//cplus/</span><br></pre></td></tr></table></figure><blockquote><p><strong>注意事项</strong></p><p>如果参数个数太多，达到或者超过了 10 个，那么就得用<code>$&#123;n&#125;</code>的形式来接收了，例如 ${10}、${23}。<code>&#123; &#125;</code>的作用是为了帮助解释器识别参数的边界，这跟使用变量时加<code>&#123; &#125;</code>是一样的效果。</p></blockquote><hr><h2 id="5-字符串">5.字符串</h2><h3 id="1-定义">1.定义</h3><p>字符串（String）就是一系列字符的组合。字符串是 Shell 编程中最常用的数据类型之一（除了数字和字符串，也没有其他类型了）。</p><p>字符串可以由单引号<code>' '</code>包围，也可以由双引号<code>&quot; &quot;</code>包围，也可以不用引号。它们之间是有区别的。</p><p>下面我们说一下三种形式的区别：</p><ol><li><p>由单引号<code>' '</code>包围的字符串：</p><ul><li>任何字符都会原样输出，在其中使用变量是无效的。</li><li>字符串中不能出现单引号，即使对单引号进行转义也不行。</li></ul></li><li><p>由双引号<code>&quot; &quot;</code>包围的字符串：</p><ul><li>如果其中包含了某个变量，那么该变量会被解析（得到该变量的值），而不是原样输出。</li><li>字符串中可以出现双引号，只要它被转义了就行。</li></ul></li><li><p>不被引号包围的字符串</p><ul><li>不被引号包围的字符串中出现变量时也会被解析，这一点和双引号<code>&quot; &quot;</code>包围的字符串一样。</li><li>字符串中不能出现空格，否则空格后边的字符串会作为其他变量或者命令解析。</li></ul></li></ol><p>我们通过代码来演示一下三种形式的区别：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">n=74</span><br><span class="line">str1=c.biancheng.net<span class="variable">$n</span> </span><br><span class="line">str2=<span class="string">&quot;shell \&quot;script\&quot; <span class="variable">$n</span>&quot;</span></span><br><span class="line">str3=<span class="string">&#x27;C语言中文网 $n&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行结果：</span></span><br><span class="line">c.biancheng.net74</span><br><span class="line">shell <span class="string">&quot;script&quot;</span> 74</span><br><span class="line">C语言中文网 <span class="variable">$n</span></span><br></pre></td></tr></table></figure><p>str1 中包含了<code>$n</code>，它被解析为变量 n 的引用。<code>$n</code>后边有空格，紧随空格的是 str2；Shell 将 str2 解释为一个新的变量名，而不是作为字符串 str1 的一部分。</p><p>str2 中包含了引号，但是被转义了（由反斜杠<code>\</code>开头的表示转义字符）。str2 中也包含了<code>$n</code>，它也被解析为变量 n 的引用。</p><p>str3 中也包含了<code>$n</code>，但是仅仅是作为普通字符，并没有解析为变量 n 的引用。</p><h3 id="2-获取字符串长度">2.获取字符串长度</h3><p>在 Shell 中获取字符串长度很简单，具体方法如下：</p><p>$</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker 学习笔记</title>
      <link href="/posts/920e92d1.html"/>
      <url>/posts/920e92d1.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><!--本文色卡号 #5FA55A #01B4BC #F6D51F #FA8925 #FA5457--><h1 id="1）简介">1）简介</h1><div class="tip home"><p>Docker：<a href="https://www.docker.com">https://www.docker.com</a></p></div><div class="tip home"><p>Docker Hub：<a href="https://hub.docker.com">https://hub.docker.com</a></p></div><h2 id="1-1-Docker-为什么横空出世">1.1 Docker 为什么横空出世</h2><p>传统开发中，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，<b style="color:#01B4BC;">开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况</b>。<b style="color:#FA5457;">Docker的出现使得Docker得以打破过去「程序即应用」的观念。透过镜像(images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作</b>。</p><h2 id="1-2-概述">1.2 概述</h2><p><b style="color:#FA5457;">Docker是基于Go语言实现的云开源项目</b>。</p><p>Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的 APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“<b style="color:#FA5457;">一次镜像，处处运行</b>”。</p><p><b style="color:#01B4BC;">Linux容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的</b>。将应用打成镜像，通过镜像成为运行在Docker容器上面的实例，而 Docker容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。<b style="color:#FA5457;">只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作</b>。</p><h2 id="1-3-容器与虚拟机的比较">1.3 容器与虚拟机的比较</h2><p>📌 <strong>纯物理部署、虚拟机的部署的缺点</strong></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13d7da4.png" alt="image-20230106105948208"></p><p>📌 <strong>虚拟化发展史</strong></p><ul><li><p>个人虚拟化 vmware workstation，主要用于个人电脑。</p></li><li><p>企业版虚拟化 vmware esxi 虚拟化工具，用于高性能服务器</p></li><li><p>Linux下虚拟机工作，kvm 工具</p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230106111151052.png" alt="image-20230106111151052" style="zoom: 50%;" /></li><li><p>容器-LXC &amp; docker</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c1311949.png" alt="image-20230106111707293"></p></li></ul><p>📌 <strong>开发中的问题</strong></p><ul><li>分布式系统中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。</li><li>在数百上千台服务中重复部署，环境不一定一致，开发、测试、生产环境有差异，会遇到各种问题</li></ul><p>📌 <strong>Docker 解决依赖兼容问题</strong></p><ul><li>将应用的Libs（函数库）、Deps（依赖）、配置与应用一起打包</li><li>将每个应用放到一个隔离<strong>容器</strong>去运行，避免互相干扰</li></ul><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c14030d7.png" alt="在这里插入图片描述" style="zoom: 33%;" /><p>📌 <strong>Docker 解决操作系统环境差异</strong></p><p>应用程序在计算机中交互的流程如下：</p><p>1）应用调用操作系统应用（函数库），实现各种功能</p><p>2）系统函数库是对内核指令集的封装，会调用内核指令</p><p>3）内核指令操作计算机硬件</p><p>📌 <strong>Docker如何解决不同系统环境的问题？</strong></p><ul><li><b style="color:#01B4BC;">Docker将用户程序与所需要调用的系统(比如Ubuntu)函数库一起打包</b>，不管实际的运行系统是Centos还是Ubuntu都可以正常运行，因为应用程序调用的是捆绑在一起的系统的函数，系统函数再调用linux内核的函数。</li><li>Docker运行到不同操作系统时，直接基于打包的函数库，<b style="color:#01B4BC;">只借助于操作系统的Linux内核来运行，不在乎实际运行的系统版本是什么</b>。</li></ul><blockquote><p>Docker是一个快速交付应用、运行应用的技术，具备下列优势：</p><ul><li>可以<b style="color:#01B4BC;">将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</b></li><li>运行时<b style="color:#01B4BC;">利用沙箱机制形成隔离容器</b>，各个应用<b style="color:#01B4BC;">互不干扰</b></li><li>启动、移除都可以通过一行命令完成，方便快捷</li></ul></blockquote><blockquote><p>Docker和虚拟机的差异：</p><ul><li>docker是一个系统进程；虚拟机是在操作系统中的操作系统</li><li>docker体积小、启动速度快、性能好；虚拟机体积大、启动速度慢、性能一般</li></ul></blockquote><h2 id="1-4-Docker-架构">1.4 Docker 架构</h2><p>Docker是一个CS架构的程序，由两部分组成：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13edfdc.png" alt="在这里插入图片描述"></p><ul><li>服务端(server)：Docker守护进程，负责处理Docker指令，管理镜像、容器等</li><li>客户端(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。</li></ul><h2 id="1-5-Docker-引擎">1.5 Docker 引擎</h2><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13c4845.png" alt="image-20230106114851591"></p><h2 id="1-6-Docker-平台组成">1.6 Docker 平台组成</h2><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c10526cd.png" alt="image-20230106115104206"></p><h2 id="1-7-镜像-容器">1.7 镜像&amp;容器</h2><p><strong>镜像（Image）</strong>：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。</p><p><strong>容器（Container）</strong>：镜像中的应用程序运行后形成的进程就是<strong>容器</strong>，只是Docker会给容器进程做隔离，对外不可见。</p><blockquote><p><strong>镜像</strong>就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。</p><p><strong>容器</strong>就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。</p></blockquote><h2 id="1-8-Docker-生命周期">1.8 Docker 生命周期</h2><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c10de085.png" alt="image-20230106201947897"></p><h2 id="1-9-Docker-镜像原理理解">1.9 Docker 镜像原理理解</h2><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c1088a88.png" alt="image-20230106214026388"></p><h1 id="2）Docker-安装">2）Docker 安装</h1><h2 id="2-1-Docker-版本说明">2.1 Docker 版本说明</h2><ul><li><a href="https://hub.docker.com/">DockerHub</a>：DockerHub是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。</li><li>国内也有类似于DockerHub 的公开服务，比如 网易云镜像服务、阿里云镜像库等。</li></ul><p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p><p>Docker CE 分为 <code>stable</code> <code>test</code> 和 <code>nightly</code> 三个更新频道。</p><blockquote><p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询内核版本</span></span><br><span class="line">cat /etc/redhat-release</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询操作系统的发型版号</span></span><br><span class="line">uname -r</span><br></pre></td></tr></table></figure><h2 id="2-2-卸载">2.2 卸载</h2><p>如果之前安装过旧版本的Docker，可以使用下面命令卸载：(<code>'\'</code>表示本行命令未结束，下一行继续，<code>'\'</code>前记得有一个空格)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br></pre></td></tr></table></figure><h2 id="2-3-安装">2.3 安装</h2><p>📌 <strong>基础环境配置</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/Centos-base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>开启linux内核的流量转发：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/docker.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 0</span><br><span class="line">net.ipv4.conf.all.rp_filter = 0</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>重新加载修改内核参数的配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br></pre></td></tr></table></figure><blockquote><p>🔴 如果报错：</p><blockquote><p>No such file or directory<br>sysctl: cannot stat /proc/sys/net/bridge/bridge-nf-call-ip6tables: No such file or directory<br>sysctl: cannot stat /proc/sys/net/bridge/beidge-nf-call-iptables: No such file or directory<br>net.ipv4.conf.default.rp_filter = 0<br>net.ipv4.conf.all.rp_filter = 0<br>net.ipv4.ip_forward = 1</p></blockquote><p>就执行如下命令：（向内核中加载模块）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br></pre></td></tr></table></figure><p>然后再重新执行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br></pre></td></tr></table></figure></blockquote><p>📌 <strong>yum安装</strong></p><ul><li><p><strong>方法1</strong>：</p><p>首先需要将虚拟机联网，安装yum工具、存储驱动、逻辑卷管理：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure><p>更新本地镜像源：(<code>yum-config-manager</code> 命令的本质是对 <code>/etc/yum.repos.d/</code>(库数据的储存位置)文件夹下文件的增删查改。)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure></li><li><p><strong>方法2</strong>：</p><p>查看源中可用版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure><p>如果没有匹配项，则下载阿里源repo文件 第一个是阿里云自带仓库 第二个是阿里云提供的docker专属repo仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-7.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line">curl -o /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p>更新yum缓存:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure><p>安装与卸载:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce-xxx </span><br><span class="line"></span><br><span class="line">yum remove -y docker-xxx</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-4-配置镜像加速器">2.4 配置镜像加速器</h2><p>Docker的镜像默认是从Docker hub下载，网速很慢，国内有很多云服务商都提供了加速器服务（阿里云加速器，Daocloud加速器，灵雀云加速器等）</p><p>注意：此处docker版本不同daemon文件的后缀不同，新版后缀为.conf，旧版的可能为.json。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-9-centos ~]# mkdir -p /etc/docker</span><br><span class="line">[root@VM-4-9-centos ~]#</span><br><span class="line">[root@VM-4-9-centos ~]# touch /etc/docker/daemon.conf</span><br><span class="line">[root@VM-4-9-centos ~]#</span><br><span class="line">[root@VM-4-9-centos ~]# vim /etc/docker/daemon.conf</span><br><span class="line">[root@VM-4-9-centos ~]# cat /etc/docker/daemon.conf</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">　　&quot;registry-mirrors&quot;:[</span><br><span class="line">　　　　&quot;https://8xpk5wnt.mirror.aliyun.com&quot;</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者：</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://hub.daocloud.io&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-启动">2.5 启动</h2><p>关闭防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止开机启动防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重载配置文件</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加开机启动</span></span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新启动服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="2-6-测试">2.6 测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">&#x27;hello-world:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">2db29710123e: Pull complete </span><br><span class="line">Digest: sha256:6e8b6f026e0b9c419ea0fd02d3905dd0952ad1feea67543f525c73a0a790fefb</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">...省略部分数据...</span><br></pre></td></tr></table></figure><hr><h1 id="3）镜像管理命令">3）镜像管理命令</h1><p>使用镜像的流程：</p><ol><li>获取该软件的docker镜像。</li><li>运行该镜像，就启动了一个容器。</li><li>停止容器，删除该镜像。</li></ol><h2 id="8-1-搜索镜像是否存在于镜像库">8.1  搜索镜像是否存在于镜像库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search 镜像名:tag# tag就是具体的标签版本</span><br></pre></td></tr></table></figure><h2 id="8-2-查看镜像">8.2  查看镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前所有镜像</span></span><br><span class="line">[root@localhost ~]# docker images</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker image ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个镜像详细信息</span></span><br><span class="line">[root@localhost ~]# docker images 镜像名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只显示镜像<span class="built_in">id</span> --quiet</span></span><br><span class="line">[root@localhost ~]# docker images -q</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化显示镜像只提取出需要的信息</span></span><br><span class="line">[root@localhost ~]# docker images --format &quot;&#123;&#123;.ID&#125;&#125;--&#123;&#123;.Repository&#125;&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化成表格 显示镜像只提取出需要的信息</span></span><br><span class="line">[root@localhost ~]# docker images --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;&quot;</span><br></pre></td></tr></table></figure><h2 id="8-2-镜像拉取">8.2 镜像拉取</h2><p>获取镜像，镜像托管仓库，好比yum源一样。（docker默认仓库是dockerhub）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker pull 镜像名:tag# tag | latest</span><br></pre></td></tr></table></figure><h2 id="8-3-查看-Docker-的服务信息">8.3 查看 Docker 的服务信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker info</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker info | grep Root</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br></pre></td></tr></table></figure><p>镜像存放在：<code>ll /var/lib/docker/image/overlay2/imagedb/content/sha256/</code></p><p>镜像文件其实是一个json数据类型的文件，记录 镜像和容器的配置关系</p><h2 id="8-4-删除镜像">8.4 删除镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker rmi 镜像名(或 ID 或 ID前三位)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量删除</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker images -aq是列出所有的镜像 用反引号‘`’框柱表示取出命令的结果</span></span><br><span class="line">[root@localhost ~]# docker rmi `docker images -aq`</span><br></pre></td></tr></table></figure><h2 id="8-5-导出镜像">8.5 导出镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker image save 镜像名[:tag] &gt; /重定向的位置/镜像名.tgz</span><br></pre></td></tr></table></figure><h2 id="8-6-导入镜像">8.6 导入镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker image load -i /位置/镜像名.tgz</span><br></pre></td></tr></table></figure><h2 id="8-7-查看-Docker-镜像信息">8.7 查看 Docker 镜像信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect 镜像id</span><br></pre></td></tr></table></figure><hr><h1 id="4）容器管理命令">4）容器管理命令</h1><h2 id="9-1-运行、创建容器">9.1 运行、创建容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果镜像不存在本地，则回去下载该镜像</span></span><br><span class="line">docker run 镜像名</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">丰富docker运行的参数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">rm</span> 容器挂掉后被删除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name niubb 给容器命名niubb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ping 是后面容器执行的指令</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker run -d --rm --name niubb centos:7.6.1810 ping baidu.com</span><br><span class="line">5579d43af5173d37d575cbb497573ec5b7db6e0daeed70730115e0eb6db34ad7</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND            CREATED          STATUS          PORTS     NAMES</span><br><span class="line">5579d43af517   centos:7.6.1810   &quot;ping baidu.com&quot;   12 seconds ago   Up 11 seconds             niubb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用--<span class="built_in">rm</span>后，容器挂掉后删除了状态记录</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">52e5ccb0d743   centos         &quot;/bin/bash&quot;              11 minutes ago   Exited (0) 11 minutes ago             heuristic_rosalind</span><br><span class="line">6684befd9bfa   f1cb7c7d58b7   &quot;bash&quot;                   2 hours ago      Exited (130) 2 hours ago              agitated_bartik</span><br><span class="line">3bbc199beb84   f1cb7c7d58b7   &quot;bash&quot;                   3 hours ago      Exited (127) 2 hours ago              tender_shtern</span><br><span class="line">2f2c4da21e01   5d0da3dc9764   &quot;bash&quot;                   3 hours ago      Exited (0) 3 hours ago                agitated_buck</span><br><span class="line">e2c3e6042ba3   nginx          &quot;/docker-entrypoint.…&quot;   4 hours ago      Exited (0) 10 minutes ago             busy_lewin</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 宿主机路径:容器内路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:rw 为可读写可省略</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:ro 在容器内只读，如果写入会报错</span></span><br><span class="line">[root@localhost ~]# docker run -d -v /opt:/tep/centos7.6 centos:7.6.1810</span><br><span class="line">[root@localhost ~]# docker run -d -v /opt:/tep/centos7.6:rw centos:7.6.1810</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认情况下，仓库被创建在/var/lib/registry目录下</span></span><br></pre></td></tr></table></figure><p><span style="color:red;background:yellow;">※注意：</span></p><ol><li><p><span style="color:red;">容器内的程序必须处于前台运行状态，否则容器就会直接退出。</span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run centos</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                NAMES</span><br></pre></td></tr></table></figure></li><li><p>如果容器内，什么事情也不做，容器也会挂掉。容器内必须有一个进程在前台运行。</p></li></ol><h2 id="9-2-启动、停止、重启容器">9.2 启动、停止、重启容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id/名字</span><br><span class="line">docker stop 容器id/名字</span><br><span class="line">docker restart 容器id/名字</span><br></pre></td></tr></table></figure><h2 id="9-3-查看容器、容器日志、容器的详细信息">9.3 查看容器、容器日志、容器的详细信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器</span></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有容器状态</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器日志</span></span><br><span class="line">[root@localhost ~]# docker logs 容器id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时刷新容器日志</span></span><br><span class="line">[root@localhost ~]# docker logs -f 容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器的详细信息</span></span><br><span class="line">[root@localhost ~]# docker container inspect 容器id</span><br></pre></td></tr></table></figure><h2 id="9-4-删除容器">9.4 删除容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 删除指定容器</span></span><br><span class="line">[root@localhost ~]# docker rm -f &lt;containerid&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 删除未启动成功的容器</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -a|grep Created|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -qf status=created)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 删除退出状态的容器</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -a|grep Exited|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -qf status=exited)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@docker_test ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS                           PORTS                               NAMES</span><br><span class="line">d13ef6c6cb8e   nginx     &quot;/docker-entrypoint.…&quot;   6 minutes ago       Up 6 minutes                     0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx1</span><br><span class="line">e30bfa566607   docker    &quot;docker-entrypoint.s…&quot;   51 minutes ago      Exited (125) 13 minutes ago                                          peaceful_black</span><br><span class="line">886aa44c834e   docker    &quot;docker-entrypoint.s…&quot;   57 minutes ago      Exited (0) 55 minutes ago                                            festive_wing</span><br><span class="line">4d8d27bc3d78   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (0) 58 minutes ago                                            reverent_engelbart</span><br><span class="line">74026fa35fbe   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (0) About an hour ago                                         jovial_galois</span><br><span class="line">64d0278cd793   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (127) About an hour ago                                       practical_archimedes</span><br><span class="line">[root@docker_test ~]# docker rm $(docker ps -a|grep Exited|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">e30bfa566607</span><br><span class="line">886aa44c834e</span><br><span class="line">4d8d27bc3d78</span><br><span class="line">74026fa35fbe</span><br><span class="line">64d0278cd793</span><br><span class="line">[root@docker_test ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">d13ef6c6cb8e   nginx     &quot;/docker-entrypoint.…&quot;   28 minutes ago   Up 28 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx1</span><br></pre></td></tr></table></figure><h2 id="9-5-进入容器内">9.5 进入容器内</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it 交互操作</span></span><br><span class="line">[root@localhost ~]# docker exec -it 容器id bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">aa7cb64f6428   nginx     &quot;/docker-entrypoint.…&quot;   6 seconds ago   Up 5 seconds   80/tcp    sleepy_faraday</span><br><span class="line">[root@localhost ~]# docker exec -it aa7cb64f6428 bash</span><br><span class="line">root@aa7cb64f6428:/# </span><br></pre></td></tr></table></figure><h2 id="9-6-容器的端口映射">9.6 容器的端口映射</h2><p>宿主机的端口范围：0~65535</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 端口映射：宿主机端口:容器端口</span></span><br><span class="line">[root@localhost ~]# docker run -d -p 端口号:端口号 镜像名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-P 随机端口映射</span></span><br><span class="line">[root@localhost ~]# docker run -d -P 镜像名</span><br></pre></td></tr></table></figure><h2 id="9-7-查看容器的端口映射">9.7 查看容器的端口映射</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker port 容器id</span><br></pre></td></tr></table></figure><h2 id="9-8-更新容器参数">9.8 更新容器参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker update [选项] 容器id</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>--blkio-weight</code></td><td style="text-align:left">阻塞IO (相对权重)，介于10到1000之间，0表示禁用（默认禁止）</td></tr><tr><td style="text-align:left"><code>--cpu-period</code></td><td style="text-align:left">限制CPU CFS（完全公平的调度程序）期限</td></tr><tr><td style="text-align:left"><code>--cpu-quota</code></td><td style="text-align:left">限制CPU CFS（完全公平的调度程序）配额</td></tr><tr><td style="text-align:left"><code>--cpu-rt-period</code></td><td style="text-align:left"><code>API 1.25+</code>，将CPU实时时间限制为微秒</td></tr><tr><td style="text-align:left"><code>--cpu-rt-runtime</code></td><td style="text-align:left"><code>API 1.25+</code>，将CPU实时运行时间限制为微秒</td></tr><tr><td style="text-align:left"><code>--cpu-shares</code>, <code>-c</code></td><td style="text-align:left">CPU份额（相对权重）</td></tr><tr><td style="text-align:left"><code>--cpus</code></td><td style="text-align:left"><code>API 1.29+</code>，CPU数量</td></tr><tr><td style="text-align:left"><code>--cpuset-cpus</code></td><td style="text-align:left">允许执行的CPU（0-3，0,1）</td></tr><tr><td style="text-align:left"><code>--cpuset-mem</code></td><td style="text-align:left">允许执行的MEM（0-3，0,1）</td></tr><tr><td style="text-align:left"><code>--kernel-memory</code></td><td style="text-align:left">内核内存限制</td></tr><tr><td style="text-align:left"><code>--memory-swap</code></td><td style="text-align:left">交换限制等于内存加交换，“-1”以启用无限交换</td></tr><tr><td style="text-align:left"><code>--memory-reservatio</code></td><td style="text-align:left">内存软限制</td></tr><tr><td style="text-align:left"><code>--memory</code>, <code>-m</code></td><td style="text-align:left">内存限制</td></tr><tr><td style="text-align:left"><code>--pids-limit</code></td><td style="text-align:left"><code>API 1.40+</code>，调节容器pids限制（-1表示无限制）</td></tr><tr><td style="text-align:left"><code>--restart</code></td><td style="text-align:left">容器退出时重新启动策略以应用</td></tr></tbody></table><h2 id="9-9-容器的文件拷贝">9.9 容器的文件拷贝</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器内拷贝文件到linux主机上</span></span><br><span class="line">[root@localhost ~]# docker cp 容器id:容器内路径 目标主机路径</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从宿主机拷贝文件到容器内</span> </span><br><span class="line">[root@localhost ~]# docker cp 文件路径 容器id:容器内路径</span><br></pre></td></tr></table></figure><h2 id="9-8-容器的提交">9.8 容器的提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker commit 容器id 重命名镜像</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS                            PORTS     NAMES</span><br><span class="line">a04a590adf6c   centos:7.6.1810   &quot;bash&quot;                   59 seconds ago   Exited (0) 7 seconds ago                    awesome_lamarr</span><br><span class="line">[root@localhost ~]# docker commit a04a590adf6c niubb/centos-vim-7.6.1810</span><br><span class="line">sha256:f6f3648f6cccdd589e6849d0075d96bd53c3727062b168fac6775b904850fef9</span><br><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY                  TAG        IMAGE ID       CREATED         SIZE</span><br><span class="line">niubb/centos-vim-7.6.1810   latest     f6f3648f6ccc   9 seconds ago   449MB</span><br><span class="line">centos                      7.6.1810   f1cb7c7d58b7   3 years ago     202MB</span><br></pre></td></tr></table></figure><h2 id="9-9-容器的导出和导入">9.9 容器的导出和导入</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> -o 文件名.tar CONTAINER<span class="comment"># 导出容器的内容留作为一个tar归档文件</span></span><br><span class="line">docker import [OPTIONS] 文件名.tar 命名CONTAINER<span class="comment"># 从tar包中得内容创建一个新的文件系统再导入为镜像</span></span><br></pre></td></tr></table></figure><h2 id="9-9-查看容器详细信息">9.9 查看容器详细信息</h2><p><strong>方法一：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect 容器名称/容器id</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect nginx1</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;d13ef6c6cb8e10be379cd796956f3e334aa44ceef15da80db3f4fddf14b09479&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-01-21T12:11:57.22722614Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 84812,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2023-01-21T12:11:57.504385223Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:a99a39d070bfd1cb60fe65c45dea3a33764dc00a9546bf8dc46cb5a11b1b50e9&quot;,</span><br><span class="line">...省略数据...</span><br></pre></td></tr></table></figure><p><strong>方法二：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询容器创建语句</span></span><br><span class="line">[root@localhost ~]# runlike -p 容器名</span><br></pre></td></tr></table></figure><ul><li><p>安装runlike</p><p>需要安装pip工具包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install python-pip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果不成功，尝试下列命令</span></span><br><span class="line">[root@localhost ~]# yum -y install python36</span><br><span class="line">[root@localhost ~]# pip install --upgrade pip</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可以尝试更换国内源</span></span><br><span class="line">[root@localhost ~]# touch /etc/pip.conf</span><br><span class="line">[root@docker_test ~]# cat &gt;&gt; /etc/pip.conf &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">[global]</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EOF</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# pip3 install runlike</span><br></pre></td></tr></table></figure></li></ul><hr><h1 id="5）Docker-镜像">5）Docker 镜像</h1><p>是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。</p><p>只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p><p>部署一个用于你需要的容器环境。</p><ul><li>定制docker镜像有两种方式：<ol><li>手动修改容器内容，导出新的镜像</li><li>基于Dockerfile 自行编写指令，基于指令流程创建镜像。</li></ol></li></ul><h2 id="10-1-dockerfile-指令">10.1 dockerfile 指令</h2><h3 id="10-1-1-FROM-指定基础镜像">10.1.1 FROM 指定基础镜像</h3><h3 id="10-1-2-MAINTAINER-指定维护者信息">10.1.2 MAINTAINER 指定维护者信息</h3><p>（可以没有维护者）</p><h3 id="10-1-3-RUN-执行命令">10.1.3 RUN 执行命令</h3><h3 id="10-1-4-ADD-拷贝文件，会自动解压">10.1.4 ADD 拷贝文件，会自动解压</h3><ol><li>添加宿主机的文件到容器内，如果是gzip、bzip2、xz、tar ADD能自动解压到当前路径下。</li><li>原文件如果是URL，此时docker引擎会下载该链接，放入目标路径，且自动设置为600权限。如果URL源文件是压缩包，则不自动解压。</li></ol><h3 id="10-1-5-COPY-复制文件">10.1.5 COPY 复制文件</h3><p>添加宿主机的文件到容器内，COPY仅复制</p><h3 id="10-1-6-WORKDIR-设置当前工作目录">10.1.6 WORKDIR 设置当前工作目录</h3><p>（相当于cd）</p><h3 id="10-1-7-VOLUME-设置卷，挂载到主机目录">10.1.7 VOLUME 设置卷，挂载到主机目录</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/data1&quot;</span>,<span class="string">&quot;/data2&quot;</span>]</span></span><br><span class="line"><span class="comment"># 支持列表的形式挂载多个文件夹</span></span><br></pre></td></tr></table></figure><h3 id="10-1-8-EXPOSE-指定对外的端口">10.1.8 EXPOSE 指定对外的端口</h3><h3 id="10-1-9-CMD-指定容器启动后要干的事情">10.1.9 CMD 指定容器启动后要干的事情</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure><p>相当于</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;cat&quot;</span>，<span class="string">&quot;/etc/os-release&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul><li><p>Docker挂载主机目录访问如果出现cannot open directory.：Permission denied</p><p>解决办法：在挂载目录后多加一个–privileged=true参数即可（扩大容器权限，使容器内的root拥有真正的root权限）</p></li></ul><h3 id="10-1-10-ENTRYPOINT-容器启动后执行的命令">10.1.10 ENTRYPOINT 容器启动后执行的命令</h3><p>当指定了ENTRYPOINT之后，CMD的指令语义就有了变化。CMD的内容当做参数传递给ENTRYPOINT指令。</p><h3 id="10-1-11-ENV-环境变量">10.1.11 ENV 环境变量</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MYSQL_VERSION=<span class="number">5.6</span></span><br></pre></td></tr></table></figure><p>ARG和ENV的区别在于，ENV无论实在镜像构建时，还是容器运行时，该变量都可以使用。ARG只存在于构建镜像时。</p><p>10.1.12 USER 用户切换</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">USER</span> niubb</span><br></pre></td></tr></table></figure><h3 id="10-1-12-restart-重启机制">10.1.12 restart 重启机制</h3><p>docker容器的重启策略有下面四种:</p><ul><li><code>no</code><br>是默认的重启策略,docker容器如启动失败或意外停止后Docker Daemon不会尝试进行重启，除非手动启动容器，否则一直是stop的状态。</li><li><code>always</code><br>表示永远重启，它的先决条件是如果你使用<code>docker stop</code>命令停止了容器则docker不会自行启动该容器，但如果执行<code>docker stop</code>命令后重启了Docker Daemon则该容器会触发<code>always</code>重启策略，进而启动容器。</li><li><code>on-failure</code><br>重启策略的触发标准是当<code>Docker Daemon</code>检测到容器非正常停止后则会执行该重启策略。<code>on-failure</code>要求传入一个整型参数表示重启次数，当重启次数<code>&gt;=</code>该整数值则不会予以重启。</li><li><code>unless-stopped</code><br>重启策略与<code>always</code>很相似，唯一不同处在于<code>unless-stopped</code>会在<code>Docker Daemon</code>启动时会检测docker容器列表内的容器在上次停止时的状态，如果上一次容器停止时就是stop状态则不会启动该容器，否则启动该容器。</li></ul><h2 id="10-2-构建镜像">10.2 构建镜像</h2><p>cd切换到写好的dockerfile文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker bulid .</span><br><span class="line">docker bulid -t &#x27;取一个镜像名&#x27; .</span><br></pre></td></tr></table></figure><h1 id="11）容器数据卷">11）容器数据卷</h1><h2 id="1-命令">.1 命令</h2><ol><li><p>初始化运行容器时：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录 镜像名</span><br></pre></td></tr></table></figure></li><li><p>dockerfile:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;宿主机绝对路径&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>值得注意的是通过 VOLUME 指令创建的挂载点，无法指定主机上对应的目录，而是自动生成的。</p><p>在dockerfile中VOLUME可以指定多个挂在目录，即<code>[&quot;宿主机绝对路径1&quot;,&quot;宿主机绝对路径2&quot;]</code>代表这两个目录都会挂在到宿主机的自动生成的目录。</p></li></ol><h2 id="2-概述">.2 概述</h2><ul><li><p>容器在运行时，应该保证在存储层不写入任何数据，运行在容器内产生的数据，我们推荐是挂载写入到宿主机上，进行维护。卷的设计目的就是<span style="color:red;">数据的持久化</span>，完全独立于容器的生存周期，因此Docker不会在容器删除是删除器挂载的数据卷。</p></li><li><p>特点：</p><ol><li>数据卷可在容器之间共享或重用数据</li><li>卷中的更改可以直接实时生效</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ol></li><li><p>注意：</p><p>Docker挂载主机目录访问如果出现<code>cannot open directory .: Permission denied</code></p><p>解决办法：在挂载目录后多加一个–privileged=true参数即可。</p><p>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，在SELinux里面挂载目录被禁止掉了额，如果要开启，我们一般使用–privileged=true命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p></li></ul><h2 id="3-读写规则">.3 读写规则</h2><p><code>:rw</code> 默认规则为可读写。</p><p><code>:ro</code> 容器实例内部被限制，只能读取不能写(= read only)，此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:rw 镜像名</span><br><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</span><br></pre></td></tr></table></figure><h2 id="4-卷的继承和共享">.4 卷的继承和共享</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it  --privileged=true --volumes-from 父类容器id  --name u2 镜像名</span><br></pre></td></tr></table></figure><p>此时u2只是继承了父类容器的规则，父类容器如果挂掉并不会对u2的挂载产生影响。</p><h1 id="团队协作">团队协作</h1><h2 id="1-阿里云">.1 阿里云</h2><h2 id="2-dockerhub">.2 dockerhub</h2><h2 id="3-私有仓库">.3 私有仓库</h2><h3 id="3-1-创建私有仓库">.3.1 创建私有仓库</h3><ul><li><p>下载镜像Docker Registry</p><p>相当于本地有个私有Docker hub。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v $&#123;PWD&#125;/registry:/var/lib/registry --restart always --privileged=true --name registry registry</span><br></pre></td></tr></table></figure></li><li><p>修改配置文件 daedom.json 使之支持http：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daedom.json</span><br></pre></td></tr></table></figure><p>在 daedom.json 添加：（！！！千万别漏掉后面的逗号！！！）</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;你的ip地址:5000&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>重启 Docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-2-查看私有库镜像">.3.2 查看私有库镜像</h3><ul><li><p>浏览器访问 <code>http://你的ip地址:5000/v2/_catalog</code></p></li><li><p>或者 curl 查询</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET http://你的ip地址:5000/v2/_catalog</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-推送和拉取">.3.3 推送和拉取</h3><p>以下以nginx举例说明</p><ul><li><p>给镜像打上标签（使其符合私库规范）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag nginx:1.18.0 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li><li><p>把本地的镜像推到服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li></ul><h1 id="Docker-APP常规安装">Docker APP常规安装</h1><h2 id="1-tomcat">.1 tomcat</h2><ul><li><p>创建临时容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 --rm --name temp_tomcat -d tomcat</span><br></pre></td></tr></table></figure><ul><li><p>8080如果不能访问，进入交互</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker_test ~]# docker exec -it temp_tomcat /bin/bash</span><br><span class="line">root@d69eb116a23c:/usr/local/tomcat# cd webapps</span><br><span class="line">root@d69eb116a23c:/usr/local/tomcat/webapps# cp -r webapps.dist/. webapps</span><br></pre></td></tr></table></figure></li></ul></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 --privileged=true  --restart=always \</span><br><span class="line">-v /mydata/tomcat/webapps:/usr/local/tomcat/webapps \</span><br><span class="line">-v /mydata/tomcat/logs:/usr/local/tomcat/logs \</span><br><span class="line">-v /mydata/tomcat/conf:/usr/local/tomcat/conf \</span><br><span class="line">--name tomcat \</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-MySQL">.2 MySQL</h2><ul><li><p>检查宿主机上是否有Mysql，以及3306端口占用情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nb /]# ps -ef | grep mysql</span><br><span class="line">root      4688  1287  0 01:35 pts/0    00:00:00 grep --color=auto mysql</span><br><span class="line">[root@nb /]# netstat -anp | grep 3306</span><br><span class="line">[root@nb /]# </span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=true --restart=always \</span><br><span class="line">-v /mydata/mysql/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>修改配置</p><p>此时应该修改配置文件，否则默认不支持utf-8</p><p>修改配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /mydata/mysql/conf/my.cnf</span><br><span class="line">vim /mydata/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server = utf8_general_ci</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure><p>重启容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure><p>再次进入容器后再进入MySQL，查看当前字符集：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bash</span><br><span class="line">mysql -u root -p 123456</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &#x27;character%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-redis">.3 redis</h2><ul><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --restart=always \</span><br><span class="line">--privileged=true \</span><br><span class="line">-v /mydata/redis/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /mydata/redis/data:/data \</span><br><span class="line">redis-server /etc/redis/redis.conf \</span><br><span class="line">--log-opt max-size=100m --log-opt max-file=2 \</span><br><span class="line">--appendonly yes \</span><br><span class="line">--requirepass 000588 \</span><br><span class="line">--name redis \</span><br><span class="line">-d redis</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>--privileged=true</code> 开启容器卷</li><li><code>--restart=always</code> 总是开机启动</li><li><code>-log</code>是日志方面的</li><li><code>-p 6379:6379</code> 将6379端口挂载出去</li><li><code>--name</code> 给这个容器取一个名字</li><li><code>-v</code> 数据卷挂载<ul><li><code>/mydata/redis/redis.conf:/etc/redis/redis.conf</code> 这里是将 liunx 路径下的myredis.conf 和redis下的redis.conf 挂载在一起。</li><li><code>/mydata/redis/data:/data</code> 这个同上</li></ul></li><li><code>-d redis</code> 表示后台启动redis</li><li><code>redis-server /etc/redis/redis.conf</code> 以配置文件启动 redis，加载容器内的 conf 文件，最终找到的是挂载的目录 <code>/etc/redis/redis.conf</code> 也就是 liunx 下的<code>/home/redis/myredis/myredis.conf</code></li><li><code>--appendonly yes</code> 开启redis 持久化</li><li><code>--requirepass 000588</code> 设置密码</li></ol></blockquote><ul><li><p>修改redis.conf</p><p>打开配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /mydata/redis/redis.conf</span><br></pre></td></tr></table></figure><p>修改 redis.conf ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.开启redis验证</span><br><span class="line">requirepass 000588</span><br><span class="line"></span><br><span class="line"># 2.允许redis外地连接</span><br><span class="line"># 注释掉 </span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># 3.将daemonize yes注释起来或者 daemonize no设置，因为该配置和docker run中-d参数冲突，会导致容器一直启动失败</span><br><span class="line">daemonize no</span><br></pre></td></tr></table></figure><p>myredis.conf <a href="https://blog.csdn.net/FangHX25/article/details/109134203">原版conf翻译</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line"># bind 127.0.0.1 ::1</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line">requirepass 000588</span><br><span class="line"></span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line">databases 30</span><br><span class="line"></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line"></span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line">replica-priority 100</span><br><span class="line"></span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"></span><br><span class="line">list-compress-depth 0</span><br><span class="line"></span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"></span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line">rdb-save-incremental-fsync yes</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="4-nginx">.4 nginx</h2><ul><li><p>创建临时容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --rm --name temp-nginx -d nginx</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>--rm</code> 退出容器时会自动将其删除</li></ol></blockquote></li><li><p>创建宿主机目录并拷贝需要创建的容器卷</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/nginx/conf</span><br><span class="line">mkdir -p /data/nginx/html</span><br><span class="line">mkdir -p /data/nginx/logs</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker cp temp-nginx:/etc/nginx/nginx.conf /data/nginx/conf/nginx.conf</span><br><span class="line">docker cp temp-nginx:/etc/nginx/conf.d /data/nginx/conf/conf.d</span><br><span class="line">docker cp temp-nginx:/usr/share/nginx/html /data/nginx</span><br><span class="line">chmod 777 /data/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>停止容器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop temp-nginx</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 -p 443:443 --privileged=true --restart=always \</span><br><span class="line">-v /mydata/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /mydata/nginx/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /mydata/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-v /mydata/nginx/logs:/var/log/nginx \</span><br><span class="line">--name nginx \</span><br><span class="line">-d nginx</span><br></pre></td></tr></table></figure></li></ul><h1 id="Docker-APP复杂安装">Docker APP复杂安装</h1><h2 id="1-MySQL主从复制">1. MySQL主从复制</h2><ol><li><p>启动主库镜像</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> --restart=always \</span><br><span class="line">-v /mydata/mysql-master/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql-master \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>进入主库配置文件<code>/mydata/mysql-master/conf</code>下新建 <code>my.cnf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=101</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line"><span class="comment">## 开启二进制日志功能</span></span><br><span class="line">log-bin=mall-mysql-bin</span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M</span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7</span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure><p>重新启动主库容器<code>docker restart mysql-master</code>。</p></li><li><p>主库操作</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker 连接容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql-master /bin/bash -c <span class="string">&#x27;mysql -uroot -p000588&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改mysql身份验证插件为mysql_native_password;</span></span><br><span class="line"><span class="comment"># 因为mysql 8.0+起;其默认的身份验证插件为caching_sha2_password;</span></span><br><span class="line"><span class="comment"># 如果不改会导致登录验证失败;</span></span><br><span class="line"><span class="comment"># ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;000588&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建从库数据同步用户slave;</span></span><br><span class="line">CREATE USER slave IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;000588&#x27;</span>;</span><br><span class="line"><span class="comment">#  授权</span></span><br><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="comment"># 查看主库状态（记录数据1,待用）</span></span><br><span class="line">show master status;</span><br></pre></td></tr></table></figure></li><li><p>启动从服务器镜像</p><p>如果同宿主服务器修改:</p><p>端口<code>-p 3307:3306</code></p><p>容器名<code>--name mysql-slave</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> --restart=always \</span><br><span class="line">-v /mydata/mysql-slave/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql-slave \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>进入主库配置文件<code>/mydata/mysql-slave/conf</code>下新建 <code>my.cnf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=102</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062  </span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line">log_slave_updates=1  </span><br><span class="line"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure><p>重新启动从库容器<code>docker restart mysql-slave</code>。</p></li><li><p>从库操作(记录数据1)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql-slave /bin/bash -c <span class="string">&#x27;mysql -uroot -p000588&#x27;</span></span><br><span class="line"><span class="comment"># 如果主从在一台服务器,则需要通过[ docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; mysql] 查询主库容器IP</span></span><br><span class="line"><span class="comment"># 如果不在一台服务器,则直接使用外网ip即可 主库中两个结果添加进来</span></span><br><span class="line"></span><br><span class="line">change master to master_host=<span class="string">&#x27;192.168.206.105&#x27;</span>, master_user=<span class="string">&#x27;slave&#x27;</span>, master_password=<span class="string">&#x27;000588&#x27;</span>, master_port=3306, master_log_file=<span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos=154, master_connect_retry=30;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主数据库的IP地址；</span></span><br><span class="line">master_host：<span class="string">&#x27;192.168.206.105&#x27;</span>,</span><br><span class="line"><span class="comment"># 主数据库的运行端口；</span></span><br><span class="line">master_port：3306,</span><br><span class="line"><span class="comment"># 在主数据库创建的用于同步数据的用户账号；</span></span><br><span class="line">master_user：<span class="string">&#x27;slave&#x27;</span>,</span><br><span class="line"><span class="comment"># 在主数据库创建的用于同步数据的用户密码；</span></span><br><span class="line">master_password：<span class="string">&#x27;000588&#x27;</span>,</span><br><span class="line"><span class="comment"># 指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span></span><br><span class="line">master_log_file：<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line"><span class="comment"># 指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span></span><br><span class="line">master_log_pos：154,</span><br><span class="line"><span class="comment"># 连接失败重试的时间间隔，单位为秒。</span></span><br><span class="line">master_connect_retry：30;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启主从同步</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"><span class="comment"># 查看主从同步状况</span></span><br><span class="line">mysql&gt; show slave status\G;</span><br></pre></td></tr></table></figure><p><code>Slave_IO_Running</code>及<code>Slave_SQL_Running</code>为YES时;从库启动+主从复制成功。</p></li></ol><ul><li><p>停止主从复制</p><p>在从库中执行<code>stop slave；</code></p></li><li><p>读写分离</p><p>参考<a href="https://blog.csdn.net/jkjkjkll/article/details/125102188">https://blog.csdn.net/jkjkjkll/article/details/125102188</a></p></li></ul><p>Docker 网络</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Gitee + PicGO 搭建图床</title>
      <link href="/posts/6c6bf881.html"/>
      <url>/posts/6c6bf881.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）图床是干什么的？">1）图床是干什么的？</h1><p>图床就是一个便于在博文中插入在线图片连接的个人图片仓库。设置图床之后，在自己博客中插入的图片链接就可以随时随地在线预览了，并且不会因为任何意外原因无法查看，除非自己亲自删除。虽然你可以在CSDN上也可以生成图片链接。但是每个软件都有自己的防盗链机制，有时候你是不可以复制到其他平台的，这时候搭建一个免费的图床就显得尤为重要了。</p><h1 id="2）安装-PicGo">2）安装 PicGo</h1><p>PicGo的官网下载链接是：<code>https://www.github.com/Molunerfinn/PicGo</code></p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b04d72bc.png" alt="image-20230109103646118"  /><p>a.下载安装：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b04ceec7.png" alt="windows安装包"></p><p>b.打开PicGo选择最底下的插件设置：</p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b04abcd9.png" alt="image-20230109104040950" style="zoom:50%;" /><p>c.搜索<code>gitee</code>安装<code>gitee-uploader 1.1.2</code>。（这里注意一下，必须要先安装<code>node.js</code>才能安装插件，没装的自己装一下，然后重启就行）</p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b046e705.png" alt="image-20230109104143565" style="zoom:50%;" /><h1 id="3）建立-Gitee-图床库">3）建立 Gitee 图床库</h1><ol><li><p><s><em>创建仓库的步骤略~</em></s></p></li><li><p>生成私人令牌token</p><p>a.点击头像，进入设置</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b044b99d.png" alt="image-20230109104944258"></p><p>b.找到右边安全设置里面的私人令牌。</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b0447c80.png" alt="image-20230109105044076"></p><p>c.点击生成新令牌，把<code>projects</code>这一项勾上，其他的不用勾，然后提交。</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b0677557.png" alt="image-20230109105146340"></p><p>这里需要验证一下密码，验证密码之后会出来一串数字，这一串数字就是你的token，<strong>令牌只会明文显示一次，令牌只会明文显示一次，令牌只会明文显示一次</strong>（重要的话说三遍），建议首先把这串字符复制到一个记事本保存起来。搞丢了又要重新生成一个。</p></li></ol><h1 id="4）配置-PicGo">4）配置 PicGo</h1><p>​这里就很容易理解了，填写一些gitee的信息，就可以实现软件互通了。这里如果你之前安装过PicGo，可能界面有点不同是因为版本的问题，但是不影响使用。</p><ul><li><p><strong>repo：用户名/仓库名(必须填写)</strong></p></li><li><p><strong>branch：分支，填写master</strong></p></li><li><p><strong>token：刚才你获取的个人令牌(必须填写)</strong></p></li><li><p><strong>path：上传到仓库的路径，可以不填</strong></p></li><li><p><strong>customPath：默认不填即可</strong></p></li><li><p><strong>customUrl：默认不填即可</strong></p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b06597ed.png" alt="image-20230109105723293" style="zoom:50%;" /></li></ul><h1 id="5）配置-Typora">5）配置 Typora</h1><p>选择 <code>文件 &gt; 偏好设置</code></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3b06c28d6.png" alt="image-20230109105909439"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdown Mermaid思维导图</title>
      <link href="/posts/6c57ce3e.html"/>
      <url>/posts/6c57ce3e.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p>Mermaid 是一个用于画流程图、状态图、时序图、甘特图的库，使用 JS 进行本地渲染，广泛集成于许多 Markdown 编辑器中。Mermaid 作为一个使用 JS 渲染的库，生成的不是一个“图片”，而是一段 HTML 代码。</p><p><a href="https://mermaidjs.github.io/">点击进入官网</a></p><p><a href="https://github.com/knsv/mermaid">点击进入Github 项目地址</a></p><p><a href="https://zhuanlan.zhihu.com/p/355997933">参考文案</a></p><h1 id="1）语法">1）语法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR; # 其中LR指的是方向</span><br><span class="line">A --&gt; B # 不同的箭头表示</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">A --&gt; B </span><br></pre></td></tr></table></figure><h1 id="2）方向">2）方向</h1><table><thead><tr><th>用词</th><th>含义</th></tr></thead><tbody><tr><td>TB</td><td>从上到下</td></tr><tr><td>BT</td><td>从下到上</td></tr><tr><td>RL</td><td>从右到左</td></tr><tr><td>LR</td><td>从左到右</td></tr></tbody></table><h1 id="3）节点间的连线">3）节点间的连线</h1><table><thead><tr><th>表述</th><th>说明</th></tr></thead><tbody><tr><td><code>&gt;</code></td><td>添加尾部箭头</td></tr><tr><td><code>-</code></td><td>不添加尾部箭头</td></tr><tr><td><code>--</code></td><td>单线</td></tr><tr><td><code>--text--</code></td><td>单线上加文字</td></tr><tr><td><code>==</code></td><td>粗线</td></tr><tr><td><code>==text==</code></td><td>粗线加文字</td></tr><tr><td><code>-.-</code></td><td>虚线</td></tr><tr><td><code>-.text.-</code></td><td>虚线加文字</td></tr></tbody></table><h1 id="4）节点">4）节点</h1><p>即流程图中每个文本块，包括开始、结束、处理、判断等。Mermaid 中每个节点都有一个 id，以及节点的文字。</p><table><thead><tr><th>表述</th><th>说明</th></tr></thead><tbody><tr><td><code>id[文字]</code></td><td>矩形节点</td></tr><tr><td><code>id(文字)</code></td><td>圆角矩形节点</td></tr><tr><td><code>id([文字])</code></td><td>体育场形</td></tr><tr><td><code>id[[文字]]</code></td><td>子程序形</td></tr><tr><td><code>id[(文字)]</code></td><td>圆柱形</td></tr><tr><td><code>id((文字))</code></td><td>圆形节点</td></tr><tr><td><code>id&#123;文字&#125;</code></td><td>菱形节点</td></tr><tr><td><code>id&#123;&#123;文字&#125;&#125;</code></td><td>六角形</td></tr><tr><td><code>id[/文字/]</code></td><td>平行四边形</td></tr><tr><td><code>id[\文字\]</code></td><td>反向平行四边形</td></tr><tr><td><code>id[/文字\]</code></td><td>梯形</td></tr><tr><td><code>id[\文字/]</code></td><td>反向梯形</td></tr></tbody></table><ul><li><p>示例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">A&gt;&quot;Ubuntu&lt;br&gt;(Linux)&quot;] -.soft.-&gt; C&#123;TV&#125;</span><br><span class="line">B[&quot;MAC&quot;] ==&gt; D((ARM64))</span><br><span class="line">D--&gt; C</span><br><span class="line">A --&gt; B</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">A&gt;&quot;Ubuntu&lt;br&gt;(Linux)&quot;] -.soft.-&gt; C&#123;TV&#125;</span><br><span class="line">B[&quot;MAC&quot;] ==&gt; D((ARM64))</span><br><span class="line">D--&gt; C</span><br><span class="line">A --&gt; B</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">a---b</span><br><span class="line">b--文本1!---c</span><br><span class="line">c---|文本2|d</span><br><span class="line">d===e</span><br><span class="line">e==文本3===f</span><br><span class="line">f-.-g</span><br><span class="line">g-.文本.-h</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">a---b</span><br><span class="line">b--文本1!---c</span><br><span class="line">c---|文本2|d</span><br><span class="line">d===e</span><br><span class="line">e==文本3===f</span><br><span class="line">f-.-g</span><br><span class="line">g-.文本.-h</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A o--o B</span><br><span class="line">    B &lt;--&gt; C</span><br><span class="line">    C x--x D</span><br><span class="line">    </span><br><span class="line">    旧连线 --文本--&gt; 也会不同</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">    A o--o B</span><br><span class="line">    B &lt;--&gt; C</span><br><span class="line">    C x--x D</span><br><span class="line">    </span><br><span class="line">    旧连线 --文本--&gt; 也会不同</span><br></pre></td></tr></table></figure></li><li><p>延长连线：增加相应字符即可，如下图中的B到E，连线中增加了一个 <code>-</code> 。字符可多次添加。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ---&gt;|No| E[End];</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ---&gt;|No| E[End];</span><br></pre></td></tr></table></figure><ul><li><p>多重链</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   a --&gt; b &amp; c--&gt; d</span><br><span class="line">   </span><br><span class="line">   A &amp; B--&gt; C &amp; D</span><br><span class="line">   </span><br><span class="line">    X --&gt; M</span><br><span class="line">    X --&gt; N</span><br><span class="line">    Y --&gt; M</span><br><span class="line">    Y --&gt; N</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   a --&gt; b &amp; c--&gt; d</span><br><span class="line">   </span><br><span class="line">   A &amp; B--&gt; C &amp; D</span><br><span class="line">   </span><br><span class="line">    X --&gt; M</span><br><span class="line">    X --&gt; N</span><br><span class="line">    Y --&gt; M</span><br><span class="line">    Y --&gt; N</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="5）注释-子图">5）注释 &amp;子图</h1><p>​<code>%%这是一条注释，在渲染图中不可见</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%%这是一条注释，在渲染图中不可见</span><br><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">    a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">    b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">    c1--&gt;c2</span><br><span class="line">    end</span><br><span class="line">    one --&gt; two</span><br><span class="line">    three --&gt; two</span><br><span class="line">    two --&gt; c2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%%这是一条注释，在渲染图中不可见</span><br><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">    a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">    b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">    c1--&gt;c2</span><br><span class="line">    end</span><br><span class="line">    one --&gt; two</span><br><span class="line">    three --&gt; two</span><br><span class="line">    two --&gt; c2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Python xlwings 将数据写入excel表格</title>
      <link href="/posts/6a75650e.html"/>
      <url>/posts/6a75650e.html</url>
      
        <content type="html"><![CDATA[<h1 id="1）创建book对象">1）创建book对象</h1><h2 id="📌打开excel程序，并新建一个工作簿">📌打开excel程序，并新建一个工作簿</h2><p>add_book参数为False时，只打开EXCEL程序,没有新建工作簿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app=xw.App(visible=<span class="literal">True</span>,add_book=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="📌在打开了excel程序的情况后，再新建工作簿">📌在打开了excel程序的情况后，再新建工作簿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb=app.books.add()</span><br></pre></td></tr></table></figure><h2 id="📌打开本地电脑上的文件">📌打开本地电脑上的文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法一：</span></span><br><span class="line"><span class="comment">#open()里面是文件的路径</span></span><br><span class="line">wb = app.books.<span class="built_in">open</span>(<span class="string">&#x27;example.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#方法二：</span></span><br><span class="line">wb = xw.Book(<span class="string">&#x27;example.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="📌获得打开工作簿的绝对路径">📌获得打开工作簿的绝对路径</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pth=wb.fullname</span><br></pre></td></tr></table></figure><h2 id="📌获得工作簿的名称">📌获得工作簿的名称</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=wb.name</span><br></pre></td></tr></table></figure><h2 id="📌保存工作簿">📌保存工作簿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.save(filepath)</span><br></pre></td></tr></table></figure><h2 id="📌关闭工作簿">📌关闭工作簿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.close()</span><br></pre></td></tr></table></figure><h2 id="📌退出excel程序">📌退出excel程序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.quit()</span><br></pre></td></tr></table></figure><hr><h1 id="2）操作sheet对象">2）操作sheet对象</h1><h2 id="📌新建一个工作表">📌新建一个工作表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sht=wb.sheets.add(<span class="string">&#x27;工作表名&#x27;</span>)</span><br><span class="line"><span class="comment">#还可以带before=&#x27;表名&#x27;或者after=&#x27;表名&#x27;，表示新建表的位置.</span></span><br></pre></td></tr></table></figure><h2 id="📌删除指定的工作表">📌删除指定的工作表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets[<span class="string">&#x27;工作表名&#x27;</span>].delete()</span><br></pre></td></tr></table></figure><h2 id="📌获得当前活跃的工作表">📌获得当前活跃的工作表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sht=wb.sheets.active</span><br></pre></td></tr></table></figure><h2 id="📌激活指定的工作表">📌激活指定的工作表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets[<span class="string">&#x27;工作表名&#x27;</span>].activate()</span><br></pre></td></tr></table></figure><h2 id="📌获得工作表的名称">📌获得工作表的名称</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets[表索引号].name</span><br></pre></td></tr></table></figure><h2 id="📌对工作表-sheet-进行重命名">📌对工作表(sheet)进行重命名</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets[表索引或原工作表名].name=<span class="string">&#x27;新工作表名&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="📌清空整个工作表里的内容和格式">📌清空整个工作表里的内容和格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets[<span class="string">&#x27;表名&#x27;</span>].clear()</span><br></pre></td></tr></table></figure><h2 id="📌获得工作簿中工作表sheet的数量">📌获得工作簿中工作表sheet的数量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.sheets.count</span><br></pre></td></tr></table></figure><h2 id="📌计算工作表sht中有数据区域最大的行数">📌计算工作表sht中有数据区域最大的行数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法一：</span></span><br><span class="line">max_row=sht[<span class="string">&#x27;a1048576&#x27;</span>].end(<span class="string">&#x27;up&#x27;</span>).row</span><br><span class="line"><span class="comment">#方法二：</span></span><br><span class="line">max_row=sht.used_range.last_cell.row</span><br></pre></td></tr></table></figure><h2 id="📌计算工作表sht中有数据区域最大的列数">📌计算工作表sht中有数据区域最大的列数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法一：</span></span><br><span class="line">max_column=sht[<span class="string">&#x27;xfd1&#x27;</span>].end(<span class="string">&#x27;left&#x27;</span>).column</span><br><span class="line">方法二：</span><br><span class="line">max_column=sht.used_range.last_cell.column</span><br></pre></td></tr></table></figure><h2 id="📌获得工作表中已经使用的单元格区域">📌获得工作表中已经使用的单元格区域</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法一：</span></span><br><span class="line">rng=sht.api.UsedRange</span><br><span class="line"><span class="comment">#方法二：</span></span><br><span class="line">rng=sht.used_range</span><br></pre></td></tr></table></figure><hr><h1 id="3）读取与写入">3）读取与写入</h1><h2 id="📌获得单元格的值">📌获得单元格的值</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;a1&#x27;</span>).expand(<span class="string">&#x27;table&#x27;</span>).value</span><br><span class="line"><span class="comment">#也可以：</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;a1&#x27;</span>).expand().value</span><br></pre></td></tr></table></figure><h2 id="📌给单元格或单元格区域赋值常量">📌给单元格或单元格区域赋值常量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1&#x27;</span>).value = 常量    </span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1:Z10&#x27;</span>).value = 常量  <span class="comment">#也可以是一个区域。</span></span><br></pre></td></tr></table></figure><h2 id="📌给单元格或单元格区域赋值一个一维列表">📌给单元格或单元格区域赋值一个一维列表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据写入的是excel行方向。</span></span><br><span class="line">sht.<span class="built_in">range</span>((<span class="string">&#x27;a1&#x27;</span>).value=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#数据写入的是excel列方向。</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1&#x27;</span>).options(transpose=<span class="literal">True</span>).value=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure><h2 id="📌给单元格或单元格区域赋值一个二维列表">📌给单元格或单元格区域赋值一个二维列表</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方法1：range为一个单元格的时候</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1&#x27;</span>).options(expand=<span class="string">&#x27;table&#x27;</span>)=[[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#方法2：直接选一个同样大小的区域进行赋值。</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;a1:b2&#x27;</span>).value=[[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]]</span><br></pre></td></tr></table></figure><h2 id="📌向单元格中写入公式">📌向单元格中写入公式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sht1.<span class="built_in">range</span>(<span class="string">&#x27;c1&#x27;</span>).formula = <span class="string">&#x27;=sum(a1:b1)&#x27;</span></span><br></pre></td></tr></table></figure><hr><h1 id="4）样式设置">4）样式设置</h1><p>先生成一个excel工作薄(book)，获得当前活动的工作表(sheet):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwings <span class="keyword">as</span> xw</span><br><span class="line"></span><br><span class="line">app = xw.App(visible=<span class="literal">True</span>, add_book=<span class="literal">False</span>)</span><br><span class="line">wb = app.books.add()</span><br><span class="line">sht = wb.sheets.active</span><br><span class="line">cell = sht.<span class="built_in">range</span>(<span class="string">&#x27;c3&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="📌设置单元格大小-行高与列宽">📌设置单元格大小(行高与列宽)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;设置单元格大小&quot;&quot;&quot;</span></span><br><span class="line">sht.autofit()    <span class="comment"># 自动调整单元格大小。</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;a1:d5&#x27;</span>).column_width = <span class="number">5</span>    <span class="comment"># 设置第1-4列的列宽。</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">4</span>).row_height = <span class="number">20</span>     <span class="comment"># 设置第1行 行高</span></span><br></pre></td></tr></table></figure><h2 id="📌设置单元格字体-font-格式">📌设置单元格字体(font)格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;设置单元格 字体格式&quot;&quot;&quot;</span></span><br><span class="line">cell.color = <span class="number">255</span>,<span class="number">200</span>,<span class="number">255</span>         <span class="comment"># 设置单元格的填充颜色</span></span><br><span class="line">cell.api.Font.ColorIndex = <span class="number">3</span>     <span class="comment"># 设置字体的颜色，具体颜色索引见下方。</span></span><br><span class="line">cell.api.Font.Size = <span class="number">24</span>          <span class="comment"># 设置字体的大小。</span></span><br><span class="line">cell.api.Font.Bold = <span class="literal">True</span>        <span class="comment"># 设置为粗体。</span></span><br><span class="line">cell.api.NumberFormat = <span class="string">&quot;0.00&quot;</span>     <span class="comment"># 设置单元格的数字格式。</span></span><br></pre></td></tr></table></figure><h2 id="📌设置单元格对齐方式">📌设置单元格对齐方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;设置单元格的对齐方式&quot;&quot;&quot;</span></span><br><span class="line">cell.api.HorizontalAlignment = -<span class="number">4108</span>    <span class="comment"># -4108 水平居中。 -4131 靠左，-4152 靠右。</span></span><br><span class="line">cell.api.VerticalAlignment = -<span class="number">4130</span>      <span class="comment"># -4108 垂直居中（默认）。 -4160 靠上，-4107 靠下， -4130 自动换行对齐。</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230312-640cb2ac9f971.png" alt="alignment"></p><h2 id="📌设置单元格边框">📌设置单元格边框</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;设置边框&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># Borders(9) 底部边框，LineStyle = 1 直线。</span></span><br><span class="line">cell.api.Borders(<span class="number">9</span>).LineStyle = <span class="number">1</span></span><br><span class="line">cell.api.Borders(<span class="number">9</span>).Weight = <span class="number">3</span>       <span class="comment"># 设置边框粗细。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borders(7) 左边框，LineStyle = 2 虚线。</span></span><br><span class="line">cell.api.Borders(<span class="number">7</span>).LineStyle = <span class="number">2</span></span><br><span class="line">cell.api.Borders(<span class="number">7</span>).Weight = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borders(8) 顶部框，LineStyle = 5 双点划线。</span></span><br><span class="line">cell.api.Borders(<span class="number">8</span>).LineStyle = <span class="number">5</span></span><br><span class="line">cell.api.Borders(<span class="number">8</span>).Weight = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borders(10) 右边框，LineStyle = 4 点划线。</span></span><br><span class="line">cell.api.Borders(<span class="number">10</span>).LineStyle = <span class="number">4</span></span><br><span class="line">cell.api.Borders(<span class="number">10</span>).Weight = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borders(5) 单元格内从左上角 到 右下角。</span></span><br><span class="line">cell.api.Borders(<span class="number">5</span>).LineStyle = <span class="number">1</span></span><br><span class="line">cell.api.Borders(<span class="number">5</span>).Weight = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Borders(6) 单元格内从左下角 到 右上角。</span></span><br><span class="line">cell.api.Borders(<span class="number">6</span>).LineStyle = <span class="number">1</span></span><br><span class="line">cell.api.Borders(<span class="number">6</span>).Weight = <span class="number">3</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230312-640cb2beb7632.png" alt="border-linestyle"></p><h2 id="📌区域内部边框设置如下">📌区域内部边框设置如下</h2><p>选择的是一个区域(range)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;如果是一个区域的单元格，内部边框设置如下&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># # Borders(11) 内部垂直边线。</span></span><br><span class="line">rng.api.Borders(<span class="number">11</span>).LineStyle = <span class="number">1</span></span><br><span class="line">rng.api.Borders(<span class="number">11</span>).Weight = <span class="number">3</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># # Borders(12) 内部水平边线。</span></span><br><span class="line">rng.api.Borders(<span class="number">12</span>).LineStyle = <span class="number">1</span></span><br><span class="line">rng.api.Borders(<span class="number">12</span>).Weight = <span class="number">3</span></span><br></pre></td></tr></table></figure><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230312-640cb32b86896.png" alt="border02"></p><h2 id="📌合并-merge-拆分-unmerge-单元格">📌合并(merge)拆分(unmerge)单元格</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;合并拆分单元格&quot;&quot;&quot;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;C8:D8&#x27;</span>).api.merge()      <span class="comment"># 合并单元格 C8 到 D8</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;C8:D8&#x27;</span>).api.unmerge()    <span class="comment"># 拆分单元格。</span></span><br></pre></td></tr></table></figure><hr><h1 id="5）实例演示">5）实例演示</h1><p>利用xlwings，操作Excel文件，制作下述表格内容：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230311-640c789a00faa.png" alt="image-20230311204818671"></p><p>命令：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwings <span class="keyword">as</span> xw</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = xw.App(visible=<span class="literal">False</span>, add_book=<span class="literal">False</span>)</span><br><span class="line">app.display_alerts = <span class="literal">False</span></span><br><span class="line">app.screen_updating = <span class="literal">False</span></span><br><span class="line">wb = app.books.add()</span><br><span class="line">sht = wb.sheets[<span class="string">&#x27;Sheet1&#x27;</span>]</span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1&#x27;</span>).value = <span class="string">&#x27;个人信息表&#x27;</span></span><br><span class="line"><span class="comment">#设置合并</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1:G1&#x27;</span>).api.Merge()</span><br><span class="line"></span><br><span class="line"><span class="comment"># xlwings设置excel单元格对齐方式</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1:G1&#x27;</span>).api.HorizontalAlignment =-<span class="number">4108</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A1:G1&#x27;</span>).api.VerticalAlignment = -<span class="number">4108</span></span><br><span class="line"><span class="comment">#数据写入的是excel行方向</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A2:F2&#x27;</span>).value = [<span class="string">&#x27;序号&#x27;</span>,<span class="string">&#x27;学号&#x27;</span>,<span class="string">&#x27;姓名&#x27;</span>,<span class="string">&#x27;英语&#x27;</span>,<span class="string">&#x27;数学&#x27;</span>,<span class="string">&#x27;物理&#x27;</span>,<span class="string">&#x27;总分&#x27;</span>]</span><br><span class="line"><span class="comment">#数据写入的是excel列方向</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;A3:A8&#x27;</span>).options(transpose=<span class="literal">True</span>).value=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;B3:B8&#x27;</span>).options(transpose=<span class="literal">True</span>).value=[<span class="string">&#x27;id01&#x27;</span>,<span class="string">&#x27;id02&#x27;</span>,<span class="string">&#x27;id03&#x27;</span>,<span class="string">&#x27;id04&#x27;</span>,<span class="string">&#x27;id05&#x27;</span>,<span class="string">&#x27;id06&#x27;</span>]</span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;C3:C8&#x27;</span>).options(transpose=<span class="literal">True</span>).value=[<span class="string">&#x27;A01&#x27;</span>,<span class="string">&#x27;A02&#x27;</span>,<span class="string">&#x27;A03&#x27;</span>,<span class="string">&#x27;A04&#x27;</span>,<span class="string">&#x27;A05&#x27;</span>,<span class="string">&#x27;A06&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#以表格方式填入数据</span></span><br><span class="line">tables=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">6</span>):<span class="comment">#列</span></span><br><span class="line">    rol=[]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">3</span>):<span class="comment">#行</span></span><br><span class="line">        rol.append(random.randint(<span class="number">0</span>,<span class="number">101</span>))  </span><br><span class="line">    tables.append(rol)</span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;D3&#x27;</span>).options(expand=<span class="string">&#x27;table&#x27;</span>).value=tables</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用公式计算</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G3&#x27;</span>).formula=<span class="string">&#x27;=SUM(D3:F3)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G4&#x27;</span>).formula=<span class="string">&#x27;=SUM(D4:F4)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G5&#x27;</span>).formula=<span class="string">&#x27;=SUM(D5:F5)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G6&#x27;</span>).formula=<span class="string">&#x27;=SUM(D6:F6)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G7&#x27;</span>).formula=<span class="string">&#x27;=SUM(D7:F7)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;G8&#x27;</span>).formula=<span class="string">&#x27;=SUM(D8:F8)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;D9&#x27;</span>).formula=<span class="string">&#x27;=SUM(D3:D8)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;E9&#x27;</span>).formula=<span class="string">&#x27;=SUM(E3:E8)&#x27;</span></span><br><span class="line">sht.<span class="built_in">range</span>(<span class="string">&#x27;F9&#x27;</span>).formula=<span class="string">&#x27;=SUM(F3:F8)&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Rsync备份服务器配置</title>
      <link href="/posts/9e614189.html"/>
      <url>/posts/9e614189.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）简介">1）简介</h1><p>rsync（remote synchronize）是Liunx/Unix下的一个远程数据同步工具。它可通过LAN/WAN快速同步多台主机间的文件和目录，并适当利用rsync算法（差分编码）以减少数据的传输。rsync算法并不是每一次都整份传输，而是只传输两个文件的不同部分，因此其传输速度相当快。除此之外，rsync可拷贝、显示目录属性，以及拷贝文件，并可选择性的压缩以及递归拷贝。</p><h2 id="1-1-rsync的工作原理">1.1 rsync的工作原理</h2><ul><li>客户端构造FileList，FileList包含了需要与服务器同步的所有文件信息对name-&gt;id<br>（id用来唯一表示文件例如MD5）</li><li>客户端将FileList发送到服务器。</li><li>服务器上rsync处理客户端发过来的FileList，构建新的NewFileList。其中根据MD5值比较，删除服务器上已经存在的文件信息对，只保留服务器上不存在或变化的文件。</li><li>客户端得到服务器发送过来的NewFileList，然后把NewFileList中的文件重新传输到服务器。</li></ul><h2 id="1-2-rsync优点">1.2 rsync优点</h2><ol><li><p>可以镜像保存整个目录树和文件系统。</p></li><li><p>可以很容易做到保持原来文件的权限、时间、软硬连接等。</p></li><li><p>无需特殊权限即可安装。</p></li><li><p>快速：第一次同步时rsync复制全部内容，但在下一次值传输修改过的内容</p></li><li><p>压缩传输：rysnc在传输的过程中可以实行压缩及解压缩操作，可以使用更少的带宽</p></li><li><p>安全：可以使用scp、ssh等方式来进行文件传输</p></li><li><p>支持匿名传输，以方便进行网站镜像</p></li><li><p>rsync不仅可以远程同步数据（类似于scp），而且可以本地同步数据（类似于cp），做差异同步</p></li><li><p>openssh 8.0已经把scp标记为过时不建议使用了。建议用sftp或者rsync替代scp</p></li></ol><p><em>（需要在Liunx/Unix服务器之间互传海量数据时，建议选择rsync进行传输）</em></p><h2 id="1-3-rsync认证方式">1.3 rsync认证方式</h2><p>rsync有两种常用的认证方式，一种是rsync-daemon方式，另外一种是ssh方式。</p><p>在平时使用过程，我们使用最多的是rsync-daemon方式。</p><p>⚠️<strong>注意：在使用rsync时，服务器和客户端都必须安装rsync程序</strong>。</p><h3 id="📌rsync-daemon-认证">📌rsync-daemon 认证</h3><p>rsync在rsync-daemon认证方式下，默认监听TCP的873端口。</p><p>rsync-daemon认证方式是rsync的主要认证方式，这个也是我们经常使用的认证方式。并且也只有在此种模式下，rsync才可以把密码写入到一个文件中。</p><blockquote><p>⚠️注意：<br>rsync-daemon认证方式，需要服务器和客户端都安装rsync服务并且只需要rsync服务器端启动rsync，同时配置rsync配置文件。客户端启动不启动rsync服务，都不影响同步的正常进行。</p></blockquote><h3 id="📌ssh认证">📌ssh认证</h3><p>rsync在ssh认证方式下，可通过系统用户进行认证，即在rsync上通过ssh隧道进行传输，类似于scp工具。此时同步操作不在局限于rsync中定义的同步文件夹。</p><blockquote><p>⚠️注意：<br>ssh认证方式，不需要服务器和客户端配置rsync配置文件只需要双方都安装rsync服务，并且也不需要双方启动rsync。</p></blockquote><p>若rsync服务端SSH为标准端口，此时rsync使用方式如下：</p><pre><code>rsync -avz /root/test root@10.10.10.10:/root/</code></pre><p>若rsync服务端SSH为非标准端口，可通过rsync的-e参数进行端口指定。使用方式如下：</p><pre><code>rsync -avz /root/test -e 'ssh -p1234' root@10.10.10.10:/root/</code></pre><h1 id="2）安装rsync">2）安装rsync</h1><p>安装rsync，我们可以分为两种方式：源码方式安装和RPM方式安装。</p><p><strong>注意：rsync软件无论是服务器端还是客户端都是同一个软件包。</strong></p><h2 id="2-1-源码方式安装">2.1 源码方式安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源码方式安装rsync，需要到其官网下载对应的安装包。rsync官网：rsync.samba.org </span></span><br><span class="line"></span><br><span class="line">1)、下载</span><br><span class="line">wget https://download.samba.org/pub/samba/stable/samba-4.18.0.tar.gz</span><br><span class="line"></span><br><span class="line">2)、解压并安装</span><br><span class="line">tar -xvf rsync-4.18.0.tar.gz</span><br><span class="line"></span><br><span class="line">3)、编译安装</span><br><span class="line"><span class="comment"># 源码安装rsync时，其编译时所需要的gcc库文件尽量提前安装完毕</span></span><br><span class="line"><span class="comment"># 默认安装到/usr/local/目录下</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">4)、设置开机启动</span><br><span class="line"><span class="built_in">echo</span> “/usr/local/bin/rsync --daemon -config=/etc/rsyncd.conf” &gt;&gt;/etc/profile</span><br></pre></td></tr></table></figure><h2 id="2-2-yum方式安装">2.2 yum方式安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install  rsync</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置开机启动</span></span><br><span class="line"><span class="built_in">echo</span> “/usr/local/bin/rsync --daemon -config=/etc/rsyncd.conf” &gt;&gt;/etc/profile</span><br></pre></td></tr></table></figure><h1 id="3）配置rsync-daemon">3）配置rsync daemon</h1><h2 id="3-1-服务端配置">3.1 服务端配置</h2><p>📌<strong>准备rsync配置文件</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 rsync 用户启动进程</span></span><br><span class="line">uid = rsync</span><br><span class="line">gid = rsync</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 无需让rsync以root身份运行，允许接收文件的完整属性</span></span><br><span class="line">fake super = <span class="built_in">yes</span>       </span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁锢推送的数据至某个目录, 不允许跳出该目录</span></span><br><span class="line">use <span class="built_in">chroot</span> = no                </span><br><span class="line"></span><br><span class="line">max connections = 200          <span class="comment"># 最大连接数</span></span><br><span class="line"><span class="built_in">timeout</span> = 600                  <span class="comment"># 超时时间</span></span><br><span class="line">ignore errors                  <span class="comment"># 忽略错误信息</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span>              <span class="comment"># 对备份数据可读写</span></span><br><span class="line"></span><br><span class="line">list = <span class="literal">false</span>                   <span class="comment"># 不允许查看模块信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义虚拟用户，作为连接认证用户</span></span><br><span class="line">auth <span class="built_in">users</span> = myuser </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义rsync服务用户连接认证密码文件路径</span></span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 定义模块信息</span></span><br><span class="line">[backup]                </span><br><span class="line">comment = commit        <span class="comment"># 模块注释信息</span></span><br><span class="line">path = /backup          <span class="comment"># 定义接收备份数据目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只允许10.10.10段ip连接</span></span><br><span class="line">hosts allow = 10.10.10.0/24</span><br></pre></td></tr></table></figure><p>📌<strong>配置并启动守护进程</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要一个rsync进程运行时使用的普通用户 rsync</span></span><br><span class="line">useradd rsync -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端需要定义一个客户端连接    虚拟用户名和密码</span></span><br><span class="line"><span class="comment"># 密码文件形式  user:passwd</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;myuser:password&quot;</span> &gt; /etc/rsync.passwd</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备模块定义好的目录,客户端的数据都存放在该目录下</span></span><br><span class="line"><span class="built_in">mkdir</span> /backup</span><br><span class="line"><span class="built_in">chown</span> -R rsync.rsync /backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">rsync --daemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务</span></span><br><span class="line">ps aux | grep rsync</span><br><span class="line">netstat -lntp|grep 873</span><br></pre></td></tr></table></figure><h2 id="3-2-客户端的使用">3.2 客户端的使用</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 在客户端安装完毕rsync服务后，是不需要启动rsync服务的。</span></span><br><span class="line"><span class="comment"># 我们只需要在客户端创建连接rsync服务器时，验证码用户所需要的密码文件即可。</span></span><br><span class="line"><span class="comment"># 该密码文件中的密码要与rsync服务器上的密码文件中的密码对应</span></span><br><span class="line"><span class="comment"># 并且也要与rsync服务器rsyncd.conf配置文件中的认证模块中的用户匹配。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> “password”&gt;&gt;/etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 rsync 守护程序分配的所有 module 列表，可以执行下面命令。</span></span><br><span class="line">rsync rsync://10.10.10.10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体写法是服务器与目标目录之间使用双冒号分隔`::`</span></span><br><span class="line"><span class="comment"># 地址中的module并不是实际路径名，而是 rsync 守护程序指定的模块名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把本地的文件同步到远程服务器</span></span><br><span class="line"><span class="comment"># rsync [OPTION]… [SRC]… [USER@]HOST::DEST</span></span><br><span class="line"><span class="comment"># rsync [选项] [--port=]  [--password-file=] [/local/path] [用户名]@服务端IP::[模块名]</span></span><br><span class="line"></span><br><span class="line">rsync -av --password-file=/etc/rsync.passwd <span class="built_in">local</span>/ myuser@10.10.10.10::backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把远程机器的文件同步到本地</span></span><br><span class="line"><span class="comment"># rsync [OPTION]… [USER@]HOST::SRC [DEST]</span></span><br><span class="line"><span class="comment"># rsync [选项] [--port=] [--password-file=] [用户名@]服务端IP::[模块名]  [/local/path]</span></span><br><span class="line"></span><br><span class="line">rsync -av --password-file=/etc/rsync.passwd myuser@10.10.10.10::backup <span class="built_in">local</span>/</span><br></pre></td></tr></table></figure><h1 id="4）rsync使用">4）rsync使用</h1><h2 id="4-1-同步模式模式">4.1 同步模式模式</h2><h3 id="4-1-1-本地同步">4.1.1 本地同步</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##本地  rsync   选项       源      目标</span></span><br><span class="line">Local:  rsync [OPTION...] SRC... [DEST]</span><br><span class="line"></span><br><span class="line"><span class="comment">#将/etc目录备份到/opt目录下，和cp的区别在于会自动增量备份</span></span><br><span class="line">rsync -avz /etc /opt</span><br></pre></td></tr></table></figure><h3 id="4-1-2远程同步">4.1.2远程同步</h3><h4 id="ssh协议">ssh协议</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认使用 SSH 进行远程登录和数据传输</span></span><br><span class="line"><span class="comment"># 不需要做任何配置，需要都安装rsync，操作上类似scp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将远端文件拉（下载）到本地</span></span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]</span><br><span class="line">         </span><br><span class="line"><span class="comment">#将本地文件推送（上传）到远端</span></span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br><span class="line"> </span><br><span class="line"><span class="comment">#将etc推送到10.10.10.10下的自定义文件夹下</span></span><br><span class="line">rsync -az /etc/ 10.10.10.10:/opt/etc-$(hostname)-$(<span class="built_in">date</span> +%F)</span><br></pre></td></tr></table></figure><h4 id="rsync协议">rsync协议</h4><blockquote><p>使用rsync协议，需要服务端启动守护进程</p><p>操作参考 <a href="">配置rsync daemon</a></p></blockquote><h2 id="4-2-命令参数">4.2 命令参数</h2><p>📌<strong>常用参数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-v, –verbose详细模式输出。</span><br><span class="line"></span><br><span class="line">-a, –archive归档模式，表示以递归方式传输文件，并保持所有文件属性不变。</span><br><span class="line"></span><br><span class="line">-z, –compress对备份的文件在传输时进行压缩处理。</span><br><span class="line"></span><br><span class="line">–delete：删除那些DST中存在而在SRC中没有的文件。</span><br></pre></td></tr></table></figure><p>📌<strong>所有参数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-a：–archive archive mode 权限保存模式，相当于 -rlptgoD 参数，存档，递归，保持属性等。</span><br><span class="line">-r：–recursive 复制所有下面的资料，递归处理。</span><br><span class="line">-p：–perms 保留档案权限，文件原有属性。</span><br><span class="line">-t：–<span class="built_in">times</span> 保留时间点，文件原有时间。</span><br><span class="line">-g：–group 保留原有属组。</span><br><span class="line">-o：–owner 保留档案所有者(root only)。</span><br><span class="line">-D：–devices 保留device资讯(root only)。</span><br><span class="line">-l：–links 复制所有的连接，拷贝连接文件。</span><br><span class="line">-z：–compress 压缩模式，当资料在传送到目的端进行档案压缩。</span><br><span class="line">-H：–hard-links 保留硬链接文件。</span><br><span class="line">-A：–acls 保留ACL属性文件，需要配合–perms。</span><br><span class="line">-P：-P参数和 --partial --progress 相同，只是为了把参数简单化，表示传进度。</span><br><span class="line">--version：输出rsync版本。</span><br><span class="line">-v：–verbose 复杂的输出信息。</span><br><span class="line">-u：–update 仅仅进行更新，也就是跳过已经存在的目标位置，并且文件时间要晚于要备份的文件，不覆盖新的文件。</span><br><span class="line">--port=PORT：定义rsyncd(daemon)要运行的port(预设为tcp 873)。</span><br><span class="line"></span><br><span class="line">--delete：删除那些目标位置有的文件而备份源没有的文件。</span><br><span class="line"></span><br><span class="line">--delete-before: 接收者在传输之前进行删除操作</span><br><span class="line"></span><br><span class="line">--password-file=FILE ：从 指定密码文件中获取密码。</span><br><span class="line">--bwlimit=KBPS：限制 I/O 带宽。</span><br><span class="line">--filter “-filename”：需要过滤的文件。</span><br><span class="line">--exclude=filname：需要过滤的文件。</span><br><span class="line">--progress：显示备份过程。</span><br></pre></td></tr></table></figure><h1 id="5）示例">5）示例</h1><h2 id="5-1-常用示例">5.1 常用示例</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将当前目录下所有文件同步到远端</span></span><br><span class="line">rsync -avzP ./* myuser@10.10.10.15::backup </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从服务端同步数据到本地</span></span><br><span class="line">rsync -avzP  myuser@10.10.10.15::backup .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保持服务端于客户端上数据完全一致，服务端有则同步给客户端，服务端没有，客户端有的则从客户端删除</span></span><br><span class="line"><span class="comment"># –delete 选项，表示客户端上的数据要与服务器端完全一致,多则删之，少则补之</span></span><br><span class="line"><span class="comment"># 用的时候要小心点，最好不要把已经有重要数所据的目录，当做本地更新目录，否则会把你的数据全部删除</span></span><br><span class="line">rsync -avzP  --delete myuser@10.10.10.15::backup  /tmp/test/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面的 rsync 命令将10.10.10.10主机上的 /www 目录（不包含 /www/logs 和 /www/conf子目录）复制到本地的 /backup/www/ </span></span><br><span class="line">rsync -avzP --delete --exclude <span class="string">&quot;logs/&quot;</span> --exclude <span class="string">&quot;conf/&quot;</span>  \</span><br><span class="line">10.10.10.10:/www/ /backup/www/</span><br></pre></td></tr></table></figure><h2 id="5-2-快速删除大量数据">5.2 快速删除大量数据</h2><p><strong>在<code>need_delete</code> 目录下建立30万个文件</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">time <span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 300000)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">test</span> &gt;&gt;<span class="variable">$i</span>.txt</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行时间</span></span><br><span class="line">real0m42.267s</span><br><span class="line">user0m6.756s</span><br><span class="line">sys0m33.973s</span><br></pre></td></tr></table></figure><p><strong>测试rsync删除</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先创建一个空目录new_dir</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后执行 </span></span><br><span class="line">time rsync -a --delete-before new_dir/ need_delete/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只需要几秒钟，速度非常快</span></span><br><span class="line">real0m8.146s</span><br><span class="line">user0m0.216s</span><br><span class="line">sys0m7.127s</span><br></pre></td></tr></table></figure><p><strong>测试 rm -rf 删除</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">time <span class="built_in">rm</span> -rf need_delete/</span><br><span class="line"></span><br><span class="line">real0m9.639s</span><br><span class="line">user0m0.143s</span><br><span class="line">sys0m8.250s</span><br></pre></td></tr></table></figure><h1 id="6）rsyncd-conf-详解">6）rsyncd.conf 详解</h1><h2 id="6-1-全局参数">6.1 全局参数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在独立运行时，用于指定的服务器运行的 IP 地址</span></span><br><span class="line">address = IP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听端口</span></span><br><span class="line">port = 873 </span><br><span class="line"></span><br><span class="line"><span class="comment"># rsync 的守护进程将其 PID 写入指定的文件</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定支持 max connections 参数的锁文件</span></span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定 rsync 守护进程的日志文件，而不将日志发送给 syslog</span></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#========== 控制参数 =============#</span></span><br><span class="line"> <span class="comment"># 以指定的 UID 传输文件</span></span><br><span class="line">uid = rsync        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定该模块以指定的 GID 传输文件。</span></span><br><span class="line">gid = rsync                     </span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁锢推送的数据至某个目录, 不允许跳出该目录,</span></span><br><span class="line"><span class="comment"># 默认为 yes，则 rsync 在传输文件之前首先 chroot 到 path 参数所指定的目录下</span></span><br><span class="line"><span class="comment"># 这样做的原因是实现额外的安全防护，但是缺点是需要 root 权限</span></span><br><span class="line"><span class="comment"># 并且不能备份指向 path 外部的符号连接所指向的目录文件</span></span><br><span class="line">use <span class="built_in">chroot</span> = no                </span><br><span class="line"></span><br><span class="line"><span class="comment"># 无需让rsync以root身份运行，允许接收文件的完整属性</span></span><br><span class="line">fake super = <span class="built_in">yes</span>                </span><br><span class="line"></span><br><span class="line"><span class="comment"># 大并发连接数量以保护服务器，超过限制的连接请求将被告知随后再试</span></span><br><span class="line"><span class="comment"># 默认为0 （没有限制）</span></span><br><span class="line">max connections = 200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超时时间</span></span><br><span class="line"><span class="built_in">timeout</span> = 600               </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定在 rsync 服务器上运行 delete 操作时是否忽略 I/O 错误。</span></span><br><span class="line"><span class="comment"># 一般来说 rsync 在出现 I/O 错误时将将跳过 –delete 操作</span></span><br><span class="line"><span class="comment"># 以防止因为暂时的资源不足或其它 I/O 错误导致的严重问题。</span></span><br><span class="line">ignore errors</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定是否允许客户上传文件。</span></span><br><span class="line"><span class="comment"># 默认为true，不允许用户上传文件，</span></span><br><span class="line"><span class="comment"># 若为 false 并且服务器目录也具有读写权限则允许上传。</span></span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定当客户请求列出可以使用的模块列表时，该模块是否应该被列出。</span></span><br><span class="line"><span class="comment"># 默认为 true，如果设置该选项为 false，可以创建隐藏的模块</span></span><br><span class="line">list = <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="6-2-模块参数">6.2 模块参数</h2><blockquote><p>模块参数主要用于定义 rsync 服务器哪个目录要被同步。</p><p>模块声明的格式必须为 [module] 形式，这个名字就是在 rsync 客户端看到的名字，类似于 Samba 服务器提供的共享名。</p><p>而服务器真正同步的数据是通过 path 来指定的。可以根据自己的需要，来指定多个模块，模块中可以定义以下参数：</p></blockquote><p><strong>基本模块参数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定模块名</span></span><br><span class="line">[backup]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定当前模块在 rsync 服务器上的同步路径，该参数是必须指定的</span></span><br><span class="line">path = /backup  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 给模块指定一个描述，该描述连同模块名在客户连接得到模块列表时显示给客户</span></span><br><span class="line">comment = commit</span><br></pre></td></tr></table></figure><p><strong>模块文件筛选参数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定多个由空格隔开的多个文件或目录(相对路径)</span></span><br><span class="line"><span class="comment"># 并将其添加到 exclude 列表中。这等同于在客户端命令中使用 –exclude 来指定模式。</span></span><br><span class="line">exclude = exclude_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定一个包含 exclude 规则定义的文件名，服务器从该文件中读取 exclude 列表定义</span></span><br><span class="line">exclude from = exclude-file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定多个由空格隔开的多个文件或目录(相对路径)，并将其添加到 include 列表中。</span></span><br><span class="line"><span class="comment"># 这等同于在客户端命令中使用 –include 来指定模式 。</span></span><br><span class="line">include = include-file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定一个包含 include 规则定义的文件名，服务器从该文件中读取 include 列表定义</span></span><br><span class="line">include from = exclude-file.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个模块只能指定一个exclude 参数、一个include 参数</span></span><br><span class="line"><span class="comment"># 结合 include 和 exclude 可以定义复杂的exclude/include 规则</span></span><br><span class="line"><span class="comment"># 这几个参数分别与相应的rsync 客户命令选项等价，唯一不同的是它们作用在服务器端</span></span><br></pre></td></tr></table></figure><p><strong>模块用户认证参数</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rsync 默认匿名方式传输</span></span><br><span class="line"><span class="comment"># 若只配置匿名访问的 rsync 服务器，则无需设置下述参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定由空格或逗号分隔的用户名列表，只有这些用户才允许连接该模块。</span></span><br><span class="line"><span class="comment"># 这里的用户和系统用户没有任何关系。用户名和口令以明文方式存放在 secrets file 参数指定的文件中</span></span><br><span class="line">auth <span class="built_in">users</span> = user_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定一个 rsync 认证口令文件。只有在 auth users 被定义时，该文件才起作用</span></span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># rsync 认证口令文件的权限一定是 600，否则客户端将不能连接服务器。</span></span><br><span class="line"><span class="comment"># rsync 认证口令文件中每一行指定一个 用户名:口令 对，格式为：</span></span><br><span class="line"><span class="comment"># username:passwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般来说口令最好不要超过8个字符</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个rsync配置文件中可以包含多个认证模块，同时一个密码文件中也可以存放多个用户和其对应的密码。</span></span><br><span class="line"><span class="comment"># 其中每一个认证模块可以对应不同的客户端。</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NFS服务器配置</title>
      <link href="/posts/757768a4.html"/>
      <url>/posts/757768a4.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）这里用一个实例环境来讲解">1）这里用一个实例环境来讲解</h1><table><thead><tr><th>hostname</th><th>ip</th></tr></thead><tbody><tr><td>Server-nfs</td><td>192.168.0.1</td></tr><tr><td>Cilent-nfs-linux</td><td>192.168.0.10</td></tr><tr><td>Cilent-nfs-windows</td><td>192.168.0.20</td></tr></tbody></table><p>📌 <strong>配置网络环境</strong></p><p>-----略-----</p><hr><h1 id="2）NFS-服务端部署">2）NFS 服务端部署</h1><h2 id="📌-在服务端安装NFS服务">📌 <strong>在服务端安装NFS服务</strong></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nfs-utils rpcbind</span><br></pre></td></tr></table></figure><h2 id="📌-创建共享目录">📌 <strong>创建共享目录</strong></h2><p>这个目录可以在任意位置的任意名字</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/share</span><br><span class="line"><span class="built_in">chmod</span> o+w /opt/share/</span><br></pre></td></tr></table></figure><h2 id="📌-配置共享目录">📌 <strong>配置共享目录</strong></h2><p>默认文件为空：此配置按列分隔</p><ul><li><p>第一列：<strong>共享文件的路径</strong></p></li><li><p>第二列：&lt;客户端ip&gt;(&lt;rw(读写)&gt; | &lt;ro(只读)&gt;,&lt;all_squash(映射为系统账号)&gt;)</p><blockquote><p>系统账号为nfs-nobody（/etc/passwd可查看）</p></blockquote></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/exports</span><br><span class="line"></span><br><span class="line">/opt/share192.168.0.0/24(rw,all_squash)</span><br></pre></td></tr></table></figure><h2 id="📌重启NFS服务">📌<strong>重启NFS服务</strong></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nfs</span><br><span class="line">systemctl status nfs</span><br></pre></td></tr></table></figure><hr><h1 id="3）Linux-NFS-客户端部署">3）Linux NFS 客户端部署</h1><h2 id="📌在客户端安装NFS服务">📌在客户端安装NFS服务</h2><p>这里并不是用于配置服务端，而是让客户端挂载时能够识别服务端的文件系统</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nfs-utils rpcbind</span><br></pre></td></tr></table></figure><h2 id="📌创建挂载点">📌创建挂载点</h2><p>语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs &lt;服务器ip&gt;:&lt;共享的绝对路径&gt; 本地挂载点</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/nfs_share</span><br><span class="line">mount -t nfs 192.168.0.1:/opt/share /mnt/nfs_share</span><br></pre></td></tr></table></figure><hr><h1 id="4）Windows-NFS-客户端部署">4）Windows NFS 客户端部署</h1><h2 id="📌-安装nfs客户端">📌 安装nfs客户端</h2><p>windows一般只有在旗舰版中才有nfs，在服务中安装nfs客户端即可，版本较多自行百度。</p><h2 id="📌-查看NFS服务器共享的信息">📌 查看NFS服务器共享的信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.0.1</span><br></pre></td></tr></table></figure><h2 id="📌挂载">📌挂载</h2><p>注意Windows下的斜杆为撬棍！</p><p>语法：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount \\&lt;服务器ip&gt;\&lt;共享的绝对路径&gt; 盘符</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount \\192.168.0.1\opt\share x:<span class="comment"># 必须使用未使用的盘符</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PassWall的正确设置，利用SmartDNS实现国内外分离</title>
      <link href="/posts/d3fb2262.html"/>
      <url>/posts/d3fb2262.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="查看本地dns服务的端口">查看本地dns服务的端口</h1><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640559303e3a7.png" alt="image-20230306110832844"></p><p>这里是6153记下来。</p><hr><h1 id="PassWall配置">PassWall配置</h1><p>📌 启用</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640553f46895a.png" alt="image-20230306104605886"></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640558f7632fc.png" alt="image-20230306110735947"></p><hr><h1 id="SmartDNS配置">SmartDNS配置</h1><p>📌 常规配置页：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-6405542633d0a.png" alt="image-20230306104702793"></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640555bb1b04a.png" alt="image-20230306105347649"></p><p>📌 自己添加DNS服务器：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-6405545242fc2.png" alt="image-20230306104746841"></p><p>📌 重点来了在此我们需要将国内和国外的dns服务器分开：(这里分为CN和GW)</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-6405554830079.png" alt="image-20230306105152740"></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-64055577e6c99.png" alt="image-20230306105240507"></p><p>📌 在自定义设置中添加：</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640557a0bf385.png" alt="image-20230306110153316"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">bind</span> <span class="string">:6153</span> <span class="string">-group</span> <span class="string">CN</span></span><br><span class="line"><span class="string">bind</span> <span class="string">:6453</span> <span class="string">-group</span> <span class="string">GW</span> <span class="string">-no-speed-check</span> <span class="string">-no-cache</span></span><br></pre></td></tr></table></figure><p>📌 拉到下方，保存&amp;应用。</p><hr><h1 id="注意事项">注意事项</h1><h2 id="1-PassWall的规则列表">1.PassWall的规则列表</h2><p>这个区域必须要有填写在SmartDNS的地址，没有请自己加上。</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-640559e64988b.png" alt="image-20230306111134867"></p><h2 id="2-如果可以访问外网但是不能访问国内">2.如果可以访问外网但是不能访问国内</h2><p>📌 请这样设置</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-64055a84a8597.png" alt="image-20230306111413322"></p><p>📌 在试试可以不，如果还不行修改防火墙规则</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-64055ad1e8e8a.png" alt="image-20230306111530529"></p><p>添加：（这里eth1是我的网卡，你修改成你的）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -I POSTROUTING -o eth1 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>📌 最后在试试，把这两个接受下</p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230306-64055b5e4254c.png" alt="image-20230306111750768"></p><h2 id="3-国内外DNS汇总">3.国内外DNS汇总</h2><blockquote><p><strong>国内DNS:</strong><br><strong>阿里公共DNS：</strong><br>223.5.5.5   类型选择：UDP<br>223.6.6.6   类型选择：UDP<br>阿里加密DNS：alidns_ip/dns-query   类型选择：https<br>阿里加密DNS：<a href="http://dns.alidns.com/dns-query">dns.alidns.com/dns-query</a>   类型选择：https<br><strong>腾讯公共DNS:</strong><br>DNS：119.29.29.29  类型选择：UDP<br>腾讯加密DNS：doh.pub/dns-query  类型选择：https<br>腾讯加密DNS：sm2.doh.pub/dns-query  类型选择：https<br><strong>360公共DNS</strong><br>中国电信/铁通/移动：  101.226.4.6   218.30.118.6   类型选择：UDP<br>中国联通：  123.125.81.6      140.207.198.6   类型选择：UDP<br>百度公共DNS：180.76.76.76  类型选择：UDP<br>**114DNS：**114.114.114.114    114.114.115.115   类型选择：UDP</p></blockquote><blockquote><p><strong>国外DNS：</strong><br>**CloudflareDNS：**1.1.1.1   类型选择：UDP<br>Cloudflare加密DNS：1.1.1.1/dns-query   类型选择：tls<br><strong>Google DNS：</strong><br>8.8.8.8      8.8.4.4    类型选择：UDP<br>谷歌加密DNS：dns.google/dns-query   类型选择：https<br>谷歌加密DNS：dns.google   类型选择：tls<br><strong>Norton ConnectSafe：</strong> 199.85.126.10    199.85.127.10  类型选择：UDP<br>威瑞信：64.6.64.6   64.6.65.6  类型选择：UDP<br><strong>Comodo安全DNS：</strong>  8.26.56.2    68.20.247.20  类型选择：UDP<br><strong>DNS Watch：</strong> 84.200.69.80    84.200.70.40  类型选择：UDP<br><strong>Quad9：</strong><br>Quda9加密DNS：<a href="http://dns11.quad9.net/dns-query">dns11.quad9.net/dns-query</a></p></blockquote><p><strong>原理我就不讲解了，照着搬就可以了。</strong></p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux三剑客grep、sed、awk</title>
      <link href="/posts/b29674f9.html"/>
      <url>/posts/b29674f9.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）三剑客的特点及应用场景">1）三剑客的特点及应用场景</h1><table><thead><tr><th>命令</th><th>特点</th><th>场景</th></tr></thead><tbody><tr><td>grep</td><td>过滤</td><td>过滤速度是最快的</td></tr><tr><td>sed</td><td>替换，修改文件内容，取行</td><td>如果要进行替换/修改文件内容<br/>取出某个范围的内容</td></tr><tr><td>awk</td><td>取列，统计计算</td><td>取列<br/>对比，比较<br/>统计计算</td></tr></tbody></table><hr><h1 id="2）grep">2）grep</h1><p>grep全拼：Global search Regular expression and Print out the line</p><p>作用，文本搜索工具，根据用户指定的条件对目标文本进行匹配检查并打印匹配的行。</p><p>📌<strong>语法</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ grep [options] [pattern] file</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>作用</th></tr></thead><tbody><tr><td>-E</td><td>相当于egrep，正则</td></tr><tr><td>-A</td><td>after；-A5 匹配你要的内容显示接下来的5行</td></tr><tr><td>-B</td><td>before；-B5 匹配你要的内容显示上面的5行</td></tr><tr><td>-C</td><td>context；-C5 匹配你要的内容显示上下5行</td></tr><tr><td>-c</td><td>只统计匹配到的行数（类似于wc -l）</td></tr><tr><td>-v</td><td>取反（一般用于对自己取反<code>grep -v grep</code>；查询进程时grep也会产生进程）</td></tr><tr><td>-n</td><td>显示行号</td></tr><tr><td>-i</td><td>忽略大小写</td></tr><tr><td>-w</td><td>精确匹配</td></tr></tbody></table><h1 id="3）sed">3）sed</h1><h2 id="3-1-简介">3.1 简介</h2><p>sed是Stream Editor (字符流编辑器)的缩写，简称流编辑器。</p><p>常用功能包括结合正则表达式对文件实现快速增删改查,其中查询的功能中最常用的两大功能是过滤(过滤指定字符串)、取行(取出指定行)。</p><h2 id="3-2-执行过程">3.2 执行过程</h2><p><span style="color:blue;">四个字总结： “找谁干啥”</span></p><p><img src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230308-6407e969a99cc.png" alt="img"></p><h2 id="3-3-语法">3.3 语法</h2><p>📌<strong>语法</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed [options] <span class="string">&#x27;&#123;command&#125;[flags]&#x27;</span> [filename]    </span><br><span class="line"><span class="comment"># 中括号内容必有 大括号内容可有可无</span></span><br><span class="line">sed  <span class="comment"># 执行命令</span></span><br><span class="line">[options]  <span class="comment"># 命令选项</span></span><br><span class="line">&#123;<span class="built_in">command</span>&#125;[flags]    <span class="comment"># sed内部选项和参数</span></span><br><span class="line">[filename]     <span class="comment"># 文件</span></span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong> <code>options</code>：</p><table border="0">  <tbody>    <tr>      <td>参数</td>      <td>解释</td>    </tr>    <tr>      <td>-n</td>      <td>        取消sed默认输出（默认输出：无论是不是匹配项都输出，即像cat一样把文本内容打印出来），常与sed内置命令p一起使用      </td>    </tr>    <tr>      <td>-i</td>      <td>        直接将修改结果写入文件，不用-i，sed修改的是内存数据而不是修改源文件      </td>    </tr>    <tr>      <td>-e</td>      <td>多次编辑，不再需要管道符了</td>    </tr>    <tr>      <td>-r</td>      <td>支持正则扩展</td>    </tr>  </tbody></table><p>📌<strong>内部命令</strong> <code>command</code>：</p><p>常用：增删改查</p><table>  <tbody>    <tr>      <td style="vertical-align: top">        <p><strong>操作符</strong></p>      </td>      <td style="vertical-align: top; width: 240px">        <p><strong>用途</strong></p>      </td>      <td style="vertical-align: top; width: 192px">        <p><strong>指令示例</strong></p>      </td>      <td style="vertical-align: top">        <p><strong>解释</strong></p>      </td>    </tr>    <tr>      <td rowspan="3" style="vertical-align: top">        <p><strong>s</strong></p>      </td>      <td rowspan="3" style="vertical-align: top; width: 240px">        <p>字符串替换(substitution)</p>      </td>      <td style="vertical-align: top; width: 192px"><p>s/old/new/</p></td>      <td style="vertical-align: top">        <p>将每行的第1&nbsp;个old替换为new</p>      </td>    </tr>    <tr>      <td style="vertical-align: top; width: 192px"><p>s/old/new/3</p></td>      <td style="vertical-align: top">        <p>将每行的第3&nbsp;个old替换为new</p>      </td>    </tr>    <tr>      <td style="vertical-align: top; width: 192px"><p>s/old/new/g</p></td>      <td style="vertical-align: top"><p>将所有的old都替换为new</p></td>    </tr>    <tr>      <td rowspan="2" style="vertical-align: top">        <p><strong>p</strong></p>      </td>      <td rowspan="2" style="vertical-align: top; width: 240px">        <p>打印行（print）</p>      </td>      <td style="vertical-align: top; width: 192px">        <p>2，4p&nbsp;&nbsp;&nbsp;</p>      </td>      <td style="vertical-align: top"><p>输出第2－4行</p></td>    </tr>    <tr>      <td style="vertical-align: top; width: 192px"><p>2p,4p</p></td>      <td style="vertical-align: top"><p>输出第2行、第4行</p></td>    </tr>    <tr>      <td style="vertical-align: top">        <p><strong>d</strong></p>      </td>      <td style="vertical-align: top; width: 240px"><p>删除行（delete）</p></td>      <td style="vertical-align: top; width: 192px"><p>2,4d</p></td>      <td style="vertical-align: top"><p>删除第2－4行</p></td>    </tr>    <tr>      <td rowspan="3" style="vertical-align: top">        <p><strong>cai</strong></p>      </td>      <td rowspan="3" style="vertical-align: top; width: 240px">        <p>取代/新增/插入</p>      </td>      <td style="vertical-align: top; width: 192px"><p>c</p></td>      <td style="vertical-align: top">        <p>c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行</p>      </td>    </tr>    <tr>      <td style="vertical-align: top; width: 192px"><p>a</p></td>      <td style="vertical-align: top">        <p>a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)</p>      </td>    </tr>    <tr>      <td style="vertical-align: top; width: 192px"><p>i</p></td>      <td style="vertical-align: top">        <p>i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)</p>      </td>    </tr>  </tbody></table><p>📌<strong>sed匹配范围</strong>：</p><table border="0">  <tbody>    <tr>      <td>范围</td>      <td>解释</td>    </tr>    <tr>      <td>空地址</td>      <td>全文处理</td>    </tr>    <tr>      <td>单地址</td>      <td>指定文件某一行</td>    </tr>    <tr>      <td>/pattern/</td>        <td>被模式匹配到的每一行，<span style="color:red;">斜线中表示正则！！！</span></td>    </tr>    <tr>      <td>范围区间</td>      <td>10,20表示10~20行；10，+5第10行向下5行;/pattern1/,/pattern2/</td>    </tr>    <tr>      <td>步长</td>      <td>1~2表示1,3,5,7奇数行，2~2表示2,4,6,8偶数行</td>    </tr>  </tbody></table>## 3.4 应用<h3 id="📌示例">📌示例</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@db001 ~]<span class="comment"># cat &gt; test.txt &lt;&lt;EOF </span></span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="📌查找（打印）p">📌查找（打印）<code>p</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打印test.txt文件内容</span></span><br><span class="line">$ sed <span class="string">&#x27;p&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印test.txt文件第三行的内容</span></span><br><span class="line">$ sed <span class="string">&#x27;3p&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印test.txt文件第二、三、四行内容</span></span><br><span class="line">$ sed <span class="string">&#x27;2,4p&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印test.txt文件包含字符串&quot;3 the&quot;的行</span></span><br><span class="line">$ sed <span class="string">&#x27;/3 the/p&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog </span><br><span class="line"><span class="comment">#可以看得出，打印内容是重复的行，原因是打印了指定文件内容一次，又将读入缓存的所有数据打印了一次，所以会看到这样的效果，如果不想看到这样的结果，可以加命令选项-n抑制内存输出即可。</span></span><br></pre></td></tr></table></figure><h3 id="📌删除-d">📌删除  <code>d</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除文件test.txt中的所有数据</span></span><br><span class="line">$ sed <span class="string">&#x27;d&#x27;</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件test.txt中的第三行数据</span></span><br><span class="line">$ sed <span class="string">&#x27;3d&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件test.txt第三到第四行的数据</span></span><br><span class="line">$ sed <span class="string">&#x27;3,4d&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除文件test.txt中包含字符串&quot;3 the&quot;的行</span></span><br><span class="line">$ sed <span class="string">&#x27;/3 the/d&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br></pre></td></tr></table></figure><h3 id="📌增加-c-a-i">📌增加  <code>c</code> <code>a</code> <code>i</code></h3><p>这里只演示下 <code>a</code> 的用法，其它2个也是相同的语法。<code>a</code> <strong>在新的一行增加</strong>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在每行后追加一行新数据内容: append data &quot;haha&quot;</span></span><br><span class="line">$ sed <span class="string">&#x27;a\append data &quot;haha&quot;&#x27;</span> test.txt<span class="comment">#这里`\`可以用空格，个人习惯用反斜杠增加可读性</span></span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在第二行后新开一行追加数据: append data &quot;haha&quot;</span></span><br><span class="line">$  sed <span class="string">&#x27;2a\append data &quot;haha&quot;&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#在第二到四行每行后新开一行追加数据: append data &quot;haha&quot;</span></span><br><span class="line">$  sed <span class="string">&#x27;2,4a\append data &quot;haha&quot;&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#匹配字符串追加: 找到包含&quot;3 the&quot;的行，在其后新开一行追加内容: append data &quot;haha&quot;</span></span><br><span class="line">$  sed <span class="string">&#x27;/3 the/a\append data &quot;haha&quot;&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">append data <span class="string">&quot;haha&quot;</span></span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br></pre></td></tr></table></figure><h3 id="📌替换-s">📌替换  <code>s</code></h3><blockquote><table><thead><tr><th>flags</th><th>说明</th><th>指令示例</th><th>解释</th></tr></thead><tbody><tr><td>数字</td><td>表示新文本替换的模式</td><td>s###3</td><td>表示每行的第3个</td></tr><tr><td>g</td><td>表示用新文本替换现有文本的全部实例</td><td></td><td></td></tr><tr><td>p</td><td>表示打印原始的内容</td><td></td><td></td></tr><tr><td>w filename</td><td>将替换的结果写入文件</td><td></td><td></td></tr></tbody></table></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果一行中有多个符合的字符串，如果没有标志位定义，那么只会替换第一个字符串，其他的就被忽略掉了，为了能精确替换，可以使用数字位做定义。</span></span><br><span class="line"><span class="comment">#替换一行中的第二处dog为cat</span></span><br><span class="line">$ sed <span class="string">&#x27;s/dog/cat/2&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . <span class="built_in">cat</span></span><br><span class="line">2 the quick brown fox jumps over the lazy dog . <span class="built_in">cat</span></span><br><span class="line">3 the quick brown fox jumps over the lazy dog . <span class="built_in">cat</span></span><br><span class="line">4 the quick brown fox jumps over the lazy dog . <span class="built_in">cat</span></span><br><span class="line">5 the quick brown fox jumps over the lazy dog . <span class="built_in">cat</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#g标志:将一行中的所有符合的字符串全部执行替换</span></span><br><span class="line"><span class="comment">#将data1文件中的所有dog替换为cat</span></span><br><span class="line">$ sed <span class="string">&#x27;s/dog/cat/g&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . <span class="built_in">cat</span></span><br><span class="line">2 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . <span class="built_in">cat</span></span><br><span class="line">3 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . <span class="built_in">cat</span></span><br><span class="line">4 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . <span class="built_in">cat</span></span><br><span class="line">5 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . <span class="built_in">cat</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p标志：打印文本内容，类似于-p命令选项</span></span><br><span class="line">$ sed  <span class="string">&#x27;3s/dog/cat/p&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#w filename标志:将修改的内容存入filename文件中</span></span><br><span class="line">$ sed  <span class="string">&#x27;3s/dog/cat/w text&#x27;</span> test.txt</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy <span class="built_in">cat</span> . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br></pre></td></tr></table></figure><h3 id="⭐其它用法">⭐其它用法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#$=统计test.txt有多少行</span></span><br><span class="line">$ sed -n <span class="string">&#x27;$=&#x27;</span> test.txt</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印test.txt内容时加上行号</span></span><br><span class="line">$ sed  <span class="string">&#x27;=&#x27;</span> test.txt</span><br><span class="line">1</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出包含the的所在行的行号（= 用来输出行号）</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/the/=&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#输出以PI开头的行</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/^PI/p&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#输出以数字结尾的行</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/[0-9]$/p&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#输出包含单词wood的行 \&lt; ,\&gt;表示单词边界</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/\&lt;wood\&gt;/p&#x27;</span> test.txt </span><br><span class="line">a wood cross!</span><br><span class="line"></span><br><span class="line"><span class="comment">#每行开始添加#字符</span></span><br><span class="line">$ sed <span class="string">&#x27;s/^/#/&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#在包含the的每行行首添加#字符</span></span><br><span class="line">$ sed <span class="string">&#x27;/the/s/^/#/&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#在每行末尾添加EOF字符</span></span><br><span class="line">$ sed <span class="string">&#x27;s/$/EOF/&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#将3-5行所有的the替换为THE  </span></span><br><span class="line">$ sed <span class="string">&#x27;3,5s/the/THE/g&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#将包含the的行中的o替换为O</span></span><br><span class="line">$ sed <span class="string">&#x27;/the/s/o/O/g&#x27;</span> test.txt </span><br></pre></td></tr></table></figure><h3 id="⭐迁移符合条件的文本">⭐迁移符合条件的文本</h3><blockquote><p>H 复制到剪贴板；</p><p>g，G 将剪贴板中的数据覆盖/追加到指定行；</p><p>w保存为文件；</p><p>r读取指定文件；</p><p>a 追加指定内容。</p><p>l, i:忽略大小写</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将包含1的行迁移到行尾（H复制到剪贴板---d删除---$G追加到行尾---&quot;；&quot;用于多个操作)</span></span><br><span class="line">$ sed <span class="string">&#x27;/1/&#123;H;d&#125;;$G&#x27;</span> test.txt | sed <span class="string">&#x27;/^$/d&#x27;</span></span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#将1-3行迁移到5行后</span></span><br><span class="line">$ sed <span class="string">&#x27;1,3&#123;H;d&#125;;5G&#x27;</span> test.txt</span><br><span class="line">4 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">5 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line">1 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">2 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line">3 the quick brown fox jumps over the lazy dog . dog</span><br><span class="line"></span><br><span class="line"><span class="comment">#在包含the每行后添加文件hostname内容</span></span><br><span class="line">$ sed <span class="string">&#x27;/the/r /etc/hostname&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#在第3行后插入新行，内容为New</span></span><br><span class="line">$ sed <span class="string">&#x27;3aNew&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#在包含the的每行后插入新行</span></span><br><span class="line">$ sed <span class="string">&#x27;/the/aNew&#x27;</span> test.txt </span><br><span class="line"></span><br><span class="line"><span class="comment">#在第3行后插入多行（\n 换行符）</span></span><br><span class="line">$ sed <span class="string">&#x27;3aNew1\nNew2&#x27;</span> test.txt </span><br></pre></td></tr></table></figure><h3 id="⭐-后向引用，反向引用（括号先保护在使用）">⭐ <strong>后向引用</strong>，<strong>反向引用</strong>（括号先保护在使用）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 123456 | sed -r <span class="string">&#x27;s#(.*)#&lt;/1&gt;#g&#x27;</span></span><br><span class="line">&lt;123456&gt;</span><br></pre></td></tr></table></figure><hr><h1 id="4）awk">4）awk</h1><h2 id="4-1-简介">4.1 简介</h2><p>awk在其对数据分析并生成报告时，显得尤为强大。简单来说awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p><h2 id="4-2-执行过程">4.2 执行过程</h2><p><span style="color:blue;">找谁{干啥}，条件{动作}，pattern{action}</span></p><h2 id="4-3-语法">4.3 语法</h2><p>📌<strong>语法</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;pattern&#123;action&#125;&#x27;</span> &#123;filenames&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4基础用法">4.4基础用法</h2><ul><li><p><strong>行row</strong>：在awk中叫记录（record）。每一行默认通过回车分割。</p></li><li><p><strong>列column</strong>：在awk中叫字段，域（field）。每一列默认通过空格分割。</p></li></ul><h3 id="📌取行">📌<strong>取行</strong></h3><table><thead><tr><th>内置变量</th><th>说明</th></tr></thead><tbody><tr><td>NR==1</td><td>取出第一行</td></tr><tr><td>NR&gt;=1 &amp;&amp; NR&lt;=5</td><td>取出第一行至第五行</td></tr><tr><td>/正则/</td><td>取出匹配条件的行</td></tr><tr><td>//，//</td><td>取出多条匹配条件，并逐行显示</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ awk -F: <span class="string">&#x27;NR==1&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure><h3 id="📌取列">📌<strong>取列</strong></h3><table><thead><tr><th>内置变量</th><th>说明</th><th></th></tr></thead><tbody><tr><td>-F :</td><td>同<code>-v FS=:</code>读取时指定每一列的分隔符为<code>：</code>（默认空格，连续空格，tab）</td><td></td></tr><tr><td>$数字</td><td>取出某一列,awk中$只表示取列</td><td></td></tr><tr><td>$0</td><td>整行内容</td><td></td></tr><tr><td>$NF</td><td>取出最后一列</td><td></td></tr><tr><td>-vOFS=:</td><td>写入时格式化输出分隔符为<code>:</code></td><td></td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将末尾列和第一列对调</span></span><br><span class="line">$ awk -F: <span class="string">&#x27;NR==1 &#123;print $NF,$2,$3,$4,$5,$6,$1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">/bin/bash x 0 0 root /root root</span><br></pre></td></tr></table></figure><h2 id="4-5-条件匹配">4.5 条件匹配</h2><table><caption>表 1 awk支持的主要条件类型</caption><tbody><tr><th>条件类型</th><th>条&nbsp;件</th><th>说&nbsp;明</th></tr><tr><td>awk保留字</td><td>BEGIN</td><td>在 awk 程序一开始，尚未读取任何数据之前执行。BEGIN 后的动作只在程序开始时执行一次</td></tr><tr><td>awk保留字</td><td>END</td><td>在 awk 程序处理完所有数据，即将结束时执行?END 后的动作只在程序结束时执行一次</td></tr><tr><td rowspan="8">关系运算符</td><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>==</td><td>等于。用于判断两个值是否相等。如果是给变童赋值，则使用"=”</td></tr><tr><td>!=</td><td>不等于</td></tr><tr><td>A~B</td><td>判断字符串 A 中是否包含能匹配 B 表达式的子字符串</td></tr><tr><td>A!~B</td><td>判断字符串 A 中是否不包含能匹配 B 表达式的子字符串</td></tr><tr><td>正则表达式</td><td>/正则/</td><td>如果在“//”中可以写入字符，则也可以支持正则表达式</td></tr></tbody></table><h3 id="📌BEGIN">📌BEGIN</h3><p>BEGIN 是 awk 的保留字，是一种特殊的条件类型。BEGIN 的执行时机是&quot;在 awk 程序一开始，尚未读取任何数据之前&quot;。一旦 BEGIN 后的动作执行一次，当 awk 开始从文件中读入数据时，BEGIN 的条件就不再成立。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;printf &quot;This is a transcript\n&quot;&#125; &#123;printf $2 &quot;\t&quot; $6 &quot;\n&quot;&#125;&#x27;</span> student.txt</span><br><span class="line"><span class="comment">#awk命令只要检测不到完整的单引号就不会执行，所以这条命令的换行不用加入&quot;\&quot;，就是一行命令</span></span><br><span class="line"><span class="comment">#这里定义了两个动作</span></span><br><span class="line"><span class="comment">#第一个动作使用BEGIN条件，所以会在读入文件数据前打印&quot;这是一张成绩单&quot;（只会执行一次）</span></span><br><span class="line"><span class="comment">#第二个动作会打印文件的第二个字段和第六个字段</span></span><br><span class="line">This is a transcript</span><br><span class="line">Name Average</span><br><span class="line">Liming 87.66</span><br><span class="line">Sc 85.66</span><br><span class="line">Gao 91.66</span><br></pre></td></tr></table></figure><h3 id="📌END">📌END</h3><p>END 也是 awk 的保留字，不过刚好和 BEGIN 相反。END 是在 awk 程序处理完所有数据，即将结束时执行的。END 后的动作只在程序结束时执行一次。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;END&#123;printf &quot;The End&quot;&#125; &#123;printf $2 &quot;\t&quot; $6 &quot;\n&quot;&#125;&#x27;</span> student.txt</span><br><span class="line"><span class="comment">#输出结尾输入&quot;The End&quot;，这并不是文档本身的内容，而且只会执行一次</span></span><br><span class="line">Name Average</span><br><span class="line">Liming 87.66</span><br><span class="line">Sc 85.66</span><br><span class="line">Gao 91.66</span><br><span class="line">The End</span><br></pre></td></tr></table></figure><h3 id="📌关系运算符">📌关系运算符</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> student.txt | grep -v Name |awk<span class="string">&#x27;$6 &gt;= 87 &#123;printf $2&#x27;</span>\n<span class="string">&quot;&#125;&#x27;</span></span><br><span class="line"><span class="string">#使用cat输出文件内容，用grep取反包含&quot;</span>Name<span class="string">&quot;的行</span></span><br><span class="line"><span class="string">#判断第六个字段（平均成绩）大于等于87分的行，如果判断式成立，则打印第六列（学员名）</span></span><br><span class="line"><span class="string">Liming</span></span><br><span class="line"><span class="string">Gao</span></span><br></pre></td></tr></table></figure><h3 id="📌正则表达式">📌正则表达式</h3><p>如果想让 awk 识别字符串，则必须使用&quot;//&quot;包含</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;/Liming/ &#123;print&#125;&#x27;</span> student.txt</span><br><span class="line"><span class="comment">#打印Liming的成绩</span></span><br><span class="line">1 Liming 82 95 86 87.66</span><br></pre></td></tr></table></figure><p>当使用 df 命令査看分区的使用情况时，如果我只想査看真正的系统分区的使用情况，而不想査看光盘和临时分区的使用情况，则可以这样做</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -h | awk <span class="string">&#x27;/sda[0-9]/ &#123;printf $1 &quot;\t&quot; $5 &quot;\n&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment">#查询包含&quot;sda数字&quot;的行，并打印第一个字段和第五个字段</span></span><br><span class="line">/dev/sda2       12%</span><br><span class="line">/dev/sda1       42%</span><br></pre></td></tr></table></figure><h2 id="4-6数组">4.6数组</h2><p>📌建立数组</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array[index] = value <span class="comment">#数组名array，下标index以及相应的值value。</span></span><br></pre></td></tr></table></figure><p>📌读取数组值</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">for</span> (item <span class="keyword">in</span> array)  <span class="built_in">print</span> array[item]&#125; <span class="comment"># 输出的顺序是随机的</span></span><br><span class="line">&#123;<span class="keyword">for</span>(i=1;i&lt;=len;i++)  <span class="built_in">print</span> array[i]&#125; <span class="comment"># Len 是数组的长度</span></span><br></pre></td></tr></table></figure><p>4.7 循环</p><p>4.8 判断</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenWRT旁路由环境下使用Cloudflare动态DNS（DDNS）服务</title>
      <link href="/posts/80ad88a9.html"/>
      <url>/posts/80ad88a9.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p><strong>服务 -&gt; 动态dns -&gt; ipv4修改</strong>：（没有则自己新建）</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230303-640161d865334.png" alt="image-20230303105616266"></p><p><strong>基本设置</strong>：</p><ul><li>域名处要注意使用<code>@</code>符分割。</li><li>用户名使用登入邮箱</li><li>密码要使用全局秘钥</li></ul><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230303-6401631b56a31.png" alt="image-20230303110146012"></p><p><strong>高级设置</strong>：</p><p>旁路由模式需要修改为url。</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230303-640163c646e3e.png" alt="image-20230303110436747"></p><p><strong>保存修改即可</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式学习笔记</title>
      <link href="/posts/7cb564cd.html"/>
      <url>/posts/7cb564cd.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="Regular-Expression（正则表达式）">Regular Expression（正则表达式）</h1><p><a href="https://jex.im/regulex/#!flags=&amp;re=%5E(a%7Cb)*%3F%24">可视化工具</a></p><h2 id="一、基础正则表达式">一、基础正则表达式</h2><h3 id="1-字符">1.字符</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>[abc]</code></td>      <td>字符集。匹配集合中所含的任一字符。</td>    </tr>    <tr>      <td><code>[^abc]</code></td>      <td>否定字符集。匹配任何不在集合中的字符。</td>    </tr>    <tr>      <td><code>[a-z]</code></td>      <td>字符范围。匹配指定范围内的任意字符。</td>    </tr>    <tr>      <td><code>.</code></td>      <td>匹配除换行符以外的任何单个字符。</td>    </tr>    <tr>      <td><code>\</code></td>      <td>转义字符。</td>    </tr>    <tr>      <td><code>\w</code></td>      <td>匹配任何字母、数字，包括下划线（等价于<code>[A-Za-z0-9_]</code>）。</td>    </tr>    <tr>      <td><code>\W</code></td>      <td>匹配任何非字母、数字（等价于<code>[^A-Za-z0-9_]</code>）。</td>    </tr>    <tr>      <td><code>\d</code></td>      <td>数字。匹配任何数字。</td>    </tr>    <tr>      <td><code>\D</code></td>      <td>非数字。匹配任何非数字字符。</td>    </tr>    <tr>      <td><code>\s</code></td>      <td>空白。匹配任何空白字符，包括空格、制表符等。</td>    </tr>    <tr>      <td><code>\S</code></td>      <td>非空白。匹配任何非空白字符。</td>    </tr>  </tbody></table><h3 id="2-分组和引用">2.分组和引用</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>(expression)</code></td>      <td>分组。匹配括号里的整个表达式。</td>    </tr>    <tr>      <td><code>(?:expression)</code></td>      <td>        非捕获分组。匹配括号里的整个字符串但不获取匹配结果，拿不到分组引用。      </td>    </tr>    <tr>      <td><code>\num</code></td>      <td>        对前面所匹配分组的引用。比如<code>(\d)\1</code>可以匹配两个相同的数字，<code>(Code)(Sheep)\1\2</code>则可以匹配<code>CodeSheepCodeSheep</code>。      </td>    </tr>  </tbody></table><h3 id="3-锚点-边界">3.锚点/边界</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>^</code></td>      <td>匹配字符串或行开头。</td>    </tr>    <tr>      <td><code>$</code></td>      <td>匹配字符串或行结尾。</td>    </tr>    <tr>      <td><code>\b</code></td>      <td>        匹配单词边界。比如<code>Sheep\b</code>可以匹配<code>CodeSheep</code>末尾的<code>Sheep</code>，不能匹配<code>CodeSheepCode</code>中的<code          >Sheep</code        >      </td>    </tr>    <tr>      <td><code>\B</code></td>      <td>        匹配非单词边界。比如<code>Code\B</code>可以匹配<code>HelloCodeSheep</code>中的<code>Code</code>，不能匹配<code>HelloCode</code>中的<code>Code</code>。      </td>    </tr>  </tbody></table><h3 id="4-数量表示">4.数量表示</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>?</code></td>      <td>匹配前面的表达式0个或1个。即表示可选项。</td>    </tr>    <tr>      <td><code>+</code></td>      <td>匹配前面的表达式至少1个。</td>    </tr>    <tr>      <td><code>*</code></td>      <td>匹配前面的表达式0个或多个。</td>    </tr>    <tr>      <td><code>|</code></td>      <td>或运算符。并集，可以匹配符号前后的表达式。</td>    </tr>    <tr>      <td><code>&#123;m&#125;</code></td>      <td>匹配前面的表达式m个。</td>    </tr>    <tr>      <td><code>&#123;m,&#125;</code></td>      <td>匹配前面的表达式最少m个。</td>    </tr>    <tr>      <td><code>&#123;m,n&#125;</code></td>      <td>匹配前面的表达式最少m个，最多n个。</td>    </tr>  </tbody></table><h3 id="5-预查断言">5.预查断言</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>(?=)</code></td>      <td>        正向预查。比如<code>Code(?=Sheep)</code>能匹配<code>CodeSheep</code>中的<code>Code</code>，但不能匹配<code>CodePig</code>中的<code>Code</code>。      </td>    </tr>    <tr>      <td><code>(?!)</code></td>      <td>        正向否定预查。比如<code>Code(?!Sheep)</code>不能匹配<code>CodeSheep</code>中的<code>Code</code>，但能匹配<code>CodePig</code>中的<code>Code</code>。      </td>    </tr>    <tr>      <td><code>(?&lt;=)</code></td>      <td>        反向预查。比如<code>(?&lt;=Code)Sheep</code>能匹配<code>CodeSheep</code>中的<code>Sheep</code>，但不能匹配<code>ReadSheep</code>中的<code>Sheep</code>。      </td>    </tr>    <tr>      <td><code>(?&lt;!)</code></td>      <td>        反向否定预查。比如<code>(?&lt;!Code)Sheep</code>不能匹配<code>CodeSheep</code>中的<code>Sheep</code>，但能匹配<code>ReadSheep</code>中的<code>Sheep</code>。      </td>    </tr>  </tbody></table><h3 id="6-特殊标志">6.特殊标志</h3><table>  <tbody>    <tr>      <td><strong>表达式</strong></td>      <td><strong>描述</strong></td>    </tr>    <tr>      <td><code>/.../i</code></td>      <td>忽略大小写。</td>    </tr>    <tr>      <td><code>/.../g</code></td>      <td>全局匹配。</td>    </tr>    <tr>      <td><code>/.../m</code></td>      <td>多行修饰符。用于多行匹配。</td>    </tr>  </tbody></table><h2 id="二、常用正则表达式">二、常用正则表达式</h2><h3 id="1-数字效验">1.数字效验</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>数字</td>      <td><code>^[0-9]*$</code></td>      <td></td>    </tr>    <tr>      <td>n位数字</td>      <td><code>^\d&#123;n&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>至少n位数字</td>      <td><code>^\d&#123;n,&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>m~n位数字</td>      <td><code>^\d&#123;m,n&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>整数</td>      <td><code>^(-?[1-9]\d*)$</code></td>      <td>非0开头，包括正整数和负整数</td>    </tr>    <tr>      <td>正整数</td>      <td><code>^[1-9]\d*$</code></td>      <td></td>    </tr>    <tr>      <td>负整数</td>      <td><code>^-[1-9]\d*$</code></td>      <td></td>    </tr>    <tr>      <td>非负整数</td>      <td><code>^(([1-9]\d*)|0)$</code></td>      <td></td>    </tr>    <tr>      <td>非正整数</td>      <td><code>^((-[1-9]\d*)|0)$</code></td>      <td></td>    </tr>    <tr>      <td>浮点数</td>      <td><code>^-?(?:[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0\.0+|0)$</code></td>      <td>包括正浮点数和负浮点数</td>    </tr>    <tr>      <td>正浮点数</td>      <td><code>^(?:[1-9]\d*\.\d*|0\.\d*[1-9]\d*)$</code></td>      <td></td>    </tr>    <tr>      <td>负浮点数</td>      <td><code>^-(?:[1-9]\d*\.\d*|0\.\d*[1-9]\d*)$</code></td>      <td></td>    </tr>    <tr>      <td>非正浮点数</td>      <td><code>^(?:-(?:[1-9]\d*\.\d+|0\.\d*[1-9]\d*)|0\.0+|0)$</code></td>      <td>包含0</td>    </tr>    <tr>      <td>非负浮点数</td>      <td><code>^(?:[1-9]\d*\.\d+|0\.\d+|0\.0+|0)$</code></td>      <td>包含0</td>    </tr>    <tr>      <td>仅一位小数</td>      <td><code>^-?(?:0|[1-9][0-9]*)\.[0-9]&#123;1&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>最少一位小数</td>      <td><code>^-?(?:0|[1-9][0-9]*)\.[0-9]&#123;1,&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>最多两位小数</td>      <td><code>^-?(?:0|[1-9][0-9]*)\.[0-9]&#123;1,2&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>连续重复的数字</td>      <td><code>^(\d)\1+$</code></td>      <td>例如：<code>111</code>，<code>222</code></td>    </tr>  </tbody></table><h3 id="2-字符校验">2.字符校验</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>中文</td>      <td><code>^[\u4E00-\u9FA5]+$</code></td>      <td></td>    </tr>    <tr>      <td>全角字符</td>      <td><code>^[\uFF00-\uFFFF]+$</code></td>      <td></td>    </tr>    <tr>      <td>半角字符</td>      <td><code>^[\u0000-\u00FF]+$</code></td>      <td></td>    </tr>    <tr>      <td>英文字符串（大写）</td>      <td><code>^[A-Z]+$</code></td>      <td></td>    </tr>    <tr>      <td>英文字符串（小写）</td>      <td><code>^[a-z]+$</code></td>      <td></td>    </tr>    <tr>      <td>英文字符串（不区分大小写）</td>      <td><code>^[A-Za-z]+$</code></td>      <td></td>    </tr>    <tr>      <td>中文和数字</td>      <td><code>^(?:[\u4E00-\u9FA5]&#123;0,&#125;|\d)+$</code></td>      <td></td>    </tr>    <tr>      <td>英文和数字</td>      <td><code>^[A-Za-z0-9]+$</code></td>      <td></td>    </tr>    <tr>      <td>数字、英文字母或者下划线组成的字符串</td>      <td><code>^\w+$</code></td>      <td></td>    </tr>    <tr>      <td>中文、英文、数字包括下划线</td>      <td><code>^[\u4E00-\u9FA5\w]+$</code></td>      <td></td>    </tr>    <tr>      <td>不含字母的字符串</td>      <td><code>^[^A-Za-z]*$</code></td>      <td></td>    </tr>    <tr>      <td>连续重复的字符串</td>      <td><code>^(.)\1+$</code></td>      <td>例如：<code>aa</code>，<code>bb</code></td>    </tr>    <tr>      <td>长度为n的字符串</td>      <td><code>^.&#123;n&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>ASCII</td>      <td><code>^[ -~]$</code></td>      <td></td>    </tr>  </tbody></table><h3 id="3-日期与时间校验">3.日期与时间校验</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>日期</td>      <td>        <code>^\d&#123;1,4&#125;-(?:1[0-2]|0?[1-9])-(?:0?[1-9]|[1-2]\d|30|31)$</code>      </td>      <td>弱校验，例如：<code>2022-06-12</code></td>    </tr>    <tr>      <td>日期</td>      <td>        <code          >^(?:(?!0000)[0-9]&#123;4&#125;-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$</code        >      </td>      <td>严格校验，考虑平闰年</td>    </tr>    <tr>      <td>时间</td>      <td><code>^(?:1[0-2]|0?[1-9]):[0-5]\d:[0-5]\d$</code></td>      <td>12小时制，例如：<code>11:21:31</code></td>    </tr>    <tr>      <td>时间</td>      <td><code>^(?:[01]\d|2[0-3]):[0-5]\d:[0-5]\d$</code></td>      <td>24小时制，例如：<code>23:21:31</code></td>    </tr>    <tr>      <td>日期+时间</td>      <td>        <code          >^(\d&#123;1,4&#125;-(?:1[0-2]|0?[1-9])-(?:0?[1-9]|[1-2]\d|30|31))          ((?:[01]\d|2[0-3]):[0-5]\d:[0-5]\d)$</code        >      </td>      <td>例如：<code>2000-11-11 23:20:21</code></td>    </tr>  </tbody></table><h3 id="4-日常生活相关">4.日常生活相关</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>中文名</td>      <td><code>^[\u4E00-\u9FA5·]&#123;2,16&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>英文名</td>      <td><code>^[a-zA-Z][a-zA-Z\s]&#123;0,20&#125;[a-zA-Z]$</code></td>      <td></td>    </tr>    <tr>      <td>车牌号</td>      <td>        <code          >^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领][A-HJ-NP-Z][A-HJ-NP-Z0-9]&#123;4&#125;[A-HJ-NP-Z0-9挂学警港澳]$</code        >      </td>      <td>不含新能源</td>    </tr>    <tr>      <td>车牌号</td>      <td>        <code          >^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领][A-HJ-NP-Z](?:(?:[A-HJ-NP-Z0-9]&#123;4&#125;[A-HJ-NP-Z0-9挂学警港澳])|(?:(?:\d&#123;5&#125;[A-HJK])|(?:[A-HJK][A-HJ-NP-Z0-9][0-9]&#123;4&#125;)))$</code        >      </td>      <td>包含新能源</td>    </tr>    <tr>      <td>火车车次</td>      <td><code>^[GCDZTSPKXLY1-9]\d&#123;1,4&#125;$</code></td>      <td>例如：<code>G1234</code></td>    </tr>    <tr>      <td>手机号</td>      <td><code>^(?:(?:\+|00)86)?1[3-9]\d&#123;9&#125;$</code></td>      <td>弱匹配</td>    </tr>    <tr>      <td>手机号</td>      <td>        <code          >^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[189]))\d&#123;8&#125;$</code        >      </td>      <td>严格匹配</td>    </tr>    <tr>      <td>固话号码</td>      <td><code>^(?:(?:\d&#123;3&#125;-)?\d&#123;8&#125;|^(?:\d&#123;4&#125;-)?\d&#123;7,8&#125;)(?:-\d+)?$</code></td>      <td></td>    </tr>    <tr>      <td>手机IMEI码</td>      <td><code>^\d&#123;15,17&#125;$</code></td>      <td>一般是15位</td>    </tr>    <tr>      <td>邮编</td>      <td>        <code          >^(?:0[1-7]|1[0-356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[0-5]|8[013-6])\d&#123;4&#125;$</code        >      </td>      <td>例如：<code>211100</code></td>    </tr>    <tr>      <td>统一社会信用代码</td>      <td><code>^[0-9A-HJ-NPQRTUWXY]&#123;2&#125;\d&#123;6&#125;[0-9A-HJ-NPQRTUWXY]&#123;10&#125;$</code></td>      <td></td>    </tr>    <tr>      <td>身份证号码(1代)</td>      <td>        <code>^[1-9]\d&#123;7&#125;(?:0\d|10|11|12)(?:0[1-9]|[1-2][\d]|30|31)\d&#123;3&#125;$</code>      </td>      <td>15位数字</td>    </tr>    <tr>      <td>身份证号码(2代)</td>      <td>        <code          >^[1-9]\d&#123;5&#125;(?:18|19|20)\d&#123;2&#125;(?:0[1-9]|10|11|12)(?:0[1-9]|[1-2]\d|30|31)\d&#123;3&#125;[0-9Xx]$</code        >      </td>      <td>18位数字</td>    </tr>    <tr>      <td>QQ号</td>      <td><code>^[1-9][0-9]&#123;4,&#125;$</code></td>      <td>一般是5到10位</td>    </tr>    <tr>      <td>微信号</td>      <td><code>^[a-zA-Z][-_a-zA-Z0-9]&#123;5,19&#125;$</code></td>      <td>一般6~20位，字母开头，可包含字母、数字、-、_，不含特殊字符</td>    </tr>    <tr>      <td>股票代码</td>      <td>        <code          >^(s[hz]|S[HZ])(000[\d]&#123;3&#125;|002[\d]&#123;3&#125;|300[\d]&#123;3&#125;|600[\d]&#123;3&#125;|60[\d]&#123;4&#125;)$</code        >      </td>      <td>A股，例如：<code>600519</code></td>    </tr>    <tr>      <td>银行卡卡号</td>      <td><code>^[1-9]&#123;1&#125;(?:\d&#123;15&#125;|\d&#123;18&#125;)$</code></td>      <td>一般为19位</td>    </tr>  </tbody></table><h3 id="5-互联网相关">5.互联网相关</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>域名</td>      <td>        <code          >^[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(?:\.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+$</code        >      </td>      <td>例如：<code>r2coding.com</code></td>    </tr>    <tr>      <td>网址</td>      <td>        <code          >^(?:https?:\/\/)?[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(?:\.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+$</code        >      </td>      <td>例如：<code>https://www.r2coding.com/</code></td>    </tr>    <tr>      <td>带端口号的网址(或IP)</td>      <td><code>^(?:https?:\/\/)?[\w-]+(?:\.[\w-]+)+:\d&#123;1,5&#125;\/?$</code></td>      <td>例如：<code>http://127.0.0.1:8888/</code></td>    </tr>    <tr>      <td>URL</td>      <td>        <code          >^https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]&#123;1,256&#125;\.[a-zA-Z0-9()]&#123;1,6&#125;\b(?:[-a-zA-Z0-9()!@:%_\+.~#?&amp;\/\/=]*)$</code        >      </td>      <td>例如：<code>https://www.r2coding.com/#/README?id=1</code></td>    </tr>    <tr>      <td>邮箱email</td>      <td>        <code          >^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(?:\.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+$</code        >      </td>      <td>支持中文，例如：<code>codesheep@cs.com</code></td>    </tr>    <tr>      <td>用户名</td>      <td><code>^[a-zA-Z0-9_-]&#123;4,20&#125;$</code></td>      <td>4到20位</td>    </tr>    <tr>      <td>弱密码</td>      <td><code>^[\w]&#123;6,16&#125;$</code></td>      <td>6~16位，包含大小写字母和数字的组合</td>    </tr>    <tr>      <td>强密码</td>      <td>        <code          >^.*(?=.&#123;6,&#125;)(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@\.#$%^&amp;*?          ]).*$</code        >      </td>      <td>至少6位，包括至少1个大写字母，1个小写字母，1个数字，1个特殊字符</td>    </tr>    <tr>      <td>端口号</td>      <td>        <code          >^(?:[0-9]|[1-9][0-9]&#123;1,3&#125;|[1-5][0-9]&#123;4&#125;|6[0-4][0-9]&#123;3&#125;|65[0-4][0-9]&#123;2&#125;|655[0-2][0-9]|6553[0-5])$</code        >      </td>      <td>例如：<code>65535</code></td>    </tr>    <tr>      <td>IPv4地址</td>      <td>        <code          >^(?:(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$</code        >      </td>      <td>例如：<code>192.168.31.1</code></td>    </tr>    <tr>      <td>IPv4地址+端口</td>      <td>        <code          >^(?:(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.)&#123;3&#125;(?:\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])(?::(?:[0-9]|[1-9][0-9]&#123;1,3&#125;|[1-5][0-9]&#123;4&#125;|6[0-4][0-9]&#123;3&#125;|65[0-4][0-9]&#123;2&#125;|655[0-2][0-9]|6553[0-5]))?$</code        >      </td>      <td>例如：<code>192.168.31.1:8080</code></td>    </tr>    <tr>      <td>IPv6地址</td>      <td>        <code          >^(([0-9a-fA-F]&#123;1,4&#125;:)&#123;7,7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9]))$</code        >      </td>      <td>例如：<code>CDCD:910A:2222:5498:8475:1111:3900:2020</code></td>    </tr>    <tr>      <td>IPv6地址+端口</td>      <td>        <code          >^\[(([0-9a-fA-F]&#123;1,4&#125;:)&#123;7,7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9]))\](?::(?:[0-9]|[1-9][0-9]&#123;1,3&#125;|[1-5][0-9]&#123;4&#125;|6[0-4][0-9]&#123;3&#125;|65[0-4][0-9]&#123;2&#125;|655[0-2][0-9]|6553[0-5]))?$</code        >      </td>      <td>例如：<code>[CDCD:910A:2222:5498:8475:1111:3900:2020]:9800</code></td>    </tr>    <tr>      <td>子网掩码</td>      <td>        <code          >^(?:254|252|248|240|224|192|128)\.0\.0\.0|255\.(?:254|252|248|240|224|192|128|0)\.0\.0|255\.255\.(?:254|252|248|240|224|192|128|0)\.0|255\.255\.255\.(?:255|254|252|248|240|224|192|128|0)$</code        >      </td>      <td>例如：<code>255.255.255.0</code></td>    </tr>    <tr>      <td>MAC地址</td>      <td>        <code          >^(?:(?:[a-f0-9A-F]&#123;2&#125;:)&#123;5&#125;|(?:[a-f0-9A-F]&#123;2&#125;-)&#123;5&#125;)[a-f0-9A-F]&#123;2&#125;$</code        >      </td>      <td></td>    </tr>    <tr>      <td>Version版本号</td>      <td><code>^\d+(?:\.\d+)&#123;2&#125;$</code></td>      <td>例如：<code>12.1.1</code></td>    </tr>    <tr>      <td>图片后缀</td>      <td><code>\.(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)+</code></td>      <td>可按需增删扩展名集合</td>    </tr>    <tr>      <td>视频后缀</td>      <td><code>\.(swf|avi|flv|mpg|rm|mov|wav|asf|3gp|mkv|rmvb|mp4)+</code></td>      <td>可按需增删扩展名集合</td>    </tr>    <tr>      <td>图片链接</td>      <td>        <code          >(?:https?:\/\/)?[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(?:\.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+.+\.(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif)</code        >      </td>      <td>可按需增删扩展名集合</td>    </tr>    <tr>      <td>视频链接</td>      <td>        <code          >(?:https?:\/\/)?[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(?:\.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+.+\.(swf|avi|flv|mpg|rm|mov|wav|asf|3gp|mkv|rmvb|mp4)</code        >      </td>      <td>可按需增删扩展名集合</td>    </tr>    <tr>      <td>迅雷链接</td>      <td><code>thunderx?:\/\/[a-zA-Z\d]+=</code></td>      <td></td>    </tr>    <tr>      <td>ed2k链接</td>      <td><code>ed2k:\/\/\|file\|.+\|\/</code></td>      <td></td>    </tr>    <tr>      <td>磁力链接</td>      <td><code>magnet:\?xt=urn:btih:[0-9a-fA-F]&#123;40,&#125;.*</code></td>      <td></td>    </tr>  </tbody></table><h3 id="6-其它">6.其它</h3><table>  <tbody>    <tr>      <td><strong>描述</strong></td>      <td><strong>正则表达式</strong></td>      <td><strong>备注</strong></td>    </tr>    <tr>      <td>MD5格式</td>      <td><code>^(?:[a-f\d]&#123;32&#125;|[A-F\d]&#123;32&#125;)$</code></td>      <td>32位MD5，例如：<code>7552E7071B118CBFFEC8C930455B4297</code></td>    </tr>    <tr>      <td>BASE64格式</td>      <td>        <code          >^\s*data:(?:[a-z]+\/[a-z0-9-+.]+(?:;[a-z-]+=[a-z0-9-]+)?)?(?:;base64)?,([a-z0-9!$&amp;',()*+;=\-._~:@/?%\s]*?)\s*$</code        >      </td>      <td>例如：<code>data:image/jpeg;base64,xxxx==</code></td>    </tr>    <tr>      <td>UUID</td>      <td><code>^[a-f\d]&#123;4&#125;(?:[a-f\d]&#123;4&#125;-)&#123;4&#125;[a-f\d]&#123;12&#125;$</code></td>      <td>例如：<code>94f9d45a-71b0-4b3c-b69d-20c4bc9c8fdd</code></td>    </tr>    <tr>      <td>16进制</td>      <td><code>^[A-Fa-f0-9]+$</code></td>      <td>例如：<code>FFFFFF</code></td>    </tr>    <tr>      <td>16进制颜色</td>      <td><code>^#?([0-9a-fA-F]&#123;3&#125;|[0-9a-fA-F]&#123;6&#125;)$</code></td>      <td>例如：<code>#FFFFFF</code></td>    </tr>    <tr>      <td>SQL语句</td>      <td><code>^(?:select|drop|delete|create|update|insert).*$</code></td>      <td></td>    </tr>    <tr>      <td>Java包名</td>      <td><code>^(?:[a-zA-Z_]\w*)+(?:[.][a-zA-Z_]\w*)+$</code></td>      <td>例如：<code>com.r2coding.controller</code></td>    </tr>    <tr>      <td>文件扩展名</td>      <td><code>\.(?:doc|pdf|txt)</code></td>      <td>可按需增删扩展名集合</td>    </tr>    <tr>      <td>Windows文件路径</td>      <td>        <code>^[a-zA-Z]:(?:\\[\w\u4E00-\u9FA5\s]+)+[.\w\u4E00-\u9FA5\s]+$</code>      </td>      <td>例如：<code>C:\Users\Administrator\Desktop\a.txt</code></td>    </tr>    <tr>      <td>Windows文件夹路径</td>      <td><code>^[a-zA-Z]:(?:\\[\w\u4E00-\u9FA5\s]+)+$</code></td>      <td>例如：<code>C:\Users\Administrator\Desktop</code></td>    </tr>    <tr>      <td>Linux文件路径</td>      <td><code>^\/(?:[^/]+\/)*[^/]+$</code></td>      <td>例如：<code>/root/library/a.txt</code></td>    </tr>    <tr>      <td>Linux文件夹路径</td>      <td><code>^\/(?:[^/]+\/)*$</code></td>      <td>例如：<code>/root/library/</code></td>    </tr>  </tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Flask 学习笔记</title>
      <link href="/posts/b275d48c.html"/>
      <url>/posts/b275d48c.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）简介">1）简介</h1><p><strong>Flask是一个轻量级的基于Python的web框架</strong>。</p><p>Flask依赖三个库：</p><ul><li>Jinja2 模板引擎</li><li>Werkzeub WSGI工具集</li><li>Itsdangerous 基于Django的签名模块</li></ul><hr><h1 id="2）安装">2）安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install Flask</span><br></pre></td></tr></table></figure><p>进入python交互模式看下Flask的介绍和版本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ python3</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; import flask</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(flask.__doc__)</span><br><span class="line">    flask</span><br><span class="line">    ~~~~~</span><br><span class="line"> </span><br><span class="line">    A microframework based on Werkzeug.  It<span class="string">&#x27;s extensively documented</span></span><br><span class="line"><span class="string">    and follows best practice patterns.</span></span><br><span class="line"><span class="string">    :copyright: © 2010 by the Pallets team.</span></span><br><span class="line"><span class="string">    :license: BSD, see LICENSE for more details.</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; print(flask.__version__)</span></span><br><span class="line"><span class="string">1.0.2</span></span><br></pre></td></tr></table></figure><hr><h1 id="3）基础">3）基础</h1><h2 id="3-1-Hello-World">3.1 Hello World</h2><p>📌<strong>建立Flask项目HelloWorld</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> HelloWorld</span><br><span class="line"><span class="built_in">mkdir</span> HelloWorld/static</span><br><span class="line"><span class="built_in">mkdir</span> HelloWorld/templates</span><br><span class="line"><span class="built_in">touch</span> HelloWorld/app.py</span><br></pre></td></tr></table></figure><p><code>static</code>和<code>templates</code>目录是默认配置，其中<code>static</code>用来存放静态资源，例如图片、js、css文件等。<code>templates</code>存放html模板文件。我们的网站逻辑基本在<code>app.py</code>文件中，当然，也可以给这个文件起其他的名字。</p><p>📌<strong>在<code>app.py</code>中加入以下内容</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>📌<strong>运行<code>app.py</code></strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 app.py </span><br><span class="line"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure><p>打开浏览器访问<code>http://127.0.0.1:5000/</code>，浏览页面上将出现<code>Hello World!</code>。终端里会显示下面的信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 - - [16/May/2014 10:29:08] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure><p>变量app是一个Flask实例，通过下面的方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br></pre></td></tr></table></figure><p>当客户端访问<code>/</code>时，将响应<code>hello_world()</code>函数返回的内容。注意，这不是返回<code>Hello World!</code>这么简单，<code>Hello World!</code>只是HTTP响应报文的实体部分，状态码等信息既可以由Flask自动处理，也可以通过编程来制定。</p><h2 id="3-2-修改Flask的配置">3.2 修改Flask的配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure><p>上面的代码中，python内置变量<code>__name__</code>的值是字符串<code>__main__</code> 。Flask类将这个参数作为程序名称。当然这个是可以自定义的，比如<code>app = Flask(&quot;my-app&quot;)</code>。</p><p>Flask默认使用<code>static</code>目录存放静态资源，<code>templates</code>目录存放模板，这是可以通过设置参数更改的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(<span class="string">&quot;my-app&quot;</span>, static_folder=<span class="string">&quot;path1&quot;</span>, template_folder=<span class="string">&quot;path2&quot;</span>)</span><br></pre></td></tr></table></figure><p>更多参数请参考<code>__doc__</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="built_in">print</span>(Flask.__doc__)</span><br></pre></td></tr></table></figure><h2 id="3-3-调试模式">3.3 调试模式</h2><p>上面的app.py中以<code>app.run()</code>方式运行，这种方式下，如果服务器端出现错误是不会在客户端显示的。但是在开发环境中，显示错误信息是很有必要的，要显示错误信息，应该以下面的方式运行Flask：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(debug=True)</span><br></pre></td></tr></table></figure><p>将<code>debug</code>设置为<code>True</code>的另一个好处是，程序启动后，会自动检测源码是否发生变化，若有变化则自动重启程序。这可以帮我们省下很多时间。</p><h3 id="3-4-绑定IP和端口">3.4 绑定IP和端口</h3><p>默认情况下，Flask绑定IP为<code>127.0.0.1</code>，端口为<code>5000</code>。我们也可以通过下面的方式自定义：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><code>0.0.0.0</code>代表电脑所有的IP。<code>80</code>是HTTP网站服务的默认端口。什么是默认？比如，我们访问网站<code>http://www.example.com</code>，其实是访问的<code>http://www.example.com:80</code>，只不过<code>:80</code>可以省略不写。</p><p>由于绑定了80端口，需要使用root权限运行<code>app.py</code>。也就是：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python3 app.py</span><br></pre></td></tr></table></figure><h1 id="4）">4）</h1><h1 id="📌request">📌request</h1><p><strong>传递参数</strong>：</p><p><a href="http://app.py">app.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 带参数的url：将参数固定到path中</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/blog/&lt;int:blog_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blog_detail</span>(<span class="params">blog_id</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;您访问的是第 %s 号博客&quot;</span> % blog_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># /book/list：会返回第一页的数据</span></span><br><span class="line"><span class="comment"># /book/list?page=2：会返回第二页的数据</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/book/list&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">book_list</span>():</span><br><span class="line">    <span class="comment"># argument:参数</span></span><br><span class="line">    <span class="comment"># request.args：类字典类型</span></span><br><span class="line">    page = request.args.get(<span class="string">&quot;page&quot;</span>, default=<span class="number">1</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;您获取的是<span class="subst">&#123;page&#125;</span>页！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><h1 id="📌-render-template-封装了Jinja2">📌 render_template(封装了Jinja2)</h1><p>index.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>您访问的博客是： &#123;&#123; blog_id &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://app2.py">app2.py</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/blog/&lt;int:blog_id&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blog_detail</span>(<span class="params">blog_id</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;blog_detail.html&quot;</span>, blog_id=blog_id)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> flask </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker 安装 Alist</title>
      <link href="/posts/f463bb27.html"/>
      <url>/posts/f463bb27.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><blockquote><p><a href="https://alist.nn.ci/zh/">Alist官网</a> <a href="https://github.com/alist-org/alist">Github</a></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230227074909040.png" alt="image-20230227074909040"></p></blockquote><h1 id="1）安装">1）安装</h1><h2 id="docker-cli">docker-cli</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart=always -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=<span class="string">&quot;alist&quot;</span> xhofe/alist:latest</span><br></pre></td></tr></table></figure><h2 id="docker-compose">docker-compose</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">alist:</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;/etc/alist:/opt/alist/data&#x27;</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;5244:5244&#x27;</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PUID=0</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">PGID=0</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">UMASK=022</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">alist</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&#x27;xhofe/alist:latest&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="aria2版本">aria2版本</h2><p>如果你想使用aria2离线下载，推荐你使用这个下面这个版本，它预装了aria2。</p><p><a href="https://hub.docker.com/r/xhofe/alist-aria2">https://hub.docker.com/r/xhofe/alist-aria2</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --restart=always -v /etc/alist:/opt/alist/data -p 5244:5244 -e PUID=0 -e PGID=0 -e UMASK=022 --name=<span class="string">&quot;alist&quot;</span> xhofe/alist-aria2:latest</span><br></pre></td></tr></table></figure><h1 id="2）查询密码">2）查询密码</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it alist ./alist admin</span><br></pre></td></tr></table></figure><h1 id="3）更新">3）更新</h1><h2 id="docker-cli-v2">docker-cli</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop alist</span><br><span class="line">docker <span class="built_in">rm</span> alist</span><br><span class="line">docker pull xhofe/alist:latest</span><br></pre></td></tr></table></figure><p>然后再次输入安装命令</p><h2 id="docker-compose-v2">docker-compose</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br><span class="line">docker-compose pull</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tool </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Debian设置为静态网络</title>
      <link href="/posts/559234b6.html"/>
      <url>/posts/559234b6.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）查看网卡">1）查看网卡</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">ip addr</span><br></pre></td></tr></table></figure><h1 id="2）修改配置文件">2）修改配置文件</h1><p>查看配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/network/interfaces</span><br><span class="line"><span class="built_in">cd</span> /etc/network/interfaces/interfaces.d</span><br><span class="line">sudo <span class="built_in">touch</span> eth1</span><br><span class="line">vi eth1</span><br></pre></td></tr></table></figure><p>比如我要修改eth1：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 10.10.10.155</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 10.10.10.2</span><br><span class="line">dns-nameservers 8.8.4.4 8.8.8.8</span><br></pre></td></tr></table></figure><blockquote><p>auto eth1 #开机自动连接网络<br>iface eth1 inet static #static表示使用固定ip，dhcp表述使用动态ip<br>address 10.10.10.155 #设置ip地址<br>netmask 255.255.255.0 #设置子网掩码<br>gateway 10.10.10.2 #设置网关<br>dns-nameservers 8.8.4.4 8.8.8.8</p></blockquote><h1 id="3）重启系统服务">3）重启系统服务</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart NetworkManager.service</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> OS </category>
          
          <category> Debian </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker 安装 openwrt</title>
      <link href="/posts/39dcc97.html"/>
      <url>/posts/39dcc97.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="更新日志：">更新日志：</h1><p><strong>v1.0 Docker 安装openwrt（20230226）</strong></p><h1 id="1）打开网卡混杂模式">1）打开网卡混杂模式</h1><p>查看本机的网卡信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br></pre></td></tr></table></figure><ul><li><p><strong>临时打开</strong></p><p>打开<code>eth0</code>混杂模式：(根据自己的网卡修改)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 promisc on</span><br></pre></td></tr></table></figure></li><li><p><strong>永久打开</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/rc.local</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 promisc on</span><br></pre></td></tr></table></figure></li></ul><p>打开后网卡信息：</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230305-64042600de3c3.png" alt="0"></p><hr><h1 id="2）在docker中为openwrt设定网络">2）在docker中为openwrt设定网络</h1><p>(根据自己的网卡修改<code>parent=eth0</code>)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d macvlan --subnet=192.168.123.0/24 --gateway=192.168.123.1 -o parent=eth0 openwrt</span><br></pre></td></tr></table></figure><hr><h1 id="3）启动openwrt容器">3）启动openwrt容器</h1><p>1️⃣查看自己机器的架构：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -a</span><br></pre></td></tr></table></figure><p>选择合适的版本：</p><p>原项目地址：<a href="https://github.com/SuLingGG/OpenWrt-Docker">https://github.com/SuLingGG/OpenWrt-Docker</a></p><table><thead><tr><th align="center">支持设备/平台</th><th align="center">DockerHub</th><th align="center">阿里云镜像仓库 (上海)</th></tr></thead><tbody><tr><td align="center">树莓派 1B</td><td align="center">sulinggg/openwrt:rpi1</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:rpi1</td></tr><tr><td align="center">树莓派 2B</td><td align="center">sulinggg/openwrt:rpi2</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:rpi2</td></tr><tr><td align="center">树莓派 3B / 3B+</td><td align="center">sulinggg/openwrt:rpi3</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:rpi3</td></tr><tr><td align="center">树莓派 4B</td><td align="center">sulinggg/openwrt:rpi4</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:rpi4</td></tr><tr><td align="center">armv7</td><td align="center">sulinggg/openwrt:armv7</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:armv7</td></tr><tr><td align="center">arm8/aarch64</td><td align="center">sulinggg/openwrt:armv8</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:armv8</td></tr><tr><td align="center">x86_64/amd64</td><td align="center">sulinggg/openwrt:x86_64</td><td align="center">registry.cn-shanghai.aliyuncs.com/suling/openwrt:x86_64</td></tr></tbody></table><p>2️⃣启动openwrt容器：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --privileged=<span class="literal">true</span> --restart=always \</span><br><span class="line">--network=openwrt \</span><br><span class="line">--name openwrt \</span><br><span class="line">-v /data/openwrt/config:/etc/config</span><br><span class="line">-d registry.cn-shanghai.aliyuncs.com/suling/openwrt:armv8 \</span><br><span class="line">/sbin/init</span><br></pre></td></tr></table></figure><p>3️⃣进入容器进行网络设置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">exec</span> -it openwrt bash</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/config/network</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230226235724060.png" alt="image-20230226235724060"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#旁路由参考设置</span></span><br><span class="line">config interface <span class="string">&#x27;lan&#x27;</span></span><br><span class="line">        option ifname <span class="string">&#x27;eth0&#x27;</span></span><br><span class="line">        option proto <span class="string">&#x27;static&#x27;</span></span><br><span class="line">        option netmask <span class="string">&#x27;255.255.255.0&#x27;</span></span><br><span class="line">        option gateway <span class="string">&#x27;192.168.123.1&#x27;</span></span><br><span class="line">        option ip6assign <span class="string">&#x27;60&#x27;</span></span><br><span class="line">        option dns <span class="string">&#x27; 8.8.8.8 114.114.114.114&#x27;</span></span><br><span class="line">        option ipaddr <span class="string">&#x27;192.168.123.254&#x27;</span></span><br><span class="line">        option broadcast <span class="string">&#x27;192.168.123.255&#x27;</span></span><br></pre></td></tr></table></figure><p>按<code>i</code>修改，<code>Esc</code> <code>:wq</code>保存后退出</p><p>4️⃣重启网络并退出容器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/network restart</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><hr><h1 id="4）设置openwrt">4）设置openwrt</h1><p>使用你设置的ip在浏览器进入openwrt登入界面，默认密码为<code>password</code></p><p>首先网络配置：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230227001542449.png" alt="image-20230227001542449"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230227003458427.png" alt="image-20230227003458427"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230227002329803.png" alt="image-20230227002329803"></p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>常用 SSH 工具介绍</title>
      <link href="/posts/c671c1ec.html"/>
      <url>/posts/c671c1ec.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）Putty">1）Putty</h1><p>putty是最简单的SSH工具，无需安装，支持多系统版本，下载后就可以直接使用。</p><p>推荐指数：⭐⭐<br>下载地址：<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">https://www.chiark.greenend.org.uk/~sgtatham/putty/</a></p><h1 id="2）XShell">2）XShell</h1><p>XShell 功能较为强大，且操作方便简单，它选项卡式界面，可以同时在一个窗口显示连接多个主机，还有树状直观的主机连接管理。</p><p>推荐指数：⭐⭐⭐<br>下载地址：<a href="https://xshell.en.softonic.com/">https://xshell.en.softonic.com/</a></p><h1 id="3）Mobaxterm">3）Mobaxterm</h1><p>mobaxterm工具其 主要面向的用户是网络管理人员，但也可以用来当ssh工具使用。可以说这是我目前用过的最满意的一款SSH工具，可以说是一个神器，它本身支持SSH、FTP、SFTP浏览器、Xserver等系列工具，各位老爷感兴趣的可以自己去发掘。</p><p>推荐指数：⭐⭐⭐⭐⭐<br>下载地址：<a href="https://mobaxterm.mobatek.net/">https://mobaxterm.mobatek.net/</a></p><h1 id="4）FinalShell">4）FinalShell</h1><p>高效，是我对这款软件的第一印象。软件打开时，层次分明，软件左侧是系统信息，包含服务器的IP地址、运行时间，负载均衡、以及CPU、内存与交换的直观展示。在软件的中部是命令操作界面，深色的底蕴加上白色的文字，显得恰到好处。下方是文件管理，不需要多余的操作就能方便的管理文件，直接拖拽就能上下载文件。而且，值得一说的这是国人开发的，不需要考虑汉化的问题。</p><p>推荐指数：⭐⭐⭐⭐<br>下载地址：<a href="http://www.hostbuf.com/">http://www.hostbuf.com/</a></p><h1 id="5）SecureCRT">5）SecureCRT</h1><p>SecureCRT这也是我用的比较长时间一款SSH工具，功能和xshell差不多，总的感觉就是比上不足、比下有余。</p><p>推荐指数：⭐⭐⭐<br>下载地址：<a href="https://www.vandyke.com/">https://www.vandyke.com/</a></p><h1 id="6）Rstudio">6）Rstudio</h1><p>现在的Rstudio能都连接本地终端，如果是在服务器端，就可以登录服务器。也就是不需要任何工具，只在任何浏览器中登录Rstudio-server，就可以直接连接服务器，非常方便。它的优势不言自明，无需携带安装你熟悉的工具，只需要通过浏览器登录既可访问服务器。</p><p>推荐指数：⭐⭐<br>下载地址：<a href="https://posit.co/products/open-source/rstudio/">https://posit.co/products/open-source/rstudio/</a></p>]]></content>
      
      
      <categories>
          
          <category> Tool </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Debian安装Docker</title>
      <link href="/posts/6c0b0bfc.html"/>
      <url>/posts/6c0b0bfc.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）卸载旧版本">1）卸载旧版本</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#remove：清除软件包</span></span><br><span class="line">$ sudo apt-get remove docker docker-engine docker.io containerd runc</span><br><span class="line"><span class="comment">#purge：清除软件包并删除配置文件</span></span><br><span class="line">$ sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br><span class="line">$ sudo <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line">$ sudo <span class="built_in">rm</span> -rf /var/lib/containerd</span><br></pre></td></tr></table></figure><hr><h1 id="2）使用-APT-安装">2）使用 APT 安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖包</span></span><br><span class="line">$ sudo apt-get install dialog<span class="comment"># 单独拿出来 放一起会报错</span></span><br><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br></pre></td></tr></table></figure><p>鉴于国内网络问题，强烈建议使用国内源，官方源请在注释中查看。</p><p>为了确认所下载软件包的合法性，需要添加软件源的 GPG 密钥。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment">## 官方源</span></span><br><span class="line"><span class="comment"># $ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span></span><br><span class="line"></span><br><span class="line">$ sudo <span class="built_in">chmod</span> a+r /usr/share/keyrings/docker-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>然后，我们需要向 sources.list 中添加 Docker 软件源：</p><p>在一些基于 Debian 的 Linux 发行版中 $(lsb_release -cs) 可能不会返回 Debian 的版本代号，例如 Kail Linux (opens new window)、 BunsenLabs Linux (opens new window)。在这些发行版中我们需要将下面命令中的 $(lsb_release -cs) 替换为 <code>https://mirrors.aliyun.com/docker-ce/linux/debian/dists/</code> 中支持的 Debian 版本代号，例如 buster。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入软件源信息</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] http://mirrors.aliyun.com/docker-ce/linux/debian <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方源</span></span><br><span class="line"><span class="comment"># $ echo \</span></span><br><span class="line"><span class="comment">#   &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \</span></span><br><span class="line"><span class="comment">#   $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span><br></pre></td></tr></table></figure><p>以上命令会添加稳定版本的 Docker APT 源，如果需要测试版本的 Docker 请将 stable 改为 test。</p><hr><h1 id="3）安装-Docker">3）安装 Docker</h1><p>查询存储库中可用的版本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line">$ apt-cache madison docker-ce</span><br><span class="line"> docker-ce | 5:23.0.1-1~debian.11~bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line"> docker-ce | 5:23.0.0-1~debian.11~bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line"> docker-ce | 5:20.10.23~3-0~debian-bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line"> docker-ce | 5:20.10.22~3-0~debian-bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line"> docker-ce | 5:20.10.21~3-0~debian-bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line"> docker-ce | 5:20.10.20~3-0~debian-bullseye | http://mirrors.aliyun.com/docker-ce/linux/debian bullseye/stable arm64 Packages</span><br><span class="line">...省略部分内容...</span><br></pre></td></tr></table></figure><blockquote><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230226165608607.png" alt="image-20230226165608607"></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line"><span class="comment"># 安装指定版本（5:23.0.1-1~debian.11~bullseye）</span></span><br><span class="line"><span class="comment"># Docker客户端</span></span><br><span class="line">$ sudo apt-get install docker-ce=5:23.0.1-1~debian.11~bullseye <span class="comment"># Docker守护进程</span></span><br><span class="line"><span class="comment"># CLI工具用来远程控制Docker守护进程（已包括）</span></span><br><span class="line"><span class="comment">#$ sudo apt-get install docker-ce-cli=5:23.0.1-1~debian.11~bullseye</span></span><br><span class="line"><span class="comment"># Docker服务端（已包括）</span></span><br><span class="line"><span class="comment">#$ sudo apt-get install containerd.io # Docker守护进程与操作系统API接口</span></span><br><span class="line"><span class="comment"># 轻松、高效的管理容器，它是一个用于定义和运行多容器 Docker 的应用程序工具</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-compose安装</span></span><br><span class="line"><span class="comment">#$ sudo apt-get install docker-compose #版本太旧</span></span><br><span class="line"><span class="comment">#$ sudo apt-get install docker-compose-plugin</span></span><br><span class="line"><span class="comment"># github拉取</span></span><br><span class="line"><span class="comment">#$ curl -L https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span></span><br><span class="line"><span class="comment"># 国内源拉取</span></span><br><span class="line">$ curl -L https://get.daocloud.io/docker/compose/releases/download/v2.16.0/docker-compose-`<span class="built_in">uname</span> -s`-`<span class="built_in">uname</span> -m` -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">$ sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><hr><h1 id="4）开机自启">4）开机自启</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker &amp;&amp; systemctl restart docker &amp;&amp; systemctl status docker</span><br></pre></td></tr></table></figure><hr><h1 id="5）配置镜像加速">5）配置镜像加速</h1><p>请首先执行以下命令，查看是否在 <code>docker.service </code>文件中配置过镜像地址。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl <span class="built_in">cat</span> docker | grep <span class="string">&#x27;\-\-registry\-mirror&#x27;</span></span><br></pre></td></tr></table></figure><p>如果该命令有输出，那么请执行 <code>$ systemctl cat docker</code> 查看 <code>ExecStart=</code> 出现的位置，修改对应的文件内容去掉 <code>--registry-mirror</code> 参数及其值，并按接下来的步骤进行配置。</p><p>如果以上命令没有任何输出，那么就可以在<code>/etc/docker/daemon.json</code> 中写入如下内容（如果文件不存在请新建该文件）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后重新启动服务。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl restart docker</span><br></pre></td></tr></table></figure><hr><h1 id="6）检查">6）检查</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本信息</span></span><br><span class="line">$ sudo docker info</span><br><span class="line"><span class="comment"># 检查安装版本</span></span><br><span class="line">$ sudo docker --version</span><br><span class="line">$ sudo docker-compose --version</span><br><span class="line"><span class="comment"># 校验Docker CE </span></span><br><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Ansible 学习笔记</title>
      <link href="/posts/e4dd4355.html"/>
      <url>/posts/e4dd4355.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）Ansible-安装部署">1）Ansible 安装部署</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install epel-release ansible libselinux-python</span><br></pre></td></tr></table></figure><h1 id="2）主机清单">2）主机清单</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#vim /etc/ansible/hosts </span></span><br><span class="line"> </span><br><span class="line">[web]</span><br><span class="line">172.16.1.7 </span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line"> </span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line"> </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><p><strong>主机分组后，执行命令测试，批量管理一组机器</strong></p><p>管理所有的机器，使用特殊主机组，all</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">让所有的主机，远程运行hostname，返回主机名信息</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m shell -a &quot;hostname&quot;</span></span><br><span class="line"> </span><br><span class="line">但是默认没配置认证方式，权限被拒绝</span><br></pre></td></tr></table></figure><h1 id="3）Ansible-连接客户端">3）Ansible 连接客户端</h1><h2 id="3-1-基于公钥认证">3.1 基于公钥认证</h2><p>生成公钥的方法：（~/.ssh/）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa <span class="comment">#-t : t是type的缩写，即指定密钥的类型，密钥的类型有两种：RSA、DSA</span></span><br></pre></td></tr></table></figure><p>发送公钥给目标机器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ssh-copy-id root@172.16.1.41</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.41 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">rsync-41</span><br></pre></td></tr></table></figure><h2 id="3-2-基于密码认证">3.2 基于密码认证</h2><ul><li>在你的客户端机器，修改了ssh默认端口，以及密码需要修改主机清单文件才可以正确连接</li><li>注意你得配置文件允许免密登录才能进行如下测试</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ansible/hosts  <span class="comment">#主机清单文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意，部分资料里的主机配置文件语法，旧版如下</span></span><br><span class="line"><span class="comment">#Ansible 2.0 has deprecated the “ssh” from ansible_ssh_user, ansible_ssh_host, and ansible_ssh_port to become </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这是旧版本的用法</span></span><br><span class="line">ansible_ssh_host</span><br><span class="line">ansible_ssh_port</span><br><span class="line">ansible_ssh_user</span><br><span class="line">ansible_ssh_password</span><br><span class="line"> </span><br><span class="line"><span class="comment">#新版参数去掉了中间的_ssh(如果你写旧版本的语法，新版也也认识)</span></span><br><span class="line">ansible_user</span><br><span class="line">ansible_host</span><br><span class="line">ansible_port</span><br></pre></td></tr></table></figure><p><strong>参数说明</strong>：</p><table><thead><tr><th><strong>参数</strong></th><th><strong>参数类型</strong></th><th><strong>参数说明</strong></th></tr></thead><tbody><tr><td>ansible_host</td><td>主机地址</td><td>远程主机ip</td></tr><tr><td>ansible_port</td><td>主机端口</td><td>设置SSH连接端口，默认22</td></tr><tr><td>ansible_user</td><td>主机用户</td><td>默认SSH远程连接的用户身份</td></tr><tr><td>ansible_password</td><td>用户密码</td><td>指定SSH远程主机密码</td></tr></tbody></table><p><strong>示例</strong>：</p><p>给rsync机器，进行免密认证</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.给rsync机器，添加密码，端口信息</span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41 ansible_port=22 ansible_password=<span class="string">&#x27;123456&#x27;</span></span><br><span class="line"> </span><br><span class="line">2.如果目标机器的ssh信息都被改了，这里也得改</span><br><span class="line">172.16.1.41 ansible_port=22999 ansible_password=<span class="string">&#x27;123123&#x27;</span></span><br></pre></td></tr></table></figure><p>测试执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m ping</span></span><br><span class="line">172.16.1.41 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="📌故障解决">📌故障解决</h2><p>你可能会遇见如下问题，关于新机器的指纹确认问题。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible 172.16.1.9 -m ping</span></span><br><span class="line">172.16.1.9 | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#x27;s fingerprint to your known_hosts file to manage this host.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解决办法1，手动ssh连接，进行指纹确认，写入到本机的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p>解决办法2，ansible配置文件中忽略指纹确认</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep &#x27;host_key_checking&#x27; /etc/ansible/ansible.cfg </span></span><br><span class="line">host_key_checking = False</span><br></pre></td></tr></table></figure><p>问题已经解决，可以正确操作web-9机器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible 172.16.1.9 -m ping</span></span><br><span class="line">172.16.1.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="📌踩坑记录-ansible缓存">📌踩坑记录(ansible缓存)</h2><p>由于ansible在对远程主机操作之前，默认会先通过setup模块获取机器的facts（静态属性），并且会生成缓存，便于加速远程主机的操作；但缓存也会导致一些奇怪的现象，比如客户端的机器信息更新了，服务端依旧使用的是旧数据，那就不准确了，因此可以删除缓存。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">关于缓存导致bug的文章，https://serverfault.com/questions/630253/ansible-stuck-on-gathering-facts</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">清理ansible的缓存目录即可</span><br><span class="line">[root@master-61 ~]<span class="comment">#rm -rf ~/.ansible/cp/*</span></span><br></pre></td></tr></table></figure><h2 id="📌同一组连续的ip">📌同一组连续的ip</h2><p>可以修改主机清单文件如下，前提是该些主机的配置一致</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[web]</span><br><span class="line">172.16.1.[7:9]</span><br></pre></td></tr></table></figure><h2 id="📌公共变量">📌公共变量</h2><p>当主机清单里，很多主机组，有相同的变量属性，可以写成公共变量</p><p>这部分配置是针对web主机组，抽象的变量</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep -vE &#x27;^#|^$&#x27; /etc/ansible/hosts </span></span><br><span class="line">[web:vars]</span><br><span class="line">ansible_ssh_port=22999</span><br><span class="line">ansible_ssh_user=root</span><br><span class="line">ansible_ssh_pass=123123</span><br><span class="line">[web]</span><br><span class="line">172.16.1.[7:9]</span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31 ansible_ssh_port=22999 </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41 ansible_ssh_port=22999 ansible_ssh_user=root ansible_ssh_pass=123123</span><br></pre></td></tr></table></figure><p><strong>所有主机都生效的变量</strong></p><p>指定主机组名all，即可针对所有主机名生效，前提是，你要确保这个信息是所有主机通用的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep -vE &#x27;^#|^$&#x27; /etc/ansible/hosts </span></span><br><span class="line">[all:vars]</span><br><span class="line">ansible_port=22</span><br><span class="line">ansible_password=<span class="string">&#x27;123456&#x27;</span></span><br><span class="line"> </span><br><span class="line">[web]</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line"> </span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line"> </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><h2 id="3-3-Ansible连接指纹确认的问题">3.3 Ansible连接指纹确认的问题</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1.master-61需要确认目标机器的指纹，记录到本地known——hosts文件</span><br><span class="line"><span class="built_in">ls</span> ~/.ssh/known_hosts文件中 这里就存放了目标机器的指纹信息</span><br><span class="line"> </span><br><span class="line">可以进行认证方式，密码，还是公钥</span><br><span class="line"> </span><br><span class="line">2.首次远程连接，需要指纹确认，可以忽略该指纹</span><br><span class="line">ssh的连接参数，忽略指纹的确认</span><br><span class="line">ansible的配置文件中也有一个参数忽略指纹的确认</span><br><span class="line"> </span><br><span class="line">一般用法是</span><br><span class="line">总之ansible就是以ssh连接标准来的</span><br><span class="line"> </span><br><span class="line">1.指纹确认 <span class="built_in">yes</span>/no</span><br><span class="line"> </span><br><span class="line">2.密码认证/公钥认证</span><br><span class="line"> </span><br><span class="line">关于ansible如何初始化的使用，有三个方案</span><br><span class="line"> </span><br><span class="line">方案一</span><br><span class="line">已经基于ssh完成了指纹确认，认证方式</span><br><span class="line">ansible直接用就可以</span><br><span class="line">你可以先一键分发公钥，实现批量化免密登录，再ansible免密远程执行命令</span><br><span class="line"> </span><br><span class="line">方案2</span><br><span class="line">ssh root@172.16.1.7</span><br><span class="line">手动确认<span class="built_in">yes</span> 写入到本地的known_hosts</span><br><span class="line">你可以手动ssh连接，确认指纹后，再ansible去远程操作，选择认证方式就行</span><br><span class="line"> </span><br><span class="line">方案3.</span><br><span class="line">你可以直接忽略指纹确认，在主机清单文件中定义好ssh连接配置参数</span><br><span class="line"> </span><br><span class="line">这个就是最简单的，修改ansible配置文件，打开忽略指纹确认的参数即可</span><br><span class="line"> </span><br><span class="line">修改如下参数即可</span><br><span class="line"> 72 <span class="comment"># uncomment this to disable SSH key host checking</span></span><br><span class="line"> 73 host_key_checking = False</span><br><span class="line"> </span><br><span class="line">后续就进入了认证方式阶段，选择密码，还是公钥，</span><br><span class="line">常见错误</span><br><span class="line">- 端口错了</span><br><span class="line">- 密码错了</span><br><span class="line">- 用户错了</span><br><span class="line"> </span><br><span class="line">如果出错</span><br><span class="line">1.找ansible的/etc/ansible/hosts中语法是否出错</span><br><span class="line">2.看目标机器，到底提供了什么样的ssh连接形式（sshd_config）</span><br></pre></td></tr></table></figure><h2 id="3-4-ssh批量管理分发（实战）">3.4 ssh批量管理分发（实战）</h2><p><a href="https://blog.csdn.net/yingcai111/article/details/127404417">https://blog.csdn.net/yingcai111/article/details/127404417</a></p><hr><h1 id="3）ad-hoc-命令行模式">3）ad-hoc 命令行模式</h1><p>Ansible的ad-hoc模式也就是ansible的命令行模式，该模式通常用来临时处理一些任务。例如</p><ul><li>临时批量查看所有被管控机器的内存、负载、磁盘</li><li>临时批量分发某个特定文件</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible 主机名 -m <span class="built_in">command</span> -a <span class="string">&quot;批量执行的操作&quot;</span></span><br><span class="line"><span class="comment"># -m 指定模块的参数</span></span><br><span class="line"><span class="comment"># -a 指定模块的执行动作参数</span></span><br></pre></td></tr></table></figure><h2 id="3-1-列出Ansible所有支持的模块">3.1 列出Ansible所有支持的模块</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当前ansible支持3387个模块</span></span><br><span class="line">[root@master-61 ~]<span class="comment"># ansible-doc -l |wc -l</span></span><br><span class="line">3387</span><br></pre></td></tr></table></figure><h2 id="3-2-查看某个模块的具体用法">3.2 查看某个模块的具体用法</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible-doc -s ping</span></span><br><span class="line">- name: Try to connect to host, verify a usable python and <span class="built_in">return</span> `pong<span class="string">&#x27; on success</span></span><br><span class="line"><span class="string">  ping:</span></span><br><span class="line"><span class="string">      data:                  # Data to return for the `ping&#x27;</span> <span class="built_in">return</span> value. If this</span><br><span class="line">                               parameter is <span class="built_in">set</span> to</span><br><span class="line">                               `crash<span class="string">&#x27;, the module</span></span><br><span class="line"><span class="string">                               will cause an</span></span><br><span class="line"><span class="string">                               exception.</span></span><br><span class="line"><span class="string">[root@master-61 ~]#ansible-doc -s shell</span></span><br><span class="line"><span class="string">- name: Execute shell commands on targets</span></span><br><span class="line"><span class="string">  shell:</span></span><br><span class="line"><span class="string">      chdir:                 # Change into this directory before running the command.</span></span><br><span class="line"><span class="string">      cmd:                   # The command to run followed by optional arguments.</span></span><br><span class="line"><span class="string">      creates:               # A filename, when it already exists, this step will</span></span><br><span class="line"><span class="string">                               *not* be run.</span></span><br><span class="line"><span class="string">      executable:            # Change the shell used to execute the command. This</span></span><br><span class="line"><span class="string">                               expects an absolute</span></span><br><span class="line"><span class="string">                               path to the executable.</span></span><br><span class="line"><span class="string">      free_form:             # The shell module takes a free form command to run, as</span></span><br><span class="line"><span class="string">                               a string. There is no</span></span><br><span class="line"><span class="string">                               actual parameter named</span></span><br><span class="line"><span class="string">                               &#x27;</span>free form<span class="string">&#x27;. See the</span></span><br><span class="line"><span class="string">                               examples on how to use</span></span><br><span class="line"><span class="string">                               this module.</span></span><br><span class="line"><span class="string">      removes:               # A filename, when it does not exist, this step will</span></span><br><span class="line"><span class="string">                               *not* be run.</span></span><br><span class="line"><span class="string">      stdin:                 # Set the stdin of the command directly to the specified</span></span><br><span class="line"><span class="string">                               value.</span></span><br><span class="line"><span class="string">      stdin_add_newline:     # Whether to append a newline to stdin data.</span></span><br><span class="line"><span class="string">      warn:                  # Whether to enable task warnings.</span></span><br></pre></td></tr></table></figure><h2 id="3-3-Ansible执行命令结果（状态颜色）">3.3 Ansible执行命令结果（状态颜色）</h2><p>可以使用模块操作，会有不同的颜色结果，都是由意义的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">运维远程执行命令，有2个方式</span><br><span class="line">shell脚本，远程执行</span><br><span class="line">ansible模块，远程执行</span><br><span class="line"> </span><br><span class="line">区别在于</span><br><span class="line">shell脚本不够智能，不会记录上一次的执行状态，以及修改的状态，因此导致，傻瓜式的，重复性执行，效率的极其低下，不做状态记录，</span><br><span class="line"> </span><br><span class="line">ansible的模块，yum模块会记录执行的状态</span><br><span class="line">第一次执行，装完之后，的却对目标机器产生了修改的状态，会给master-61返回一个命令执行结果，执行状态，存储下来</span><br><span class="line">ansible web -m yum -a <span class="string">&quot;name=rsync  state=installed&quot;</span></span><br><span class="line"> </span><br><span class="line">ansible会检测目标机器，对比这个状态，如果状态没变，ansible就不会再执行该命令，因此效率很高</span><br><span class="line">ansible web -m yum -a <span class="string">&quot;name=rsync  state=installed&quot;</span></span><br></pre></td></tr></table></figure><p>ansible的状态，颜色区分，看到不同的状态</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">绿色：命令以用户期望的执行了，但是状态没有发生改变；</span><br><span class="line">黄色：命令以用户期望的执行了，并且状态发生了改变； </span><br><span class="line">紫色：警告信息，说明ansible提示你有更合适的用法；出现了warning警告</span><br><span class="line">红色：命令错误，执行失败；</span><br><span class="line">蓝色： 详细的执行过程；</span><br></pre></td></tr></table></figure><hr><h1 id="4）Ansible-模块（核心内容）">4）Ansible 模块（核心内容）</h1><p>Ansible自动化软件的核心功能就在于其众多的模块，可以说学习Ansible就是学习模块的使用。</p><p>剩余的是对Ansible剧本编写的熟练度。</p><h2 id="1-ping-测试连通性模块">.1 ping 测试连通性模块</h2><h3 id="📓文档">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module</a></p><h3 id="📖-概要">📖 概要</h3><ul><li>一个简单的测试模块，这个模块总是pong在成功联系时返回。它在剧本中没有意义，但它有助于/usr/bin/ansible验证登录能力以及配置了可用的 Python。</li><li>这不是 ICMP ping，这只是一个在远程节点上需要 Python 的简单测试模块。</li><li>对于 Windows 目标，请改用win_ping模块。</li><li>对于网络目标，请改用net_ping模块。</li></ul><h3 id="📖-参数">📖 参数</h3><table><thead><tr><th>parameter</th><th>choices/default</th><th>comments</th></tr></thead><tbody><tr><td>data</td><td>默认为’pong’</td><td>为<code>ping</code>返回值返回的数据。如果该参数设置为<code>crash</code>，模块将引发异常。</td></tr></tbody></table><h3 id="📌通过master-61机器，查看目标机器是否运行">📌通过master-61机器，查看目标机器是否运行</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m ping</span></span><br><span class="line">172.16.1.8 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.7 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.31 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.41 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-command-简单命令模块">.2 command 简单命令模块</h2><h3 id="📓文档-v2">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module</a></p><h3 id="📖-概要-v2">📖 概要</h3><ul><li>该command模块以命令名称为单位，然后是空间限制的参数列表。</li><li>给定命令将在所有选定的节点上执行。</li><li>命令将不会通过外壳处理，因此变量和$HOME操作，例如，“&lt;“和不起作用。如果需要这些功能，请使用Shell模块”&gt;”<code>&quot;|&quot;</code>“;”``“&amp;”</li><li>要创建command比使用空格删除参数的任务更容易读取的任务，请使用args 任务关键字或使用参数传递cmd参数。</li><li>需要免费的表单命令或cmd参数，请参见示例。</li><li>对于Windows目标，请改用Win_Command模块。</li></ul><h3 id="📖-参数-v2">📖 参数</h3><table><thead><tr><th>parameter（参数）</th><th>choices/defaults（选项）</th><th>comments（注解）</th></tr></thead><tbody><tr><td>argv</td><td></td><td>将命令作为列表而不是字符串传递。使用<code>argv</code>来避免引用可能被错误解释的值(例如“user name”)。只能提供字符串或列表形式，不能同时提供两者。必须提供其中一种。</td></tr><tr><td>chdir</td><td></td><td>在运行该命令之前，切换到该目录</td></tr><tr><td>cmd</td><td></td><td>要运行的命令。</td></tr><tr><td>creates</td><td></td><td>文件名或(从2.0开始)glob模式。如果它已经存在，则不会运行此步骤。</td></tr><tr><td>free_form</td><td></td><td>命令模块以自由形式运行。没有名为“free form”的实际参数。</td></tr><tr><td>removes</td><td></td><td>文件名或(从2.0开始)glob模式。如果它已经存在，则将运行此步骤。</td></tr><tr><td>stdin</td><td></td><td>将命令的stdin直接设置为指定的值</td></tr><tr><td>stdin_add_newline</td><td>yes or no，默认yes</td><td>如果设置为<code>yes</code>，则向<code>stdin</code>数据追加一个换行符。</td></tr><tr><td>strip_empty_ends</td><td>yes or no，默认yes</td><td>从结果的stdout/stderr结尾剥离空行。</td></tr><tr><td>warn</td><td>yes or no，默认yes</td><td>启用或禁用任务警告。</td></tr></tbody></table><h3 id="📌远程查看主机名">📌远程查看主机名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">两个方法</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">简写，<span class="built_in">command</span>是ansible的基础模块，默认就是 -m <span class="built_in">command</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7</span><br></pre></td></tr></table></figure><h3 id="📌远程查看主机内存">📌远程查看主机内存</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;free -m&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821         100        1579           9         141        1561</span><br><span class="line">Swap:             0           0           0</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821         100        1579           9         141        1560</span><br><span class="line">Swap:             0           0           0</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821          98        1581           9         141        1562</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure><h3 id="📌远程创建文件，查看文件">📌远程创建文件，查看文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;touch /opt/666.log&quot;</span></span><br><span class="line">[WARNING]: Consider using the file module with state=<span class="built_in">touch</span> rather than running</span><br><span class="line"><span class="string">&#x27;touch&#x27;</span>.  If you need to use <span class="built_in">command</span> because file is insufficient you can add <span class="string">&#x27;warn:</span></span><br><span class="line"><span class="string">false&#x27;</span> to this <span class="built_in">command</span> task or <span class="built_in">set</span> <span class="string">&#x27;command_warnings=False&#x27;</span> <span class="keyword">in</span> ansible.cfg to get rid</span><br><span class="line">of this message.</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">里面没有东西，</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;cat /opt/666.log&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="📌远程获取机器负载">📌远程获取机器负载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;uptime&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.00, 0.02, 0.05</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.00, 0.01, 0.05</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.01, 0.03, 0.05</span><br></pre></td></tr></table></figure><h3 id="📌关闭告警信息">📌关闭告警信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;touch /opt/666.log  warn=false &quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="📌在所有机器上，创建wenjie01用户">📌在所有机器上，创建wenjie01用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;useradd wenjie01&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="📌使用command提供的专有命令">📌使用command提供的专有命令</h3><p>这些命令用于编写ansible-playbook，完成服务器部署的各种复杂条件限定</p><p><strong>chdir</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;touch /opt/wenjie666&quot;</span></span><br><span class="line"><span class="comment">#等同于</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;touch wenjie666 chdir=/opt&quot;</span></span><br></pre></td></tr></table></figure><p><strong>removes</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断如果文件夹不存在，则不执行备份</span></span><br><span class="line"><span class="comment">#目标文件夹不存在，这个命令不会对目标机器产生任何修改，因此绿色结果</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;tar -zcf /backup_config/etc.tgz  etc chdir=/  removes=/backup_config&quot;</span></span><br></pre></td></tr></table></figure><p><strong>creates</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m command -a &quot;mkdir /opt creates=/opt&quot;</span></span><br><span class="line">172.16.1.41 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">skipped, since /opt exists</span><br></pre></td></tr></table></figure><h2 id="3-shell-万能模块">.3 shell 万能模块</h2><h3 id="📖-概要-v3">📖 概要</h3><ul><li>该<code>shell</code>模块采用命令名称，后跟以空格分隔的参数列表。</li><li>需要自由格式的命令或<code>cmd</code>参数，请参见示例。</li><li>它几乎与命令<code>/bin/sh</code>模块完全相同，但通过远程节点上的shell ( ) 运行命令。</li><li>对于 Windows 目标，请改用win_shell模块。</li></ul><h3 id="📖-参数-v3">📖 参数</h3><table><thead><tr><th>parameter</th><th>choices/defaults（选项）</th><th>comments（注解）</th></tr></thead><tbody><tr><td>chdir</td><td></td><td>在运行该命令之前，切换到该目录。</td></tr><tr><td>cmd</td><td></td><td>运行的命令后跟可选参数</td></tr><tr><td>creates</td><td></td><td>当文件名已经存在时，此步骤将不运行</td></tr><tr><td>executable</td><td></td><td>更改用于执行该命令的shell。这需要可执行文件的绝对路径。</td></tr><tr><td>free_form</td><td></td><td>shell模块接受一个以字符串形式运行的自由形式命令。没有名为“free form”的实际参数。</td></tr><tr><td>removes</td><td></td><td>当文件名不存在时，此步骤将不运行。</td></tr><tr><td>stdin</td><td></td><td>将命令的stdin直接设置为指定的值。</td></tr><tr><td>stdin_add_newline</td><td>yes or no，默认yes</td><td>是否向stdin数据追加换行符。</td></tr><tr><td>warn</td><td>yes or no，默认yes</td><td>是否启用任务警告。</td></tr></tbody></table><h3 id="📌远程过滤ssh进程信息">📌远程过滤ssh进程信息</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m shell -a &quot;ps -ef | grep ssh&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">root        977      1  0 16:42 ?        00:00:00 /usr/sbin/sshd -D</span><br><span class="line">root       1496    977  0 16:57 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root       4614    977  4 20:45 ?        00:00:00 sshd: root@pts/1</span><br><span class="line">root       4672   4671  0 20:45 pts/1    00:00:00 /bin/sh -c ps -ef | grep ssh</span><br><span class="line">root       4674   4672  0 20:45 pts/1    00:00:00 grep ssh</span><br></pre></td></tr></table></figure><h3 id="📌使用重定向符号，创建文件">📌使用重定向符号，创建文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">远程获取时间信息，且写入到文件中</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">command</span>不认识重定向</span><br><span class="line"><span class="comment"># ansible web -m command -a &quot;date &gt; /tmp/date.log&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &quot;date &#x27;+%F %T&#x27; &gt; /tmp/date.log&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &#x27;cat /tmp/date.log&#x27;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br></pre></td></tr></table></figure><h3 id="📌远程执行复杂linux命令">📌远程执行复杂linux命令</h3><p>这个命令就无法在command中执行</p><p>通过一条命令，做如下事情</p><ul><li>创建文件夹</li><li>生成sh脚本文件（查看主机名）</li><li>赋予脚本可执行权限</li><li>执行脚本</li><li>忽略warning信息</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &quot;mkdir /0224/;echo &#x27;hostname&#x27; &gt; /0224/hostname.sh;chmod +x /0224/hostname.sh;/0224/hostname.sh;  warn=false&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8mkdir: cannot create directory ‘/0224/’: File exists</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7mkdir: cannot create directory ‘/0224/’: File exists</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9mkdir: cannot create directory ‘/0224/’: File exists</span><br></pre></td></tr></table></figure><h2 id="4-copy-拷贝文件模块">.4 copy 拷贝文件模块</h2><h3 id="📖-概要-v4">📖 概要</h3><ul><li>该<code>copy</code>模块将文件从本地或远程机器复制到远程机器上的某个位置。</li><li>使用<code>fetch</code>模块将文件从远程位置复制到本地框。</li><li>如果您需要在复制的文件中进行变量插值，请使用<code>模板模块</code>。在字段中使用变量<code>content</code>将导致不可预测的输出。</li><li>对于 Windows 目标，请改用<code>win_copy</code>模块。</li></ul><h3 id="📖-参数-v4">📖 参数</h3><table><thead><tr><th>Parameter（参数）</th><th>choices（选项）/default</th><th>comments（注解5）</th></tr></thead><tbody><tr><td>attributes</td><td></td><td>生成的文件或目录应该具有的属性。 要获得支持的标志，请查看目标系统上chatr的手册页。 这个字符串应该包含与lsattr显示的相同顺序的属性。<br>=操作符被假定为默认值，否则需要在字符串中包含+或-操作符</td></tr><tr><td>backup</td><td>yes or no，默认no</td><td>创建一个包含时间戳信息的备份文件，这样，如果您以某种方式错误地修改了它，就可以重新获得原始文件。</td></tr><tr><td>checksum</td><td></td><td>正在传输的文件的SHA1校验和用于验证文件的复制是否成功。如果没有提供，ansible将使用src文件的本地计算的校验和。</td></tr><tr><td>content</td><td></td><td>当代替src使用时，将文件的内容直接设置为指定的值。只有当dest是一个文件时才有效。如果文件不存在，则创建该文件。对于高级格式化或内容包含变量，请使用template模块。</td></tr><tr><td>decrypt</td><td>yes or no，默认no</td><td>此选项控制使用保险库对源文件进行自动解密。</td></tr><tr><td>dest</td><td></td><td>文件应该复制到的远程绝对路径。1、如果<code>src</code>是一个目录，那么它也必须是一个目录。2、如果<code>dest</code>是一个不存在的路径，并且<code>dest</code>以"/"结尾或者<code>src</code>是一个目录，则创建<code>dest</code>。3、如果<code>dest</code>是相对路径，则启动目录由远程主机决定。4、如果<code>src</code>和<code>dest</code>是文件，则不会创建<code>dest</code>的父目录，如果父目录不存在，则任务失败。</td></tr><tr><td>directory_mode</td><td></td><td>在进行递归复制时，设置目录的模式。如果没有设置，我们将使用系统默认值。该模式只对新创建的目录进行设置，对已经存在的目录不产生影响。</td></tr><tr><td>follow</td><td>yes or no，默认no</td><td>这个标志指示目标中的文件系统链接(如果存在的话)应该被跟随。</td></tr><tr><td>force</td><td>yes or no，默认yes</td><td>是否要替换远程文件。如果是，当远程文件的内容与源文件不一致时，远程文件将被替换。如果不存在，则只有在目标不存在的情况下才会传输文件。</td></tr><tr><td>group</td><td></td><td>应该拥有该文件/目录的组的名称，这将提供给chown。</td></tr><tr><td>local_follow</td><td>yes or no，默认yes</td><td>这个标志指示源树中的文件系统链接(如果存在的话)应该被跟随。</td></tr><tr><td>mode</td><td></td><td>目标文件或目录的权限。对于那些习惯使用/usr/bin/chmod的人，请记住模式实际上是八进制数字。你必须添加一个前导零，以便Ansible的YAML解析器知道它是一个八进制数字(如0644或01777)或引用它(如’644’或’1777’)，以便Ansible接收到一个字符串，并可以进行自己的转换，从字符串到数字。给Ansible一个号码,遵循这些规则中的一个将会得到一个小数，这将会产生意想不到的结果。在Ansible 1.8中，模式可以被指定为符号模式(例如，u+rwx或u=rw,g=r,o=r)。在Ansible 2.3中，模式也可以是特殊的字符串保存。<code>preserver</code>意味着文件将被赋予与源文件相同的权限。</td></tr><tr><td>owner</td><td></td><td>应该拥有文件/目录的用户名，这将被提供给chown。</td></tr><tr><td>remote_src</td><td>yes or no，默认no</td><td>影响<code>src</code>是否需要转移或已经远程存在。如果<code>no</code>，它将在原始/主机上搜索<code>src</code>。如果<code>yes</code>，它将转到<code>src</code>的远程/目标计算机。从2.8版本开始，<code>Remote_src</code>支持递归复制。<code>Remote_src</code>只适用于<code>mode=preserve</code>版本2.6。</td></tr><tr><td>selevel</td><td>默认0</td><td>SELinux文件上下文的级别部分。这就是MLS/MCS属性，有时也被称为<code>range</code>。当设置为default时，如果可用，它将使用策略的<code>level</code>部分。</td></tr><tr><td>serole</td><td></td><td>SELinux文件上下文的角色部分。当设置为_default时，它将使用策略的<code>role</code>部分(如果可用的话)。</td></tr><tr><td>setype</td><td></td><td>SELinux文件上下文的<code>type</code>部分。当设置为_default时，它将使用策略的类型部分(如果可用的话)。</td></tr><tr><td>seuser</td><td></td><td>SELinux文件上下文的用户部分。<code>default</code>情况下，它使用系统策略。当设置为_default时，它将使用策略的用户部分(如果可用)。</td></tr><tr><td>src</td><td></td><td>要复制到远程服务器的文件的本地路径。这可以是绝对的，也可以是相对的。如果path是目录，则递归复制。在这种情况下，如果path以“/”结尾，则只将该目录中的内容复制到目的地。否则，如果它不是以“/”结尾，则复制包含所有内容的目录本身。这种行为类似于rsync命令行工具。</td></tr><tr><td>unsafe_writes</td><td>yes or no，默认no</td><td>影响何时使用原子操作来防止数据损坏或从目标文件进行不一致的读取。默认情况下，该模块使用原子操作来防止数据损坏或不一致地读取目标文件，但有时系统配置或破坏的方式会防止这种情况。一个例子是docker挂载的文件，它不能从容器内部原子地更新，只能以不安全的方式写入。当任务操作失败时，这个选项允许Ansible退回到不安全的方法来更新文件(但是，它不会强迫Ansible执行不安全的写操作)。<br>重要!不安全的写操作会受到竞争条件的影响，并可能导致数据损坏。</td></tr><tr><td>validate</td><td></td><td>复制到适当位置之前要运行的验证命令。要验证的文件路径是通过’%s’传入的，它必须如下例所示。该命令是安全传递的，因此像扩展和管道这样的shell功能将不起作用</td></tr></tbody></table><p><strong>复制文件时候应该注意<code>/</code></strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#远程拷贝/opt/下的所有内容到目标机器</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m copy -a &quot;src=/opt/ dest=/tmp/&quot;</span></span><br><span class="line"><span class="comment">#远程拷贝/opt  整个目录到目标机器</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m copy -a &quot;src=/opt  dest=/tmp/&quot;</span></span><br></pre></td></tr></table></figure><h2 id="5-file-文件操作模块">.5 file 文件操作模块</h2><h3 id="📓文档-v3">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module">https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module</a></p><h3 id="📖概要">📖概要</h3><ul><li>设置文件、符号链接或目录的属性。</li><li>或者，删除文件、符号链接或目录。</li><li>许多其他模块支持与该模块相同的选项<code>file</code>- 包括复制、模板和组装。</li><li>对于 Windows 目标，请改用win_file模块。</li></ul><h3 id="📖参数">📖参数</h3><table><thead><tr><th>parameters（参数）</th><th>choices/defaults（选项）</th><th>comments（注释）</th></tr></thead><tbody><tr><td>access_time</td><td></td><td>该参数表示应该设置文件访问时间的时间。应该在不需要修改时保留，<code>YYYYMMDDHHMM.SS</code>时使用默认的时间格式，或<code>now</code>。默认为<code>None</code>，这意味着保存是<code>state=[file,directory,link,hard]</code>的默认值，现在是<code>state=touch</code>的默认值。</td></tr><tr><td>access_time_format</td><td>默认 <code>"%Y%m%d%H%M.%S"</code></td><td>当与<code>access_time</code>一起使用时，表示必须使用的时间格式。</td></tr><tr><td>attributes</td><td></td><td>生成的文件或目录应该具有的属性。要获得支持的标志，请查看目标系统上chatr的手册页。这个字符串应该包含与lsattr显示的相同顺序的属性。<code>=</code>操作符被假定为默认值，否则需要在字符串中包含<code>+</code>或<code>-</code>操作符。</td></tr><tr><td>follow</td><td>yes or no，默认yes</td><td>这个标志指示文件系统链接(如果存在的话)应该被跟随。</td></tr><tr><td>force</td><td>yes or no，默认no</td><td>强制在以下两种情况下创建符号链接:源文件不存在(但稍后会出现);目的地已经存在，并且是一个文件(因此，我们需要取消<code>path</code>文件的链接，并创建到<code>src</code>文件的符号链接来代替它)。</td></tr><tr><td>group</td><td></td><td>应该拥有该文件/目录的组的名称，这将提供给chown。</td></tr><tr><td>mode</td><td></td><td>生成的文件或目录应有的权限。对于那些习惯使用/usr/bin/chmod的人，请记住模式实际上是八进制数字。你必须添加一个前导零，以便Ansible的YAML解析器知道它是一个八进制数字(如0644或01777)或引用它(如’644’或’1777’)，以便Ansible接收到一个字符串，并可以进行自己的转换，从字符串到数字。给Ansible一个数字，而不遵循这些规则之一，将结束与一个十进制数字，这将有意想不到的结果。在Ansible 1.8中，模式可以被指定为符号模式(例如，u+rwx或u=rw,g=r,o=r)。</td></tr><tr><td>modification_time</td><td></td><td>该参数表示设置文件修改时间的时间。应该在不需要修改时保留，<code>YYYYMMDDHHMM.SS</code>时使用默认的时间格式，或<code>now</code>。默认为<code>None</code>，这意味着保存是<code>state=[file,directory,link,hard]</code>的默认值，现在是<code>state=touch</code>的默认值。</td></tr><tr><td>modification_time_format</td><td>默认 <code>"%Y%m%d%H%M.%S"</code></td><td>与“modification_time”一起使用时，表示必须使用的时间格式。</td></tr><tr><td>owner</td><td></td><td>应该拥有文件/目录的用户名，这将被提供给chown。</td></tr><tr><td>path</td><td></td><td>被管理文件的路径。</td></tr><tr><td>resource</td><td>yes or no，默认no</td><td>递归地对目录内容设置指定的文件属性。这只适用于将<code>state</code>设置为<code>directory</code>的情况。</td></tr><tr><td>selevel</td><td>默认“s0”</td><td>SELinux文件上下文的级别部分。这就是MLS/MCS属性，有时也被称为范围。当设置为<code>_default</code>时，如果可用，它将使用策略的<code>level</code>部分。</td></tr><tr><td>serole</td><td></td><td>SELinux文件上下文的角色部分。当设置为<code>_default</code>时，它将使用策略的<code>role</code>部分(如果可用的话)。</td></tr><tr><td>setype</td><td></td><td>SELinux文件上下文的类型部分。当设置为<code>_default</code>时，它将使用策略的<code>type</code>部分(如果可用的话)。</td></tr><tr><td>seuser</td><td></td><td>SELinux文件上下文的用户部分。在默认情况下它使用系统策略，当设置为<code>_default</code>时，它将使用策略的<code>user</code>部分(如果可用)。</td></tr><tr><td>src</td><td></td><td>要链接的文件的路径。这只适用于<code>state=link</code>和<code>state=hard</code>。对于<code>state=link</code>，这也将接受一个不存在的路径。相对路径是相对于正在创建的文件(path)的，这是Unix命令<code>ln -s SRC DEST</code>处理相对路径的方式。</td></tr><tr><td>state</td><td>absent or directory or file or hard or link or touch</td><td>1、如果<code>absent</code>，目录将被递归删除，文件或符号链接将被解除链接。对于目录，如果声明了<code>diff</code>，您将看到列出在<code>path_contents</code>下的文件和文件夹被删除。注意，如果<code>path</code>不存在，缺席不会导致文件失败，因为状态没有改变。2、如果中间<code>directory</code>不存在，则创建所有中间子目录。因为Ansible 1.7，他们将被创建与提供的权限。3、如果<code>file</code>，没有任何其他选项，这主要作为一个“统计”，并将返回路径的当前状态。即使有其他选项(即模式)，文件将被修改，但不会创建如果它不存在;如果你想要那个行为，可以查看触摸值或复制或模板模块。4、如果是<code>hard</code>，则会创建或更改硬链接。5、如果<code>link</code>，符号链接将被创建或更改。6、如果<code>touch</code>(1.4中的新功能)，如果<code>path</code>不存在，将创建一个空文件，而现有的文件或目录将接收更新的文件访问和修改时间(类似于<code>touch</code>从命令行工作的方式)。</td></tr><tr><td>unsafe_writes</td><td>yes or no，默认no</td><td>影响何时使用原子操作来防止数据损坏或从目标文件进行不一致的读取。默认情况下，该模块使用原子操作来防止数据损坏或不一致地读取目标文件，但有时系统配置或破坏的方式会防止这种情况。一个例子是docker挂载的文件，它不能从容器内部原子地更新，只能以不安全的方式写入。当原子操作失败时，这个选项允许Ansible退回到不安全的方法来更新文件(但是，它不会强迫Ansible执行不安全的写操作)。重要!不安全的写操作会受到竞争条件的影响，并可能导致数据损坏</td></tr></tbody></table><p>与copy区别开</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy src(管理机器上)  dest(目标机器上)</span><br><span class="line"><span class="comment">#file专门用于在远程机器上，关于文件的操作</span></span><br><span class="line">file src(目标机器上的文件)  dest(目标机器上的文件)</span><br></pre></td></tr></table></figure><h3 id="📌远程创建文件">📌远程创建文件</h3><p>state参数，path参数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#远程在web服务器组中，创建一个文本，  hello_ansible.log</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello_ansible.log state=touch&quot;</span></span><br><span class="line"><span class="comment">#创建文件夹</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello_ansible state=directory&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌创建文件且设定权限">📌创建文件且设定权限</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello-linux.log state=touch owner=www group=www&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌远程修改文件属性">📌远程修改文件属性</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello-linux.log owner=www group=www mode=666&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌创软连接文件">📌创软连接文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;src=/etc/hosts dest=/opt/hosts state=link&quot;</span></span><br><span class="line"><span class="comment">#强制性创建文件（软连接）</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;src=/etc/hostsss  dest=/opt/hosts state=link  force=yes &quot;</span></span><br></pre></td></tr></table></figure><h2 id="6-script脚本模块">.6 script脚本模块</h2><h3 id="📓文档-v4">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module</a></p><h3 id="📖-概要-v5">📖 概要</h3><ul><li>该script模块采用脚本名称，后跟以空格分隔的参数列表。</li><li>需要自由格式的命令或cmd参数，请参见示例。</li><li>path 的本地脚本将被传输到远程节点然后执行。</li><li>给定的脚本将通过远程节点上的 shell 环境进行处理。</li><li>这个模块在远程系统上不需要 python，很像raw模块。</li><li>Windows 目标也支持此模块。</li></ul><h3 id="📖-参数-v5">📖 参数</h3><table><thead><tr><th>parameter（参数）</th><th>choices/defualts（选项）</th><th>comments（注解）</th></tr></thead><tbody><tr><td>chdir</td><td></td><td>在运行脚本之前，在远程节点上切换到这个目录。</td></tr><tr><td>cmd</td><td></td><td>要运行的本地脚本的路径，后跟可选参数。</td></tr><tr><td>creates</td><td></td><td>远程节点上的文件名，如果它已经存在，则不会运行此步骤。</td></tr><tr><td>decrypt</td><td>yes or no，默认yes</td><td>此选项控制使用保险库对源文件进行自动解密。</td></tr><tr><td>executable</td><td></td><td>用于调用脚本的可执行文件的名称或路径。</td></tr><tr><td>free_form</td><td></td><td>本地脚本文件的路径，后跟可选参数。</td></tr><tr><td>removes</td><td></td><td>远程节点上的文件名，如果不存在，则不会运行此步骤。</td></tr></tbody></table><h3 id="📌远程执行脚本">📌远程执行脚本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.管理机创建测试脚本</span><br><span class="line"> </span><br><span class="line">master-61创建该脚本</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat echo_server_info.sh </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(hostname -I)</span>&quot;</span> &gt;&gt; /tmp/server_info.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(uptime)</span>&quot;</span> &gt;&gt; /tmp/server_info.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(free -m)</span>&quot;</span> &gt;&gt; /tmp/server_info.sh</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">2.添加执行权限</span><br><span class="line">[root@master-61 ~]<span class="comment">#chmod +x echo_server_info.sh </span></span><br><span class="line"> </span><br><span class="line">3.远程执行</span><br><span class="line">发送nfs机器去执行</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/echo_server_info.sh&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 172.16.1.31 closed.\r\n&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stderr_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Shared connection to 172.16.1.31 closed.&quot;</span></span><br><span class="line">    ], </span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">4.检查结果</span><br><span class="line">[root@nfs-31 ~]<span class="comment">#cat /tmp/server_info.log</span></span><br><span class="line">10.0.0.31 172.16.1.31 </span><br><span class="line"> 22:40:45 up  5:58,  2 <span class="built_in">users</span>,  load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure><h3 id="📌远程在目标机器执行脚本">📌远程在目标机器执行脚本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">远程安装nginx脚本</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat install_nginx.sh </span></span><br><span class="line">yum install nginx -y</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/install_nginx.sh&quot;</span></span><br><span class="line"> </span><br><span class="line">卸载nginx</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat install_nginx.sh </span></span><br><span class="line"><span class="comment">#yum install nginx -y</span></span><br><span class="line">yum remove nginx -y</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/install_nginx.sh&quot;</span></span><br></pre></td></tr></table></figure><h2 id="7-cron定时任务模块">.7 cron定时任务模块</h2><h3 id="📓文档-v5">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module">https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module</a></p><h3 id="📖概要-v2">📖概要</h3><ul><li>使用此模块来管理 crontab 和环境变量条目。此模块允许您创建环境变量和命名的 crontab 条目、更新或删除它们。</li><li>管理 crontab 作业时：模块包含一行，其中包含与传递给模块的“名称”相对应的 crontab 条目的描述，供将来的 ansible/module 调用用于查找/检查状态。“name”参数应该是唯一的，更改“name”值将导致创建一个新的 cron 任务（或删除一个不同的任务）。&quot;#Ansible: &quot;</li><li>管理环境变量时，不添加注释行，但是，当模块需要查找/检查状态时，它使用“name”参数查找环境变量定义行。</li><li>使用 % 等符号时，必须正确转义它们。</li></ul><h3 id="📖参数-v2">📖参数</h3><table><thead><tr><th>parameter(参数)</th><th>choices/default(选项)</th><th>comments(注释)</th></tr></thead><tbody><tr><td>backup</td><td>yes or no，默认no</td><td>如果设置了，请在修改crontab之前创建备份。该模块在<code>backup_file</code>变量中返回备份的位置。</td></tr><tr><td>cron_file</td><td></td><td>如果指定了该文件，将使用该文件而不是单个用户的crontab。如果这是一个相对路径，它将根据/etc/cron.d进行解释,如果它是绝对的，它通常会是/etc/crontab。要使用<code>cron_file</code>参数，还必须指定<code>use</code>。</td></tr><tr><td>day</td><td>默认"*"</td><td>作业应该运行的月份(1-31、<em>、</em>/2等)</td></tr><tr><td>disabled</td><td>yes or no，默认no</td><td>是否应该在crontab中禁用该作业(注释掉)。只有state=present时才有效。</td></tr><tr><td>env</td><td>yes or no，默认no</td><td>如果设置了，则管理crontab的环境变量。在crontab上添加了新的变量。<code>Name</code>和<code>value</code>参数是环境变量的名称和值。</td></tr><tr><td>hour</td><td>默认"*"</td><td>作业应该运行的时间(0-23、<em>、</em>/2等)</td></tr><tr><td>insertafter</td><td></td><td>与state=present和env一起使用。如果指定了，环境变量将被插入到指定环境变量的声明之后。</td></tr><tr><td>insertbefore</td><td></td><td>与state=present和env一起使用。如果指定了，环境变量将被插入到指定环境变量的声明之前。</td></tr><tr><td>job</td><td></td><td>执行的命令，如果设置了env，则为环境变量的值。命令不应该包含换行符。如果需要<code>state=present</code>。</td></tr><tr><td>minute</td><td>默认"*"</td><td>作业应该运行的时间(0-59、<em>、</em>/2等)</td></tr><tr><td>month</td><td>默认"*"</td><td>作业应该运行的月份(1-12，<em>，</em>/2，等等)</td></tr><tr><td>name</td><td></td><td>crontab表项的描述，如果设置了env，则是环境变量的名称。如果需要<code>state=absent</code>。如果没有设置<code>name</code>并且<code>state=present</code>，那么无论现有的crontab条目是什么，都会创建一个新的crontab条目。</td></tr><tr><td>reboot</td><td>yes or no，默认no</td><td>是否应该在重新启动时运行作业。不赞成使用该选项。用户应该使用<code>special_time</code>。</td></tr><tr><td>special_time</td><td>annually or daily or hourly or monthly or reboot or weekly or yearly</td><td>特殊时间规范昵称。</td></tr><tr><td>state</td><td>absent or present，默认present</td><td>是否确保作业或环境变量存在或不存在。</td></tr><tr><td>user</td><td></td><td>需要修改crontab的用户。如果不设置，该参数默认使用root。</td></tr><tr><td>weekday</td><td>默认"*"</td><td>作业应该运行的星期几(0-6表示周日-周六，*等)</td></tr></tbody></table><h3 id="📌添加ntpdate定时任务">📌添加ntpdate定时任务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cron模块创建定时任务</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;ntp aliyun&#x27; minute=*/5 job=&#x27;ntpdate -u ntp.aliyun.com&#x27;&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;ntp aliyun&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">查看远程机器的crontab记录</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">* * * * * /usr/sbin/ntpdate time1.aliyun.com &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"> </span><br><span class="line"><span class="comment">#Ansible: ntp aliyun</span></span><br><span class="line">*/5 * * * * ntpdate -u ntp.aliyun.com</span><br></pre></td></tr></table></figure><h3 id="📌删除定时任务">📌删除定时任务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先检查远程的定时任务</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">* * * * * /usr/sbin/ntpdate time1.aliyun.com &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"> </span><br><span class="line"><span class="comment">#Ansible: ntp aliyun</span></span><br><span class="line">*/5 * * * * ntpdate -u ntp.aliyun.com</span><br><span class="line"> </span><br><span class="line"><span class="comment">#正统用法</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;ntp aliyun&#x27;  state=absent&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#歪门邪道</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -r&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="📌修改指定名称的定时任务">📌修改指定名称的定时任务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;12345&#x27; minute=30 hour=23 job=&#x27;echo  大鹏 &gt;&gt;/tmp/hello.log&#x27;&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;12345&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="comment">#Ansible: 12345</span></span><br><span class="line">30 23 * * * <span class="built_in">echo</span> 大鹏 &gt;&gt;/tmp/hello.log</span><br></pre></td></tr></table></figure><h2 id="8-group-模块">.8 group 模块</h2><p>📓<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/group_module.html#group-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/group_module.html#group-module</a></p><h3 id="📌创建wenjie-ops组，gid-1234">📌创建wenjie_ops组，gid=1234</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=wenjie_ops  gid=1234&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 1234, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;wenjie_ops&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="📌删除组">📌删除组</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=wenjie_ops gid=1234 state=absent&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;wenjie_ops&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;absent&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-user-用户模块">.9 user 用户模块</h2><h3 id="📓文档-v6">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/modules/user_module.html">https://docs.ansible.com/ansible/latest/modules/user_module.html</a></p><h3 id="📖-参数-v6">📖 参数</h3><table><thead><tr><th>模块参数</th><th>参数描述</th></tr></thead><tbody><tr><td>create_home</td><td>创建家目录，设置no则不创建家目录</td></tr><tr><td>group</td><td>创建用户组</td></tr><tr><td>name</td><td>创建用户的名字</td></tr><tr><td>password</td><td>创建用户的密码</td></tr><tr><td>uid</td><td>创建用户的UID</td></tr><tr><td>shell</td><td>用户登录解释器</td></tr><tr><td>state</td><td>Absent（删除用户）present（默认参数，创建）</td></tr><tr><td>expires</td><td>账户过期时间</td></tr></tbody></table><h3 id="📌创建用户">📌创建用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">注意该用户组是否存在，否则报错</span><br><span class="line">group，name，gid</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=cc01 gid=1777&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">创建用户，设置权限</span><br><span class="line">user  naem  uid  group  create_home  shell</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=cc01 gid=1777&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m user -a &quot;name=cc01 uid=1777 group=1777 create_home=no shell=/sbin/nologin &quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;create_home&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1777, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/cc01&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;cc01&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/sbin/nologin&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1777</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">检查用户</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;id cc01&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">uid=1777(cc01) gid=1777(cc01) <span class="built_in">groups</span>=1777(cc01)</span><br></pre></td></tr></table></figure><h2 id="10-yum-安装软件">.10 yum 安装软件</h2><h3 id="📓文档-v7">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html</a></p><h3 id="📖-概要-v6">📖 概要</h3><ul><li>使用yum包管理器安装、升级、降级、删除和列出包和组。</li><li>yum模块仅适用于python2，若使用python3则用dnf模块。</li></ul><h3 id="📖-参数-v7">📖 参数</h3><table><thead><tr><th>parameter（参数）</th><th align="left">choices/<em>default</em></th><th>comments（注解）</th></tr></thead><tbody><tr><td>allow_downgrade</td><td align="left">yes or no，默认no</td><td>指定指定的包和版本是否允许降级该包可能已经安装的更高版本。注意，设置allow_降级=True会使此模块以非幂等方式运行。该任务最终可能会得到一组与要安装的指定包的完整列表不匹配的包(因为降级的包与其他包之间的依赖关系可能会导致对先前事务中的包的更改)。</td></tr><tr><td>autoremove</td><td align="left">yes or no，默认no</td><td>如果<code>yes</code>，则从系统中删除所有“leaf”包，这些包最初是作为用户安装包的依赖项安装的，但任何此类包不再需要它们。应该单独使用还是在没有状态时使用<br>注意:该特性需要yum &gt;= 3.4.3 (RHEL/CentOS 7+)</td></tr><tr><td>bugfix</td><td align="left">yes or no，默认no</td><td>如果设置为yes，并且state=latest，则只安装标记为与bug修复相关的更新。</td></tr><tr><td>conf_file</td><td align="left"></td><td>用于事务的远程yum配置文件。</td></tr><tr><td>disable_excludes</td><td align="left"></td><td>禁用YUM配置文件中定义的排除。<br>如果设置为all，则禁用所有排除。<br>如果设置为main，禁用yum.conf中[main]中定义的排除。<br>如果设置为repoid，禁用为给定的repoid定义的排除。</td></tr><tr><td>disable_gpg_check</td><td align="left">yes or no，默认no</td><td>是否对正在安装的包进行GPG签名检查。仅当state为present或latest时才生效。</td></tr><tr><td>disable_plugin</td><td align="left"></td><td>安装/更新操作中禁用的插件名称。被禁用的插件将不会在事务之外持久存在。</td></tr><tr><td>disablerepo</td><td align="left"></td><td>Repoid存储库以禁用安装/更新操作。这些回购不会在交易结束后继续存在。当指定多个回购时，用“，”隔开。<br>在Ansible 2.7中，这也可以是一个列表，而不是“，”分隔字符串</td></tr><tr><td>download_dir</td><td align="left"></td><td>指定存储包的备用目录。<br>只有在指定download_only时才会生效。</td></tr><tr><td>download_only</td><td align="left">yes or no，默认no</td><td>只下载，不安装。</td></tr><tr><td>enable_plugin</td><td align="left"></td><td>用于安装/更新操作的插件名称。启用的插件将不会在事务之后持久存在。</td></tr><tr><td>enablerepo</td><td align="left"></td><td>Repoid存储库以启用安装/更新操作。这些回购不会在交易结束后继续存在。当指定多个回购时，用“，”隔开。<br>在Ansible 2.7中，这也可以是一个列表，而不是“，”分隔字符串</td></tr><tr><td>exclude</td><td align="left"></td><td>当state=present或latest时要排除的包名</td></tr><tr><td>install_weak_deps</td><td align="left">yes or no，默认yes</td><td>也将安装由弱依赖关系链接的所有包。<br>注意:该特性需要yum &gt;= 4 (RHEL/CentOS 8+)</td></tr><tr><td>installroot</td><td align="left">默认"/"</td><td>指定一个替代的installroot，所有的包都将相对于它安装。</td></tr><tr><td>list</td><td align="left"></td><td>要运行等价于yum list——show-duplicate &lt; Package &gt;的包名。除了列出软件包，use还可以列出以下:已安装、更新、可用和回购。<br>与name互斥。</td></tr><tr><td>lock_timeout</td><td align="left">默认30s</td><td>等待yum锁定文件释放的时间。</td></tr><tr><td>name</td><td align="left"></td><td>带有版本的包名或包说明符，如name-1.0。 如果指定了以前的版本，任务还需要打开allow_降级。有关降级包的注意事项，请参阅allow_降级文档。<br>当使用state=latest时，可以是’*'，这意味着运行yum -y update。 您还可以传递一个url或一个本地路径到rpm文件(使用state=present)。要操作多个包，可以使用逗号分隔的包字符串或(从2.0开始)包列表。</td></tr><tr><td>releasever</td><td align="left"></td><td>指定将从其中安装所有包的替代版本。</td></tr><tr><td>security</td><td align="left">yes or no，默认no</td><td>如果设置为yes，并且state=latest，则只安装标记为安全相关的更新。</td></tr><tr><td>skip_broken</td><td align="left">yes pr no，默认no</td><td>跳过依赖关系损坏的包(devsolve)并导致问题。</td></tr><tr><td>state</td><td align="left">absent <br>installed<br>latest<br>present <br>removed</td><td>是否安装(<code>present</code>或<code>intsalled</code>，<code>latest</code>)，或删除(<code>absent</code>或<code>removed</code>)软件包。<br><code>present</code>和<code>installed</code>将确保安装所需的软件包。<br><code>latest</code>将更新指定的包，如果它不是最新的可用版本。<br><code>absent</code>和<code>removed</code>将删除指定的包。<br>默认为<code>None</code>，但是实际上默认操作是存在的，除非该模块启用了自动删除选项，然后推断缺席。</td></tr><tr><td>update_cache</td><td align="left">yes or no，默认no</td><td>强制yum检查缓存是否过期，并在需要时重新下载。仅当state为present或latest时才生效。</td></tr><tr><td>update_only</td><td align="left">yes or no，默认no</td><td>使用latest时，只更新已安装的软件包。请勿安装软件包。<br>作为效果只有当<em>state</em>是<em>latest</em></td></tr><tr><td>use_backend</td><td align="left">auto(默认)<br>yum<br>yum4<br>dnf</td><td>这个模块支持yum(一如既往)，被上游yum开发者称为yum3/ yum3/ yum-deprecated。在Ansible 2.7+版本中，这个模块也支持YUM4，这是一个“新yum”，它有一个dnf后端。<br>默认情况下，该模块将基于ansible_pkg_mgr事实选择后端。</td></tr><tr><td>validate_certs</td><td align="left">yes or no，默认yes</td><td>这只适用于使用https url作为rpm的源。例如localinstall。如果设置为no，将不验证SSL证书。 在使用自签名证书的个人控制网站上，这只应该设置为no，因为它避免了验证源网站。<br>在2.1版本之前，这段代码的工作方式就好像设置为yes一样。</td></tr></tbody></table><h3 id="📌安装net-tools最新版本">📌安装net-tools最新版本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m yum -a &quot;name=net-tools state=latest&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌卸载net-rools软件">📌卸载net-rools软件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m yum -a &quot;name=net-tools state=absent&quot;</span></span><br></pre></td></tr></table></figure><h2 id="11-service-systemd模块">.11 service/systemd模块</h2><p>该模块作用是针对yum包管理</p><p>service适用于centos6前的系统</p><p>systemd命令适用于centos7系统</p><p><strong>要注意的是service模块依旧对centos7有效，但是建议大家使用systemd模块</strong></p><h3 id="📌安装，启动nginx服务">📌安装，启动nginx服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1.安装nginx服务</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m yum -a &quot;name=nginx state=installed&quot;</span></span><br><span class="line"> </span><br><span class="line">2.启动服务</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=started&quot;</span></span><br><span class="line"> </span><br><span class="line">3.查询状态，这里ansible为直接提供status参数，可以借助<span class="built_in">command</span>模块即可</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl status nginx&quot;</span></span><br><span class="line"> </span><br><span class="line">4.停止nginx服务</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=stopped&quot;</span></span><br><span class="line"> </span><br><span class="line">5.设置nginx开机自启</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=started enabled=yes&quot;</span></span><br><span class="line"> </span><br><span class="line">6.检查nginx状态</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl is-enabled nginx&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl status nginx&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">7.关闭开机自启，且停止服务</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=stopped enabled=no&quot;</span></span><br><span class="line"> </span><br><span class="line">8.再次检查状态</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web  -m shell -a &quot;systemctl is-enabled nginx;systemctl status nginx&quot;</span></span><br></pre></td></tr></table></figure><h2 id="12-mount-挂载模块">.12 mount 挂载模块</h2><h3 id="📓文档-v8">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/mount_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/mount_module.html</a></p><h3 id="📖-参数-v8">📖 参数</h3><table><thead><tr><th>参数</th><th>选项/默认值</th><th>描述</th></tr></thead><tbody><tr><td><strong>backup</strong> <br> <em>boolean</em></td><td><strong>·</strong> no ⬅️ <br> <strong>·</strong> yes</td><td>创建一个包含时间戳信息的备份文件，以便在您以某种方式错误地抓取原始文件时取回原始文件。</td></tr><tr><td><strong>boot</strong> <br> <em>boolean</em></td><td><strong>·</strong> yes ⬅️ <br> <strong>·</strong> no</td><td>确定文件系统是否应该挂载在引导上。<br>仅适用于Solaris系统。</td></tr><tr><td><strong>dump</strong> <br> <em>string</em></td><td>Default: 0</td><td>Dump（见fstab（5））。<br>请注意，如果设置为 null，state设置为present，它将停止工作，并将在后续运行中重复条目。<br>对Solaris系统没有影响。</td></tr><tr><td><strong>fstab</strong> <br> <em>string</em></td><td></td><td>文件代替/etc/fstab。<br>除非你真的知道自己在做什么，否则你不应该使用这个选项。<br>如果您需要在chroot环境中配置挂载点，这可能会很有用。<br>OpenBSD不允许指定带有挂载的备用fstab文件，因此不要在OpenBSD上以任何在实时文件系统上运行的状态使用它。<br>在Solaris上，此参数默认为/etc/fstab或/etc/vfstab。</td></tr><tr><td><strong>fstype</strong> <br> <em>string</em></td><td></td><td>文件系统类型。<br>当state是 present 或 mounted时需要。</td></tr><tr><td><strong>opts</strong> <br> <em>string</em></td><td></td><td>mount选项（请参阅solaris上的fstab（5）或vfstab（4））</td></tr><tr><td><strong>passno</strong> <br> <em>string</em></td><td>Default: 0</td><td>Passno（见fstab（5））。<br>请注意，如果设置为null 和state设置为present，它将停止工作，并将在后续运行中重复条目。<br>Solaris系统不建议使用。</td></tr><tr><td><strong>path</strong> <br> <em>path</em> <br> <mark>required</mark></td><td></td><td>挂载点的路径（例如/mnt/files）。<br>在Ansible 2.3之前，此选项只能用作dest、destfile和名称。</td></tr><tr><td><strong>src</strong> <br> <em>path</em></td><td></td><td>要被挂载设备的路径。当state设置为present或mounted时是必需的。</td></tr><tr><td><strong>state</strong> <br> <em>string</em> <br> <mark>required</mark></td><td><strong>·</strong> absent <br> <strong>·</strong> mounted <br> <strong>·</strong> present <br> <strong>·</strong> unmounted <br> <strong>·</strong> remounted</td><td>如果 mounted，设备将被主动安装，并在fstab中适当配置。如果挂载点不存在，则将创建挂载点。<br>如果 unmounted，设备将卸载而不更改fstab。<br>present 仅指定设备将在fstab中配置，不会触发或要求挂载。<br>absent 表示设备支架的条目将从fstab中删除，还将卸载设备并删除挂载点。<br>remounted 指定当您想强制刷新挂载本身时，设备将被重新安装（在2.9中添加）。这总是会返回 changed=true</td></tr></tbody></table><h3 id="📌给web机器组挂载nfs目录（只写入-etc-fstab而不挂载）">📌给web机器组挂载nfs目录（只写入/etc/fstab而不挂载）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=present&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌给web机器组挂载nfs目录（立即挂载且写入-etc-fstab）">📌给web机器组挂载nfs目录（立即挂载且写入/etc/fstab）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=mounted&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌取消挂载，以及删除fstab记录">📌取消挂载，以及删除fstab记录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=absent&quot;</span></span><br><span class="line"><span class="comment">#取消挂载，不删除fstab记录</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=umounted&quot;</span></span><br></pre></td></tr></table></figure><h2 id="13-archive压缩模块">.13 archive压缩模块</h2><h3 id="📓文档-v9">📓文档</h3><p><a href="https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html</a></p><h3 id="📌压缩-etc配置文件到指定路径">📌压缩/etc配置文件到指定路径</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m archive -a &quot;path=/etc dest=/opt/etc.tgz&quot;</span></span><br><span class="line"> </span><br><span class="line">查看</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;ls /opt -l&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">total 10092</span><br><span class="line">-rw-rw-rw- 1 www  www        0 May  6 20:11 666.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 9679353 May  7 20:36 etc.tgz</span><br><span class="line">drwxr-xr-x 2 www  www        6 May  6 22:13 hello_ansible</span><br><span class="line">-rw-r--r-- 1 root root       0 May  6 22:10 hello_ansible.log</span><br><span class="line">-rw-rw-rw- 1 www  www        0 May  6 22:20 hello-linux.log</span><br><span class="line">lrwxrwxrwx 1 root root      10 May  6 22:22 hosts -&gt; /etc/hosts</span><br><span class="line">-rw-r--r-- 1 root root  640923 May  6 20:17 log.tgz</span><br><span class="line">-rw------- 1 www  www       20 May  6 21:40 web-cf.log</span><br><span class="line">-rw------- 1 www  www        9 May  6 21:26 web-cf.log.6269.2022-05-06@21:35:30~</span><br><span class="line">-rw-r--r-- 1 root root       0 May  6 20:19 wenjie666</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">total 10392</span><br><span class="line"> </span><br><span class="line">查看文件类型</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;file /opt/etc.tgz&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">/opt/etc.tgz: gzip compressed data, was <span class="string">&quot;/opt/etc.tgz&quot;</span>, last modified: Sat May  7 20:36:34 2022, max compression</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">/opt/etc.tgz: gzip compressed data, was <span class="string">&quot;/opt/etc.tgz&quot;</span>, last modified: Sat May  7 20:36:34 2022, max compression</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h2 id="14-unarchive解压缩模块">.14 unarchive解压缩模块</h2><h3 id="📌解压缩etc-tgz到指定目录（远程解压）">📌解压缩etc.tgz到指定目录（远程解压）</h3><p>remote_src远程数据源</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">指定目录必须存在</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/etc_file state=directory&quot;</span></span><br><span class="line"> </span><br><span class="line">解压缩</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m unarchive -a &quot;src=/opt/etc.tgz dest=/opt/etc_file remote_src=yes&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">查看</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;ls /opt/etc_file/etc/&quot;</span></span><br></pre></td></tr></table></figure><h3 id="📌将管理机的压缩包，解压到远程机器上">📌将管理机的压缩包，解压到远程机器上</h3><p>将master-61的压缩文件，压缩到web组机器上</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.生成etc.tgz数据</span><br><span class="line">[root@master-61 ~]<span class="comment">#cd / &amp;&amp; tar -zcf /opt/etc.tgz etc</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 /]<span class="comment">#ls /opt/</span></span><br><span class="line">etc.tgz</span><br><span class="line"> </span><br><span class="line">2.远程解压到web组机器上</span><br><span class="line">[root@master-61 /]<span class="comment">#ansible web -m unarchive -a &quot;src=/opt/etc.tgz dest=/tmp/&quot;</span></span><br><span class="line"> </span><br><span class="line">3.检查</span><br><span class="line">[root@master-61 /]<span class="comment">#ansible web -a &quot;ls /tmp/etc/&quot;</span></span><br></pre></td></tr></table></figure><h2 id="15-fetch-从客户端服务文件模块">15. fetch 从客户端服务文件模块</h2><h3 id="📖-概要-v7">📖 概要</h3><ul><li>该模块的工作方式与copy类似，但相反。</li><li>它用于从远程机器获取文件并将它们本地存储在按主机名组织的文件树中。</li><li><em>如果dest</em>中已经存在的文件与<em>src</em>不同，它们将被覆盖。</li><li>Windows 目标也支持此模块。</li></ul><h3 id="📖-参数-v9">📖 参数</h3><table><thead><tr><th>parameter</th><th>choices/defaults</th><th>comments</th></tr></thead><tbody><tr><td>dest</td><td></td><td>保存文件的目录。例如，如果dest目录是/backup，则主机host.example.com上名为/etc/profile的src文件将被保存到/backup/host.example.com/etc/profile。主机名以库存名称为准</td></tr><tr><td>fail_on_missing</td><td>yes or no，默认为yes</td><td>当设置为yes时，如果由于任何原因无法读取远程文件，则任务将失败。</td></tr><tr><td>flat</td><td>yes or no，默认no</td><td>允许您覆盖将主机名/path/to/文件追加到目标的默认行为。如果dest以’/'结尾，它将使用源文件的基名，类似于copy模块。如果使用单个主机，或者检索每个主机唯一命名的文件，这可能很有用。如果使用多个具有相同文件名的主机，则每个主机的文件将被覆盖。</td></tr><tr><td>src</td><td></td><td>要在远程系统上获取的文件。这必须是一个文件，而不是目录。在以后的版本中可能会支持递归抓取。</td></tr><tr><td>validate_checksum</td><td>yes or no，默认yes</td><td>在获取文件之后，验证源和目标校验和是否匹配。</td></tr></tbody></table><h1 id="5）ansible-playbook-剧本模式">5）ansible-playbook 剧本模式</h1><p>Ansible的playbook模式就是针对特定的具体较大的任务，事先写好执行剧本，然后在其他机器上批量执行相同的任务，属于定制化的批量执行任务。</p><h3 id="playbook剧本的组成规范">playbook剧本的组成规范</h3><blockquote><p>剧本很重要的就是，定义演员的信息(其实就是定义主机的信息)，演员的具体任务(以及主机要执行的模块，动作)。<br>Ansible的剧本也是由两个最基本的部分组成。</p><ul><li>hosts定义的被管理的主机列表信息(演员有哪些)</li><li>tasks关键词定义的被管理主机需要执行的动作(演员要做什么事)</li></ul></blockquote><h3 id="剧本之hosts部分">剧本之hosts部分</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一，定义被管理主机的ip地址</span></span><br><span class="line">- hosts: 192. 168.178.138</span><br><span class="line">  tasks:</span><br><span class="line"> - name: 这是我第一个任务</span><br><span class="line">  yum: name=nginx state=installed</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二，定义被管理主机的名字，注意该主机名必须能够解析</span></span><br><span class="line">- hosts: backup01</span><br><span class="line">  tasks:</span><br><span class="line">    - name:需要执行的动作</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式三，定义多个主机信息</span></span><br><span class="line">- hosts: 192.168.178.138,192.168.178.139,backup01</span><br><span class="line">  tasks:</span><br><span class="line">- name: 执行的动作...</span><br><span class="line"></span><br><span class="line"><span class="comment">#方式四，填写所有的主机</span></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br></pre></td></tr></table></figure><blockquote><p>定义被管理的主机，有一个重要的前提，就是被管理的主机必须在ansible管理的hosts文件中有对应的信息，否则识别不了/etc/ansible/hosts</p></blockquote><h3 id="剧本之tasks讲解">剧本之tasks讲解</h3><blockquote><ul><li>变量形式定义task任务，name=&quot;shenfu” age=18</li><li>还可以使用字典形式定义，特点是<code>key:value</code>，相关的词语，自卑，自豪，自律，自力更生<ul><li>name:“shenfu”</li><li>age:18</li><li>addr: “北京沙河”</li></ul></li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义task方式一：采用变量形式设置任务</span></span><br><span class="line">tasks:</span><br><span class="line">  -name: make sure apache is runing</span><br><span class="line">    service: name=httpd state=running </span><br><span class="line"></span><br><span class="line">  - name: copy file. .</span><br><span class="line">copy: src=/etc/ansible/hosts dest=/etc/ansible/hosts</span><br><span class="line">  owner=root group=root mode=0644</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 当传入的参数列表过长的时候，我们还可以将其分割</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二，采用字典形式设置多个任务</span></span><br><span class="line">tasks:</span><br><span class="line">  - name:copy file to client...</span><br><span class="line">copy:</span><br><span class="line">  src: /etc/ansible/hosts </span><br><span class="line">  dest: /etc/ansible/hosts</span><br><span class="line">  owner: root</span><br><span class="line">  group: root</span><br><span class="line">      mode: 0644</span><br></pre></td></tr></table></figure><h3 id="yaml语法规范">yaml语法规范</h3><blockquote><p>在学习ansible的时候，编写palybook是最重要的环节，那么palybook是遵循yaml语法，因此需要掌握yaml语法的数据格式。</p></blockquote><blockquote><p>目前主流使用的数据格式，有json、xml、yaml，都属于数据序列化格式。</p><p>yaml更容易被解析，已读，因此更多的使用在了配置文件当中，ansible、saltstack、k8s都用yaml。</p></blockquote><blockquote><p>yaml基本语法</p><p>大小写敏感使用缩进表示层级的关系(同样的空格数量)<br>在配置缩进关系的时候，禁止用tab键，请一个一个用空格键表示相同元素的左侧空格数目不重要，只需要对其即可<br>yaml 语法支持的数据结构</p><p>对象，指的就是字典的概念，key: value，注意key: 后面有一个空格数组，指的就是列表的概念</p></blockquote><h3 id="playbook编写的规范">playbook编写的规范</h3><p>剧本的缩进关系，一般是两个空格作为一个缩进，且空格数目无所谓，左侧对齐即可。</p><h3 id="playbook实际编写与执行">playbook实际编写与执行</h3><blockquote><p>剧本编写完成之后，还得执行才能工作。在ansible程序中，加载模块的功能可以直接使用ansible adhoc命令行形执行加载剧本中的功能，可以使用ansible- playbook命令去执行脚本。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本执行语法</span></span><br><span class="line">ansible-playbook nginx.yaml   <span class="comment"># 可以使用绝对相对路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看剧本命令的帮相信息</span></span><br><span class="line">ansible-playbook -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看剧本的执行详细输出</span></span><br><span class="line">ansible-playbook nginx.yaml --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看剧本影响的主机列表信息</span></span><br><span class="line">ansible-playbook nginx.yaml --list-hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行剧本加载指定的主机清单文件，默认剧本使用的是/etc/ansible/hosts</span></span><br><span class="line">ansible-playbook nginx.yaml -i /etc/my_ansible/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行剧本并且检查语法</span></span><br><span class="line">ansible-playbook nginx.yaml --syntax-check</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试剧本，只是调试，但是不会对被管理节点发生改变</span></span><br><span class="line">ansible-playbook nginx.yaml -C <span class="comment"># 模拟执行，不影响客户端机器</span></span><br></pre></td></tr></table></figure><h3 id="📌使用剧本批量安装nginx服务">📌使用剧本批量安装nginx服务</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">     <span class="number">1</span><span class="comment"># install nginx yaml,by shenfu</span></span><br><span class="line">     <span class="number">2</span><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">     <span class="number">3</span>  <span class="attr">tasks:</span></span><br><span class="line">     <span class="number">4</span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">     <span class="number">5</span> <span class="attr">yum:</span> <span class="string">name=nginx</span> <span class="string">state=present</span></span><br><span class="line">     <span class="number">6</span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">Nignx.conf</span> <span class="string">to</span> <span class="string">every_server</span></span><br><span class="line">     <span class="number">7</span><span class="attr">copy:</span> <span class="string">src=./nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.表示注释信息，可以用#号，也可以用三个短横线当做注释</span></span><br><span class="line"><span class="comment"># 2.表示定义playbook管理的目标机器，可以写all管理所有，也可以单独的填写ip,也可以填写主机名</span></span><br><span class="line"><span class="comment"># 3.定义playbook需要完成的任务的集合，比如你要定义2，第一个是安装nginx通过yum模块，第二个是通过copy模块，发送管理节点上的配置文件，发送给被管理的客户端机器</span></span><br><span class="line"><span class="comment"># 4.定义任务的名字，是一个自定义的帮助信息</span></span><br><span class="line"><span class="comment"># 5.定义任务的具体操作，指定用哪些模块，与参数</span></span><br><span class="line"><span class="comment"># 6~7行作用是和4~5行是一样了</span></span><br></pre></td></tr></table></figure><h3 id="📌使用剧本部署rsync服务">📌使用剧本部署rsync服务</h3><blockquote><p>进行思考，剧本如何设计，和安排</p><p>先考虑好部署rsync的整个过程</p><p>部署的思路过程如下，然后转化成playbook剧本的过程就可以</p><p>安装rysnc服务，使用yum<br>编写rsync配置文件，(常用的操作是，在Ansible-01管理机器上编写好配置文件，分发给客户端机器即可) copy模块创建rsync用户，使用ansible的user模块创建用于rsync验证的文件，还是选择在Ansible-01上写好后分发，copy模块，注意文件权限设置创建数据备份的文件夹，rsync指定 了bakcup模块，备份目录是<br>/data_ backup/，调用file模块创建文件夹启动rsync服务端，且是守护进程模式，shell模块，systemd模块</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@m01</span> <span class="string">myyaml</span>]<span class="comment"># cat install_rsync.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.178</span><span class="number">.115</span></span><br><span class="line"> <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step01,install</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line"> <span class="attr">yum:</span> <span class="string">name=rsync</span> <span class="string">state=installed</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step02,edit</span> <span class="string">rsync</span> <span class="string">conf</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">copy:</span> <span class="string">src=/etc/ansible/rsync_conf/rsyncd.conf</span></span><br><span class="line"><span class="string">dest=/etc/rsync/conf/</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step03,create</span> <span class="string">user</span> <span class="string">rsync</span></span><br><span class="line">     <span class="attr">user:</span> <span class="string">name=rsync</span> <span class="string">state=present</span> <span class="string">createhome=no</span></span><br><span class="line"><span class="string">shell=/sbin/nolgoin</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step04,create</span> <span class="string">user</span> <span class="string">auth</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">copy:</span> <span class="string">src=/etc/ansible/rsync_conf/rsync.password</span></span><br><span class="line"><span class="string">dest=/etc/rsync/conf/</span> <span class="string">mode=0600</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step05,create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">     <span class="attr">file:</span> <span class="string">dest=/data_backup/</span> <span class="string">state=directory</span> <span class="string">owner=rsync</span></span><br><span class="line"><span class="string">group=rsync</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step06,run</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">     <span class="attr">shell:</span> <span class="string">rsync</span> <span class="string">--daemon</span> <span class="string">creates=/var/run/rsync.pid</span></span><br></pre></td></tr></table></figure><h1 id="6）Ansible-变量">6）Ansible 变量</h1><p>Ansible支持利用变量来存储值，并在Ansible项目的所有文件中重复使用这些值。这可以简化项目的创建和维护，并减少错误的数量。</p><p>通过变量，可以轻松地在Ansible项目中管理给定环境的动态值。例如，变量可能包含下面这些值：</p><ul><li>要创建的用户</li><li>要安装的软件包</li><li>要重新启动的服务</li><li>要删除的文件</li><li>要从互联网检索的存档</li></ul><h2 id="1-命名变量">.1 命名变量</h2><p>变量的名称必须以字母开头，并且只能包含字母、数字和下划线。</p><table><thead><tr><th>无效的变量名称</th><th>有效的变量名称</th></tr></thead><tbody><tr><td>web server</td><td>web_server</td></tr><tr><td>remote.file</td><td>remote_file</td></tr><tr><td>1st file</td><td>file_1 file1</td></tr><tr><td>remoteserver$1</td><td>remote_server_1 remote_server1</td></tr></tbody></table><h2 id="2-定义变量">.2 定义变量</h2><p>可以在Ansible项目中的多个位置定义变量。不过，这些变量大致可简化为三个范围级别：</p><ul><li>全局范围：从命令行或Ansible配置设置的变量</li><li>Play范围：在play和相关结构中设置的变量</li><li>主机范围：由清单、事实收集或注册的任务，在主机组和个别主机上设置的变量</li></ul><p>如果在多个xekl定义了相同名称的变量，则采用优先级别最高的变量。窄范围优先于更广泛的范围：由清单定义的变量将被playbook定义的变量覆盖，后者将被命令行中定义的变量覆盖。</p><h3 id="2-1-在playbook文件中进行变量定义">.2.1 在playbook文件中进行变量定义</h3><p>Playbook变量可以通过多种方式定义。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 方式一：在模块下定义变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat nfs_yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: install tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">      vars:</span><br><span class="line">        packages:</span><br><span class="line">        - tree</span><br><span class="line">    - name: remove tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">        state: absent</span><br><span class="line">      vars:</span><br><span class="line">        packages:</span><br><span class="line">        - tree</span><br><span class="line"><span class="comment">#问题：</span></span><br><span class="line">1.如果将变量设置到模块下，那么其他的name是不识别的</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 方式二：在hosts下定义变量</span></span><br><span class="line">[root@m01 ~] <span class="comment"># vim yum.yml</span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    packages:</span><br><span class="line">      - tree</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span>  </span><br><span class="line">    - name: remove tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">        state: absent</span><br><span class="line"><span class="comment">#问题：</span></span><br><span class="line">1.创建目录时可能会出现格式转换问题</span><br><span class="line">2.如果将变量设置到hosts下，那么其他的hosts是不识别的</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 方式三：在hosts下面定义多个变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat nfs_yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    packages:</span><br><span class="line">      - tree</span><br><span class="line">    db: </span><br><span class="line">      - httpd</span><br><span class="line">      - httpd-tools</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span>  </span><br><span class="line">    - name: install httpd server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; db &#125;&#125;&quot;</span></span><br><span class="line">    - name: Mkdir Dir</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; packages &#125;&#125;</span><br><span class="line">        state: directory</span><br></pre></td></tr></table></figure><h3 id="2-2-通过vars-file定义变量">.2.2 通过vars_file定义变量</h3><p>刚才我们学到在playbook中使用vars定义变量，有一个缺陷，就是其他的playbook无法使用该变量。所以我们可以采取第二种定义变量的方式，在vars_file中定义变量。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.准备变量文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim vars.yml </span></span><br><span class="line">web: </span><br><span class="line">  - httpd</span><br><span class="line">  - httpd-tools</span><br><span class="line">db: tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.调用变量文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars_files: /root/vars.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed http Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; web &#125;&#125;&quot;</span></span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; db &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>注意：当变量用作开始一个值的第一元素时，必须使用引号。这可以防止Ansible将变量引用视为YAML字典的开头。</p><h3 id="2-3-通过Inventory主机清单中进行变量定义">.2.3 通过Inventory主机清单中进行变量定义</h3><p>这是较旧的做法，不建议采用，但你可能会在未来的工作当中遇到。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.配置主机清单</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">... ...</span><br><span class="line">[db_server]</span><br><span class="line">db01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[db_server:vars]</span><br><span class="line">web=httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.调用变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim yum.yml </span></span><br><span class="line">- hosts: db_server</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; web &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：</span></span><br><span class="line">1.主机清单中定义变量，只要hosts配置的是主机清单中设置变量的组，可以直接使用变量</span><br><span class="line">2.如果hosts配置的不是主机清单中设置变量的组，变量不可识别</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.主机清单定义变量注意</span></span><br><span class="line">1.设置主机清单的变量</span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts</span></span><br><span class="line">[lb_group]</span><br><span class="line">lb01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">lb02 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[web_group]</span><br><span class="line">web01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">web02 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[nginx:children]</span><br><span class="line">web_group</span><br><span class="line">lb_group</span><br><span class="line"></span><br><span class="line">[nginx:vars]</span><br><span class="line">web=nginx_group</span><br><span class="line"></span><br><span class="line">[web_group:vars]  </span><br><span class="line">web=nginx_host</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.主机组定义的变量优先级高于整合组定义的变量 </span></span><br><span class="line"><span class="comment"># 2.主机定义的变量优先级高于主机组定义的变量</span></span><br></pre></td></tr></table></figure><h3 id="2-4-通过hosts-vars和group-vars定义变量">2.4 通过hosts_vars和group_vars定义变量</h3><p>之前的几种变量定义都不是很好用，比较好用的是在Ansible项目目录下创建两个变量目录 <code>host_vars</code>、 <code>group_vars </code>切记，目录名字一定要一致，不能做任何修改。</p><p>1️⃣主机组定义变量</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.创建主机组变量的目录，不能改名字</span></span><br><span class="line">[root@m01 ~]<span class="comment"># mkdir group_vars</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.目录下创建变量文件，文件的名字要跟主机清单中主机组名字一致</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cd group_vars/</span></span><br><span class="line">[root@m01 group_vars]<span class="comment"># vim web_group</span></span><br><span class="line">file: group_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.调用变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#4.注意：</span></span><br><span class="line">1.只要剧本中的hosts与设置变量的主机组名字相同，就可以直接使用变量</span><br></pre></td></tr></table></figure><p>2️⃣主机定义变量</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.创建主机变量的目录，不能改名字</span></span><br><span class="line">[root@m01 ~]<span class="comment"># mkdir host_vars</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.目录下创建变量文件，文件的名字要跟主机清单中主机名字一致</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim host_vars/web01</span></span><br><span class="line">file: host_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.调用变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.执行</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.查看执行结果</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 22 17:35 host_vars</span><br><span class="line">[root@web02 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec 22 17:35 group_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.注意：</span></span><br><span class="line">1）主机组定义的变量优先级高于整合组定义的变量</span><br><span class="line">2）主机定义的变量优先级高于主机组定义的变量</span><br></pre></td></tr></table></figure><h3 id="2-5-命令行定义变量（命令行-e-设置变量）">2.5 命令行定义变量（命令行 -e 设置变量）</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、查看剧本文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、命令行指定变量执行</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml -e &quot;file=minglinghang&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、查看远端文件</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 22 17:41 minglinghang</span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec 22 17:41 minglinghang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、修改剧本</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file2 &#125;&#125; </span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、命令行指定多个变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml -e &quot;file=command&quot; -e &quot;file2=command2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-6-直接使用内置变量">2.6 直接使用内置变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看内置变量 </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible &#x27;web_group&#x27; -m setup</span></span><br><span class="line"><span class="comment"># 查看内部变量的主机名</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible &#x27;web_group&#x27; -m setup -a &#x27;filter=ansible_fqdn&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用内置变量创建目录，目录格式为 主机名_IP_时间</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml   </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /backup/&#123;&#123; ansible_fqdn &#125;&#125;_&#123;&#123; ansible_eth1.ipv4.address &#125;&#125;_&#123;&#123; ansible_date_time.date &#125;&#125;</span><br><span class="line">        state: directory</span><br><span class="line">        </span><br><span class="line">[root@nfs ~]<span class="comment"># ll    #相当于在nfs机器上创建时间备份目录</span></span><br><span class="line">drwxr-xr-x 2 root root  6 May  6 22:37 nfs_172.16.1.131_2021-05-06</span><br></pre></td></tr></table></figure><h3 id="2-7-内置变量设置变量">2.7 内置变量设置变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim test.yml   </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    - host: <span class="string">&quot;&#123;&#123;ansible_fqdn &#125;&#125;&quot;</span></span><br><span class="line">    - remoe_ip: <span class="string">&quot;&#123;&#123; ansible_eth1.ipv4.address &#125;&#125;&quot;</span></span><br><span class="line">    - <span class="built_in">date</span>: <span class="string">&quot;&#123;&#123; ansible_date_time.date &#125;&#125;&quot;</span></span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /backup/&#123;&#123; remote_ip &#125;&#125;_&#123;&#123; host &#125;&#125;_&#123;&#123; <span class="built_in">date</span> &#125;&#125;</span><br><span class="line">        state: directory</span><br></pre></td></tr></table></figure><h3 id="2-8-内置变量常用方式">2.8 内置变量常用方式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.编写配置文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> &#123;&#123; ansible_eth1.ipv4.address &#125;&#125;</span><br><span class="line"><span class="comment"># 2.配置playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat redis.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: install redis server</span><br><span class="line">      yum:</span><br><span class="line">        name: redis</span><br><span class="line"></span><br><span class="line">    - name: config redis </span><br><span class="line">      template:</span><br><span class="line">        src: /root/mm/redis.conf</span><br><span class="line">        dest: /etc</span><br><span class="line"><span class="comment"># 3.执行</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook redis.yml</span></span><br><span class="line"><span class="comment"># 4.查看结果</span></span><br><span class="line">[root@web01 ~]<span class="comment"># grep &#x27;^bind&#x27; /etc/redis.conf </span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.107</span><br><span class="line">[root@web02 ~]<span class="comment"># grep &#x27;^bind&#x27; /etc/redis.conf </span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.108</span><br></pre></td></tr></table></figure><h3 id="2-9-层级变量">2.9 层级变量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.编辑变量文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim vars_file.yml</span></span><br><span class="line">lamp:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: httpd</span><br><span class="line">    db_package: mariadb-server</span><br><span class="line">    php_package: php</span><br><span class="line"></span><br><span class="line">lnmp:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: nginx</span><br><span class="line">    db_package: mysql</span><br><span class="line">    php_package: php</span><br><span class="line"></span><br><span class="line">lnmt:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: nginx</span><br><span class="line">    db_package: mysql</span><br><span class="line">    java_package: tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.编辑playbook文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  vars_files: ./vars_file.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install LAMP httpd</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.web_package &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP mariadb-server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.db_package &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP php</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.php_package &#125;&#125;&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 3.官方推荐写法</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  vars_files: ./vars_file.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install LAMP httpd</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;web_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP mariadb-server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;db_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP php</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;php_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.执行playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml</span></span><br></pre></td></tr></table></figure><h2 id="3-变量注册">.3 变量注册</h2><p>当Absible的模块运行以后，其实都会返回一些结果（result），就像是执行脚本，我们有的时候需要脚本给我们一些返回值（return），这时我们才知道，上一步是否可以执行成功；但是…默认情况下，Ansible的结果（result）并不会显示出来，所以，我们可以把这些返回值’存储’到变量中，这样我们就能通过’调用’对应的变量名，从而获取到这些结果（result），这种将模块的返回值，写入到变量中的方法被称为变量注册。</p><p><strong>使用ad-hoc模式会得到返回结果</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible web01 -m shell -a &#x27;df -h&#x27;</span></span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 475M     0  475M   0% /dev</span><br><span class="line">tmpfs                    487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs                    487M  7.6M  479M   2% /run</span><br><span class="line">tmpfs                    487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   17G  2.3G   15G  13% /</span><br><span class="line">/dev/sda1               1014M  163M  852M  17% /boot</span><br><span class="line">tmpfs                     98M     0   98M   0% /run/user/0</span><br></pre></td></tr></table></figure><p><strong>使用playbook执行同样的命令得不到结果</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># cat test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: list File</span><br><span class="line">      shell: <span class="string">&quot;df -h &quot;</span></span><br><span class="line">      </span><br><span class="line">[root@m01 ~]<span class="comment"># vim a.yml </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook a.yml </span></span><br><span class="line"></span><br><span class="line">PLAY [web01] ******************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] ********************************************************************</span><br><span class="line">ok: [web01]</span><br><span class="line"></span><br><span class="line">TASK [list <span class="built_in">dir</span>] ***************************************************************************</span><br><span class="line">changed: [web01]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ********************************************************************************</span><br><span class="line">web01                      : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><p><strong>使用注册变量的方式</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、注册一个变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、调用并输出变量</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line">    - name: Get Register</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; get_dir_list &#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 3、只输出想要的部分</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line">    - name: Get Register</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; get_dir_list[&#x27;stdout_lines&#x27;] &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>变量注册一般使用场景</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 lnmp]<span class="comment"># cat lnmp2.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Tar php Package</span><br><span class="line">      unarchive:</span><br><span class="line">        src: /root/package/php.tar.gz</span><br><span class="line">        dest: /tmp/</span><br><span class="line"></span><br><span class="line">    - name: Check php Install Status</span><br><span class="line">      shell: <span class="string">&quot;rpm -qa | grep php | wc -l&quot;</span></span><br><span class="line">      register: get_php_instll_status</span><br><span class="line"></span><br><span class="line">    - name: Install php Server </span><br><span class="line">      shell: <span class="string">&quot;yum localinstall -y /tmp/*.rpm&quot;</span></span><br><span class="line">      when: get_php_instll_status.stdout_lines == 0</span><br><span class="line"></span><br><span class="line">    - name: Config php Server</span><br><span class="line">      copy:</span><br><span class="line">        src:/root/mm/php.ini</span><br><span class="line">        dest: /etc/ </span><br><span class="line"></span><br><span class="line">    - name: Config php Server</span><br><span class="line">      copy:</span><br><span class="line">        src: /root/mm/www.conf</span><br><span class="line">        dest: /etc/php-fpm.d/</span><br><span class="line"></span><br><span class="line">    - name: Start php Server</span><br><span class="line">      systemd:</span><br><span class="line">        name: php-fpm</span><br><span class="line">        state: started</span><br></pre></td></tr></table></figure><h2 id="4-facts缓存">.4 facts缓存</h2><p>Ansible facts是在被管理主机上通过Ansible自动采集发现的变量。facts包含每台特定的主机信息。比如：被控端的主机名、IP地址、系统版本、CPU数量、内存状态、磁盘状态等等。</p><p>使用场景：</p><ol><li><p>通过facts缓存检查CPU，来生成对应的nginx配置文件</p></li><li><p>通过facts缓存检查主机名，生成不同的redis配置文件</p></li><li><p>通过facts缓存检索物理机的内存大小来生成不通的mysql配置文件</p></li></ol><p><strong>查看所有内置变量</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i hosts web -m setup &gt; facts.json</span><br></pre></td></tr></table></figure><p>内容较多保存的json文件中查看。</p><p><strong>关闭facts缓存</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim facts.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  gather_facts: no   <span class="comment">#关闭信息采集</span></span><br><span class="line">  tasks:</span><br><span class="line">  </span><br><span class="line"><span class="comment">#如果不使用内置变量，可以关闭会提高剧本的执行速度，如果使用内置变量，那么不能关闭facts缓存</span></span><br></pre></td></tr></table></figure><p><strong>一般使用</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.配置redis配置文件</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> &#123;&#123; ansible_eth1.ipv4.address &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.编写剧本</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install Redis Server</span><br><span class="line">      yum:</span><br><span class="line">        name: redis</span><br><span class="line">        state: present</span><br><span class="line"></span><br><span class="line">    - name: Config Redis Server</span><br><span class="line">      template:</span><br><span class="line">        src: /root/mm/redis.conf</span><br><span class="line">        dest: /etc/</span><br><span class="line">        </span><br><span class="line"><span class="comment">#3.查看受控端配置</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.107</span><br><span class="line">[root@web02 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.108</span><br></pre></td></tr></table></figure><h2 id="5-handlers-触发器">.5 handlers 触发器</h2><h2 id="6-when-条件">.6 when 条件</h2><h2 id="7-with-item循环">.7 with item循环</h2>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
          <category> Operations </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bitwarden</title>
      <link href="/posts/cd0249f6.html"/>
      <url>/posts/cd0249f6.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" />]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Docker Compose 部署 Zabbix6.0 Server</title>
      <link href="/posts/9d568281.html"/>
      <url>/posts/9d568281.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="更新日志">更新日志</h1><p>v1.0 Docker-compose 部署 Zabbix6.0 Server（20230223）</p><h1 id="1）部署">1）部署</h1><p>📌 <strong>创建容器映射文件夹</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/zabbix-server</span><br><span class="line"><span class="comment"># mkdir -p /data/zabbix/mysql/data # 别创建否则启动不了</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/mysql/conf</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/mysql/logs</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/font</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/snmptraps</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/mibs</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/alertscripts</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zabbix/externalscripts</span><br></pre></td></tr></table></figure><blockquote><p>⚠️ 创建数据库出现错误！</p><blockquote><p>[ERROR] [MY-010457] [Server] --initialize specified but the data directory has files in it. Aborting.<br>[ERROR] [MY-013236] [Server] The designated data directory /var/lib/mysql/ is unusable. You can remove all files<br>docker start</p></blockquote><p>解决方法：</p><blockquote><p>删除掉<code>/data/zabbix/mysql/data</code>，不要去创建这个目录，在启动堆栈时会自行创建。</p></blockquote></blockquote><p>📌 <strong>解决zabbix web的官方字体中文乱码</strong>：</p><p>Win字体在 <code>C:\Windows\Fonts\simfang.ttf</code> 提取。</p><p>将字体文件放入<code>/data/zabbix/mysql/logs</code></p><p>📌<strong>拉取镜像</strong>：</p><p>可以不拉，执行compose命令时如果没有也会拉取。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0</span><br><span class="line">docker pull zabbix/zabbix-java-gateway:6.0-centos-latest</span><br><span class="line">docker pull zabbix/zabbix-snmptraps:6.0-centos-latest</span><br><span class="line">docker pull zabbix/zabbix-server-mysql:6.0-centos-latest</span><br><span class="line">docker pull zabbix/zabbix-web-nginx-mysql:6.0-centos-latest</span><br></pre></td></tr></table></figure><p>检查一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>📌 <strong>编辑zabbix6.0-server.yml文件部署容器堆栈</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/zabbix</span><br><span class="line">vim ./zabbix6.0-server.yml</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    container_name: mysql</span><br><span class="line">    volumes:</span><br><span class="line">      - ./mysql/data:/var/lib/mysql</span><br><span class="line">      - ./mysql/conf:/etc/mysql/conf.d</span><br><span class="line">      - ./mysql/logs:/var/log/mysql</span><br><span class="line">      - /etc/localtime:/etc/localtime</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=myrootpass</span><br><span class="line">      - MYSQL_DATABASE=zabbix</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=mypass</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">      - LANG=en_US.UTF-8</span><br><span class="line">    expose:</span><br><span class="line">      - <span class="string">&quot;3306&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      zabbix-net:</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      --character-set-server=utf8mb4</span><br><span class="line">      --collation_server=utf8mb4_bin</span><br><span class="line">      --default-authentication-plugin=mysql_native_password</span><br><span class="line">      </span><br><span class="line">  zabbix-gateway:</span><br><span class="line">    image: zabbix/zabbix-java-gateway:6.0-centos-latest</span><br><span class="line">    container_name: zabbix-gateway</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/localtime:/etc/localtime</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;10052:10052&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      zabbix-net:</span><br><span class="line">  zabbix-snmptraps:</span><br><span class="line">    image: zabbix/zabbix-snmptraps:6.0-centos-latest</span><br><span class="line">    container_name: zabbix-snmptraps</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/localtime:/etc/localtime</span><br><span class="line">      - ./snmptraps:/var/lib/zabbix/snmptraps</span><br><span class="line">      - ./mibs:/var/lib/zabbix/mibs</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;1162:1162/udp&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      zabbix-net:</span><br><span class="line">      </span><br><span class="line">  zabbix-server:</span><br><span class="line">    image: zabbix/zabbix-server-mysql:6.0-centos-latest</span><br><span class="line">    container_name: zabbix-server</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/localtime:/etc/localtime</span><br><span class="line">      - ./snmptraps:/var/lib/zabbix/snmptraps</span><br><span class="line">      - ./mibs:/var/lib/zabbix/mibs</span><br><span class="line">      - ./alertscripts:/usr/lib/zabbix/alertscripts</span><br><span class="line">      - ./externalscripts:/usr/lib/zabbix/externalscripts</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    environment:</span><br><span class="line">      - ZBX_LISTENPORT=10051</span><br><span class="line">      - DB_SERVER_HOST=mysql</span><br><span class="line">      - DB_SERVER_PORT=3306</span><br><span class="line">      - MYSQL_DATABASE=zabbix</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=mypass</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=myrootpass</span><br><span class="line">      - ZBX_CACHESIZE=1G</span><br><span class="line">      - ZBX_HISTORYCACHESIZE=512M</span><br><span class="line">      - ZBX_HISTORYINDEXCACHESIZE=16M</span><br><span class="line">      - ZBX_TRENDCACHESIZE=256M</span><br><span class="line">      - ZBX_VALUECACHESIZE=256M</span><br><span class="line">      - ZBX_STARTPINGERS=64</span><br><span class="line">      - ZBX_IPMIPOLLERS=1</span><br><span class="line">      - ZBX_ENABLE_SNMP_TRAPS=<span class="literal">true</span></span><br><span class="line">      - ZBX_STARTTRAPPERS=1</span><br><span class="line">      - ZBX_JAVAGATEWAY_ENABLE=<span class="literal">true</span></span><br><span class="line">      - ZBX_JAVAGATEWAY=zabbix-gateway</span><br><span class="line">      - ZBX_STARTJAVAPOLLERS=1</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;10051:10051&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      zabbix-net:</span><br><span class="line">    links:</span><br><span class="line">      - mysql</span><br><span class="line">      - zabbix-gateway</span><br><span class="line">      </span><br><span class="line">  zabbix-web:</span><br><span class="line">    image: zabbix/zabbix-web-nginx-mysql:6.0-centos-latest</span><br><span class="line">    container_name: zabbix-web</span><br><span class="line">    volumes:</span><br><span class="line">      - ./font/simfang.ttf:/usr/share/zabbix/assets/fonts/DejaVuSans.ttf</span><br><span class="line">      - /etc/localtime:/etc/localtime</span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    environment:</span><br><span class="line">      - ZBX_SERVER_NAME=Zabbix 6.0</span><br><span class="line">      - ZBX_SERVER_HOST=zabbix-server</span><br><span class="line">      - ZBX_SERVER_PORT=10051</span><br><span class="line">      - DB_SERVER_HOST=mysql</span><br><span class="line">      - DB_SERVER_PORT=3306</span><br><span class="line">      - MYSQL_DATABASE=zabbix</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=mypass</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=myrootpass</span><br><span class="line">      - PHP_TZ=Asia/Shanghai</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;80:8080&quot;</span></span><br><span class="line">    networks:</span><br><span class="line">      zabbix-net:</span><br><span class="line">    links:</span><br><span class="line">      - mysql</span><br><span class="line">      - zabbix-server</span><br><span class="line">      </span><br><span class="line">networks:</span><br><span class="line">  zabbix-net:</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: 10.10.10.0/24</span><br><span class="line">          gateway: 10.10.10.1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>📌 <strong>启动Zabbix Server容器堆栈</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f zabbix6.0-server.yml up -d</span><br></pre></td></tr></table></figure><hr><h1 id="2）访问页面成功">2）访问页面成功</h1><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223233517011.png" alt="image-20230223233517011"></p><h1 id="3）如何让“本”宿主机的agent连上docker内的zabbix-server？">3）如何让“本”宿主机的agent连上docker内的zabbix server？</h1><p>1️⃣修改agent的配置文件：（我这里用的是zabbix-agent2）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xxx.xxx.xxx 处填入你的宿主机ip</span></span><br><span class="line">sed -i <span class="string">&#x27;s#Server=127.0.0.1#Server=xxx.xxx.xxx#g&#x27;</span> /etc/zabbix/zabbix_agent2.conf</span><br><span class="line"></span><br><span class="line">systemctl restart zabbix-agent2</span><br></pre></td></tr></table></figure><p>2️⃣修改web端中</p><p>监测-&gt;主机-&gt;选择主机-&gt;配置</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230224233232822.png" alt="image-20230224233232822"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230224233451067.png" alt="image-20230224233451067"></p><p>启动有时候比较慢稍微等待个30s，然后图标就变绿了~</p>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
          <category> Operations </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 部署兰空图床 Lsky Pro + Picgo</title>
      <link href="/posts/bacf3f29.html"/>
      <url>/posts/bacf3f29.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2023-02-23_13-49-43.png" alt="Snipaste_2023-02-23_13-49-43"></p><blockquote><p><strong>Nginx 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。</strong></p><p><strong><a href="http://Acme.sh">Acme.sh</a> 是一个自动申请证书工具。</strong></p><p><strong>Lsky Pro 兰空图床可以帮您保管大量无处安放的图片，数据可以自由选择储存驱动，支持主流第三方储存。作为一个助手，它不仅可以将您把图片以指定规则存放在指定位置，还有更多强大的功能来帮助您处理这些图片。</strong></p><p><strong>Mariadb是一个关系型数据库管理系统。</strong></p><p><strong>Picgo 一个用于快速上传图片并获取图片 URL 链接的工具</strong></p></blockquote><h1 id="更新日志：">更新日志：</h1><p><strong>v1.0 Docker 安装兰空图床（20230223）</strong></p><p><strong>v1.1 拉取新的lsky镜像 修改nginx的配置文件 增加获取tokens的方法（20230302）</strong></p><h1 id="1）安装-Docker">1）安装 Docker</h1><h2 id="1-环境设置">1. 环境设置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/Centos-base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h2 id="2-开启-Linux-内核的流量转发">2. 开启 Linux 内核的流量转发</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/sysctl.d/docker.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="3-重新加载修改内核参数的配置文件">3. 重新加载修改内核参数的配置文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 向内核中加载模块</span></span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="comment"># 重新加载配置文件</span></span><br><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br></pre></td></tr></table></figure><h2 id="4-yum安装-Docker">4. yum安装 Docker</h2><p>首先需要将虚拟机联网，安装yum工具、存储驱动、逻辑卷管理：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 --skip-broken</span><br></pre></td></tr></table></figure><p>更新本地镜像源：(<code>yum-config-manager</code> 命令的本质是对 <code>/etc/yum.repos.d/</code>(库数据的储存位置)文件夹下文件的增删查改。)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sed -i <span class="string">&#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><p>安装docker-ce：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure><h2 id="5-配置镜像加速器">5. 配置镜像加速器</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">touch</span> /etc/docker/daemon.conf</span><br><span class="line">vim /etc/docker/daemon.conf</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">　　<span class="string">&quot;registry-mirrors&quot;</span>:[</span><br><span class="line">　　　　<span class="string">&quot;https://8xpk5wnt.mirror.aliyun.com&quot;</span></span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-启动-Docker">6. 启动 Docker</h2><p><strong>关闭防火墙</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 禁止开机启动防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><p><strong>启动 docker</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><hr><h1 id="2）安装docker-compose">2）安装docker-compose</h1><p>切记docker-compose不要使用yum安装，版本太旧。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/v2.16.0/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="comment">#curl -L https://get.daocloud.io/docker/compose/releases/download/v2.16.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用 </span></span><br><span class="line"><span class="comment"># ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span></span><br></pre></td></tr></table></figure><hr><h1 id="3）Nginx-配置">3）Nginx 配置</h1><p><strong>创建容器卷映射文件夹</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/nginx/conf</span><br><span class="line"><span class="built_in">mkdir</span> /data/nginx/html</span><br><span class="line"><span class="built_in">mkdir</span> /data/nginx/logs</span><br></pre></td></tr></table></figure><p>启动下 Nginx 容器：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --<span class="built_in">rm</span> --name temp-nginx -d nginx</span><br></pre></td></tr></table></figure><p><strong>复制容器内的内容</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> temp-nginx:/etc/nginx/nginx.conf /data/nginx/conf/nginx.conf</span><br><span class="line">docker <span class="built_in">cp</span> temp-nginx:/etc/nginx/conf.d /data/nginx/conf/conf.d</span><br><span class="line">docker <span class="built_in">cp</span> temp-nginx:/usr/share/nginx/html /data/nginx</span><br><span class="line"><span class="built_in">chmod</span> 777 /data/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p><strong>关闭容器</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop temp-nginx</span><br></pre></td></tr></table></figure><p><strong>新建配置文件</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /data/nginx/conf/conf.d/lsky-pro.conf</span><br></pre></td></tr></table></figure><p><strong>黏贴以下配置</strong>：</p><p>使用的自己的ssl证书</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    server_namexxx.xxxx.xxx;<span class="comment"># 图床的访问地址（填自己的） </span></span><br><span class="line">    rewrite ^(.*) https://$host<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_namexxx.xxxx.xxx;<span class="comment"># 图床的访问地址（填自己的） </span></span><br><span class="line">    ssl_certificate     /cert/fullchain.cer;<span class="comment"># ssl证书（填自己的） </span></span><br><span class="line">    ssl_certificate_key /cert/*.xxx.xxx.key;<span class="comment"># key（填自己的） </span></span><br><span class="line">    ssl_session_cache shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout 30m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers HIGH:!aNULL:!MD5:!EXPORT56:!EXP;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    proxy_connect_timeout 500;</span><br><span class="line">    proxy_send_timeout 500;</span><br><span class="line">    proxy_read_timeout 500;</span><br><span class="line">    client_max_body_size 10m;<span class="comment"># 上传的图片的最大大小</span></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://172.28.0.3;<span class="comment"># docker中lsky app的ip</span></span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>:443;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        proxy_set_header REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>按</strong><kbd>i</kbd>，<kbd>Shift</kbd> + <kbd>Ctrl</kbd> + <kbd>v</kbd> 黏贴；</p><p><strong>按</strong><kbd>Esc</kbd><strong>输入</strong><code>:wq</code>。<strong>保存后退出</strong>。</p><h1 id="4）安装兰空图床">4）安装兰空图床</h1><p><strong>创建lsky-pro的根目录</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data/lsky-pro</span><br><span class="line"><span class="built_in">cd</span> /mydata/lsky-pro</span><br></pre></td></tr></table></figure><p><strong>写入docker-compose.yml配置</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p><strong>黏贴下面的配置</strong>：</p><p>⚠️ <strong>坑点</strong>：</p><p>1️⃣<span style="color:red;">大部分新手阵亡于此。因为yaml文件对格式缩进要求很严格，请自行使用格式化工具或者手动调整缩进。</span></p><p>2️⃣这里强行指定网络，不然如果重启容器内经常会混乱。<strong><span style="background:cyan; ">我自己也在这里卡了好久</span></strong>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3.9&quot;</span></span><br><span class="line">services:</span><br><span class="line">    nginx:<span class="comment"># Nginx 反向代理</span></span><br><span class="line">        image: nginx:latest</span><br><span class="line">        container_name: nginx</span><br><span class="line">        depends_on:</span><br><span class="line">            - acme.sh</span><br><span class="line">        volumes:</span><br><span class="line">            - /data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf</span><br><span class="line">            - /data/nginx/conf/conf.d:/etc/nginx/conf.d</span><br><span class="line">            - /data/nginx/html:/usr/share/nginx/html</span><br><span class="line">            - /data/nginx/logs:/var/log/nginx</span><br><span class="line">            - /data/acme/*.xxxx.xxx_ecc:/cert  <span class="comment"># 证书文件夹 lsky 申请证书 （填自己的）   </span></span><br><span class="line">        ports:<span class="comment"># 对外开放 80 (http) 和 443 (https) 端口</span></span><br><span class="line">            - 80:80</span><br><span class="line">            - 443:443</span><br><span class="line">        restart: always</span><br><span class="line">        networks:</span><br><span class="line">            mynetwork:</span><br><span class="line">                ipv4_address: 172.28.0.2</span><br><span class="line">  </span><br><span class="line">    acme.sh:<span class="comment"># ssl证书生成</span></span><br><span class="line">        image: neilpang/acme.sh</span><br><span class="line">        container_name: acme.sh</span><br><span class="line">        restart: always</span><br><span class="line">        environment:</span><br><span class="line">            - CF_Token=xxxxxxxxxxxxx<span class="comment">#我这里是 CloudFlare</span></span><br><span class="line">            - CF_Account_ID=xxxxxxxxxxxxx<span class="comment">#我这里是 CloudFlare</span></span><br><span class="line">        <span class="built_in">command</span>: daemon</span><br><span class="line">        volumes:</span><br><span class="line">            - /data/acme:/acme.sh</span><br><span class="line">        networks:</span><br><span class="line">            mynetwork:</span><br><span class="line">                ipv4_address: 172.28.0.3</span><br><span class="line"></span><br><span class="line">    lsky:</span><br><span class="line">        image: halcyonazure/lsky-pro-docker:latest</span><br><span class="line">        container_name: lsky</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - 8080:80     <span class="comment"># 如果使用nginx无需放开防火墙8080</span></span><br><span class="line">        volumes:</span><br><span class="line">            - /data/web:/var/www/html</span><br><span class="line">        networks:</span><br><span class="line">            mynetwork:</span><br><span class="line">                ipv4_address: 172.28.0.4</span><br><span class="line"></span><br><span class="line">    mariadb:</span><br><span class="line">        image: mariadb</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 其中包含了WordPress的核心数据信息</span></span><br><span class="line">        container_name: mariadb</span><br><span class="line">        volumes:</span><br><span class="line">           - /data/mariadb_data:/var/lib/mysql<span class="comment"># 映射mariadb容器内存放数据库数据的文件夹</span></span><br><span class="line">        restart: always</span><br><span class="line">        environment:<span class="comment"># 下面的环境变量会在数据库数据文件夹已存在时失效</span></span><br><span class="line">            MYSQL_ROOT_PASSWORD: password<span class="comment"># root用户的初始密码</span></span><br><span class="line">            MYSQL_DATABASE: lsky<span class="comment"># 使用的数据库</span></span><br><span class="line">            MYSQL_USER: lsky<span class="comment"># 使用的用户</span></span><br><span class="line">            MYSQL_PASSWORD: lsky<span class="comment"># 使用的用户的密码</span></span><br><span class="line">        networks:</span><br><span class="line">            mynetwork:</span><br><span class="line">                ipv4_address: 172.28.0.5</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">    mynetwork:</span><br><span class="line">        driver: bridge</span><br><span class="line">        ipam:</span><br><span class="line">            driver: default</span><br><span class="line">            config:</span><br><span class="line">                - subnet: 172.28.0.0/16</span><br><span class="line">                  gateway: 172.28.0.1</span><br></pre></td></tr></table></figure><p><strong>按</strong><kbd>i</kbd>，<kbd>Shift</kbd> + <kbd>Ctrl</kbd> + <kbd>v</kbd> 黏贴；</p><p><strong>按</strong><kbd>Esc</kbd><strong>输入</strong><code>:wq</code>。<strong>保存后退出</strong>。</p><p><strong>启动容器</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p><strong>检查容器</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><hr><h1 id="5）申请证书">5）申请证书</h1><p><strong>为 Lsky Pro 及 phpmyadmin 申请证书</strong>：</p><p><a href="https://blog.cloudwai.com/archives/1171/">证书申请参考</a> 。域名可以使用<code>*.baidu.com</code>这种格式申请泛域名，也可申请泛域名。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it acme.sh acme.sh --issue --server letsencrypt --dns dns_cf -d xxx.xxx.xxx --nginx</span><br></pre></td></tr></table></figure><p><strong>申请成功后重启 docker-compose</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure><p><strong>查看证书续签时间间隔</strong>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it acme.sh crontab -l</span><br></pre></td></tr></table></figure><p><strong>开启 <a href="http://acme.sh">acme.sh</a> 自动更新</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it acme.sh acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure><p><strong>由于证书更新后需要重启nginx重启才能识别，所以添加一条定时重启 nginx 容器 的命令</strong>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p><strong>添加为 每天 0点30分 重启nginx</strong>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 0 * * * docker restart nginx</span><br></pre></td></tr></table></figure><p>如在云服务器中配置则直接解析域名到IP地址即可访问</p><p>如在本地自建DNS服务器则解析IP地址到本地DNS服务器即可访问</p><p>如在本机或局域网测试环境直接修改电脑 hosts 文件 解析IP即可访问</p><hr><h1 id="6）Lsky-Pro-网页配置">6）Lsky Pro 网页配置</h1><p>进入 Lsky Pro，地址栏敲入<a href="localhost">localhost</a></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223134357186.png" alt="image-20230223134357186"></p><p>配置数据库</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223132938740.png" alt="image-20230223132938740"></p><p>设置管理员账号，下一步</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223134443852.png" alt="image-20230223134443852"></p><hr><h1 id="7）获取tokens">7）获取tokens</h1><p>这里需要使用postman，然后按下图操作即可</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230302-64004f617ceab.png" alt="Snipaste_2023-03-02_14-38-00"></p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230302-64004f83be2dd.png" alt="image-20230302142413980"></p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230302-64004f8f791dd.png" alt="Snipaste_2023-03-02_14-34-28"></p><h1 id="8）Picgo">8）Picgo</h1><p>下载 Picgo 客户端</p><p>进入 <a href="https://aoliyougei.com/?golink=aHR0cHM6Ly9naXRodWIuY29tL01vbHVuZXJmaW5uL1BpY0dv">GitHub</a> 中 点击 Releases</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223135552637.png" alt="image-20230223135552637"></p><p>下载对应版本</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230223135700744.png" alt="image-20230223135700744"></p><p>打开 PicGo 客户端 &gt;插件设置&gt;搜索&gt;lsky&gt;安装</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230302-64004e5012f5a.png" alt="Snipaste_2023-03-02_15-16-16"></p><p>提示缺少 node.js 点击 yes 转跳至官网下载，Node.js 安装完成后再次安装插件（略）</p><p>PicGo &gt;插件设置&gt;配置 uploader – lankong &gt;设置相关选项</p><p><img src="https://images.halfsummer.xyz/i/pictures/niubb/2023/20230302-64004e6b94e0c.png" alt="Snipaste_2023-03-02_15-18-15"></p><h1 id="9）迁移">9）迁移</h1><p>打包了整个public和数据库，到新机器完成配置后先默认走一遍流程看能初始化网页不，然后覆盖。</p><ul><li>打包public的映射web</li><li>打包整个mariadb的映射-直接tar全量备份了没啥东西</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tool </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 兰空 </tag>
            
            <tag> 图床 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 中使用 emoji 表情</title>
      <link href="/posts/9fc1e5d1.html"/>
      <url>/posts/9fc1e5d1.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）安装">1）安装</h1><details class="folding-tag" blue open><summary> 安装 </summary>              <div class='content'>              <p>卸载 <code>hexo-renderer-marked</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save</span><br></pre></td></tr></table></figure><p>安装 <code>hexo-renderer-markdown-it</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-renderer-markdown-it --save</span><br></pre></td></tr></table></figure>              </div>            </details><hr><h1 id="2）配置">2）配置</h1><details class="folding-tag" blue open><summary> 配置 </summary>              <div class='content'>              <p>完成插件安装后还需要修改 Hexo 站点配置文件 <code>_config.yml</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># markdown 渲染引擎配置</span></span><br><span class="line"><span class="comment"># 默认是hexo-renderer-marked</span></span><br><span class="line"><span class="comment"># 当前为hexo-renderer-markdown-it</span></span><br><span class="line">markdown:</span><br><span class="line">  preset: <span class="string">&quot;default&quot;</span></span><br><span class="line">  render:</span><br><span class="line">    html: <span class="literal">true</span></span><br><span class="line">    xhtmlOut: <span class="literal">false</span></span><br><span class="line">    <span class="comment"># langPrefix: &quot;language-&quot;</span></span><br><span class="line">    breaks: <span class="literal">true</span></span><br><span class="line">    linkify: <span class="literal">true</span></span><br><span class="line">    typographer: <span class="literal">true</span></span><br><span class="line">    quotes: <span class="string">&quot;“”‘’&quot;</span></span><br><span class="line">  <span class="comment"># enable_rules:</span></span><br><span class="line">  <span class="comment"># disable_rules:</span></span><br><span class="line">  plugins:</span><br><span class="line">    - markdown-it-abbr</span><br><span class="line">    - markdown-it-cjk-breaks</span><br><span class="line">    - markdown-it-deflist</span><br><span class="line">    - markdown-it-emoji</span><br><span class="line">    - markdown-it-footnote</span><br><span class="line">    <span class="comment"># - markdown-it-ins</span></span><br><span class="line">    <span class="comment"># - markdown-it-mark</span></span><br><span class="line">    <span class="comment"># - markdown-it-sub</span></span><br><span class="line">    <span class="comment"># - markdown-it-sup</span></span><br><span class="line">    <span class="comment"># - markdown-it-checkbox</span></span><br><span class="line">    <span class="comment"># - markdown-it-imsize</span></span><br><span class="line">    <span class="comment"># - markdown-it-expandable</span></span><br><span class="line">    <span class="comment"># - name: markdown-it-container</span></span><br><span class="line">    <span class="comment">#   options: success</span></span><br><span class="line">    <span class="comment"># - name: markdown-it-container</span></span><br><span class="line">    <span class="comment">#   options: tips</span></span><br><span class="line">    <span class="comment"># - name: markdown-it-container</span></span><br><span class="line">    <span class="comment">#   options: warning</span></span><br><span class="line">    <span class="comment"># - name: markdown-it-container</span></span><br><span class="line">    <span class="comment">#   options: danger</span></span><br><span class="line">  anchors:</span><br><span class="line">    level: 1</span><br><span class="line">    collisionSuffix: <span class="string">&quot;v&quot;</span></span><br><span class="line">    permalink: <span class="literal">false</span></span><br><span class="line">    permalinkClass: <span class="string">&quot;header-anchor&quot;</span></span><br><span class="line">    <span class="comment"># permalinkSide: &quot;left&quot;</span></span><br><span class="line">    permalinkSymbol: <span class="string">&quot;¶&quot;</span></span><br><span class="line">    <span class="comment"># case: 0</span></span><br><span class="line">    <span class="comment"># separator: &quot;-&quot;</span></span><br></pre></td></tr></table></figure>              </div>            </details><hr><h1 id="3）使用方法">3）使用方法</h1><details class="folding-tag" blue><summary> 使用方法 </summary>              <div class='content'>              <p>输入对应的emoji编码就行了例如：输入笑脸对应的 emoji 编码 😄 就可以得到 😄</p>              </div>            </details><hr><h1 id="4）emoji表情编码合集">4）emoji表情编码合集</h1><details class="folding-tag" blue><summary> emoji表情编码合集 </summary>              <div class='content'>              <p>People</p><table>  <thead>    <tr>      <th align="left">😐<code>:neutral_face:</code></th>      <th align="left">😄<code>:smile:</code></th>      <th align="left">😆<code>:laughing:</code></th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">😊<code>:blush:</code></td>      <td align="left">😃<code>:smiley:</code></td>      <td align="left">☺️<code>:relaxed:</code></td>    </tr>    <tr>      <td align="left">😏<code>:smirk:</code></td>      <td align="left">😍<code>:heart_eyes:</code></td>      <td align="left">😘<code>:kissing_heart:</code></td>    </tr>    <tr>      <td align="left">😚<code>:kissing_closed_eyes:</code></td>      <td align="left">😳<code>:flushed:</code></td>      <td align="left">😌<code>:relieved:</code></td>    </tr>    <tr>      <td align="left">😆<code>:satisfied:</code></td>      <td align="left">😁<code>:grin:</code></td>      <td align="left">😉<code>:wink:</code></td>    </tr>    <tr>      <td align="left">😜<code>:stuck_out_tongue_winking_eye:</code></td>      <td align="left">😝<code>:stuck_out_tongue_closed_eyes:</code></td>      <td align="left">😀<code>:grinning:</code></td>    </tr>    <tr>      <td align="left">😗<code>:kissing:</code></td>      <td align="left">😙<code>:kissing_smiling_eyes:</code></td>      <td align="left">😛<code>:stuck_out_tongue:</code></td>    </tr>    <tr>      <td align="left">😴<code>:sleeping:</code></td>      <td align="left">😟<code>:worried:</code></td>      <td align="left">😦<code>:frowning:</code></td>    </tr>    <tr>      <td align="left">😧<code>:anguished:</code></td>      <td align="left">😮<code>:open_mouth:</code></td>      <td align="left">😬<code>:grimacing:</code></td>    </tr>    <tr>      <td align="left">😕<code>:confused:</code></td>      <td align="left">😯<code>:hushed:</code></td>      <td align="left">😑<code>:expressionless:</code></td>    </tr>    <tr>      <td align="left">😒<code>:unamused:</code></td>      <td align="left">😅<code>:sweat_smile:</code></td>      <td align="left">😓<code>:sweat:</code></td>    </tr>    <tr>      <td align="left">😥<code>:disappointed_relieved:</code></td>      <td align="left">😩<code>:weary:</code></td>      <td align="left">😔<code>:pensive:</code></td>    </tr>    <tr>      <td align="left">😞<code>:disappointed:</code></td>      <td align="left">😖<code>:confounded:</code></td>      <td align="left">😨<code>:fearful:</code></td>    </tr>    <tr>      <td align="left">😰<code>:cold_sweat:</code></td>      <td align="left">😣<code>:persevere:</code></td>      <td align="left">😢<code>:cry:</code></td>    </tr>    <tr>      <td align="left">😭<code>:sob:</code></td>      <td align="left">😂<code>:joy:</code></td>      <td align="left">😲<code>:astonished:</code></td>    </tr>    <tr>      <td align="left">😱<code>:scream:</code></td>      <td align="left">💭<code>:thought_balloon:</code></td>      <td align="left">😫<code>:tired_face:</code></td>    </tr>    <tr>      <td align="left">😠<code>:angry:</code></td>      <td align="left">😡<code>:rage:</code></td>      <td align="left">😤<code>:triumph:</code></td>    </tr>    <tr>      <td align="left">😪<code>:sleepy:</code></td>      <td align="left">😋<code>:yum:</code></td>      <td align="left">😷<code>:mask:</code></td>    </tr>    <tr>      <td align="left">😎<code>:sunglasses:</code></td>      <td align="left">😵<code>:dizzy_face:</code></td>      <td align="left">👿<code>:imp:</code></td>    </tr>    <tr>      <td align="left">😈<code>:smiling_imp:</code></td>      <td align="left">💬<code>:speech_balloon:</code></td>      <td align="left">😶<code>:no_mouth:</code></td>    </tr>    <tr>      <td align="left">😇<code>:innocent:</code></td>      <td align="left">👽<code>:alien:</code></td>      <td align="left">💛<code>:yellow_heart:</code></td>    </tr>    <tr>      <td align="left">💙<code>:blue_heart:</code></td>      <td align="left">💜<code>:purple_heart:</code></td>      <td align="left">❤️<code>:heart:</code></td>    </tr>    <tr>      <td align="left">💚<code>:green_heart:</code></td>      <td align="left">💔<code>:broken_heart:</code></td>      <td align="left">💓<code>:heartbeat:</code></td>    </tr>    <tr>      <td align="left">💗<code>:heartpulse:</code></td>      <td align="left">💕<code>:two_hearts:</code></td>      <td align="left">💞<code>:revolving_hearts:</code></td>    </tr>    <tr>      <td align="left">💘<code>:cupid:</code></td>      <td align="left">💖<code>:sparkling_heart:</code></td>      <td align="left">✨<code>:sparkles:</code></td>    </tr>    <tr>      <td align="left">⭐️<code>:star:</code></td>      <td align="left">🌟<code>:star2:</code></td>      <td align="left">💫<code>:dizzy:</code></td>    </tr>    <tr>      <td align="left">💥<code>:boom:</code></td>      <td align="left">💥<code>:collision:</code></td>      <td align="left">💢<code>:anger:</code></td>    </tr>    <tr>      <td align="left">❗️<code>:exclamation:</code></td>      <td align="left">❓<code>:question:</code></td>      <td align="left">❕<code>:grey_exclamation:</code></td>    </tr>    <tr>      <td align="left">❔<code>:grey_question:</code></td>      <td align="left">💤<code>:zzz:</code></td>      <td align="left">💨<code>:dash:</code></td>    </tr>    <tr>      <td align="left">💦<code>:sweat_drops:</code></td>      <td align="left">🎶<code>:notes:</code></td>      <td align="left">🎵<code>:musical_note:</code></td>    </tr>    <tr>      <td align="left">🔥<code>:fire:</code></td>      <td align="left">💩<code>:hankey:</code></td>      <td align="left">💩<code>:poop:</code></td>    </tr>    <tr>      <td align="left">💩<code>:shit:</code></td>      <td align="left">👍<code>:+1:</code></td>      <td align="left">👍<code>:thumbsup:</code></td>    </tr>    <tr>      <td align="left">👎<code>:-1:</code></td>      <td align="left">👎<code>:thumbsdown:</code></td>      <td align="left">👌<code>:ok_hand:</code></td>    </tr>    <tr>      <td align="left">👊<code>:punch:</code></td>      <td align="left">👊<code>:facepunch:</code></td>      <td align="left">✊<code>:fist:</code></td>    </tr>    <tr>      <td align="left">✌️<code>:v:</code></td>      <td align="left">👋<code>:wave:</code></td>      <td align="left">✋<code>:hand:</code></td>    </tr>    <tr>      <td align="left">✋<code>:raised_hand:</code></td>      <td align="left">👐<code>:open_hands:</code></td>      <td align="left">☝️<code>:point_up:</code></td>    </tr>    <tr>      <td align="left">👇<code>:point_down:</code></td>      <td align="left">👈<code>:point_left:</code></td>      <td align="left">👉<code>:point_right:</code></td>    </tr>    <tr>      <td align="left">🙌<code>:raised_hands:</code></td>      <td align="left">🙏<code>:pray:</code></td>      <td align="left">👆<code>:point_up_2:</code></td>    </tr>    <tr>      <td align="left">👏<code>:clap:</code></td>      <td align="left">💪<code>:muscle:</code></td>      <td align="left">🤘<code>:metal:</code></td>    </tr>    <tr>      <td align="left">🖕<code>:fu:</code></td>      <td align="left">🚶<code>:walking:</code></td>      <td align="left">🏃<code>:runner:</code></td>    </tr>    <tr>      <td align="left">🏃<code>:running:</code></td>      <td align="left">👫<code>:couple:</code></td>      <td align="left">👪<code>:family:</code></td>    </tr>    <tr>      <td align="left">👬<code>:two_men_holding_hands:</code></td>      <td align="left">👭<code>:two_women_holding_hands:</code></td>      <td align="left">💃<code>:dancer:</code></td>    </tr>    <tr>      <td align="left">👯<code>:dancers:</code></td>      <td align="left">🙆<code>:ok_woman:</code></td>      <td align="left">🙅<code>:no_good:</code></td>    </tr>    <tr>      <td align="left">💁<code>:information_desk_person:</code></td>      <td align="left">🙋<code>:raising_hand:</code></td>      <td align="left">👰<code>:bride_with_veil:</code></td>    </tr>    <tr>      <td align="left">🙎<code>:person_with_pouting_face:</code></td>      <td align="left">🙍<code>:person_frowning:</code></td>      <td align="left">🙇<code>:bow:</code></td>    </tr>    <tr>      <td align="left">💏<code>:couplekiss:</code></td>      <td align="left">💑<code>:couple_with_heart:</code></td>      <td align="left">💆<code>:massage:</code></td>    </tr>    <tr>      <td align="left">💇<code>:haircut:</code></td>      <td align="left">💅<code>:nail_care:</code></td>      <td align="left">👦<code>:boy:</code></td>    </tr>    <tr>      <td align="left">👧<code>:girl:</code></td>      <td align="left">👩<code>:woman:</code></td>      <td align="left">👨<code>:man:</code></td>    </tr>    <tr>      <td align="left">👶<code>:baby:</code></td>      <td align="left">👵<code>:older_woman:</code></td>      <td align="left">👴<code>:older_man:</code></td>    </tr>    <tr>      <td align="left">👱<code>:person_with_blond_hair:</code></td>      <td align="left">👲<code>:man_with_gua_pi_mao:</code></td>      <td align="left">👳<code>:man_with_turban:</code></td>    </tr>    <tr>      <td align="left">👷<code>:construction_worker:</code></td>      <td align="left">👮<code>:cop:</code></td>      <td align="left">👼<code>:angel:</code></td>    </tr>    <tr>      <td align="left">👸<code>:princess:</code></td>      <td align="left">😺<code>:smiley_cat:</code></td>      <td align="left">😸<code>:smile_cat:</code></td>    </tr>    <tr>      <td align="left">😻<code>:heart_eyes_cat:</code></td>      <td align="left">😽<code>:kissing_cat:</code></td>      <td align="left">😼<code>:smirk_cat:</code></td>    </tr>    <tr>      <td align="left">🙀<code>:scream_cat:</code></td>      <td align="left">😿<code>:crying_cat_face:</code></td>      <td align="left">😹<code>:joy_cat:</code></td>    </tr>    <tr>      <td align="left">😾<code>:pouting_cat:</code></td>      <td align="left">👹<code>:japanese_ogre:</code></td>      <td align="left">👺<code>:japanese_goblin:</code></td>    </tr>    <tr>      <td align="left">🙈<code>:see_no_evil:</code></td>      <td align="left">🙉<code>:hear_no_evil:</code></td>      <td align="left">🙊<code>:speak_no_evil:</code></td>    </tr>    <tr>      <td align="left">💂<code>:guardsman:</code></td>      <td align="left">💀<code>:skull:</code></td>      <td align="left">🐾<code>:feet:</code></td>    </tr>    <tr>      <td align="left">👄<code>:lips:</code></td>      <td align="left">💋<code>:kiss:</code></td>      <td align="left">💧<code>:droplet:</code></td>    </tr>    <tr>      <td align="left">👂<code>:ear:</code></td>      <td align="left">👀<code>:eyes:</code></td>      <td align="left">👃<code>:nose:</code></td>    </tr>    <tr>      <td align="left">👅<code>:tongue:</code></td>      <td align="left">💌<code>:love_letter:</code></td>      <td align="left">👤<code>:bust_in_silhouette:</code></td>    </tr>    <tr>      <td align="left">👥<code>:busts_in_silhouette:</code></td>      <td align="left"></td>      <td align="left"></td>    </tr>  </tbody></table><p>Nature</p><table>  <thead>    <tr>      <th align="left">☀️<code>:sunny:</code></th>      <th align="left">☔️<code>:umbrella:</code></th>      <th align="left">☁️<code>:cloud:</code></th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">❄️<code>:snowflake:</code></td>      <td align="left">⛄️<code>:snowman:</code></td>      <td align="left">⚡️<code>:zap:</code></td>    </tr>    <tr>      <td align="left">🌀<code>:cyclone:</code></td>      <td align="left">🌁<code>:foggy:</code></td>      <td align="left">🌊<code>:ocean:</code></td>    </tr>    <tr>      <td align="left">🐱<code>:cat:</code></td>      <td align="left">🐶<code>:dog:</code></td>      <td align="left">🐭<code>:mouse:</code></td>    </tr>    <tr>      <td align="left">🐹<code>:hamster:</code></td>      <td align="left">🐰<code>:rabbit:</code></td>      <td align="left">🐺<code>:wolf:</code></td>    </tr>    <tr>      <td align="left">🐸<code>:frog:</code></td>      <td align="left">🐯<code>:tiger:</code></td>      <td align="left">🐨<code>:koala:</code></td>    </tr>    <tr>      <td align="left">🐻<code>:bear:</code></td>      <td align="left">🐷<code>:pig:</code></td>      <td align="left">🐽<code>:pig_nose:</code></td>    </tr>    <tr>      <td align="left">🐮<code>:cow:</code></td>      <td align="left">🐗<code>:boar:</code></td>      <td align="left">🐵<code>:monkey_face:</code></td>    </tr>    <tr>      <td align="left">🐒<code>:monkey:</code></td>      <td align="left">🐴<code>:horse:</code></td>      <td align="left">🐎<code>:racehorse:</code></td>    </tr>    <tr>      <td align="left">🐫<code>:camel:</code></td>      <td align="left">🐑<code>:sheep:</code></td>      <td align="left">🐘<code>:elephant:</code></td>    </tr>    <tr>      <td align="left">🐼<code>:panda_face:</code></td>      <td align="left">🐍<code>:snake:</code></td>      <td align="left">🐦<code>:bird:</code></td>    </tr>    <tr>      <td align="left">🐤<code>:baby_chick:</code></td>      <td align="left">🐥<code>:hatched_chick:</code></td>      <td align="left">🐣<code>:hatching_chick:</code></td>    </tr>    <tr>      <td align="left">🐔<code>:chicken:</code></td>      <td align="left">🐧<code>:penguin:</code></td>      <td align="left">🐢<code>:turtle:</code></td>    </tr>    <tr>      <td align="left">🐛<code>:bug:</code></td>      <td align="left">🐝<code>:honeybee:</code></td>      <td align="left">🐜<code>:ant:</code></td>    </tr>    <tr>      <td align="left">🐞<code>:beetle:</code></td>      <td align="left">🐌<code>:snail:</code></td>      <td align="left">🐙<code>:octopus:</code></td>    </tr>    <tr>      <td align="left">🐠<code>:tropical_fish:</code></td>      <td align="left">🐟<code>:fish:</code></td>      <td align="left">🐳<code>:whale:</code></td>    </tr>    <tr>      <td align="left">🐋<code>:whale2:</code></td>      <td align="left">🐬<code>:dolphin:</code></td>      <td align="left">🐄<code>:cow2:</code></td>    </tr>    <tr>      <td align="left">🐏<code>:ram:</code></td>      <td align="left">🐀<code>:rat:</code></td>      <td align="left">🐃<code>:water_buffalo:</code></td>    </tr>    <tr>      <td align="left">🐅<code>:tiger2:</code></td>      <td align="left">🐇<code>:rabbit2:</code></td>      <td align="left">🐉<code>:dragon:</code></td>    </tr>    <tr>      <td align="left">🐐<code>:goat:</code></td>      <td align="left">🐓<code>:rooster:</code></td>      <td align="left">🐕<code>:dog2:</code></td>    </tr>    <tr>      <td align="left">🐖<code>:pig2:</code></td>      <td align="left">🐁<code>:mouse2:</code></td>      <td align="left">🐂<code>:ox:</code></td>    </tr>    <tr>      <td align="left">🐲<code>:dragon_face:</code></td>      <td align="left">🐡<code>:blowfish:</code></td>      <td align="left">🐊<code>:crocodile:</code></td>    </tr>    <tr>      <td align="left">🐪<code>:dromedary_camel:</code></td>      <td align="left">🐆<code>:leopard:</code></td>      <td align="left">🐈<code>:cat2:</code></td>    </tr>    <tr>      <td align="left">🐩<code>:poodle:</code></td>      <td align="left">🐾<code>:paw_prints:</code></td>      <td align="left">💐<code>:bouquet:</code></td>    </tr>    <tr>      <td align="left">🌸<code>:cherry_blossom:</code></td>      <td align="left">🌷<code>:tulip:</code></td>      <td align="left">🍀<code>:four_leaf_clover:</code></td>    </tr>    <tr>      <td align="left">🌹<code>:rose:</code></td>      <td align="left">🌻<code>:sunflower:</code></td>      <td align="left">🌺<code>:hibiscus:</code></td>    </tr>    <tr>      <td align="left">🍁<code>:maple_leaf:</code></td>      <td align="left">🍃<code>:leaves:</code></td>      <td align="left">🍂<code>:fallen_leaf:</code></td>    </tr>    <tr>      <td align="left">🌿<code>:herb:</code></td>      <td align="left">🍄<code>:mushroom:</code></td>      <td align="left">🌵<code>:cactus:</code></td>    </tr>    <tr>      <td align="left">🌴<code>:palm_tree:</code></td>      <td align="left">🌲<code>:evergreen_tree:</code></td>      <td align="left">🌳<code>:deciduous_tree:</code></td>    </tr>    <tr>      <td align="left">🌰<code>:chestnut:</code></td>      <td align="left">🌱<code>:seedling:</code></td>      <td align="left">🌼<code>:blossom:</code></td>    </tr>    <tr>      <td align="left">🌾<code>:ear_of_rice:</code></td>      <td align="left">🐚<code>:shell:</code></td>      <td align="left">🌐<code>:globe_with_meridians:</code></td>    </tr>    <tr>      <td align="left">🌞<code>:sun_with_face:</code></td>      <td align="left">🌝<code>:full_moon_with_face:</code></td>      <td align="left">🌚<code>:new_moon_with_face:</code></td>    </tr>    <tr>      <td align="left">🌑<code>:new_moon:</code></td>      <td align="left">🌒<code>:waxing_crescent_moon:</code></td>      <td align="left">🌓<code>:first_quarter_moon:</code></td>    </tr>    <tr>      <td align="left">🌔<code>:waxing_gibbous_moon:</code></td>      <td align="left">🌕<code>:full_moon:</code></td>      <td align="left">🌖<code>:waning_gibbous_moon:</code></td>    </tr>    <tr>      <td align="left">🌗<code>:last_quarter_moon:</code></td>      <td align="left">🌘<code>:waning_crescent_moon:</code></td>      <td align="left">🌜<code>:last_quarter_moon_with_face:</code></td>    </tr>    <tr>      <td align="left">🌛<code>:first_quarter_moon_with_face:</code></td>      <td align="left">🌔<code>:moon:</code></td>      <td align="left">🌍<code>:earth_africa:</code></td>    </tr>    <tr>      <td align="left">🌎<code>:earth_americas:</code></td>      <td align="left">🌏<code>:earth_asia:</code></td>      <td align="left">🌋<code>:volcano:</code></td>    </tr>    <tr>      <td align="left">🌌<code>:milky_way:</code></td>      <td align="left">⛅️<code>:partly_sunny:</code></td>      <td align="left"></td>    </tr>  </tbody></table><p>Objects</p><table>  <thead>    <tr>      <th align="left">🎍<code>:bamboo:</code></th>      <th align="left">💝<code>:gift_heart:</code></th>      <th align="left">🎎<code>:dolls:</code></th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">🎒<code>:school_satchel:</code></td>      <td align="left">🎓<code>:mortar_board:</code></td>      <td align="left">🎏<code>:flags:</code></td>    </tr>    <tr>      <td align="left">🎆<code>:fireworks:</code></td>      <td align="left">🎇<code>:sparkler:</code></td>      <td align="left">🎐<code>:wind_chime:</code></td>    </tr>    <tr>      <td align="left">🎑<code>:rice_scene:</code></td>      <td align="left">🎃<code>:jack_o_lantern:</code></td>      <td align="left">👻<code>:ghost:</code></td>    </tr>    <tr>      <td align="left">🎅<code>:santa:</code></td>      <td align="left">🎄<code>:christmas_tree:</code></td>      <td align="left">🎁<code>:gift:</code></td>    </tr>    <tr>      <td align="left">🔔<code>:bell:</code></td>      <td align="left">🔕<code>:no_bell:</code></td>      <td align="left">🎋<code>:tanabata_tree:</code></td>    </tr>    <tr>      <td align="left">🎉<code>:tada:</code></td>      <td align="left">🎊<code>:confetti_ball:</code></td>      <td align="left">🎈<code>:balloon:</code></td>    </tr>    <tr>      <td align="left">🔮<code>:crystal_ball:</code></td>      <td align="left">💿<code>:cd:</code></td>      <td align="left">📀<code>:dvd:</code></td>    </tr>    <tr>      <td align="left">💾<code>:floppy_disk:</code></td>      <td align="left">📷<code>:camera:</code></td>      <td align="left">📹<code>:video_camera:</code></td>    </tr>    <tr>      <td align="left">🎥<code>:movie_camera:</code></td>      <td align="left">💻<code>:computer:</code></td>      <td align="left">📺<code>:tv:</code></td>    </tr>    <tr>      <td align="left">📱<code>:iphone:</code></td>      <td align="left">☎️<code>:phone:</code></td>      <td align="left">☎️<code>:telephone:</code></td>    </tr>    <tr>      <td align="left">📞<code>:telephone_receiver:</code></td>      <td align="left">📟<code>:pager:</code></td>      <td align="left">📠<code>:fax:</code></td>    </tr>    <tr>      <td align="left">💽<code>:minidisc:</code></td>      <td align="left">📼<code>:vhs:</code></td>      <td align="left">🔉<code>:sound:</code></td>    </tr>    <tr>      <td align="left">🔈<code>:speaker:</code></td>      <td align="left">🔇<code>:mute:</code></td>      <td align="left">📢<code>:loudspeaker:</code></td>    </tr>    <tr>      <td align="left">📣<code>:mega:</code></td>      <td align="left">⌛️<code>:hourglass:</code></td>      <td align="left">⏳<code>:hourglass_flowing_sand:</code></td>    </tr>    <tr>      <td align="left">⏰<code>:alarm_clock:</code></td>      <td align="left">⌚️<code>:watch:</code></td>      <td align="left">📻<code>:radio:</code></td>    </tr>    <tr>      <td align="left">📡<code>:satellite:</code></td>      <td align="left">➿<code>:loop:</code></td>      <td align="left">🔍<code>:mag:</code></td>    </tr>    <tr>      <td align="left">🔎<code>:mag_right:</code></td>      <td align="left">🔓<code>:unlock:</code></td>      <td align="left">🔒<code>:lock:</code></td>    </tr>    <tr>      <td align="left">🔏<code>:lock_with_ink_pen:</code></td>      <td align="left">🔐<code>:closed_lock_with_key:</code></td>      <td align="left">🔑<code>:key:</code></td>    </tr>    <tr>      <td align="left">💡<code>:bulb:</code></td>      <td align="left">🔦<code>:flashlight:</code></td>      <td align="left">🔆<code>:high_brightness:</code></td>    </tr>    <tr>      <td align="left">🔅<code>:low_brightness:</code></td>      <td align="left">🔌<code>:electric_plug:</code></td>      <td align="left">🔋<code>:battery:</code></td>    </tr>    <tr>      <td align="left">📲<code>:calling:</code></td>      <td align="left">✉️<code>:email:</code></td>      <td align="left">📫<code>:mailbox:</code></td>    </tr>    <tr>      <td align="left">📮<code>:postbox:</code></td>      <td align="left">🛀<code>:bath:</code></td>      <td align="left">🛁<code>:bathtub:</code></td>    </tr>    <tr>      <td align="left">🚿<code>:shower:</code></td>      <td align="left">🚽<code>:toilet:</code></td>      <td align="left">🔧<code>:wrench:</code></td>    </tr>    <tr>      <td align="left">🔩<code>:nut_and_bolt:</code></td>      <td align="left">🔨<code>:hammer:</code></td>      <td align="left">💺<code>:seat:</code></td>    </tr>    <tr>      <td align="left">💰<code>:moneybag:</code></td>      <td align="left">💴<code>:yen:</code></td>      <td align="left">💵<code>:dollar:</code></td>    </tr>    <tr>      <td align="left">💷<code>:pound:</code></td>      <td align="left">💶<code>:euro:</code></td>      <td align="left">💳<code>:credit_card:</code></td>    </tr>    <tr>      <td align="left">💸<code>:money_with_wings:</code></td>      <td align="left">📧<code>:e-mail:</code></td>      <td align="left">📥<code>:inbox_tray:</code></td>    </tr>    <tr>      <td align="left">📤<code>:outbox_tray:</code></td>      <td align="left">✉️<code>:envelope:</code></td>      <td align="left">📨<code>:incoming_envelope:</code></td>    </tr>    <tr>      <td align="left">📯<code>:postal_horn:</code></td>      <td align="left">📪<code>:mailbox_closed:</code></td>      <td align="left">📬<code>:mailbox_with_mail:</code></td>    </tr>    <tr>      <td align="left">📭<code>:mailbox_with_no_mail:</code></td>      <td align="left">🚪<code>:door:</code></td>      <td align="left">🚬<code>:smoking:</code></td>    </tr>    <tr>      <td align="left">💣<code>:bomb:</code></td>      <td align="left">🔫<code>:gun:</code></td>      <td align="left">🔪<code>:hocho:</code></td>    </tr>    <tr>      <td align="left">💊<code>:pill:</code></td>      <td align="left">💉<code>:syringe:</code></td>      <td align="left">📄<code>:page_facing_up:</code></td>    </tr>    <tr>      <td align="left">📃<code>:page_with_curl:</code></td>      <td align="left">📑<code>:bookmark_tabs:</code></td>      <td align="left">📊<code>:bar_chart:</code></td>    </tr>    <tr>      <td align="left">📈<code>:chart_with_upwards_trend:</code></td>      <td align="left">📉<code>:chart_with_downwards_trend:</code></td>      <td align="left">📜<code>:scroll:</code></td>    </tr>    <tr>      <td align="left">📋<code>:clipboard:</code></td>      <td align="left">📆<code>:calendar:</code></td>      <td align="left">📅<code>:date:</code></td>    </tr>    <tr>      <td align="left">📇<code>:card_index:</code></td>      <td align="left">📁<code>:file_folder:</code></td>      <td align="left">📂<code>:open_file_folder:</code></td>    </tr>    <tr>      <td align="left">✂️<code>:scissors:</code></td>      <td align="left">📌<code>:pushpin:</code></td>      <td align="left">📎<code>:paperclip:</code></td>    </tr>    <tr>      <td align="left">✒️<code>:black_nib:</code></td>      <td align="left">✏️<code>:pencil2:</code></td>      <td align="left">📏<code>:straight_ruler:</code></td>    </tr>    <tr>      <td align="left">📐<code>:triangular_ruler:</code></td>      <td align="left">📕<code>:closed_book:</code></td>      <td align="left">📗<code>:green_book:</code></td>    </tr>    <tr>      <td align="left">📘<code>:blue_book:</code></td>      <td align="left">📙<code>:orange_book:</code></td>      <td align="left">📓<code>:notebook:</code></td>    </tr>    <tr>      <td align="left">📔<code>:notebook_with_decorative_cover:</code></td>      <td align="left">📒<code>:ledger:</code></td>      <td align="left">📚<code>:books:</code></td>    </tr>    <tr>      <td align="left">🔖<code>:bookmark:</code></td>      <td align="left">📛<code>:name_badge:</code></td>      <td align="left">🔬<code>:microscope:</code></td>    </tr>    <tr>      <td align="left">🔭<code>:telescope:</code></td>      <td align="left">📰<code>:newspaper:</code></td>      <td align="left">🏈<code>:football:</code></td>    </tr>    <tr>      <td align="left">🏀<code>:basketball:</code></td>      <td align="left">⚽️<code>:soccer:</code></td>      <td align="left">⚾️<code>:baseball:</code></td>    </tr>    <tr>      <td align="left">🎾<code>:tennis:</code></td>      <td align="left">🎱<code>:8ball:</code></td>      <td align="left">🏉<code>:rugby_football:</code></td>    </tr>    <tr>      <td align="left">🎳<code>:bowling:</code></td>      <td align="left">⛳️<code>:golf:</code></td>      <td align="left">🚵<code>:mountain_bicyclist:</code></td>    </tr>    <tr>      <td align="left">🚴<code>:bicyclist:</code></td>      <td align="left">🏇<code>:horse_racing:</code></td>      <td align="left">🏂<code>:snowboarder:</code></td>    </tr>    <tr>      <td align="left">🏊<code>:swimmer:</code></td>      <td align="left">🏄<code>:surfer:</code></td>      <td align="left">🎿<code>:ski:</code></td>    </tr>    <tr>      <td align="left">♠️<code>:spades:</code></td>      <td align="left">♥️<code>:hearts:</code></td>      <td align="left">♣️<code>:clubs:</code></td>    </tr>    <tr>      <td align="left">♦️<code>:diamonds:</code></td>      <td align="left">💎<code>:gem:</code></td>      <td align="left">💍<code>:ring:</code></td>    </tr>    <tr>      <td align="left">🏆<code>:trophy:</code></td>      <td align="left">🎼<code>:musical_score:</code></td>      <td align="left">🎹<code>:musical_keyboard:</code></td>    </tr>    <tr>      <td align="left">🎻<code>:violin:</code></td>      <td align="left">👾<code>:space_invader:</code></td>      <td align="left">🎮<code>:video_game:</code></td>    </tr>    <tr>      <td align="left">🃏<code>:black_joker:</code></td>      <td align="left">🎴<code>:flower_playing_cards:</code></td>      <td align="left">🎲<code>:game_die:</code></td>    </tr>    <tr>      <td align="left">🎯<code>:dart:</code></td>      <td align="left">🀄️<code>:mahjong:</code></td>      <td align="left">🎬<code>:clapper:</code></td>    </tr>    <tr>      <td align="left">📝<code>:memo:</code></td>      <td align="left">📝<code>:pencil:</code></td>      <td align="left">📖<code>:book:</code></td>    </tr>    <tr>      <td align="left">🎨<code>:art:</code></td>      <td align="left">🎤<code>:microphone:</code></td>      <td align="left">🎧<code>:headphones:</code></td>    </tr>    <tr>      <td align="left">🎺<code>:trumpet:</code></td>      <td align="left">🎷<code>:saxophone:</code></td>      <td align="left">🎸<code>:guitar:</code></td>    </tr>    <tr>      <td align="left">👞<code>:shoe:</code></td>      <td align="left">👡<code>:sandal:</code></td>      <td align="left">👠<code>:high_heel:</code></td>    </tr>    <tr>      <td align="left">💄<code>:lipstick:</code></td>      <td align="left">👢<code>:boot:</code></td>      <td align="left">👕<code>:shirt:</code></td>    </tr>    <tr>      <td align="left">👕<code>:tshirt:</code></td>      <td align="left">👔<code>:necktie:</code></td>      <td align="left">👚<code>:womans_clothes:</code></td>    </tr>    <tr>      <td align="left">👗<code>:dress:</code></td>      <td align="left">🎽<code>:running_shirt_with_sash:</code></td>      <td align="left">👖<code>:jeans:</code></td>    </tr>    <tr>      <td align="left">👘<code>:kimono:</code></td>      <td align="left">👙<code>:bikini:</code></td>      <td align="left">🎀<code>:ribbon:</code></td>    </tr>    <tr>      <td align="left">🎩<code>:tophat:</code></td>      <td align="left">👑<code>:crown:</code></td>      <td align="left">👒<code>:womans_hat:</code></td>    </tr>    <tr>      <td align="left">👞<code>:mans_shoe:</code></td>      <td align="left">🌂<code>:closed_umbrella:</code></td>      <td align="left">💼<code>:briefcase:</code></td>    </tr>    <tr>      <td align="left">👜<code>:handbag:</code></td>      <td align="left">👝<code>:pouch:</code></td>      <td align="left">👛<code>:purse:</code></td>    </tr>    <tr>      <td align="left">👓<code>:eyeglasses:</code></td>      <td align="left">🎣<code>:fishing_pole_and_fish:</code></td>      <td align="left">☕️<code>:coffee:</code></td>    </tr>    <tr>      <td align="left">🍵<code>:tea:</code></td>      <td align="left">🍶<code>:sake:</code></td>      <td align="left">🍼<code>:baby_bottle:</code></td>    </tr>    <tr>      <td align="left">🍺<code>:beer:</code></td>      <td align="left">🍻<code>:beers:</code></td>      <td align="left">🍸<code>:cocktail:</code></td>    </tr>    <tr>      <td align="left">🍹<code>:tropical_drink:</code></td>      <td align="left">🍷<code>:wine_glass:</code></td>      <td align="left">🍴<code>:fork_and_knife:</code></td>    </tr>    <tr>      <td align="left">🍕<code>:pizza:</code></td>      <td align="left">🍔<code>:hamburger:</code></td>      <td align="left">🍟<code>:fries:</code></td>    </tr>    <tr>      <td align="left">🍗<code>:poultry_leg:</code></td>      <td align="left">🍖<code>:meat_on_bone:</code></td>      <td align="left">🍝<code>:spaghetti:</code></td>    </tr>    <tr>      <td align="left">🍛<code>:curry:</code></td>      <td align="left">🍤<code>:fried_shrimp:</code></td>      <td align="left">🍱<code>:bento:</code></td>    </tr>    <tr>      <td align="left">🍣<code>:sushi:</code></td>      <td align="left">🍥<code>:fish_cake:</code></td>      <td align="left">🍙<code>:rice_ball:</code></td>    </tr>    <tr>      <td align="left">🍘<code>:rice_cracker:</code></td>      <td align="left">🍚<code>:rice:</code></td>      <td align="left">🍜<code>:ramen:</code></td>    </tr>    <tr>      <td align="left">🍲<code>:stew:</code></td>      <td align="left">🍢<code>:oden:</code></td>      <td align="left">🍡<code>:dango:</code></td>    </tr>    <tr>      <td align="left">🥚<code>:egg:</code></td>      <td align="left">🍞<code>:bread:</code></td>      <td align="left">🍩<code>:doughnut:</code></td>    </tr>    <tr>      <td align="left">🍮<code>:custard:</code></td>      <td align="left">🍦<code>:icecream:</code></td>      <td align="left">🍨<code>:ice_cream:</code></td>    </tr>    <tr>      <td align="left">🍧<code>:shaved_ice:</code></td>      <td align="left">🎂<code>:birthday:</code></td>      <td align="left">🍰<code>:cake:</code></td>    </tr>    <tr>      <td align="left">🍪<code>:cookie:</code></td>      <td align="left">🍫<code>:chocolate_bar:</code></td>      <td align="left">🍬<code>:candy:</code></td>    </tr>    <tr>      <td align="left">🍭<code>:lollipop:</code></td>      <td align="left">🍯<code>:honey_pot:</code></td>      <td align="left">🍎<code>:apple:</code></td>    </tr>    <tr>      <td align="left">🍏<code>:green_apple:</code></td>      <td align="left">🍊<code>:tangerine:</code></td>      <td align="left">🍋<code>:lemon:</code></td>    </tr>    <tr>      <td align="left">🍒<code>:cherries:</code></td>      <td align="left">🍇<code>:grapes:</code></td>      <td align="left">🍉<code>:watermelon:</code></td>    </tr>    <tr>      <td align="left">🍓<code>:strawberry:</code></td>      <td align="left">🍑<code>:peach:</code></td>      <td align="left">🍈<code>:melon:</code></td>    </tr>    <tr>      <td align="left">🍌<code>:banana:</code></td>      <td align="left">🍐<code>:pear:</code></td>      <td align="left">🍍<code>:pineapple:</code></td>    </tr>    <tr>      <td align="left">🍠<code>:sweet_potato:</code></td>      <td align="left">🍆<code>:eggplant:</code></td>      <td align="left">🍅<code>:tomato:</code></td>    </tr>    <tr>      <td align="left">🌽<code>:corn:</code></td>      <td align="left"></td>      <td align="left"></td>    </tr>  </tbody></table><p>Places</p><table>  <thead>    <tr>      <th align="left">🏠<code>:house:</code></th>      <th align="left">🏡<code>:house_with_garden:</code></th>      <th align="left">🏫<code>:school:</code></th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">🏢<code>:office:</code></td>      <td align="left">🏣<code>:post_office:</code></td>      <td align="left">🏥<code>:hospital:</code></td>    </tr>    <tr>      <td align="left">🏦<code>:bank:</code></td>      <td align="left">🏪<code>:convenience_store:</code></td>      <td align="left">🏩<code>:love_hotel:</code></td>    </tr>    <tr>      <td align="left">🏨<code>:hotel:</code></td>      <td align="left">💒<code>:wedding:</code></td>      <td align="left">⛪️<code>:church:</code></td>    </tr>    <tr>      <td align="left">🏬<code>:department_store:</code></td>      <td align="left">🏤<code>:european_post_office:</code></td>      <td align="left">🌇<code>:city_sunrise:</code></td>    </tr>    <tr>      <td align="left">🌆<code>:city_sunset:</code></td>      <td align="left">🏯<code>:japanese_castle:</code></td>      <td align="left">🏰<code>:european_castle:</code></td>    </tr>    <tr>      <td align="left">⛺️<code>:tent:</code></td>      <td align="left">🏭<code>:factory:</code></td>      <td align="left">🗼<code>:tokyo_tower:</code></td>    </tr>    <tr>      <td align="left">🗾<code>:japan:</code></td>      <td align="left">🗻<code>:mount_fuji:</code></td>      <td align="left">🌄<code>:sunrise_over_mountains:</code></td>    </tr>    <tr>      <td align="left">🌅<code>:sunrise:</code></td>      <td align="left">🌠<code>:stars:</code></td>      <td align="left">🗽<code>:statue_of_liberty:</code></td>    </tr>    <tr>      <td align="left">🌉<code>:bridge_at_night:</code></td>      <td align="left">🎠<code>:carousel_horse:</code></td>      <td align="left">🌈<code>:rainbow:</code></td>    </tr>    <tr>      <td align="left">🎡<code>:ferris_wheel:</code></td>      <td align="left">⛲️<code>:fountain:</code></td>      <td align="left">🎢<code>:roller_coaster:</code></td>    </tr>    <tr>      <td align="left">🚢<code>:ship:</code></td>      <td align="left">🚤<code>:speedboat:</code></td>      <td align="left">⛵️<code>:boat:</code></td>    </tr>    <tr>      <td align="left">⛵️<code>:sailboat:</code></td>      <td align="left">🚣<code>:rowboat:</code></td>      <td align="left">⚓️<code>:anchor:</code></td>    </tr>    <tr>      <td align="left">🚀<code>:rocket:</code></td>      <td align="left">✈️<code>:airplane:</code></td>      <td align="left">🚁<code>:helicopter:</code></td>    </tr>    <tr>      <td align="left">🚂<code>:steam_locomotive:</code></td>      <td align="left">🚊<code>:tram:</code></td>      <td align="left">🚞<code>:mountain_railway:</code></td>    </tr>    <tr>      <td align="left">🚲<code>:bike:</code></td>      <td align="left">🚡<code>:aerial_tramway:</code></td>      <td align="left">🚟<code>:suspension_railway:</code></td>    </tr>    <tr>      <td align="left">🚠<code>:mountain_cableway:</code></td>      <td align="left">🚜<code>:tractor:</code></td>      <td align="left">🚙<code>:blue_car:</code></td>    </tr>    <tr>      <td align="left">🚘<code>:oncoming_automobile:</code></td>      <td align="left">🚗<code>:car:</code></td>      <td align="left">🚗<code>:red_car:</code></td>    </tr>    <tr>      <td align="left">🚕<code>:taxi:</code></td>      <td align="left">🚖<code>:oncoming_taxi:</code></td>      <td align="left">🚛<code>:articulated_lorry:</code></td>    </tr>    <tr>      <td align="left">🚌<code>:bus:</code></td>      <td align="left">🚍<code>:oncoming_bus:</code></td>      <td align="left">🚨<code>:rotating_light:</code></td>    </tr>    <tr>      <td align="left">🚓<code>:police_car:</code></td>      <td align="left">🚔<code>:oncoming_police_car:</code></td>      <td align="left">🚒<code>:fire_engine:</code></td>    </tr>    <tr>      <td align="left">🚑<code>:ambulance:</code></td>      <td align="left">🚐<code>:minibus:</code></td>      <td align="left">🚚<code>:truck:</code></td>    </tr>    <tr>      <td align="left">🚋<code>:train:</code></td>      <td align="left">🚉<code>:station:</code></td>      <td align="left">🚆<code>:train2:</code></td>    </tr>    <tr>      <td align="left">🚅<code>:bullettrain_front:</code></td>      <td align="left">🚄<code>:bullettrain_side:</code></td>      <td align="left">🚈<code>:light_rail:</code></td>    </tr>    <tr>      <td align="left">🚝<code>:monorail:</code></td>      <td align="left">🚃<code>:railway_car:</code></td>      <td align="left">🚎<code>:trolleybus:</code></td>    </tr>    <tr>      <td align="left">🎫<code>:ticket:</code></td>      <td align="left">⛽️<code>:fuelpump:</code></td>      <td align="left">🚦<code>:vertical_traffic_light:</code></td>    </tr>    <tr>      <td align="left">🚥<code>:traffic_light:</code></td>      <td align="left">⚠️<code>:warning:</code></td>      <td align="left">🚧<code>:construction:</code></td>    </tr>    <tr>      <td align="left">🔰<code>:beginner:</code></td>      <td align="left">🏧<code>:atm:</code></td>      <td align="left">🎰<code>:slot_machine:</code></td>    </tr>    <tr>      <td align="left">🚏<code>:busstop:</code></td>      <td align="left">💈<code>:barber:</code></td>      <td align="left">♨️<code>:hotsprings:</code></td>    </tr>    <tr>      <td align="left">🏁<code>:checkered_flag:</code></td>      <td align="left">🎌<code>:crossed_flags:</code></td>      <td align="left">🏮<code>:izakaya_lantern:</code></td>    </tr>    <tr>      <td align="left">🗿<code>:moyai:</code></td>      <td align="left">🎪<code>:circus_tent:</code></td>      <td align="left">🎭<code>:performing_arts:</code></td>    </tr>    <tr>      <td align="left">📍<code>:round_pushpin:</code></td>      <td align="left">🚩<code>:triangular_flag_on_post:</code></td>      <td align="left"></td>    </tr>  </tbody></table><p>Symbols</p><table>  <thead>    <tr>      <th align="left">1️⃣<code>:one:</code></th>      <th align="left">2️⃣<code>:two:</code></th>      <th align="left">3️⃣<code>:three:</code></th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">4️⃣<code>:four:</code></td>      <td align="left">5️⃣<code>:five:</code></td>      <td align="left">6️⃣<code>:six:</code></td>    </tr>    <tr>      <td align="left">7️⃣<code>:seven:</code></td>      <td align="left">8️⃣<code>:eight:</code></td>      <td align="left">9️⃣<code>:nine:</code></td>    </tr>    <tr>      <td align="left">🔟<code>:keycap_ten:</code></td>      <td align="left">🔢<code>:1234:</code></td>      <td align="left">0️⃣<code>:zero:</code></td>    </tr>    <tr>      <td align="left">#️⃣<code>:hash:</code></td>      <td align="left">🔣<code>:symbols:</code></td>      <td align="left">◀️<code>:arrow_backward:</code></td>    </tr>    <tr>      <td align="left">⬇️<code>:arrow_down:</code></td>      <td align="left">▶️<code>:arrow_forward:</code></td>      <td align="left">⬅️<code>:arrow_left:</code></td>    </tr>    <tr>      <td align="left">🔠<code>:capital_abcd:</code></td>      <td align="left">🔡<code>:abcd:</code></td>      <td align="left">🔤<code>:abc:</code></td>    </tr>    <tr>      <td align="left">↙️<code>:arrow_lower_left:</code></td>      <td align="left">↘️<code>:arrow_lower_right:</code></td>      <td align="left">➡️<code>:arrow_right:</code></td>    </tr>    <tr>      <td align="left">⬆️<code>:arrow_up:</code></td>      <td align="left">↖️<code>:arrow_upper_left:</code></td>      <td align="left">↗️<code>:arrow_upper_right:</code></td>    </tr>    <tr>      <td align="left">⏬<code>:arrow_double_down:</code></td>      <td align="left">⏫<code>:arrow_double_up:</code></td>      <td align="left">🔽<code>:arrow_down_small:</code></td>    </tr>    <tr>      <td align="left">⤵️<code>:arrow_heading_down:</code></td>      <td align="left">⤴️<code>:arrow_heading_up:</code></td>      <td align="left">↩️<code>:leftwards_arrow_with_hook:</code></td>    </tr>    <tr>      <td align="left">↪️<code>:arrow_right_hook:</code></td>      <td align="left">↔️<code>:left_right_arrow:</code></td>      <td align="left">↕️<code>:arrow_up_down:</code></td>    </tr>    <tr>      <td align="left">🔼<code>:arrow_up_small:</code></td>      <td align="left">🔃<code>:arrows_clockwise:</code></td>      <td align="left">🔄<code>:arrows_counterclockwise:</code></td>    </tr>    <tr>      <td align="left">⏪<code>:rewind:</code></td>      <td align="left">⏩<code>:fast_forward:</code></td>      <td align="left">ℹ️<code>:information_source:</code></td>    </tr>    <tr>      <td align="left">🆗<code>:ok:</code></td>      <td align="left">🔀<code>:twisted_rightwards_arrows:</code></td>      <td align="left">🔁<code>:repeat:</code></td>    </tr>    <tr>      <td align="left">🔂<code>:repeat_one:</code></td>      <td align="left">🆕<code>:new:</code></td>      <td align="left">🔝<code>:top:</code></td>    </tr>    <tr>      <td align="left">🆙<code>:up:</code></td>      <td align="left">🆒<code>:cool:</code></td>      <td align="left">🆓<code>:free:</code></td>    </tr>    <tr>      <td align="left">🆖<code>:ng:</code></td>      <td align="left">🎦<code>:cinema:</code></td>      <td align="left">🈁<code>:koko:</code></td>    </tr>    <tr>      <td align="left">📶<code>:signal_strength:</code></td>      <td align="left"></td>      <td align="left"></td>    </tr>    <tr>      <td align="left">🈂️<code>:sa:</code></td>      <td align="left">🚻<code>:restroom:</code></td>      <td align="left">🚹<code>:mens:</code></td>    </tr>    <tr>      <td align="left">🚺<code>:womens:</code></td>      <td align="left">🚼<code>:baby_symbol:</code></td>      <td align="left">🚭<code>:no_smoking:</code></td>    </tr>    <tr>      <td align="left">🅿️<code>:parking:</code></td>      <td align="left">♿️<code>:wheelchair:</code></td>      <td align="left">🚇<code>:metro:</code></td>    </tr>    <tr>      <td align="left">🛄<code>:baggage_claim:</code></td>      <td align="left">🉑<code>:accept:</code></td>      <td align="left">🚾<code>:wc:</code></td>    </tr>    <tr>      <td align="left">🚰<code>:potable_water:</code></td>      <td align="left">🚮<code>:put_litter_in_its_place:</code></td>      <td align="left">㊙️<code>:secret:</code></td>    </tr>    <tr>      <td align="left">㊗️<code>:congratulations:</code></td>      <td align="left">Ⓜ️<code>:m:</code></td>      <td align="left">🛂<code>:passport_control:</code></td>    </tr>    <tr>      <td align="left">🛅<code>:left_luggage:</code></td>      <td align="left">🛃<code>:customs:</code></td>      <td align="left">🉐<code>:ideograph_advantage:</code></td>    </tr>    <tr>      <td align="left">🆑<code>:cl:</code></td>      <td align="left">🆘<code>:sos:</code></td>      <td align="left">🆔<code>:id:</code></td>    </tr>    <tr>      <td align="left">🚫<code>:no_entry_sign:</code></td>      <td align="left">🔞<code>:underage:</code></td>      <td align="left">📵<code>:no_mobile_phones:</code></td>    </tr>    <tr>      <td align="left">🚯<code>:do_not_litter:</code></td>      <td align="left">🚱<code>:non-potable_water:</code></td>      <td align="left">🚳<code>:no_bicycles:</code></td>    </tr>    <tr>      <td align="left">🚷<code>:no_pedestrians:</code></td>      <td align="left">🚸<code>:children_crossing:</code></td>      <td align="left">⛔️<code>:no_entry:</code></td>    </tr>    <tr>      <td align="left">✳️<code>:eight_spoked_asterisk:</code></td>      <td align="left">✴️<code>:eight_pointed_black_star:</code></td>      <td align="left">💟<code>:heart_decoration:</code></td>    </tr>    <tr>      <td align="left">🆚<code>:vs:</code></td>      <td align="left">📳<code>:vibration_mode:</code></td>      <td align="left">📴<code>:mobile_phone_off:</code></td>    </tr>    <tr>      <td align="left">💹<code>:chart:</code></td>      <td align="left">💱<code>:currency_exchange:</code></td>      <td align="left">♈️<code>:aries:</code></td>    </tr>    <tr>      <td align="left">♉️<code>:taurus:</code></td>      <td align="left">♊️<code>:gemini:</code></td>      <td align="left">♋️<code>:cancer:</code></td>    </tr>    <tr>      <td align="left">♌️<code>:leo:</code></td>      <td align="left">♍️<code>:virgo:</code></td>      <td align="left">♎️<code>:libra:</code></td>    </tr>    <tr>      <td align="left">♏️<code>:scorpius:</code></td>      <td align="left">♐️<code>:sagittarius:</code></td>      <td align="left">♑️<code>:capricorn:</code></td>    </tr>    <tr>      <td align="left">♒️<code>:aquarius:</code></td>      <td align="left">♓️<code>:pisces:</code></td>      <td align="left">⛎<code>:ophiuchus:</code></td>    </tr>    <tr>      <td align="left">🔯<code>:six_pointed_star:</code></td>      <td align="left">❎<code>:negative_squared_cross_mark:</code></td>      <td align="left">🅰️<code>:a:</code></td>    </tr>    <tr>      <td align="left">🅱️<code>:b:</code></td>      <td align="left">🆎<code>:ab:</code></td>      <td align="left">🅾️<code>:o2:</code></td>    </tr>    <tr>      <td align="left">💠<code>:diamond_shape_with_a_dot_inside:</code></td>      <td align="left">♻️<code>:recycle:</code></td>      <td align="left">🔚<code>:end:</code></td>    </tr>    <tr>      <td align="left">🔛<code>:on:</code></td>      <td align="left">🔜<code>:soon:</code></td>      <td align="left">🕐<code>:clock1:</code></td>    </tr>    <tr>      <td align="left">🕜<code>:clock130:</code></td>      <td align="left">🕙<code>:clock10:</code></td>      <td align="left">🕥<code>:clock1030:</code></td>    </tr>    <tr>      <td align="left">🕚<code>:clock11:</code></td>      <td align="left">🕦<code>:clock1130:</code></td>      <td align="left">🕛<code>:clock12:</code></td>    </tr>    <tr>      <td align="left">🕧<code>:clock1230:</code></td>      <td align="left">🕑<code>:clock2:</code></td>      <td align="left">🕝<code>:clock230:</code></td>    </tr>    <tr>      <td align="left">🕒<code>:clock3:</code></td>      <td align="left">🕞<code>:clock330:</code></td>      <td align="left">🕓<code>:clock4:</code></td>    </tr>    <tr>      <td align="left">🕟<code>:clock430:</code></td>      <td align="left">🕔<code>:clock5:</code></td>      <td align="left">🕠<code>:clock530:</code></td>    </tr>    <tr>      <td align="left">🕕<code>:clock6:</code></td>      <td align="left">🕡<code>:clock630:</code></td>      <td align="left">🕖<code>:clock7:</code></td>    </tr>    <tr>      <td align="left">🕢<code>:clock730:</code></td>      <td align="left">🕗<code>:clock8:</code></td>      <td align="left">🕣<code>:clock830:</code></td>    </tr>    <tr>      <td align="left">🕘<code>:clock9:</code></td>      <td align="left">🕤<code>:clock930:</code></td>      <td align="left">💲<code>:heavy_dollar_sign:</code></td>    </tr>    <tr>      <td align="left">©️<code>:copyright:</code></td>      <td align="left">®️<code>:registered:</code></td>      <td align="left">™️<code>:tm:</code></td>    </tr>    <tr>      <td align="left">❌<code>:x:</code></td>      <td align="left">❗️<code>:heavy_exclamation_mark:</code></td>      <td align="left">‼️<code>:bangbang:</code></td>    </tr>    <tr>      <td align="left">⁉️<code>:interrobang:</code></td>      <td align="left">⭕️<code>:o:</code></td>      <td align="left">✖️<code>:heavy_multiplication_x:</code></td>    </tr>    <tr>      <td align="left">➕<code>:heavy_plus_sign:</code></td>      <td align="left">➖<code>:heavy_minus_sign:</code></td>      <td align="left">➗<code>:heavy_division_sign:</code></td>    </tr>    <tr>      <td align="left">💮<code>:white_flower:</code></td>      <td align="left">💯<code>:100:</code></td>      <td align="left">✔️<code>:heavy_check_mark:</code></td>    </tr>    <tr>      <td align="left">☑️<code>:ballot_box_with_check:</code></td>      <td align="left">🔘<code>:radio_button:</code></td>      <td align="left">🔗<code>:link:</code></td>    </tr>    <tr>      <td align="left">➰<code>:curly_loop:</code></td>      <td align="left">〰️<code>:wavy_dash:</code></td>      <td align="left">〽️<code>:part_alternation_mark:</code></td>    </tr>    <tr>      <td align="left">🔱<code>:trident:</code></td>      <td align="left">🔻<code>:small_red_triangle_down:</code></td>      <td align="left">🔺<code>:small_red_triangle:</code></td>    </tr>    <tr>      <td align="left">✅<code>:white_check_mark:</code></td>      <td align="left">🔲<code>:black_square_button:</code></td>      <td align="left">🔳<code>:white_square_button:</code></td>    </tr>    <tr>      <td align="left">⚫️<code>:black_circle:</code></td>      <td align="left">⚪️<code>:white_circle:</code></td>      <td align="left">🔴<code>:red_circle:</code></td>    </tr>    <tr>      <td align="left">🔵<code>:large_blue_circle:</code></td>      <td align="left">🔷<code>:large_blue_diamond:</code></td>      <td align="left">🔶<code>:large_orange_diamond:</code></td>    </tr>    <tr>      <td align="left">🔹<code>:small_blue_diamond:</code></td>      <td align="left">🔸<code>:small_orange_diamond:</code></td>      <td align="left"></td>    </tr>  </tbody></table>              </div>            </details>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> emoji </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WMware安装Linux</title>
      <link href="/posts/1763fb9d.html"/>
      <url>/posts/1763fb9d.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）下载">1）下载</h1><div class="btns rounded grid5">            <a class="button" href='https://www.centos.org/download/' title='CentOS'><i class='fas fa-download'></i>CentOS</a><a class="button" href='https://ubuntu.com/download/server' title='Ubuntu'><i class='fas fa-download'></i>Ubuntu</a>          </div><hr><h1 id="2）VMware-中安装-Linux">2）VMware 中安装 Linux</h1><details class="folding-tag" cyan><summary> 1）配置 </summary>              <div class='content'>              <div class="tabs" id="vmware-setting"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#vmware-setting-1">VMware 17</button></li><li class="tab"><button type="button" data-href="#vmware-setting-2">VMware 15.5</button></li><li class="tab"><button type="button" data-href="#vmware-setting-3">VMware 14</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="vmware-setting-1"><ol><li><p>打开“VMware Workstation 17 PRO“软件，选择”创建新的虚拟机“。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213195818166.png" alt="image-20230213195818166"></p></li><li><p>选择“典型”选项，然后下一步。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200017639.png" alt="image-20230213200017639"></p></li><li><p>选择“稍后安装操作系统”，点击下一步。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200226774.png" alt="image-20230213200226774"></p></li><li><p>客户机操作选择“Linux”,版本选择“CentOS 7 64位”，点击下一步。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200258945.png" alt="image-20230213200258945"></p></li><li><p>输入“虚拟机名称”，选择虚拟机文件保存的位置，点击下一步。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200712138.png" alt="image-20230213200712138"></p></li><li><p>最大磁盘默认20G大小即可，然后选择“将虚拟机磁盘存储为单个文件”，下一步。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200907483.png" alt="image-20230213200907483"></p></li><li><p>点击”自定义硬件配置“。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213200940144.png" alt="image-20230213200940144"></p></li><li><p>选中”新 CD/DVD“，选择”使用 ISO 映像文件“，然后设置 CentOS7 的 ISO 映像路径，点击关闭。网络适配器默认 NAT。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213201247111.png" alt="image-20230213201247111"></p></li><li><p>点击完成，如下。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213201323470.png" alt="image-20230213201323470"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="vmware-setting-2"><ol><li><p>打开“VMware Workstation 15.5 PRO“软件，选择”创建新的虚拟机“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140015933-1356816755.png" alt="image"></p></li><li><p>选择“典型”选项，然后下一步。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140016278-476372467.png" alt="image"></p></li><li><p>选择“稍后安装操作系统”，点击下一步。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140453132-502089345.png" alt="image"></p></li><li><p>客户机操作选择“Linux”,版本选择“CentOS 7 64位”，点击下一步。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140016803-1445963239.png" alt="image"></p></li><li><p>输入“虚拟机名称”，选择虚拟机文件保存的位置，点击下一步。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140017106-928997325.png" alt="image"></p></li><li><p>最大磁盘默认20G大小即可，然后选择“将虚拟机磁盘存储为单个文件”，下一步。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630141232256-59977779.png" alt="image"></p></li><li><p>点击”自定义硬件配置“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630140017653-1916664250.png" alt="image"></p></li><li><p>选中”新CD/DVD“，选择”使用ISO映像文件“，然后设置CentOS7的ISO映像路径，点击关闭。网络适配器默认NAT。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630141232699-74619395.png" alt="image"></p></li><li><p>点击完成，如下。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630141233074-1238634344.png" alt="image"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="vmware-setting-3"><p><strong>暂无</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><details class="folding-tag" cyan><summary> 2）Linux 安装 </summary>              <div class='content'>              <div class="tabs" id="install-os"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#install-os-1">CentOS</button></li><li class="tab"><button type="button" data-href="#install-os-2">Ubuntu</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="install-os-1"><div class="tabs" id="centos-install"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#centos-install-1">CentOS 7</button></li><li class="tab"><button type="button" data-href="#centos-install-2">CentOS 6</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="centos-install-1"><ol><li><p>选中刚刚配置的CentOS7，然后点击“开启此虚拟机”。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630152759505-141749521.png" alt="image"></p></li><li><p>虚拟机启动之后会出现如下界面（白色表示选中），默认选中的是Test this media &amp; install CentOS 7。我们将鼠标移入到虚拟机中，并按下键盘中的“↑”键，选择Install CentOS 7，最后按下“Enter 键”。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630174905921-1795699179.png" alt="image"></p><p>注意： 在虚拟机中的操作，鼠标必须要移入到虚拟机中，否则虚拟机感应不到，无法对其进行操作。鼠标移动到虚拟机内部单击或者按下Ctrl + G，鼠标即可移入到虚拟机中。按下Ctrl + Alt，鼠标即可移出虚拟机。</p></li><li><p>按下Enter进行安装。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630161011759-1366753066.png" alt="image"></p></li><li><p>等待系统加载完成。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630174906608-1990481588.png" alt="image"></p></li><li><p>选择使用哪种语言，推荐使用英文。但如果是第一次安装，建议先安装中文版的熟悉一下，之后再选择英文的进行实践，这里就介绍中文的，下滑至底部选择中文。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630161012242-1628807300.png" alt="image"></p></li><li><p>【本地化】只配置日期和时间，键盘和语言支持没有特殊情况默认就好。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630230557848-1683354797.png" alt="image"></p></li><li><p>中国范围内都选择为上海（因为只有上海可选），并选择为24小时制，设置完成后单击完成按钮。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630161013056-530280498.png" alt="image"></p></li><li><p>【软件】中只配置软件选择，安装源系统会自动识别，所以不用管。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630231531469-1653331645.png" alt="image"></p></li><li><p>然后我们选择安装的系统是否含有界面，界面一般对于我们来说用处不大，而且CentOS的界面不好操作，所以这里选择最小安装。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223316408-794861899.png" alt="image"></p></li><li><p>【系统】中只配置安装位置，指的是系统如何分区，其它的都默认就好。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630231532034-1202194449.png" alt="image"></p></li><li><p>对分区不清楚的就选择自动配置分区，这里演示我要配置分区。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630161014687-1799563201.png" alt="image"></p></li><li><p>手动分区我们要选择标准分区，然后点击下面的“+”添加分区。我们分别创建三个分区：<strong>/boot区、swap交换分区、根分区/</strong></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630231532408-1234484840.png" alt="image"></p></li><li><p>添加 /boot分区，用来放启动文件，大小300MB足矣，然后点击“添加挂载点”。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223316841-1398200240.png" alt="image"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223317186-1310188677.png" alt="image"></p></li><li><p>添加 swap分区，这个是交换分区，一般情况是物理内存的2倍大小，用于物理内存不足时使用，可能造成系统不稳定，所以看情况，可以设置小一点，甚至设置为0MB，这里我设置为512MB，然后点击”添加挂载点“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701093454865-211062967.png" alt="image"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223317888-1108993201.png" alt="image"></p></li><li><p>增加根分区，表示所有空间大小，这里不填写大小，即默认剩余的空间都给根分区，然后点击”添加挂载点“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701093455353-272328394.png" alt="image"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223318560-1525794421.png" alt="image"></p></li><li><p>点击”完成“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223318908-1084660760.png" alt="image"></p></li><li><p>点击”接受更改“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630223319242-1124997568.png" alt="image"></p></li><li><p>回到界面，点击“开始安装“。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630232750247-1502840411.png" alt="image"></p></li><li><p>设置管理员ROOT密码，这是最高权限root用户的密码（默认账号为root，密码为现在要设置的）。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701101854681-815218118.png" alt="image"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701094351203-1406912009.png" alt="image"></p><p>在实际中root密码越复杂越好，因为这里只是演示，所以密码就没有那么复杂了。</p><p>提示：这个密码非常重要，请务必牢记！！！</p></li><li><p>创建用户，这里就是普通的用户，权限比较低，这一步我们可以省略。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630232751570-998326083.png" alt="image"></p></li><li><p>用户设置好了之后，等待CentOS安装完成，，然后点击“完成配置”。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200630232751891-1194015186.png" alt="image"></p></li><li><p>CentOS的启动之后的界面如下。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701101855216-1487541996.png" alt="image"></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="centos-install-2"><p><strong>暂无</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="install-os-2"><p><strong>暂无</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><details class="folding-tag" cyan><summary> 3） 网络配置 </summary>              <div class='content'>              <p>因为前面在设置CentOS7的网络适配器的时候，设置是NAT模式。所以这里有两种方法，一种是自动获取IP，另一种是固定获取IP。详细请戳此篇<a href="https://aceniu.github.io/posts/ba31607c.html">《VMware网络配置，只此一篇就够了！》</a>。</p><details class="folding-tag" cyan><summary> 3.1 自动获取IP </summary>              <div class='content'>              <ol><li><p>首先要确保的是CentOS为NAT模式。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701155823239-1019617442.png" alt="image"></p></li><li><p>在VMware界面（管理员方式启动）点击“编辑”里面的“虚拟网络编辑器”，然后勾选DHCP服务将IP地址分配给虚拟机，并设置子网IP(默认就好)。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701163206407-408019680.png" alt="image"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701163206863-358549546.png" alt="image"></p></li><li><p>点击NAT模式旁边的“NAT设置”，然后修改与子网IP同网段下的网关IP，就是前三位必须相同，即192.168.30要相同，最后一位数不相同即可（其实已经自动设置好了，默认），最后点击“确认”保存设置。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701163207167-139980290.png" alt="image"></p></li><li><p>然后启动虚拟机，进入网络配置文件目录：cd /etc/sysconfig/network-scripts/，并且用 ls 命令查看是否有ifcfg-xxx名称的配置文件（ifcfg-lo除外），如果没有则说明网卡没有被识别，这种只能重装或者换个CentOS的版本。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701155824126-673432678.png" alt="image"></p></li><li><p>编辑ifcfg-ens33文件：vi ifcfg-ens33。按 i 进入insert编辑模式，将BOOTPROTO设为dhcp，将ONBOOT设为yes，按下Esc进入命令模式输入:wq保存并退出。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701163207425-717637895.png" alt="image"></p></li><li><p>配置完成之后输入：service network restart，重启网卡让网卡设置生效，之后就可以上网了。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701164056088-720926395.png" alt="image"></p></li><li><p>输入ip addr检查一下动态分配的IP，可以发现分配的动态IP为192.168.30.128。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701164056482-555681813.png" alt="image"></p></li><li><p>最后验证是否可以访问外网。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701164056759-9331224.png" alt="image"></p><p>发现是可以访问外网的。自动获取IP至此就介绍完了，下面介绍另一种方式。</p></li></ol>              </div>            </details><details class="folding-tag" cyan><summary> 3.2 固定获取IP (推荐) </summary>              <div class='content'>              <ol><li><p>首先要确保的虚拟机网络适配器为 自定义<code>WMware8（NAT模式）</code>。（如果在同网段使用NAT模式也可以连通外网）</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214000036153.png" alt="image-20230214000036153"></p></li><li><p>点击“编辑”里面的“虚拟网络编辑器”,取消勾选DHCP服务将IP地址分配给虚拟机。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214000809770.png" alt="image-20230214000809770"></p></li><li><p>启动虚拟机，进入网络配置文件目录：cd /etc/sysconfig/network-scripts/，然后编辑ifcfg-ens33文件：vi ifcfg-ens33。按shift+i进入insert编辑模式，修改以下内容：</p><blockquote><p>BOOTPROTO=static 启用静态IP地址</p><p>ONBOOT=yes   开启自动启用网络连接</p></blockquote><p>添加以下内容：</p><blockquote><p>IPADDR=192.168.30.100   设置IP地址</p><p>NETMASK=255.255.255.0  子网掩码</p><p>GATEWAY=192.168.30.2  设置网关</p></blockquote><p>注意：IPADDR不能和子网IP冲突(最后一位只要在0~255范围内随便取一个数字，这里选择100)，GATEWAY即”NAT设置“里面的网关IP。</p><p>最后按下Esc进入命令模式输入:wq保存并退出。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214001010813.png" alt="image-20230214001010813"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214001113573.png" alt="image-20230214001113573"></p><p>修改和添加内容后如下图：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214001427820.png" alt="image-20230214001427820"></p></li><li><p>输入 <code>service network restart</code> 重启网卡让网卡设置生效。</p></li><li><p>输入ip addr检查一下IP。</p></li><li><p>验证是否可以访问外网：<code>ping www.baidu.com</code></p><p>如果 <code>ping www.baidu.com</code> 不通，那么再测试一下百度的ip地址<code>14.215.177.38</code>能否ping通，如果ip能通而域名不通则说明DNS解析有误，需要设置DNS。</p></li><li><p>设置DNS（有两种方式）。</p><p>注意：DNS服务器可以只配一个，也可以配置多个，下面我用的是两个免费的DNS服务器，查看IP地址，测试联网。</p><p>①在 ifcfg-ens33 <a href="http://%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%8E%E9%9D%A2%E8%BF%9B%E8%A1%8C%E6%B7%BB%E5%8A%A0DNS1=xxx.xxx.xxx.xxx">文件的后面进行添加DNS1=xxx.xxx.xxx.xxx</a>。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701182055948-798983910.png" alt="image"></p><p>注意改完后重启网卡才能生效。</p><p>②改 <code>vi /etc/resolv.conf</code> ,使用vi命令添加的时候要注意格式：</p><blockquote><p>nameserver xxx1.xxx1.xxx1.xxx1</p><p>nameserver xxx2.xxx2.xxx2.xxx2</p></blockquote><p>或者直接 <code>echo -e &quot;nameserver 114.114.114.114\nnameserver 223.5.5.5&quot; &gt;&gt;/etc/resolv.conf</code>。(\n是换行的意思)</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1745215-20200701182056328-1371855461.png" alt="image"></p></li></ol>              </div>            </details><details class="folding-tag" cyan><summary> 常用的免费DNS地址 </summary>              <div class='content'>              <ul><li><p>国内移动、电信和联通通用的 DNS：<code>114.114.114.114</code></p></li><li><p>阿里：首选：<code>223.5.5.5</code> 备用：<code>223.6.6.6</code></p></li><li><p>百度 ：<code>180.76.76.76</code></p></li><li><p>腾讯：首选：<code>119.29.29.29</code>，备用：<code>119.28.28.28</code></p></li><li><p>谷歌： <code>8.8.8.8</code></p></li></ul>              </div>            </details>              </div>            </details><hr><h1 id="3）安装-VMware-Tools">3）安装 VMware Tools</h1><details class="folding-tag" cyan><summary> 安装VMware Tools </summary>              <div class='content'>              <blockquote><p>VMware Tools 是 VMware 虚拟机中自带的一种增强工具，相当于 VirtualBox 中的增强功能（Sun VirtualBox Guest Additions），是VMware 提供的增强虚拟显卡和硬盘性能、以及同步虚拟机与主机时钟的驱动程序。</p></blockquote><p>⚠️ <strong>请在连接外网后再这样做</strong></p><ol><li><p>首先关闭虚拟机，如果之前使用过iso镜像启动的，请将连接选项中更改为使用物理驱动器。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214014512998.png" alt="image-20230214014512998"></p></li><li><p>启动虚拟机成功以后使用root用户登录虚拟机，然后点击VMware菜单→虚拟机→安装VMware Tools。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1366-e15f161772830acd336097569a0e6ce4.png" alt="img"></p></li><li><p>勾选安装VMware-Tools以后会弹出提示，默认如下页面。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2a62-2136cc7201d2e5d68a28978baaa487c1.png" alt="img"></p></li><li><p>安装过程为了方便复制命令，我这里使用第三方工具finashell 登录centos系统。</p></li><li><p>进入虚拟机，将光盘里面的安装文件挂载到/mnt 目录下。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mount /dev/sr0 /mnt</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ls /mnt</span></span><br><span class="line">manifest.txt  run_upgrader.sh  VMwareTools-10.3.25-20206839.tar.gz  vmware-tools-upgrader-32  vmware-tools-upgrader-64</span><br><span class="line"><span class="comment"># 看到安装文件已经正确挂载</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>文件复制到root目录下，解压。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意文件版本不通名字一样的需要修改</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cp /mnt/VMwareTools-10.3.25-20206839.tar.gz /root</span></span><br><span class="line"><span class="comment"># 进行解压</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tar -zxvf VMwareTools-10.3.25-20206839.tar.gz</span></span><br></pre></td></tr></table></figure></li><li><p>安装依赖包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl gcc make kernel-headers kernel-devel</span><br></pre></td></tr></table></figure></li><li><p>进入VMwareTools安装目录，并执行安装。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/vmware-tools-distrib</span><br><span class="line">./vmware-install.pl</span><br><span class="line"><span class="comment"># 执行安装脚本进行安装，一直按回车按键即可。</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
          <category> VMware </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> VMware </tag>
            
            <tag> CentOS </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware网络配置，只此一篇就够了！</title>
      <link href="/posts/ba31607c.html"/>
      <url>/posts/ba31607c.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1-使用VMware虚拟机连接网络时，经常会遇到以下问题">1. 使用VMware虚拟机连接网络时，经常会遇到以下问题</h1><ul><li>主机和虚拟机如何建立网络连接</li><li>虚拟机如何访问Internet</li><li>在工作单位的网络中如何使用虚拟机，避免虚拟机影响正常网络</li></ul><hr><h1 id="2-网络场景配置">2. 网络场景配置</h1><h2 id="2-1-宿主机与虚拟机组成局域网，其他电脑不能访问该网络">2.1 宿主机与虚拟机组成局域网，其他电脑不能访问该网络</h2><p>相当于把虚拟机当成PC，宿主机当成路由器。&quot;路由器&quot;不接入外网。</p><p><strong>仅主机模式</strong></p><ul><li><p><strong>特点</strong>：</p><ul><li>虚拟机和宿主机组成一个封闭的局域网</li><li>虚拟机不能访问外部网络、互联网</li><li>外部网络也不能访问虚拟机</li></ul></li><li><p><strong>具体操作过程</strong></p><div class="note default modern"><p>进入VMware-&gt;主菜单-&gt; 虚拟网络编辑器</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213123835460.png" alt="image-20230213123835460"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213124245129.png" alt="image-20230213124245129"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213124434486.png" alt="image-20230213124434486"></p><blockquote><ul><li>在网络列表中选择“VMnet1”,如果没有，可以点击“添加网络”按钮增加，为什么是VMnet1呢，这个应该是VMWare默认设置，当然是用其他网卡也是可以的。</li><li>选择“仅主机模式”</li><li>并选择“将主机虚拟适配器连接到此网络”和“是用本地DHCP服务将IP地址分配给虚拟机”选项</li><li>子网IP:10.10.10.0，子网掩码：255.255.255.0，我习惯将“仅主机模式”的子网网段配置为“10.10.10.0”，这个可以根据自己的喜好来设置。</li></ul></blockquote><div class="note default modern"><p>修改虚拟机设置，将网络适配器修改为“仅主机模式”</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213124901613.png" alt="image-20230213124901613"></p></li><li><p>总结</p><p>宿主机主机IP地址为：10.10.10.1<br>虚拟机的IP地址为自动获取，一般为：10.10.10.128<br>此时宿主机和虚拟机组成了一个小的独立局域网，其他电脑不能访问该网络，同时该网络内的虚拟机也不能访问外部网络，如果大家有此种应用需求，就可以使用该方式搭建网络。</p></li></ul><h2 id="2-2-虚拟机加入工作单位局域网，其他电脑允许访问虚拟机">2.2 虚拟机加入工作单位局域网，其他电脑允许访问虚拟机</h2><p>相当于把虚拟机当成PC，去连接宿主机。宿主机和虚拟机连接路由后再接入外网。</p><p><strong>桥接模式</strong></p><ul><li><p><strong>特点</strong></p><ul><li>可以将虚拟机看做一台新电脑，接入了宿主机所在的网络，如果是在工作单位，可能造成虚拟机IP占用单位同事电脑的IP地址，小心单位网管会找你呦。。。</li><li>虚拟机允许访问宿主机所在网络的其他电脑</li><li>虚拟机允许访问Internet互联网（当然宿主机必须可以访问互联网才行）。</li><li>主机和虚拟机通过单位局域网，互联互通。</li></ul></li><li><p><strong>具体操作过程</strong></p><div class="note default modern"><p>进入VMware-&gt;主菜单-&gt; 虚拟网络编辑器</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213123835460.png" alt="image-20230213123835460"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213124245129.png" alt="image-20230213124245129"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213132601922.png" alt="image-20230213132601922"></p><blockquote><ul><li>在网络列表中选择“VMnet0”,如果没有，可以点击“添加网络”按钮增加，为什么是VMnet0呢，这个应该是VMware默认设置，当然是用其他网卡也是可以的。</li><li>选择“桥接模式”</li><li>选择宿主机访问外部网络的物理网卡，可以使有线网卡也可以是无线网卡。</li><li>确定，保存</li></ul></blockquote><div class="note default modern"><p>修改虚拟机设置，将网络适配器修改为“桥接模式”</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213133120357.png" alt="image-20230213133120357"></p></li><li><p>总结</p><p>虚拟机从单位局域网自动获取IP地址，如果未获取到IP地址，需要自己指定IP<br>宿主机仍然使用单位内原有IP<br>宿主机和虚拟机同时接入工作单位局域网络虚拟机通过公司局域网，访问Internet互联网（当然需要网管人员为虚拟机IP开通外网访问权限）。</p></li></ul><h2 id="2-3-虚拟机通过宿主机访问互联网">2.3 虚拟机通过宿主机访问互联网</h2><p>相当于把虚拟机当成PC，去连接宿主机（宿主机也是一层路由）。宿主机再连接路由后再接入外网。</p><p><strong>NAT模式</strong></p><ul><li><p><strong>特点</strong></p><ul><li><p>虚拟机和宿主机组成小局域网，做到互联互通。</p></li><li><p>虚拟机通过宿主机访问外部网络（此时宿主机起到路由器作用），但外部网络不能访问虚拟机</p></li><li><p>虚拟机允许访问Internet互联网（当然宿主机必须可以访问互联网才行）</p></li></ul></li><li><p><strong>具体操作过程</strong></p><div class="note default modern"><p>进入VMware-&gt;主菜单-&gt; 虚拟网络编辑器</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213123835460.png" alt="image-20230213123835460"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213124245129.png" alt="image-20230213124245129"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213133801249.png" alt="image-20230213133801249"></p><blockquote><ul><li>在网络列表中选择“VMnet8”,如果没有，可以点击“添加网络”按钮增加，为什么是VMnet8呢，这个应该是VMware默认设置，当然是用其他网卡也是可以的。</li><li>选择“NAT模式”</li><li>并选择“将主机虚拟适配器连接到此网络”和“是用本地DHCP服务将IP地址分配给虚拟机”选项</li><li>子网IP:10.0.0.0，子网掩码：255.255.255.0，为了与“仅主机模式”区分，我习惯将“NAT模式”的子网网段配置为“10.0.0.0”，这个可以根据自己的喜好来设置。</li></ul></blockquote><div class="note default modern"><p>修改虚拟机设置，将网络适配器修改为“NAT模式”</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213134055381.png" alt="image-20230213134055381"></p></li><li><p>总结</p><p>宿主机主机IP地址为：10.0.0.1<br>虚拟机的IP地址为自动获取，一般为：10.0.0.128<br>此时宿主机和虚拟机组成了一个小的独立局域网，其他电脑不能访问该网络虚拟机可以访问外部网络，如果宿主机可以访问Internet互联网，此时虚拟就具备了访问互联网的能力；我个人在工作单位一般使用该方式，虚拟机可以使用互联网功能，又不会有网管找上门来。如果大家有此种应用需求，就可以使用该方式搭建网络。</p></li></ul><hr><h1 id="3-图解分析">3. 图解分析</h1><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/17031708005610.jpg" alt="17031708005610"></p>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
          <category> VMware </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 虚拟机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 6.0 学习笔记</title>
      <link href="/posts/c1031b26.html"/>
      <url>/posts/c1031b26.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="1）Zabbix-简介">1）Zabbix 简介</h1><div class="tip home"><p><strong>Zabbix官网</strong>：<a href="https://www.zabbix.com">https://www.zabbix.com</a></p></div><div class="tip cogs"><p><strong>Zabbix官方文档</strong>：<a href="https://www.zabbix.com/documentation/6.0/zh/manual/installation/requirements">https://www.zabbix.com/documentation/6.0/zh/manual/installation/requirements</a></p></div><p>参考文案：<a href="https://blog.csdn.net/weixin_52906737/article/details/128331225">https://blog.csdn.net/weixin_52906737/article/details/128331225</a></p><p>dnf安装：<a href="https://www.cnblogs.com/eeexu123/p/16525096.html">https://www.cnblogs.com/eeexu123/p/16525096.html</a></p><h2 id="概述">概述</h2><p>Zabbix是由Alexei Vladishev开发的一种网络监视、管理系统，基于Server-Client架构。可用于监视各种网络服务、服务器和网络机器等状态。</p><p>使用各种Database-end如MySQL, PostgresQL, sQLite, Oracle或 IBM DB2储存资料。Server端基于C语言、Web管理端frontend则是基于PHP所制作的。</p><p>Zabbix可以使用多种方式监视。可以只使用Simple Check 不需要安装Client端，亦可基于SMTP或HTTP…各种协议定制监视。</p><p>在客户端如UNIX,Windows中安装Zabbix Agent 之后，可监视 CPU Load、网络使用状况、硬盘容量等各种状态。而就算没有安装Agent 在监视对象中，Zabbix也可以经由SNMP、TCP、ICMP、利用IPMI、SSH、 telnet 对目标进行监视。</p><p>Zabbbix自带的ltem足够满足普通小公司的监控需求，对于大公司也可以设定自定义的ltem，自动生成报表，也有API可以和其他系统集成。</p><h2 id="使用-Zabbix-的优势">使用 Zabbix 的优势</h2><ul><li><p>开源,无软件成本投入</p></li><li><p>Server 对设备性能要求低</p></li><li><p>支持设备多,自带多种监控模板</p></li><li><p>支持分布式集中管理,有自动发现功能,可以实现自动化监控</p></li><li><p>开放式接口,扩展性强,插件编写容易</p></li><li><p>当监控的 item 比较多服务器队列比较大时可以采用主动状态,被监控客户端主动 从server 端去下载需要监控的 item 然后取数据上传到 server 端。 这种方式对服务器的负载比较小。</p></li><li><p>Api 的支持,方便与其他系统结合</p></li><li><p>zabbix可以满足理想化的监控系统需求</p></li></ul><h2 id="软件的生命周期">软件的生命周期</h2><p>LTS为Long Term Support的简写，zabbix将为客户提供5年的支持服务。前三年完全支持与后两年有限制支持。前三年包括一般、关键、安全性问题解决，后两年包括关键、安全性问题解决。超出时间不提供技术支持服务。然而标准版，只提供6+1月支持。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213111630296.png" alt="image-20230213111630296"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213111643162.png" alt="image-20230213111643162"></p><hr><h1 id="2）Zabbix-架构">2）Zabbix 架构</h1><h2 id="监控方式">监控方式</h2><ol><li><p><strong>被动监控</strong><br>被动检测：相对于agent而言；agent, server向agent请求获取配置的各监控项相关的数据，agent接收请求、获取数据并响应给server；</p></li><li><p><strong>主动监控</strong><br>主动检测：相对于agent而言；agent(active),agent向server请求与自己相关监控项配置，主动地将server配置的监控项相关的数据发送给server；主动监控能极大节约监控server 的资源。</p></li></ol><h2 id="可监控对象">可监控对象</h2><ul><li>数据库： MySQL,MariaDB,Oracle,SQL Server    agent</li><li>应用软件：Nginx,Apache,PHP,Tomcat                 agent</li><li>集群： LVS,Keepalived,HAproxy,RHCS,F5          agent</li><li>虚拟化： VMware,KVM,XEN ,docker,k8s             agent</li><li>操作系统：Linux,Unix,Windows性能参数              agent</li><li>硬件： 服务器，存储，网络设备 IPMI                   IPMI</li><li>网络： 网络环境（内网环境，外网环境）             SNMP</li></ul><h2 id="监控架构">监控架构</h2><blockquote><ul><li>Zabbix是一个CS(服务端/客户端)架构的服务.</li><li>zabbix监控架构<br>Zabbix-Agent获取数据  --发送给  --&gt;Zabbix-Server服务端  --&gt;数据会被存放 --数据库 &lt;–Zabbix Web 页面展示数据</li><li>采集数据–&gt; 数据收集，数据分析，报警  --&gt;存储  --&gt;友好的展示</li></ul></blockquote><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230213111546778.png" alt="image-20230213111546778"></p><ol><li><p><strong>zabbix sever</strong><br>Zabbix server 是 agent 程序报告系统可用性、系统完整性和统计数据的核心组件，是所有配置信息、统计信息和操作数据的核心存储器。</p></li><li><p><strong>zabbix数据库存储</strong><br>所有配置信息和 Zabbix 收集到的数据都被存储在数据库中。</p></li><li><p><strong>Zabbix Web 界面</strong><br>为了从任何地方和任何平台都可以轻松的访问Zabbix, 我们提供基于Web的Zabbix界面。该界面是Zabbix Server的一部分，通常(但不一定)跟Zabbix Server运行在同一台物理机器上。</p><p>如果使用 SQLite,Zabbix Web 界面必须要跟Zabbix Server运行在同一台物理机器上。</p></li><li><p><strong>Zabbix Proxy 代理服务器</strong><br>Zabbix proxy 可以替Zabbix Server收集性能和可用性数据。Proxy代理服务器是Zabbix软件可选择部署的一部分；当然，Proxy代理服务器可以帮助单台Zabbix Server分担负载压力。</p></li><li><p><strong>Zabbix Agent 监控代理</strong><br>Zabbix agents监控代理 部署在监控目标上，能够主动监控本地资源和应用程序，并将收集到的数据报告给Zabbix Server。</p></li><li><p><strong>Zabbix 数据流</strong><br>监控方面，为了创建一个监控项(item)用于采集数据，必须先创建一个主机（host）。</p><p>告警方面，在监控项里创建触发器（trigger），通过触发器（trigger）来触发告警动作（action）。 因此，如果你想收到Server XCPU负载过高的告警，必须满足：</p><ul><li>为Server X创建一个host并关联一个用于对CPU进行监控的监控项（Item）。</li><li>创建一个Trigger，设置成当CPU负载过高时会触发</li><li>Trigger被触发，发送告警邮件</li></ul></li></ol><hr><h1 id="3）监控的生命周期">3）监控的生命周期</h1><ol><li><p>服务器上架机柜</p></li><li><p>进行基础设施的监控</p><ul><li>服务器温度，风扇转速（ipmitool命令对服务器进行远程管理，注意只能用在物理机，VMware不行）</li><li>存储的容量，性能（df，fdisk，dd，iotop）</li><li>CPU性能（Iscpu，uptime，top，htop，glances）</li><li>内存（free）</li><li>网络情况（iftop，nethogs）</li></ul></li><li><p>应用监控</p><ul><li>数据库mysql，redis</li><li>nginx</li><li>php-fmp</li><li>python</li></ul></li><li><p>注意：若是服务器在维护中，还得暂停监控指标，否则监控会不停报警。</p></li><li><p>监控系统在运维自动化系统中，实现如下功能</p><ul><li>监控数据收集，可视化展示（图标展示，柱状图，曲线图，折线图）</li><li>异常数据报警</li><li>结合CMDB等系统协同工作</li></ul></li></ol><hr><h1 id="4）主机规划">4）主机规划</h1><h2 id="推荐配置">推荐配置</h2><table>  <colgroup>    <col style="width: 22%" />    <col style="width: 4%" />    <col style="width: 38%" />    <col style="width: 33%" />    <col style="width: 1%" />  </colgroup>  <thead>    <tr class="header">      <th>规模 平</th>      <th>CPU</th>      <th>内存 数据库</th>      <th colspan="2">受监控的主机数量</th>    </tr>  </thead>  <tbody>    <tr class="odd">      <td><em>小型</em> C</td>      <td>ntOS V</td>      <td>rtual Appliance M</td>      <td>SQL InnoDB 1</td>      <td>0</td>    </tr>    <tr class="even">      <td><em>中型</em> C</td>      <td>ntOS 2</td>      <td>CPU cores/2GB M</td>      <td>SQL InnoDB 5</td>      <td>0</td>    </tr>    <tr class="odd">      <td><em>大型</em> R</td>      <td>dHat Enterprise Linux 4</td>      <td>CPU cores/8GB R</td>      <td>ID10 MySQL InnoDB 或 PostgreSQL &amp;g</td>      <td>;1000</td>    </tr>    <tr class="even">      <td><em>极大型</em> Re</td>      <td>Hat Enterprise Linux 8</td>      <td>PU cores/16GB Fa</td>      <td>t RAID10 MySQL InnoDB 或 PostgreSQL &amp;gt</td>      <td>10000</td>    </tr>  </tbody></table>>  实际上，Zabbix 环境的配置非常依赖于监控项（主动）和更新间隔。 如果是进行大规模部署，强烈建议将数据库独立部署。<p><strong>内存和磁盘</strong></p><p>Zabbix 运行需要物理内存和磁盘空间。如果刚接触 Zabbix，128 MB 的物理内存和 256 MB 的可用磁盘空间可能是一个很好的起点。 然而，所需的内存和磁盘空间显然取决于被监控的主机数量和配置参数。 如果您计划调整参数以保留较长的历史数据，那么您应该考虑至少有几 GB 磁盘空间，以便有足够的磁盘空间将历史数据存储在数据库中。</p><p>每个 Zabbix 守护程序进程都需要与数据库服务器建立多个连接。 为连接分配的内存量取决于数据库引擎的配置。</p><blockquote><p>拥有的物理内存越多，数据库（以及 Zabbix ）的工作速度就越快！</p></blockquote><p><strong>CPU</strong></p><p>Zabbix，尤其是 Zabbix 数据库可能需要大量 CPU 资源，该具体取决于被监控参数的数量和所选的数据库引擎。</p><p><strong>其他硬件</strong></p><p>如果需要启用短信（SMS）通知功能，需要串行通讯口（serial communication port）和串行GSM调制解调器（serial GSM modem）。USB转串行转接器也同样可以工作。</p><h2 id="容量估算">容量估算</h2><table><thead><tr><th>参数</th><th>所需磁盘空间的计算公式 （单位：字节</th></tr></thead><tbody><tr><td>Zabbix 配置文件</td><td>固定大小。通常为10MB或者更少。</td></tr><tr><td>History（历史数据）</td><td>days(items/refresh rate)243600bytes items：监控项数量。 days：保留历史数据的天数。 refresh rate：监控项的更新间隔。 bytes：保留单个值所需要占用的字节数，依赖于数据库引擎，通常为 ~90 字节。</td></tr><tr><td>Trends(趋势数据)</td><td>days(items/3600)243600bytes items：监控项数量。 days：保留历史数据的天数。 bytes：保留单个趋势数据所需要占用的字节数，依赖于数据库引擎，通常为 ~90 字节。</td></tr><tr><td>Events(事件数据)</td><td>daysevents243600bytes events：每秒产生的事件数量。假设最糟糕的情况下，每秒产生 1 个事件。 days：保留历史数据的天数。 bytes：保留单个趋势数据所需的字节数，取决于数据库引擎，通常为 ~170 字节。</td></tr></tbody></table><hr><h1 id="5）部署-Zabbix-服务端">5）部署 Zabbix 服务端</h1><p>参考文章（使用centos7.4+nginx1.20+mysql8.0.30+php7.2.34、zabbix-server 6.0.1）：<a href="https://blog.csdn.net/weixin_52906737/article/details/128331225">https://blog.csdn.net/weixin_52906737/article/details/128331225</a></p><h2 id="5-1-本篇内容的主机规划">5.1 本篇内容的主机规划</h2><div class="tip warning faa-horizontal animated-hover"><p>⚠️注意！CentOS 7.x 不支持 yum 方式安装 Zabbix 服务端。</p></div><ul><li><p><strong>安装方式：</strong></p><ul><li><emp>Zabbix **服务端编译安装**</emp></li><li>Zabbix 客户端 yum 安装</li></ul></li><li><p><strong>规划</strong></p><table id="guihua" border="1"><tr><th>角色</th><th>主机名</th><th>eth0/eth1</th><th>配置</th></tr><tr><td>Zabbix服务器</td><td>docker01</td><td>10.0.0.111</td><td>1C2G</td></tr><tr><td>Zabbix客户端</td><td>web01</td><td>10.0.0.116</td><td>1C1G</td></tr><tr><td>Zabbix客户端</td><td>db01</td><td>10.0.0.117</td><td>1C1G</td></tr><tr><td>Zabbix客户端</td><td>nfs01</td><td>10.0.0.118</td><td></td></tr></table></li></ul><h2 id="5-2-部署-zabbix-流程">5.2 部署 zabbix 流程</h2><p>1️⃣ 部署 nginx</p><p>2️⃣ 部署 php 环境</p><p>3️⃣ 部署数据库 mariadb 10.5（Mysql 7.6）及以上 然后进行配置</p><p>4️⃣ 编译安装 zabbix_server 服务端及后续配置</p><p>5️⃣ 部署前端代码进行访问</p><p>6️⃣ web访问</p><p>7️⃣ 配置客户端</p><h2 id="5-3-部署-nginx">5.3 部署 nginx</h2><p>1️⃣<strong>更改或新增 nginx 源</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br><span class="line"></span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>2️⃣<strong>安装 nginx</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nginx</span><br></pre></td></tr></table></figure><p>3️⃣<strong>启动 nginx</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure><p>4️⃣<strong>检查</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -qa | egrep &#x27;nginx&#x27;</span></span><br><span class="line">nginx-1.22.1-1.el7.ngx.x86_64</span><br></pre></td></tr></table></figure><p>5️⃣<strong>配置</strong></p><p>修改配置来连通 php。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /mydata/web/zabbix</span><br><span class="line">vim /etc/nginx/conf.d/zabbix-php.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">    server_name zbx.aceniu.com;</span><br><span class="line">    root /mydata/web/zabbix;</span><br><span class="line">    location / &#123;</span><br><span class="line">index index.php;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">fastcgi_pass  127.0.0.1:9000;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME  $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note info modern"><p>修改 Windows 配置<code>hosts</code>解析,后面测试用。</p></div><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214213847613.png" alt="image-20230214213847613"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加</span></span><br><span class="line">10.0.0.111zbx.aceniu.com<span class="comment"># zabbix web</span></span><br></pre></td></tr></table></figure><h2 id="5-4-部署-php-环境">5.4 部署 php 环境</h2><p>1️⃣<strong>安装依赖</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更换阿里云源(一般都换过了)</span></span><br><span class="line"><span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http:mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># webtatic 要求</span></span><br><span class="line">yum -y install epel-release.noarch</span><br><span class="line"></span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="comment">#webtatic源</span></span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm  </span><br><span class="line"></span><br><span class="line">yum -y install php72w-cli php72w-fpm php72w-gd php72w-mbstring php72w-bcmath php72w-xml php72w-ldap php72w-mysqlnd</span><br></pre></td></tr></table></figure><p>2️⃣<strong>检查结果</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | egrep <span class="string">&#x27;php&#x27;</span></span><br><span class="line"></span><br><span class="line">rpm -qa | egrep <span class="string">&#x27;php|nginx&#x27;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><blockquote><p>结果①:<br>php72w-common-7.2.34-1.w7.x86_64<br>php72w-fpm-7.2.34-1.w7.x86_64<br>php72w-mbstring-7.2.34-1.w7.x86_64<br>php72w-mysqlnd-7.2.34-1.w7.x86_64<br>php72w-cli-7.2.34-1.w7.x86_64<br>php72w-ldap-7.2.34-1.w7.x86_64<br>php72w-xml-7.2.34-1.w7.x86_64<br>php72w-pdo-7.2.34-1.w7.x86_64<br>php72w-gd-7.2.34-1.w7.x86_64<br>php72w-bcmath-7.2.34-1.w7.x86_64</p><p>结果②：<br>11</p></blockquote><p>3️⃣<strong>配置</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -ri  <span class="string">&#x27;/^(user|group)/s#apache#nginx#g&#x27;</span> /etc/php-fpm.d/www.conf</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">vim /etc/php-fpm.d/www.conf</span><br><span class="line"></span><br><span class="line">egrep <span class="string">&#x27;^(user|group)&#x27;</span> /etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure><blockquote><p>结果为：</p><p>user = nginx</p><p>group = nginx</p></blockquote><p>创建测试文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /mydata/web/zabbix/info.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>4️⃣<strong>启动、测试</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> php-fpm</span><br><span class="line">systemctl start php-fpm</span><br></pre></td></tr></table></figure><p>测试：直接用地址访问 <code>zbx.aceniu.com/info.php</code></p><details class="folding-tag" red><summary> 404 Not Found </summary>              <div class='content'>              <p>在虚拟机上安装成功 Nginx 和 PHP，并配置完成后，发现访问域名出现 404。</p><p>1️⃣<strong>防火墙功能未关闭，先关闭防火墙</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><p>2️⃣<strong>关闭 SELinux</strong></p><ul><li><p><strong>永久关闭</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config </span><br><span class="line"> </span><br><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line"><span class="comment"># 开启状态</span></span><br><span class="line"><span class="comment">#SELINUX=enforcing</span></span><br><span class="line"><span class="comment"># 设置为禁用状态</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"><span class="comment"># SELINUXTYPE= can take one of three values:</span></span><br><span class="line"><span class="comment">#     targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="comment">#     minimum - Modification of targeted policy. Only selected processes are protected. </span></span><br><span class="line"><span class="comment">#     mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure></li><li><p><strong>临时关闭</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></li><li><p><strong>查看selinux的状态，都为禁用状态</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7]<span class="comment"># getenforce </span></span><br><span class="line">Disabled </span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">[root@centos7~]<span class="comment"># sestatus</span></span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></table></figure></li></ul>              </div>            </details><p>访问页面，成功。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230214223704242.png" alt="image-20230214223704242"></p><h2 id="5-5-部署-mariadb-数据库">5.5 部署 mariadb 数据库</h2><details class="folding-tag" red><summary> Zabbix 6.0 LTS 支持的数据库引擎及版本 </summary>              <div class='content'>              <p>你可能已经发现了，我们增加了 Zabbix 后端数据库的版本要求。这样做的原因是 Zabbix 利用了这些新版本数据库提供的特性，从而确保 Zabbix 的最佳性能。如果使用不受支持的数据库版本，Zabbix 将不会启动。有一个配置参数可以解决这种问题，但是不建议这样做，因为无法确保 Zabbix 会不会遇到性能问题或者崩溃。在迁移到 Zabbix 6.0 LTS 之前，应该首先将数据库升级到支持的版本。</p><ul><li>MySQL/Percona 8.0.x</li><li>MariaDB 10.5.0 -10.6.x</li><li>PostgreSQL 13.x</li><li>Oracle 19c – 21c</li></ul>              </div>            </details><div class="tabs" id="database"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#database-1">MySQL</button></li><li class="tab active"><button type="button" data-href="#database-2">Mariadb</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="database-1"><p class='p center gray ultra'>Buliding...</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="database-2"><div class="tip warning faa-horizontal animated-hover"><p>⚠️注意！Zabbix 6.0 LTS 不支持默认源中的 mariadb 5.5</p></div><p>1️⃣<strong>更改或新增 mariadb 源</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/mariadb.repo</span><br><span class="line"></span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = http://mirrors.aliyun.com/mariadb/yum/10.5/centos7-amd64/</span><br><span class="line">gpgkey = http://mirrors.aliyun.com/mariadb/yum/RPM-GPGKEY-MariaDB</span><br><span class="line">gpgcheck = 1</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><p>2️⃣<strong>安装 mariadb</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb-server</span><br></pre></td></tr></table></figure><details class="folding-tag" red><summary> GPG 密钥失败：[Errno 14] </summary>              <div class='content'>              <p>错误信息：</p><blockquote><p>从 <a href="http://mirrors.aliyun.com/mariadb/yum/RPM-GPGKEY-MariaDB">http://mirrors.aliyun.com/mariadb/yum/RPM-GPGKEY-MariaDB</a> 检索密钥获取 GPG 密钥失败：[Errno 14] HTTP Error 404 - Not Found</p></blockquote><p>如果不行在添加参数  <code>--nogpgcheck</code> 解决</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb-server --nogpgcheck</span><br></pre></td></tr></table></figure>              </div>            </details><p>3️⃣<strong>启动 mariadb</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line">systemctl start mariadb</span><br></pre></td></tr></table></figure><p>4️⃣<strong>检查</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mariadb</span><br></pre></td></tr></table></figure><blockquote><p>结果为：</p><p>MariaDB-compat-10.5.16-1.el7.centos.x86_64<br>MariaDB-common-10.5.16-1.el7.centos.x86_64<br>MariaDB-server-10.5.16-1.el7.centos.x86_64<br>MariaDB-client-10.5.16-1.el7.centos.x86_64</p></blockquote><p>5️⃣数据库初始化</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><blockquote><p>Enter current password for root (enter for none): # 回车 （输入默认密码，没有）</p><p>Switch to unix_socket authentication [Y/n] n# ⚠️ 注意此处要选择 <code>n</code>（unix的连接方式</p><p>Change the root password? [Y/n] Y# 修改root密码<br>New password: # 新密码<br>Re-enter new password: # 确认密码<br>Password updated successfully!<br>Reloading privilege tables…<br>… Success!</p><p>Remove anonymous users? [Y/n] # 默认为Y<br>… Success!</p><p>Disallow root login remotely? [Y/n] # 默认为Y<br>… Success!</p><p>Remove test database and access to it? [Y/n] # 默认为Y</p><ul><li>Dropping test database…<br>… Success!</li><li>Removing privileges on test database…<br>… Success!</li></ul><p>Reload privilege tables now? [Y/n] # 默认为Y<br>… Success!</p><p>Thanks for using MariaDB!</p></blockquote><p>6️⃣<strong>创建  库、用户</strong></p><p>进入数据库</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></table></figure><p>创建  库、用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 创建数据库要指定字符集</span><br><span class="line">create database zabbix charset utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line">2. 创建zabbix用户</span><br><span class="line">grant all on zabbix.* to &#x27;zabbix&#x27;@&#x27;localhost&#x27; identified by &#x27;zabbix&#x27;;</span><br><span class="line"></span><br><span class="line">#如果生产环境数据库与zbx,php不在同一台主机上，则改成内网ip最后一位用%表示所有</span><br><span class="line">#grant all on zabbix.* to &#x27;zabbix&#x27;@&#x27;172.16.1.%&#x27; identified by &#x27;zabbix&#x27; ;</span><br></pre></td></tr></table></figure><p>7️⃣<strong>导入表和数据</strong></p><details class="folding-tag" blue><summary> 下载 Zabbix 6 LTS 源码包 </summary>              <div class='content'>              <p>▶️1️⃣<strong>官网下载 Zabbix 6 LTS 源码</strong>：<span class='p gray'>直接使用方法2即可</span></p><p>官网下载： <a href="https://www.zabbix.com/cn/download">https://www.zabbix.com/cn/download</a></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230215020522224.png" alt="image-20230215020522224"></p><p>上传到 centos7。</p><p>▶️2️⃣<strong>wget下载</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#或者（推荐）</span></span><br><span class="line">wget https://cdn.zabbix.com/zabbix/sources/stable/6.0/zabbix-6.0.13.tar.gz</span><br></pre></td></tr></table></figure>              </div>            </details><p><strong>解压、查看需要导包的文件</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf zabbix-6.0.13.tar.gz -C /usr/local</span><br><span class="line">ll /usr/local/zabbix-6.0.13/database/mysql/</span><br></pre></td></tr></table></figure><blockquote><p>-rw-r–r–. 1 1000 1000 35413900 2月   1 15:20 data.sql# 数据<br>-rw-r–r–. 1 1000 1000      282 1月  23 16:33 double.sql<br>-rw-r–r–. 1 1000 1000     1527 2月   1 15:20 history_pk_prepare.sql<br>-rw-r–r–. 1 1000 1000  1978341 1月  23 16:33 images.sql<br>-rw-r–r–. 1 1000 1000      715 2月   1 15:19 <a href="http://Makefile.am">Makefile.am</a><br>-rw-r–r–. 1 1000 1000    16572 2月   1 15:20 <a href="http://Makefile.in">Makefile.in</a><br>-rw-r–r–. 1 1000 1000   164688 2月   1 15:20 schema.sql# 创建表结构</p></blockquote><p><strong>导入</strong>（<span class='p green'>尽量使用推荐顺序导入，如果重复导入建议删除zabbix库后重新尝试</span>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/zabbix-6.0.13/database/mysql/</span><br><span class="line">mysql -uroot -p123456 zabbix &lt;schema.sql</span><br><span class="line">mysql -uroot -p123456 zabbix &lt;images.sql</span><br><span class="line">mysql -uroot -p123456 zabbix &lt;data.sql</span><br><span class="line">mysql -uroot -p123456 zabbix &lt;double.sql</span><br><span class="line">mysql -uroot -p123456 zabbix &lt;history_pk_prepare.sql</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="5-6-部署-zabbix-server-服务端">5.6 部署 zabbix-server 服务端</h2><p class='p red large'>编译安装 zabbix-server 服务端</p><p>1️⃣安装依赖</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-devel pcre-devel openssl-devel zlib-devel libxml2-devel net-snmp-devel net-snmp libssh2-devel OpenIPMI-devel libevent-devel openldap-devel libcurl-devel --nogpgcheck</span><br></pre></td></tr></table></figure><p>2️⃣将解压后的 zabbix 文件夹移动至：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> zabbix-6.0.13 /usr/local/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/zabbix-6.0.13</span><br></pre></td></tr></table></figure><p>3️⃣编译安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./configure--sysconfdir=/etc/zabbix/  \</span><br><span class="line">--enable-server  \</span><br><span class="line">--with-mysql  \</span><br><span class="line">--with-net-snmp  \</span><br><span class="line">--with-libxml2  \</span><br><span class="line">--with-ssh2  \</span><br><span class="line">--with-openipmi  \</span><br><span class="line">--with-zlib  \</span><br><span class="line">--with-libpthread  \</span><br><span class="line">--with-libevent  \</span><br><span class="line">--with-openssl  \</span><br><span class="line">--with-ldap  \</span><br><span class="line">--with-libcurl  \</span><br><span class="line">--with-libpcre</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><blockquote><p><code>./configure</code>#默认安装到/usr/local/下<br><code>--sysconfdir=/etc/zabbix/</code>#指定配置文件安装目录<br><code>--enable-server </code>#安装的是服务端<br><code>--with-mysql</code>#开启对mysql数据库的支持<br><code>--with-net-snmp</code># 下面都是依赖与功能<br><code>--with-libxml2</code><br><code>--with-ssh2</code><br><code>--with-openipmi</code><br><code>--with-zlib</code><br><code>--with-libpthread</code><br><code>--with-libevent</code><br><code>--with-openssl</code><br><code>--with-ldap</code><br><code>--with-libcurl</code><br><code>--with-libpcre</code></p></blockquote><details class="folding-tag" red><summary> `make install`时发生错误 </summary>              <div class='content'>              <p>此错误时由于gcc的版本太低造成，<strong>临时运行高版本的gcc来完成安装</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230215142023253.png" alt="image-20230215142023253"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#清除编译</span></span><br><span class="line">make clean</span><br><span class="line"></span><br><span class="line"><span class="comment">#更新步骤</span></span><br><span class="line">yum -y update</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装 SCL 发行包 centos-release-scl</span></span><br><span class="line">yum -y install centos-release-scl</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装需要的Software Collection</span></span><br><span class="line">yum -y install devtoolset-7-gcc*</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用已安装的软件集合环境</span></span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-7 bash</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="comment">#source /opt/rh/devtoolset-7/enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次执行编译安装</span></span><br></pre></td></tr></table></figure>              </div>            </details><p>4️⃣检验</p><p>安装成功后并没有什么提示，只能输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="comment">#?</span></span><br></pre></td></tr></table></figure><blockquote><p>结果为：</p><p>0</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zabbix_server --version</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230215143421099.png" alt="image-20230215143421099"></p><p>5️⃣配置 zabbix-server 服务端</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br><span class="line">grep -n <span class="string">&#x27;^[a-Z]&#x27;</span> /etc/zabbix/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">12:ListenPort=10051</span><br><span class="line">38:LogFile=/tmp/zabbix_server.log</span><br><span class="line">87:DBHost=localhost</span><br><span class="line">99:DBName=zabbix</span><br><span class="line">115:DBUser=zabbix</span><br><span class="line">123:DBPassword=zabbix</span><br><span class="line">140:DBPort=3306</span><br><span class="line">507:Timeout=4</span><br><span class="line">593:LogSlowQueries=3000</span><br><span class="line">708:StatsAllowedIP=127.0.0.1</span><br></pre></td></tr></table></figure><p>6️⃣创建用户</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd -g zabbix -M -s /sbin/nologin zabbix</span><br></pre></td></tr></table></figure><p>8️⃣启动服务端</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zabbix_server</span><br></pre></td></tr></table></figure><p>9️⃣检查</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep <span class="string">&#x27;zabbix&#x27;</span></span><br><span class="line">netstat -tulnp|grep zabbix</span><br></pre></td></tr></table></figure><blockquote><p>结果①：</p><p>zabbix     2501      1  0 06:22 ?        00:00:00 zabbix_server<br>zabbix     2504   2501  0 06:22 ?        00:00:00 zabbix_server: ha manager<br>zabbix     2505   2501  0 06:22 ?        00:00:00 zabbix_server: service manager #1 [processed 0 events, updated 0 event tags, deleted 0 problems, synced 0 service updates, idle 5.006196 sec during 5.006291 sec]<br>zabbix     2506   2501  0 06:22 ?        00:00:00 zabbix_server: configuration syncer [synced configuration in 0.163344 sec, idle 60 sec]</p><p>…省略部分内容…</p><p>zabbix     2575   2501  0 06:22 ?        00:00:00 zabbix_server: trigger housekeeper [startup idle for 60 second(s)]<br>zabbix     2576   2501  0 06:22 ?        00:00:00 zabbix_server: odbc poller #1 [got 0 values in 0.000026 sec, idle 5 sec]<br>root       2933   1524  0 06:22 pts/0    00:00:00 grep --color=auto zabbix</p><p>结果②：</p><p>tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      2501/zabbix_server</p></blockquote><p>🔟配置开机自启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/zabbix_server.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Server with MySQL DB</span><br><span class="line">After=syslog.target network.target mysqld.service</span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/sbin/zabbix_server -f</span><br><span class="line">User=zabbix</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">pkill zabbix_server</span><br><span class="line">ps -ef|grep zabbix</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix_server</span><br><span class="line">systemctl start zabbix_server</span><br></pre></td></tr></table></figure><h2 id="5-8-部署-前端页面">5.8 部署 前端页面</h2><p>1️⃣前端页面放到 nginx 网站目录下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -rp /usr/local/zabbix-6.0.13/ui/* /mydata/web/zabbix</span><br><span class="line"><span class="built_in">chown</span> -R nginx.nginx /mydata/web/zabbix</span><br></pre></td></tr></table></figure><p>2️⃣web 页面配置</p><p><strong>访问页面</strong>。😍 幸福的中文。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216001052209.png" alt="image-20230216001052209"></p><p><strong>错误</strong>，操作如下</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216001540844.png" alt="image-20230216001540844"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/php.ini</span><br><span class="line"></span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">post_max_size = 16M</span><br><span class="line"></span><br><span class="line">egrep -n <span class="string">&#x27;^(max_.*_time|post_max)&#x27;</span> /etc/php.ini</span><br></pre></td></tr></table></figure><blockquote><p>368:max_execution_time = 300<br>378:max_input_time = 300<br>656:post_max_size = 16M</p><p>根据实际情况修改即可。</p></blockquote><p><strong>重启下php</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure><p><strong>配置数据库</strong></p><p>刷新下页面,或者返回在进来。</p><p>此处的设置是：<span class='p red'>配置php访问数据库</span>。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216003034980.png" alt="image-20230216003034980"></p><p><strong>网站名</strong></p><p>改下时区shanghai。zabbix 5 需要改配置文件才能修改</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216003847434.png" alt="image-20230216003847434"></p><p><strong>汇总信息</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216004011742.png" alt="image-20230216004011742"></p><details class="folding-tag" red><summary> :warning:无法创建配置文件 </summary>              <div class='content'>              <p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216004234782.png" alt="image-20230216004234782"></p><p>要么就下载配置文件然后上传然后授权给zabbix即可要么就是如下操作：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /mydata/web/zabbix/conf/zabbix.conf.php.example /mydata/web/zabbix/conf/zabbix.conf.php</span><br><span class="line"><span class="built_in">chown</span> zabbix:zabbix /mydata/web/zabbix/conf/zabbix.conf.php</span><br><span class="line">vim /mydata/web/zabbix/conf/zabbix.conf.php</span><br><span class="line"><span class="comment">#只修改PASSWORD的密码</span></span><br><span class="line"><span class="variable">$DB</span>[<span class="string">&#x27;PASSWORD&#x27;</span>]= <span class="string">&#x27;zabbix&#x27;</span>;</span><br></pre></td></tr></table></figure>              </div>            </details><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216004935666.png" alt="image-20230216004935666"></p><p>3️⃣<strong>登入</strong></p><ul><li><p><strong>用户名</strong>：Admin</p></li><li><p><strong>密码</strong>：<psw>zabbix</psw></p></li></ul><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216005426684.png" alt="image-20230216005426684"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230216005638065.png" alt="image-20230216005638065"></p><p class='p red large'>处理zabbix 网页中文乱码问题</p><p>原因：zabbix显示中文的字库有问题。</p><p>解决：把zabixx中文字体替换。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230219175718581.png" alt="image-20230219175718581"></p><p>📌 <strong>字体来源</strong>：（别找太飘逸的字体，简单整洁即可）</p><p>1️⃣网上找字库(略)</p><p>2️⃣Windows字库中找(推荐)</p><p>用Windows自带的搜索 -&gt; 字体 -&gt; 搜楷体</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230219180231047.png" alt="image-20230219180231047"></p><p>查看字体文件名</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230219175937864.png" alt="image-20230219175937864"></p><p>用everything搜下字体名 -&gt; 上传到服务器（没有的everything的直接上面的路径里找即可）</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230219180050339.png" alt="image-20230219180050339"></p><p>📌<strong>替换字体</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份初始字体</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># cp /mydata/web/zabbix/assets/fonts/DejaVuSans.ttf&#123;,.back&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 放进新字体并把名字改成原来的字体名</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># mv simkai.ttf /mydata/web/zabbix/assets/fonts/DejaVuSans.ttf</span></span><br><span class="line"><span class="built_in">mv</span>：是否覆盖<span class="string">&quot;/mydata/web/zabbix/assets/fonts/DejaVuSans.ttf&quot;</span>？ y</span><br></pre></td></tr></table></figure><p>刷新网页即可，不必重启。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230219180948155.png" alt="image-20230219180948155"></p><hr><h2 id="5-9-部署-zabbix-客户端">5.9 部署 zabbix 客户端</h2><p>1️⃣配置zabbix源</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>2️⃣源文件中还是官方的链接替换下清华源</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s#https://repo.zabbix.com/zabbix#https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/#g&#x27;</span> /etc/yum.repos.d/zabbix.repo</span><br></pre></td></tr></table></figure><p>3️⃣查看下更换情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum list | grep zabbix-agent2</span></span><br><span class="line">zabbix-agent2.x86_64                       6.0.13-release1.el7    zabbix        </span><br><span class="line">zabbix-agent2-plugin-mongodb.x86_64        6.0.13-release1.el7    zabbix        </span><br><span class="line">zabbix-agent2-plugin-postgresql.x86_64     6.0.13-release1.el7    zabbix </span><br></pre></td></tr></table></figure><p>4️⃣yum安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install zabbix-agent2</span><br></pre></td></tr></table></figure><p>5️⃣配置客户端</p><p>客户端如果和服务端都在本地，则无需修改配置文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># grep &#x27;^[a-Z]&#x27; /etc/zabbix/zabbix_agent2.conf</span></span><br><span class="line">PidFile=/run/zabbix/zabbix_agent2.pid</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_agent2.<span class="built_in">log</span></span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=127.0.0.1</span><br><span class="line">ServerActive=127.0.0.1</span><br><span class="line">Hostname=Zabbix server</span><br><span class="line">Include=/etc/zabbix/zabbix_agent2.d/*.conf</span><br><span class="line">PluginSocket=/run/zabbix/agent.plugin.sock</span><br><span class="line">ControlSocket=/run/zabbix/agent.sock</span><br><span class="line">Include=./zabbix_agent2.d/plugins.d/*.conf</span><br></pre></td></tr></table></figure><p>6️⃣启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent2</span><br><span class="line">systemctl start zabbix-agent2</span><br></pre></td></tr></table></figure><p>7️⃣检查</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ps -ef | grep agent2</span></span><br><span class="line">zabbix   126531      1  0 06:34 ?        00:00:00 /usr/sbin/zabbix_agent2 -c /etc/zabbix/zabbix_agent2.conf</span><br><span class="line">root     129864   1696  0 06:37 pts/0    00:00:00 grep --color=auto agent2</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]<span class="comment"># ss -lntup|grep agent2</span></span><br><span class="line">tcp    LISTEN     0      128    [::]:10050              [::]:*                   <span class="built_in">users</span>:((&quot;zabbix_agent2&quot;,pid=<span class="number">126531</span>,fd=<span class="number">10</span>))</span><br></pre></td></tr></table></figure><p>网页中已经可以看到</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230217001204238.png" alt="image-20230217001204238"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230217001221735.png" alt="image-20230217001221735"></p><hr><h1 id="6）Zabbix-配置文件">6）Zabbix 配置文件</h1><h2 id="6-1-服务端配置">6.1 服务端配置</h2><table><thead><tr><th>服务端目录和文件</th><th>功能</th></tr></thead><tbody><tr><td><code>/etc/zabbix/zabbix_server.conf</code></td><td>配置文件</td></tr><tr><td><code>/var/log/zabbix/zabbix_server.log</code></td><td>日志</td></tr><tr><td><code>/usr/lib/systemd/system/zabbix-server.service </code></td><td>systemctl管理文件</td></tr><tr><td><code>/usr/local/share/zabbix/alertscripts/ </code></td><td>用于实现告警的脚本</td></tr></tbody></table><p><strong>zbx服务端配置文件详解</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">grep -n <span class="string">&#x27;^[a-Z]&#x27;</span> /etc/zabbix/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">12:ListenPort=10051<span class="comment"># 服务端端口</span></span><br><span class="line">38:LogFile=/var/log/zabbix/zabbix_server.log<span class="comment"># 日志文件</span></span><br><span class="line">87:DBHost=localhost<span class="comment"># 数据库地址</span></span><br><span class="line">99:DBName=zabbix<span class="comment"># 数据库名字</span></span><br><span class="line">115:DBUser=zabbix<span class="comment">#数据库用户名</span></span><br><span class="line">123:DBPassword=zabbix<span class="comment">#数据库密码</span></span><br><span class="line">140:DBPort=3306</span><br><span class="line">507:Timeout=4<span class="comment"># 超时时间</span></span><br><span class="line">593:LogSlowQueries=3000</span><br><span class="line">708:StatsAllowedIP=127.0.0.1</span><br></pre></td></tr></table></figure><h2 id="6-2-客户端配置">6.2 客户端配置</h2><table><thead><tr><th>客户端目录和文件</th><th></th></tr></thead><tbody><tr><td><code>/etc/zabbix/zabbix_agent2.conf</code></td><td>配置文件</td></tr><tr><td><code>/etc/zabbix/zabbix_agent2.d</code></td><td>子配置文件目录，用于自定义监控</td></tr><tr><td>/var/log/zabbix/</td><td>日志</td></tr></tbody></table><p><strong>zbx客户端配置文件内容</strong>：</p><blockquote><p>Server=127.0.0.1#指定服务端地址</p></blockquote><h1 id="8）Zabbix-agent-和-agent2">8）Zabbix agent 和 agent2</h1><p>在任何一台服务器上安装zabbix-agent ,zabbix-agent2都是可以的</p><ul><li>agent：由C语言开发。独立进程方式运行；</li><li>agent2：go和C语言开发。1个进程多个线程技术运行，减少资源消耗占用较少tcp资源，能够承受更高并发。</li></ul><h1 id="9）监控任意主机流程">9）监控任意主机流程</h1><h2 id="9-1-整体流程">9.1 整体流程</h2><p>1️⃣安装客户端及修改配置文件 （交给ansible）</p><p>2️⃣web页面添加主机，关联模板 （zabbix自动发现与自动注册）</p><p>3️⃣调试</p><h2 id="9-2-配置客户端">9.2 配置客户端</h2><p>安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-4.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line">yum -y install zabbix-agent2</span><br></pre></td></tr></table></figure><p>配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s#Server=127.0.0.1#Server=10.0.0.100#g&#x27;</span> /etc/zabbix/zabbix_agent2.conf</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> zabbix-agent2</span><br><span class="line">systemctl start zabbix-agent2</span><br><span class="line">systemctl restart zabbix-agent2</span><br></pre></td></tr></table></figure><p>检查</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep zabbix</span><br></pre></td></tr></table></figure><h2 id="9-3-web页面添加主机">9.3 web页面添加主机</h2><p>1️⃣创建主机</p><p><font style="color:grey;">创建主机时，创建的*主机名称要和linux的主机名称一致且ping主机名时候能够正常联通，否则可能造成一些监控功能异常。</font></p><p>2️⃣填写主机信息</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230225003253352.png" alt="image-20230225003253352"></p><p>3️⃣耐心等待变绿</p><hr><h1 id="10）自定义监控">10）自定义监控</h1><h2 id="10-1-客户端">10.1 客户端</h2><p>📌<strong>示范案例</strong>：</p><p>❓ <u>监控80端口是否存在</u>：</p><p>1️⃣通过命令、脚本取出对应的值</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ss -lntup | grep -w 80 | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="comment"># 存在返回行数1，不存在则返回0</span></span><br></pre></td></tr></table></figure><p>2️⃣创建键值与重启</p><blockquote><p>自定义的范本可以在<code>/etc/zabbix/zabbix_agent2.d/plugins.d</code>下参考。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=key,cmd</span><br></pre></td></tr></table></figure><blockquote><ul><li>UserParameter 固定写法，表示要自定义键值</li><li>key 表示键值名（见名知意，单词+&quot;.&quot;做分割）</li><li>cmd命令或脚本</li></ul></blockquote></blockquote><p>这里自建个<code>/etc/zabbix/zabbix_agent2.d/web.conf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_agent2.d/web.conf</span><br><span class="line">UserParameter=check.ngx,ss -lntup | grep -w 80 | <span class="built_in">wc</span> -l</span><br><span class="line">systemctl restart zabbix-agent2</span><br></pre></td></tr></table></figure><p>3️⃣本地测试</p><blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zabbix_agent2 -t key</span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">key     [类型|值]</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zabbix_agent2 -t check.ngx</span><br><span class="line">check.nginx            [s|0]</span><br></pre></td></tr></table></figure><h2 id="10-2-服务端">10.2 服务端</h2><p>1️⃣服务端手动测试</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum  -y install zabbix-get</span><br><span class="line"><span class="comment"># 向客户端要指定键值的数据</span></span><br><span class="line">zabbix_get -s 客户端地址 -p 客户端端口 -k 键</span><br></pre></td></tr></table></figure><p>zabbix选项：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-s</td><td>客户端ip地址</td></tr><tr><td>-p</td><td>客户端端口号（默认是10050）</td></tr><tr><td>-k</td><td>指定键值</td></tr></tbody></table><p>2️⃣web页面：创建监控项</p><p>把客户端创建的键值与zbx服务端监控项关联前来。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230225163644606.png" alt="image-20230225163644606"></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230225170352208.png" alt="image-20230225170352208"></p>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
          <category> Operations </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 学习笔记</title>
      <link href="/posts/3c3cdb74.html"/>
      <url>/posts/3c3cdb74.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="swig￼21"><p class='p cyan huge center'>1. Git简介</p></h1><div class="tip home"><p><strong>Git官网</strong>：<a href="https://git-scm.com/">https://git-scm.com/</a></p></div><ul><li><p><strong>概述</strong></p><p>Git 是一个开源的**<span style="color:red;">分布式</span>**版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理。</p></li><li><p><strong>何为版本控制</strong></p><p>版本控制是一种或记录文件内容变化，以便将来查阅特定版本修订情况的系统。</p><p>版本控制其实最重要的是可以记录文件修改历史记录，从而让用户能够查看历史版本，方便版本切换。</p></li><li><p><strong>优点</strong></p><ol><li><p>解决了集中式版本控制系统的缺陷，服务器断网的情况下也可以进行开发（因为版本控制是在本地进行的）</p></li><li><p>每个客户端保存的也都是整个完整的项目（包含历史记录，更加安全）</p></li></ol></li><li><p><strong>Git 发展史</strong></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230104185414310.png" alt="image-20230104185414310"></p></li><li><p><strong>工作机制</strong></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230104190134428.png" alt="image-20230104190134428"></p></li><li><p><strong>代码托管中心</strong></p><p>代码托管中心是基于网络服务器的远程代码仓库，一般我们简单称为**<font style="color:red;">远程库</font>**</p><ul><li><p><strong>局域网</strong></p><p><code>GitLab</code></p></li><li><p><strong>互联网</strong></p><p><code>Github</code></p><p><code>Gitee</code> 码云</p></li></ul></li></ul><hr><h1 id="swig￼23"><p class='p cyan huge center'>2. Git安装</p></h1><h2 id="2-1-Windows-安装">2.1 Windows 安装</h2><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230104191136130.png" alt="image-20230104191136130"></p><p>其它菜单没有特殊需求基本都是默认。</p><hr><h1 id="swig￼24"><p class='p cyan huge center'>3. Git命令</p></h1><h2 id="3-1-常用命令">3.1 常用命令</h2><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>git config --global <a href="http://user.name">user.name</a> 用户名</td><td>设置用户签名</td></tr><tr><td>git config --global user.email 邮箱</td><td>设置用户邮箱</td></tr><tr><td>git init</td><td><span style="color:red;">初始化本地库</span></td></tr><tr><td>git status</td><td><span style="color:red;">查看本地库状态</span></td></tr><tr><td>git add 文件名</td><td><span style="color:red;">添加到暂存区</span></td></tr><tr><td>git commit -m “日志信息” 文件名</td><td><span style="color:red;">提交到本地库</span></td></tr><tr><td>git reflog</td><td><span style="color:red;">查看历史记录</span></td></tr><tr><td>git reset --hard 版本号</td><td><span style="color:red;">版本穿梭</span></td></tr></tbody></table><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/1a74ce2a5d7ecaed8b3fe9b52b720eec3.jpg" alt="1a74ce2a5d7ecaed8b3fe9b52b720eec3"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">git init                                                  # 初始化本地git仓库（创建新仓库）</span><br><span class="line">git config --global user.name &quot;xxx&quot;                       # 配置用户名</span><br><span class="line">git config --global user.email &quot;xxx@xxx.com&quot;              # 配置邮件</span><br><span class="line">git config --global color.ui true                         # git status等命令自动着色</span><br><span class="line">git config --global color.status auto</span><br><span class="line">git config --global color.diff auto</span><br><span class="line">git config --global color.branch auto</span><br><span class="line">git config --global color.interactive auto</span><br><span class="line">git config --global --unset http.proxy                    # remove  proxy configuration on git</span><br><span class="line">git clone git+ssh://git@192.168.53.168/VT.git             # clone远程仓库</span><br><span class="line">git status                                                # 查看当前版本状态（是否修改）</span><br><span class="line">git add xyz                                               # 添加xyz文件至index</span><br><span class="line">git add .                                                 # 增加当前子目录下所有更改过的文件至index</span><br><span class="line">git commit -m &#x27;xxx&#x27;                                       # 提交</span><br><span class="line">git commit --amend -m &#x27;xxx&#x27;                               # 合并上一次提交（用于反复修改）</span><br><span class="line">git commit -am &#x27;xxx&#x27;                                      # 将add和commit合为一步</span><br><span class="line">git rm xxx                                                # 删除index中的文件</span><br><span class="line">git rm -r *                                               # 递归删除</span><br><span class="line">git log                                                   # 显示提交日志</span><br><span class="line">git log -1                                                # 显示1行日志 -n为n行</span><br><span class="line">git log -5</span><br><span class="line">git log --stat                                            # 显示提交日志及相关变动文件</span><br><span class="line">git log -p -m</span><br><span class="line">git show dfb02e6e4f2f7b573337763e5c0013802e392818         # 显示某个提交的详细内容</span><br><span class="line">git show dfb02                                            # 可只用commitid的前几位</span><br><span class="line">git show HEAD                                             # 显示HEAD提交日志</span><br><span class="line">git show HEAD^                                            # 显示HEAD的父（上一个版本）的提交日志 ^^为上两个版本 ^5为上5个版本</span><br><span class="line">git tag                                                   # 显示已存在的tag</span><br><span class="line">git tag -a v2.0 -m &#x27;xxx&#x27;                                  # 增加v2.0的tag</span><br><span class="line">git show v2.0                                             # 显示v2.0的日志及详细内容</span><br><span class="line">git log v2.0                                              # 显示v2.0的日志</span><br><span class="line">git diff                                                  # 显示所有未添加至index的变更</span><br><span class="line">git diff --cached                                         # 显示所有已添加index但还未commit的变更</span><br><span class="line">git diff HEAD^                                            # 比较与上一个版本的差异</span><br><span class="line">git diff HEAD -- ./lib                                    # 比较与HEAD版本lib目录的差异</span><br><span class="line">git diff origin/master..master                            # 比较远程分支master上有本地分支master上没有的</span><br><span class="line">git diff origin/master..master --stat                     # 只显示差异的文件，不显示具体内容</span><br><span class="line">git remote add origin git+ssh://git@192.168.53.168/VT.git # 增加远程定义（用于push/pull/fetch）</span><br><span class="line">git branch                                                # 显示本地分支</span><br><span class="line">git branch --contains 50089                               # 显示包含提交50089的分支</span><br><span class="line">git branch -a                                             # 显示所有分支</span><br><span class="line">git branch -r                                             # 显示所有原创分支</span><br><span class="line">git branch --merged                                       # 显示所有已合并到当前分支的分支</span><br><span class="line">git branch --no-merged                                    # 显示所有未合并到当前分支的分支</span><br><span class="line">git branch -m master master_copy                          # 本地分支改名</span><br><span class="line">git checkout -b master_copy                               # 从当前分支创建新分支master_copy并检出</span><br><span class="line">git checkout -b master master_copy                        # 上面的完整版</span><br><span class="line">git checkout features/performance                         # 检出已存在的features/performance分支</span><br><span class="line">git checkout --track hotfixes/BJVEP933                    # 检出远程分支hotfixes/BJVEP933并创建本地跟踪分支</span><br><span class="line">git checkout v2.0                                         # 检出版本v2.0</span><br><span class="line">git checkout -b devel origin/develop                      # 从远程分支develop创建新本地分支devel并检出</span><br><span class="line">git checkout -- README                                    # 检出head版本的README文件（可用于修改错误回退）</span><br><span class="line">git merge origin/master                                   # 合并远程master分支至当前分支</span><br><span class="line">git cherry-pick ff44785404a8e                             # 合并提交ff44785404a8e的修改</span><br><span class="line">git push origin master                                    # 将当前分支push到远程master分支</span><br><span class="line">git push origin :hotfixes/BJVEP933                        # 删除远程仓库的hotfixes/BJVEP933分支</span><br><span class="line">git push --tags                                           # 把所有tag推送到远程仓库</span><br><span class="line">git fetch                                                 # 获取所有远程分支（不更新本地分支，另需merge）</span><br><span class="line">git fetch --prune                                         # 获取所有原创分支并清除服务器上已删掉的分支</span><br><span class="line">git pull origin master                                    # 获取远程分支master并merge到当前分支</span><br><span class="line">git mv README README2                                     # 重命名文件README为README2</span><br><span class="line">git reset --hard HEAD                                     # 将当前版本重置为HEAD（通常用于merge失败回退）</span><br><span class="line">git rebase</span><br><span class="line">git branch -d hotfixes/BJVEP933                           # 删除分支hotfixes/BJVEP933（本分支修改已合并到其他分支）</span><br><span class="line">git branch -D hotfixes/BJVEP933                           # 强制删除分支hotfixes/BJVEP933</span><br><span class="line">git ls-files                                              # 列出git index包含的文件</span><br><span class="line">git show-branch                                           # 图示当前分支历史</span><br><span class="line">git show-branch --all                                     # 图示所有分支历史</span><br><span class="line">git whatchanged                                           # 显示提交历史对应的文件修改</span><br><span class="line">git revert dfb02e6e4f2f7b573337763e5c0013802e392818       # 撤销提交dfb02e6e4f2f7b573337763e5c0013802e392818</span><br><span class="line">git ls-tree HEAD                                          # 内部命令：显示某个git对象</span><br><span class="line">git rev-parse v2.0                                        # 内部命令：显示某个ref对于的SHA1 HASH</span><br><span class="line">git reflog                                                # 显示所有提交，包括孤立节点</span><br><span class="line">git show HEAD@&#123;5&#125;</span><br><span class="line">git show master@&#123;yesterday&#125;                               # 显示master分支昨天的状态</span><br><span class="line">git log --pretty=format:&#x27;%h %s&#x27; --graph                   # 图示提交日志</span><br><span class="line">git show HEAD~3</span><br><span class="line">git show -s --pretty=raw 2be7fcb476</span><br><span class="line">git stash                                                 # 暂存当前修改，将所有至为HEAD状态</span><br><span class="line">git stash list                                            # 查看所有暂存</span><br><span class="line">git stash show -p stash@&#123;0&#125;                               # 参考第一次暂存</span><br><span class="line">git stash apply stash@&#123;0&#125;                                 # 应用第一次暂存</span><br><span class="line">git grep &quot;delete from&quot;                                    # 文件中搜索文本“delete from”</span><br><span class="line">git grep -e &#x27;#define&#x27; --and -e SORT_DIRENT</span><br><span class="line">git gc</span><br><span class="line">git fsck</span><br></pre></td></tr></table></figure><h2 id="3-2-设置用户签名">3.2 设置用户签名</h2><p><strong>命令：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name 用户名</span><br><span class="line">git config --global user.email 邮箱</span><br><span class="line">git config -l # 查看所有配置</span><br></pre></td></tr></table></figure><p><strong><font style="color:red;">Git首次安装必须设置用户签名，否则后续无法提交代码</font></strong>。签名的作用是区分不同操作者身份。用户的签名信息在每一个版本的提交信息中能够看到，以此确认本次提交是谁做的。</p><p><font style="color:red;background:yellow;">※注意：</font>这里设置用户签名和将来登录 Github （或其他代码托管中心）的账号没有任何关系。（Windows下如果想手动修改可以在<code>C:\Users\Niu‘s XX Pro 13</code> 下的<code>.gitconfig</code>文件中修改。）</p><h2 id="3-3-初始化本地库">3.3 初始化本地库</h2><p>**命令：**在需要的文件夹中输入命令，初始化工作区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><hr><h1 id="swig￼25"><p class='p cyan huge center'>4. 分支操作</p></h1><p>在版本控制过程中，同时推进多个任务，为每个任务，我们就可以创建每个任务的单独分支。使用分支意味着程序员可以把自己的工作从开发主线上分离开来，开发自己分支的时候，不会影响主线分支的运行。（分支的底层也是指针的运用）</p><p><strong>分支的好处在于可以同时并行推进多个功能开发，提高开发效率</strong>。</p><h2 id="4-1-分支的操作">4.1 分支的操作</h2><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>git branch 分支名</td><td>创建分支</td></tr><tr><td>git branch -v</td><td>查看分支</td></tr><tr><td>git checkout 分支名</td><td>切换分支</td></tr><tr><td>git merge 分支名</td><td>把<u>指定的分支</u>合并到<u>当前分支</u>上</td></tr><tr><td>git branch -d 分支名</td><td>删除本地分支</td></tr></tbody></table><h2 id="4-2-分支冲突">4.2 分支冲突</h2><p>合并分支时，两个分支在<font style="color:red;">同一个文件的同一个位置</font>有两套完全不同的修改。Git无法替我们决定使用哪一个。必须<font style="color:red;">人为决定</font>新代码内容。</p><p>解决办法：</p><ol><li><p>本地有两个分支：master，beta</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换到master分支</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git checkout master</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将beta分支合并到当前分支master上</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git merge beta</span></span><br></pre></td></tr></table></figure></li><li><p>在合并分支时冲突提示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git merge beta</span></span><br><span class="line">Auto-merging README.md</span><br><span class="line">CONFLICT (content): Merge conflict in README.md</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure></li><li><p>手动打开冲突的文档进行修改（并去掉多余的符号）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">当前分支区的冲突数据</span><br><span class="line">=======</span><br><span class="line">指定分支区的冲突数据</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;&gt;&gt;&gt;&gt; beta</span></span><br></pre></td></tr></table></figure></li><li><p>在执行 add 和 commit 操作完成冲突合并</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add .</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit -m <span class="string">&quot;merge beta&quot;</span><span class="comment"># 此处不能加文件名，否则报错</span></span></span><br></pre></td></tr></table></figure></li></ol><hr><h1 id="swig￼26"><p class='p cyan huge center'>5. 团队协作机制</p></h1><h2 id="5-1-团队内协作">5.1 团队内协作</h2><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/d71ae461e980d9246d92f1afce6f148f.jpeg" alt="d71ae461e980d9246d92f1afce6f148f"></p><h2 id="5-2-跨团队协作">5.2 跨团队协作</h2><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105101336437.png" alt="image-20230105101336437"></p><hr><h1 id="swig￼27"><p class='p cyan huge center'>6. GitHub</p></h1><div class="tip home"><p><strong>Github官网</strong>：<a href="https://github.com">https://github.com</a></p></div><h2 id="swig￼29"><p class='p cyan large left'>6.1 网页操作</p></h2><h3 id="6-1-1-创建仓库">6.1.1 创建仓库</h3><p>注册成功登陆后，点击 <code>create repository</code></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/24a342741a1b4f4482ba0cfb155f1eca.png" alt="在这里插入图片描述"></p><p>根据提示进行填写，这里是记录自己第一次使用，选择私人仓库。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/d277aa337d414b6f8948e5b2bf9391e9.png" alt="在这里插入图片描述"></p><p>创建成功，就进入了仓库主页</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/39d86423610a40dab383c533494748f1.png" alt="在这里插入图片描述"></p><h3 id="6-1-2-仓库管理">6.1.2 仓库管理</h3><p>新建文件</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/8e5e22bdf40b4845ac4a5fb9a0c2081c.png" alt="在这里插入图片描述"></p><p>进入新建文件页面</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/0bf6425e165e420897adb1ab7e935742.png" alt="在这里插入图片描述"></p><p>然后来看一下preview</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/f73502458f3d444da2031bb6f7d00a2d.png" alt="在这里插入图片描述"></p><p>创建之后，会自动跳转到仓库主页</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/f7061261bcef4c5086e7425850ab3fab.png" alt="在这里插入图片描述"></p><p>然后，我这里选择点击文件名python1，进入新的页面</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/3af8a765171a4d28a727325454a29755.png" alt="在这里插入图片描述"></p><p>点击编辑（🖊），进入编辑页面</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/67324c2c51c74406a391e0415badad4f.png" alt="在这里插入图片描述"></p><p>成功提交之后，会返回刚刚的页面</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/cafa110cabe54617b6a26ba5cdc3c7fd.png" alt="在这里插入图片描述"></p><p>这里选择点击仓库名python_test，返回仓库主页，再点击发生变化的描述，查看提交的详细情况</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/a5b83bb6ac824a9f9668c02b02d47820.png" alt="在这里插入图片描述"></p><p>在仓库主页，点击commits，可以查看历史提交版本</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/e1eabd7d2b4248e18d1eca6852aea19c.png" alt="在这里插入图片描述"></p><h3 id="6-1-3-上传文件">6.1.3 上传文件</h3><p>在仓库主页进行以下操作</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/ee24021b7f6e46ce92bbd92f3068c9f7.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/4568eca8ba544d088e23a1e69e607883.png" alt="在这里插入图片描述"></p><p>上传成功之后，会自动返回仓库主页</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/3460e1bde26c44dc848718ce3dd7d3e3.png" alt="在这里插入图片描述"></p><p>在仓库主页，还可以搜索文件，根据文件名进行搜索</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/454530d42d4f4aa3b0dbb03376447816.png" alt="在这里插入图片描述"></p><h3 id="6-1-4-关注、收藏、克隆、issues">6.1.4 关注、收藏、克隆、issues</h3><p>​关注：关注之后，作者仓库发生变化，你会收到提示信息；</p><p>​收藏：收藏仓库，方便查找；</p><p>​克隆（复制）：创建一个和作者仓库一样的仓库，不会动态变化，即作者之后更新的内容，你的仓库不会发生变化；</p><p>​发送请求：如果你克隆了一个作者的仓库，还想和作者同步，那么可以选择发送请求。</p><p>​issues：用于发现bug，讨论使用，也可以理解为私信</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/a9405f9ec943465380ee7e519b9acd9b.png" alt="在这里插入图片描述"></p><p>进行以下步骤，查看自己的收藏</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/dd7f61b10a494fdf899a946309520003.png" alt="在这里插入图片描述"></p><h2 id="swig￼30"><p class='p blue large left'>6.2 远程库操作</p></h2><h3 id="6-2-1-创建远程仓库别名">6.2.1 创建远程仓库别名</h3><p>建议别名与仓库名保持一致</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote -v<span class="comment"># 查看当前所有远程地址别名</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add 别名 远程地址<span class="comment"># 给此远程仓库取别名，方便操作</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote remove &lt;name&gt;     <span class="comment"># 删除别名</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote rename trunk(现有远程仓别名)  private(自定义的远程仓别名)  <span class="comment">#修改远程仓别名</span></span></span><br></pre></td></tr></table></figure><h3 id="6-2-2-推送本地分支到远程仓库">6.2.2 推送本地分支到远程仓库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push 别名(或远程库地址) 本地分支<span class="comment"># 推送本地分支上的内容到远程仓库</span></span></span><br></pre></td></tr></table></figure><p>如果首次登入过会弹出登入账号或其他选项，按照实际情况操作。（Windows下可以查看凭据管理器）</p><h3 id="6-2-3克隆远程仓库到本地">6.2.3克隆远程仓库到本地</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> 远程库地址<span class="comment"># 克隆远程仓库内容到本地</span></span></span><br></pre></td></tr></table></figure><p>克隆会做如下操作：1. 拉取代码 2. 初始化本地库 3. 自动创建别名</p><details class="folding-tag" blue><summary> Github克隆自己私密库的方法 </summary>              <div class='content'>              <ol><li><p>右键选择 git Bash Here (首先得在本地安装git客户端，这个直接百度下载；然后默认安装即可，安装完成之后右键即可看到此选项)</p></li><li><p>设置用户名</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;aceniu&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>设置邮箱</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email <span class="string">&quot;123****@qq.com&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>生成秘钥文件执行命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&#x27;123****@qq.com&#x27;</span></span><br></pre></td></tr></table></figure><p>执行完成之后会在路径：C:\Users\电脑用户名.ssh\ 下生成以下文件:</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20803213-74c7824b55a81675.png" alt="img"></p></li><li><p>然后访问登录github；点击添加ssh-key</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20803213-405ca20e1c143958.png" alt="img"></p><p>在key中将本地生成的id_rsa.pub文件内的内容复制到key输入框中，然后title随便输入，点击保存即可。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20803213-5cd6be16690b5e3c.png" alt="img"></p><p>以上操作完成之后即可复制仓库的 SSH地址，然后回到本地打开git bash窗口，执行以下命令即可将代码拉取到本地。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> 粘贴的ssh路径<span class="comment"># 注意是ssh路径。</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><h3 id="6-2-4-拉取远程库内容">6.2.4 拉取远程库内容</h3><p>要注意切换到需要拉取的本地库分支上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git pull 别名(或远程库地址) 远程分支名<span class="comment"># 将远程仓库对于分支最新内容拉下来后与当前本地分支直接合并</span></span></span><br></pre></td></tr></table></figure><h2 id="swig￼32"><p class='p blue large left'>6.3 团队协作</p></h2><h3 id="6-3-1-团队内协作">6.3.1 团队内协作</h3><h4 id="6-3-1-1-邀请">6.3.1.1 邀请</h4><ol><li><p>选择邀请合作者</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/2726f1402ef34d909df1ea69b84831bc.png" alt="img"></p></li><li><p>填入想要合作的人</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/07e62400d97c4e1c98f2ef300ffddb6f.png" alt="img"></p></li><li><p>复制地址并发送给该用户</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/31a3b825f9fe40ba8fd4416fca714315.png" alt="img"></p></li></ol><h4 id="6-3-1-2-加入团队">6.3.1.2 加入团队</h4><ol><li><p>在linghuchong258这个账号中的地址栏复制收到邀请的链接，点击接受邀请</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/075d5a861c9a4572a82042a6e80746f7.png" alt="img"></p></li><li><p>成功加入团队</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/f6b71feb9a784800886eb87d539c5f9c.png" alt="img"></p></li></ol><h3 id="6-3-2-跨团队协作">6.3.2 跨团队协作</h3><h4 id="6-3-2-1-非团队成员操作">6.3.2.1 非团队成员操作</h4><ol><li><p>搜索项目(项目需要是public的，否则搜不到)</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/a4f81e7bdce94a0ca50490ba14fcbf3b.png" alt="在这里插入图片描述"></p></li><li><p>Fork创造副本</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/95aa6e3fef6b40f3ad6619c9ad1915ac.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/cd764c5516984cc496579f5f8bff6f35.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/e3de26a8ed694a1caf1c0380df236d37.png" alt="在这里插入图片描述"></p></li><li><p>修改内容,这里直接在修改一些内容，当然也可以<code>git clone</code>到本地，再执行<code>add</code>,<code>commit</code>,<code>push</code>等操作来修改。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/f51a7a1eb49e4f19928b68f54cd1c379.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/0028c4b076e34be088baedb9e7695cce.png" alt="在这里插入图片描述"></p></li><li><p>创建拉取请求（就是提交）</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/55b5730eb2684c5e9c1ccf39e6ef2f52.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/00246e281fd545f4b0a9b1b0c33a897e.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/bbef840148074c3b9583e195678523c1.png" alt="在这里插入图片描述"></p></li></ol><h4 id="6-3-2-2-库原作者操作">6.3.2.2 库原作者操作</h4><ol><li><p>查看合并请求</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/531a47b76f994f09bbfa41b8fdd5d429.png" alt="在这里插入图片描述"></p></li><li><p>点击查看合并请求，点击merge pull request进行合并</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/d4d9b19b08ad41c7b61f1c5cf7519eca.png" alt="在这里插入图片描述"></p><p>当然原作者如果有疑问，也可以向团队外的修改者进行交流，消息发送后，对方会实时收到。</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/2f078a2cf84d46ca9e668e115bcc1e8f.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/29978e77b4fb4449b53cc82a75efe518.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YCG5rC06KGM6Iif5rKh5pyJ6YCA6Lev,size_16,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><ol start="3"><li><p>执行合并操作，原作者的仓库就会修改</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/30c31d87f9174b96b5067358ad87035b.png" alt="在这里插入图片描述"></p></li></ol></li></ol><h2 id="swig￼33"><p class='p blue large left'>6.4 SSH 免密登录</p></h2><h3 id="6-4-1-Linux">6.4.1 Linux</h3><p>想要从 Linux 命令行clone github仓库的话，目前不支持 HTTPS 的方式了。那么不想使用 Github CLI 的话，就必须配置 SSH 连接了。</p><ol><li><p>生成SSH密钥</p><p>在<code>~/.ssh</code>下生成一个私钥id_rsa，和一个公钥id_rsa.pub。</p><p>生成过程中会询问是否设置passphrase，这就相当于保护这个私钥的密码，避免被破译。</p><p>安全起见，建议设置密码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ6we7h05pt11jdb989dawZ ~]# ssh-keygen -t rsa</span><br></pre></td></tr></table></figure></li><li><p>配置 Github</p><p>① 复制公钥文件的内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ6we7h05pt11jdb989dawZ ~]# cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>② <code>Github</code>中，打开 <code>Settings</code> &gt; <code>SSH and GPG keys</code> &gt; <code>New SSH key</code></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105220227246.png" alt="image-20230105220227246"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105220618037.png" alt="image-20230105220618037"></p></li></ol><p>​<img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105221432918.png" alt="image-20230105221432918"></p><p>​③ 在 Key 文本框中粘贴上复制好的公钥内容，并且设置好 Title 后，点击 Add SSH key</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105221550696.png" alt="image-20230105221550696"></p><ol start="3"><li><p>检查 SSH 链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ6we7h05pt11jdb989dawZ ~]# ssh -T git@github.com</span><br><span class="line">Enter passphrase for key &#x27;pass/to/private/key&#x27;: </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果收到下面的提示，则表示设置成功。</span></span><br><span class="line">Hi xxxx! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">否则，可能会看到这样的提示</span></span><br><span class="line">Permission denied (publickey).</span><br></pre></td></tr></table></figure><p>如果除了permission denied以外，还出现了：sign_and_send_pubkey: signing failed: agent refused operation的报错提示，有两种解决方法：</p><ul><li><p>ssh文件夹由于手动创建的原因权限不足。运行下面这行代码即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ6we7h05pt11jdb989dawZ ~]# chmod 700 ~/.ssh &amp;&amp; chmod 600 ~/.ssh/*</span><br></pre></td></tr></table></figure></li><li><p>密钥没有被添加到缓存中。运行<code>ssh-add</code>来添加，随后运行<code>ssh-add -l</code>来检测是否添加成功.</p></li></ul></li></ol><h3 id="6-4-2-Windows">6.4.2 Windows</h3><p>在<code>C:\Users\当前用户</code>呼出命令提示符</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C xxx@qq.com# -C表示添加描述：邮箱为...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连续三次回车，会在C:\Users\当前用户\.ssh\生成.pub公钥</span></span><br></pre></td></tr></table></figure><p>其他同Linux相同。</p><hr><h1 id="swig￼34"><p class='p cyan huge center'>7. IDEA集成Git</p></h1><h2 id="7-1-配置Git忽略文件">7.1 配置Git忽略文件</h2><p>与项目的实际功能无关，不参与服务器上部署运行。把它们忽略掉能够屏蔽IDE工具之间的差异。</p><h3 id="7-1-1-MacOS">7.1.1 MacOS</h3><h3 id="7-1-2-Windows">7.1.2 Windows</h3><ol><li><p>创建忽略规则文件 $\textcolor{red}{xxx.ignore （前缀名随便起，建议是git.ignore）}$</p><p>这个文件放置在哪里都可以，为了便于让<code>~/.gitconfig</code>文件引用，建议也放在用户家目录下</p><p>（idea一般会自动生成）</p></li><li><p>在<code>~/.gitconfig</code>中添加</p><p>注意：Windows下要使用斜线 <code>/</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">excludesfile = C:/Users/用户/git.ignore</span><br></pre></td></tr></table></figure></li></ol><h2 id="7-2-配置IDEA">7.2 配置IDEA</h2><ol><li><p>打开 <code>File</code> &gt; <code>Settings</code></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105230001768.png" alt="image-20230105230001768"></p></li><li><p><code>Version Control</code> &gt;  <code>Git</code>(或直接搜索git)</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105230044402.png" alt="image-20230105230044402"></p></li><li><p>配置git.exe的安装目录，点击<code>Test</code>出现版本号证明成功，点<code>OK</code></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230105230126332.png" alt="image-20230105230126332"></p></li></ol><h2 id="7-3-初始化IDEA本地库">7.3 初始化IDEA本地库</h2><ol><li><p>VCS &gt; Create Git Repository…</p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230106001012899.png" alt="image-20230106001012899"></p><p><img src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230106001111394.png" alt="image-20230106001111394"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Program </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 学习手册</title>
      <link href="/posts/52702296.html"/>
      <url>/posts/52702296.html</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="操作系统的发展史">操作系统的发展史</h1><h2 id="Unix">Unix</h2><p>1965年之前，电脑只有军事或者学院的研究机构碰的起，当时大型主机至多能提供30台终端（30个键盘、显示器)的连接。<br>1965年左后由贝尔实验室、麻省理工学院 以及 通用电气共同发起了Multics项目，想让大型主机支持300台终端。<br>1969年前后这个项目进度缓慢，资金短缺，贝尔实验室退出了研究。<br>1969年从这个项目中退出的Ken Thompson当时在实验室无聊时，为了让一台空闲的电脑上能够运行“星际旅行”游行，在8月份左右趁着其妻子探亲的时间，用了1个月的时间编写出了 Unix操作系统的原型。<br>1970年，美国贝尔实验室的 Ken Thompson，以 BCPL语言 为基础，设计出很简单且很接近硬件的 B语言（取BCPL的首字母），并且他用B语言写了第一个UNIX操作系统。因为B语言的跨平台性较差，为了能够在其他的电脑上也能够运行这个非常棒的Unix操作系统，Dennis Ritchie和Ken Thompson 从B语言的基础上准备研究一个更好的语言。<br>1972年，美国贝尔实验室的 Dennis Ritchie在B语言的基础上最终设计出了一种新的语言，他取了BCPL的第二个字母作为这种语言的名字，这就是C语言。<br>1973年初，C语言的主体完成。Thompson和Ritchie迫不及待地开始用它完全重写了现在大名鼎鼎的Unix操作系统。</p><h2 id="Minix">Minix</h2><p>因为AT&amp;T(通用电气)的政策改变，在Version 7 Unix推出之后，发布新的使用条款，将UNIX源代码私有化，在大学中不再能使用UNIX源代码。Andrew S. Tanenbaum(塔能鲍姆)教授为了能在课堂上教授学生操作系统运作的实务细节，决定在不使用任何AT&amp;T的源代码前提下，自行开发与UNIX兼容的操作系统，以避免版权上的争议。他以小型UNIX（mini-UNIX）之意，将它称为MINIX。</p><h2 id="Linux">Linux</h2><p>因为Minix只是教学使用，因此功能并不强，因此Torvalds利用GNU的bash当做开发环境，gcc当做编译工具，编写了Linux内核-v0.02，但是一开始Linux并不能兼容Unix，即Unix上跑的应用程序不能在Linux上跑，即应用程序与内核之间的接口不一致，因为Unix是遵循POSIX规范的，因此Torvalds修改了Linux，并遵循POSIX（Portable Operating System Interface，他规范了应用程序与内核的接口规范）； 一开始Linux只适用于386，后来经过全世界的网友的帮助，最终能够兼容多种硬件。</p><h2 id="操作系统的发展">操作系统的发展</h2><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/linux_history01.jpg" alt="linux_history01"></p><h2 id="Minix没有火起来的原因">Minix没有火起来的原因</h2><p>Minix的创始人说，MINIX 3没有统治世界是源于他在1992年犯下的一个错误，当时他认为BSD必然会一统天下，因为它是一个更稳定和更成熟的系统，其它操作系统难以与之竞争。因此他的MINIX的重心集中在教育上。四名BSD开发者已经成立了一家公司销售BSD系统，他们甚至还有一个有趣的电话号码1-800-ITS-UNIX。然而他们正因为这个电话号码而惹火上身。美国电话电报公司因电话号码而提起诉讼。官司打了三年才解决。在此期间，BSD陷于停滞，而Linux则借此一飞冲天。他的错误在于没有意识官司竟然持续了如此长的时间，以及BSD会因此受到削弱。如果美国电话电报公司没有起诉，Linux永远不会流行起来，BSD将统治世界。</p><hr><h1 id="Linux介绍">Linux介绍</h1><h2 id="Linux内核-发行版">Linux内核&amp;发行版</h2><h3 id="Linux内核版本">Linux内核版本</h3><p>内核(kernel)是系统的心脏，是运行程序和管理像磁盘和打印机等硬件设备的核心程序，它提供了一个在裸设备与应用程序间的抽象层。</p><p>Linux内核版本又分为稳定版和开发版，两种版本是相互关联，相互循环：</p><p>稳定版：具有工业级强度，可以广泛地应用和部署。新的稳定版相对于较旧的只是修正一些bug或加入一些新的驱动程序。</p><p>开发版：由于要试验各种解决方案，所以变化很快。</p><p>所有来自全世界的对<strong>Linux源码</strong>的修改最终都会汇总到 <a href="http://www.kernel.org">kernel.org</a> 这个网站，由Linus领导的开源社区对其进行甄别和修改最终决定是否进入到Linux主线内核源码中。</p><h3 id="Linux发行版本">Linux发行版本</h3><p>Linux发行版 (也被叫做 GNU/Linux 发行版) 通常包含了包括桌面环境、办公套件、媒体播放器、数据库等应用软件。</p><p>目前市面上较知名的发行版有：Ubuntu、RedHat、CentOS、Debian、Fedora、SuSE、OpenSUSE、Arch Linux、SolusOS 等。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/94fda88f37da710407059bf585dfccf4.png" alt="linuxOS-all"></p><h2 id="类Unix系统目录结构">类Unix系统目录结构</h2><p>Unix没有盘符这个概念，只有一个根目录/，所有文件都在它下面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TB;</span><br><span class="line">A[&quot;/&quot;] --&gt; B1[&quot;bin&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B2[&quot;sbin&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B3[&quot;usr&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B4[&quot;lib&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B5[&quot;...&quot;];</span><br><span class="line">B3 --&gt; C1[&quot;bin&quot;];</span><br><span class="line">B3 --&gt; C2[&quot;local&quot;];</span><br><span class="line">B3 --&gt; C3[&quot;lib&quot;];</span><br><span class="line">C2 --&gt; D1[&quot;include&quot;];</span><br></pre></td></tr></table></figure><h2 id="Linux目录结构">Linux目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">graph TB;</span><br><span class="line">A[&quot;/&quot;] --&gt; B1[&quot;/bin&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B2[&quot;/sbin&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B3[&quot;/lib&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B4[&quot;/lib64&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B5[&quot;/usr&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B6[&quot;/boot&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B7[&quot;/dev&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B8[&quot;/etc&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B9[&quot;/home&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B10[&quot;/root&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B11[&quot;/opt&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B12[&quot;/media&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B13[&quot;/mnt&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B14[&quot;/proc&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B15[&quot;/run&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B16[&quot;/srv&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B17[&quot;/sys&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B18[&quot;/tmp&quot;];</span><br><span class="line">A[&quot;/&quot;] --&gt; B19[&quot;/var&quot;];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">B1 -.- |实际位置| C1;</span><br><span class="line">B2 -.- |实际位置| C2;</span><br><span class="line">B3 -.- |实际位置| C3;</span><br><span class="line">B5 --&gt; C1[&quot;/usr/bin&quot;]</span><br><span class="line">B5 --&gt; C2[&quot;/usr/sbin&quot;]</span><br><span class="line">B5 --&gt; C3[&quot;/usr/lib&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>文件夹</th><th>作用</th></tr></thead><tbody><tr><td><code>/</code></td><td>根目录，一般根目录下只存放目录，在Linux下有且只有一个根目录。所有的东西都是从这里开始。当你在终端里输入“<code>/home</code>”，你其实是在告诉电脑，先从<code>/</code>（根目录）开始，再进入到<code>home</code>目录。</td></tr><tr><td><code>/bin</code>：<code>/usr/bin</code></td><td>常用命令集合（实际位置在<code>usr/bin</code>）。可执行二进制文件的目录，如常用的命令<code>ls</code>、<code>tar</code>、<code>mv</code>、<code>cat</code>等。</td></tr><tr><td><code>/sbin</code>：<code>/usr/sbin</code></td><td>管理员命令集（实际位置在<code>usr/sbin</code>）。放置系统管理员使用的可执行命令，如<code>fdisk</code>、<code>shutdown</code>、<code>mount</code> 等。与<code> /bin</code> 不同的是，这几个目录是给系统管理员 root 使用的命令，一般用户只能&quot;查看&quot;而不能设置和使用。</td></tr><tr><td><code>/lib</code>： <code>/usr/lib</code>：<code>/usr/local/lib</code></td><td>库目录（相当于<code>System32</code>）（实际位置在<code>usr/lib</code>）。系统使用的函数库的目录，程序在执行过程中，需要调用一些额外的参数时需要函数库的协助。</td></tr><tr><td><code>/lib64</code></td><td>64位库目录。</td></tr><tr><td><code>/usr</code></td><td>包含用户的所有应用程序、文件和数据 （<code>usr/local/ </code>相当于 <code>Progrom Files</code> 应用一般安装于此）。应用程序存放目录，/usr/bin 存放应用程序，/usr/share 存放共享数据，/usr/lib 存放不能直接运行的，却是许多程序运行所必需的一些函数库文件。/usr/local: 存放软件升级包。/usr/share/doc: 系统说明文件存放目录。/usr/share/man: 程序说明文件存放目录。</td></tr><tr><td><code>/boot</code></td><td>挂载引导。放置linux系统启动时用到的一些文件，如Linux的内核文件：<code>/boot/vmlinuz</code>，系统引导管理器：<code>/boot/grub</code>。</td></tr><tr><td><code>/dev</code></td><td>管理所有设备。存放linux系统下的设备文件，访问该目录下某个文件，相当于访问某个设备，常用的是挂载光驱 <code>mount /dev/cdrom /mnt</code>。</td></tr><tr><td><code>/etc</code></td><td>系统管理的配置文件。不建议在此目录下存放可执行文件，重要的配置文件有<code>/etc/inittab</code>、<code>/etc/fstab</code>、<code>/etc/init.d</code>、<code>/etc/X11</code>、<code>/etc/sysconfig</code>、<code>/etc/xinetd.d</code>。</td></tr><tr><td><code>/home</code></td><td>用户的个性化主目录。系统默认的用户家目录，新增用户账号时，用户的家目录都存放在此目录下，表示当前用户的家目录，edu 表示用户 edu 的家目录。</td></tr><tr><td><code>/root</code></td><td>管理员个性化主目录。</td></tr><tr><td><code>/opt</code></td><td>第三方软件包的目录。给主机额外安装软件所摆放的目录。</td></tr><tr><td><code>/mnt</code>：<code>/media</code></td><td>移动设备挂载点。光盘默认挂载点，通常光盘挂载于 /mnt/cdrom 下，也不一定，可以选择任意位置进行挂载。</td></tr><tr><td><code>/proc</code></td><td>进程目录。此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间，比较重要的目录有 <code>/proc/cpuinfo</code>、<code>/proc/interrupts</code>、<code>/proc/dma</code>、<code>/proc/ioports</code>、<code>/proc/net/*</code> 等。</td></tr><tr><td><code>/run</code></td><td>当前系统运行的所有信息。</td></tr><tr><td><code>/srv</code></td><td>系统服务。服务启动之后需要访问的数据目录，如 www 服务需要访问的网页数据存放在 <code>/srv/www</code> 内。</td></tr><tr><td><code>/sys</code></td><td>系统硬件信息的相关信息。</td></tr><tr><td><code>/tmp</code></td><td>临时目录。一般用户或正在执行的程序临时存放文件的目录，任何人都可以访问，重要数据不可放置在此目录下。</td></tr><tr><td><code>/var</code></td><td>可变目录。放置系统执行过程中经常变化的文件，如随时更改的日志文件 <code>/var/log</code>，<code>/var/log/message</code>：所有的登录文件存放目录，<code>/var/spool/mail</code>：邮件存放的目录，/var/run:程序或服务启动后，其PID存放在该目录下。</td></tr><tr><td><code>/lost+fount</code></td><td>系统异常产生错误时，会将一些遗失的片段放置于此目录下。</td></tr></tbody></table><h2 id="用户目录">用户目录</h2><p>位于<code>/home/user</code>，称之为用户工作目录或家目录,表示方式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/home/user</span><br><span class="line">~</span><br></pre></td></tr></table></figure><p>从/目录开始描述的路径为绝对路径，如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line"><span class="built_in">ls</span> /usr</span><br></pre></td></tr></table></figure><p>从当前位置开始描述的路径为相对路径，如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../../</span><br><span class="line"><span class="built_in">ls</span> abc/def</span><br></pre></td></tr></table></figure><p>每个目录下都有<code>.</code>和<code>..</code></p><p><code>. </code>表示当前目录</p><p><code>.. </code>表示上一级目录，即父目录</p><p>根目录下的<code>.</code>和<code>...</code>都表示当前目录</p><table><thead><tr><th>文件的颜色</th><th>含义</th></tr></thead><tbody><tr><td>蓝色</td><td>目录</td></tr><tr><td>绿色</td><td>可执行文件</td></tr><tr><td>红色</td><td>压缩文件</td></tr><tr><td>浅蓝色</td><td>链接文件</td></tr><tr><td>灰色</td><td>其他文件</td></tr></tbody></table><hr><h1 id="命令行基本操作">命令行基本操作</h1><h2 id="命令使用方法">命令使用方法</h2><p>📌<strong>Linux命令格式</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> [-options] [parameter1] …</span><br></pre></td></tr></table></figure><blockquote><p>command: 命令名；</p><p>-options：选项,可用来对命令进行控制，也可以省略；</p><p>parameter1 …：传给命令的参数：可以是零个一个或多个。</p></blockquote><h2 id="查看帮助文档">查看帮助文档</h2><h3 id="help-内置命令的帮助信息">help 内置命令的帮助信息</h3><p>一般是linux命令自带的帮助信息。一部分基础功能的系统命令是直接内嵌在 shell 中的，系统加载启动之后会随着 shell 一起加载，常驻系统内存中。这部分命令被称为“内置（built-in）”命令；响应的其他命令被称为“外部命令”。</p><p>📌<strong>help命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span> [-options] [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure><p>✨ <strong>主要用法</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[外部命令] --<span class="built_in">help</span>  </span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-d</code></td><td>输出每个命令的简短描述</td></tr><tr><td><code>-m</code></td><td>以类似于 man 手册的格式描述命令</td></tr><tr><td><code>-m</code></td><td>只显示命令使用格式</td></tr></tbody></table><h3 id="man-manual-获得帮助信息">man(manual) 获得帮助信息</h3><p>💾<u><code>/usr/share/man</code></u></p><p>man是linux提供的一个手册， 其内容包括绝大部分的命令语法、各选项的意义及相关命令、函数使用说明 。更为强大的是，不仅可以查看Linux中命令的使用帮助，还可以查看软件服务配置文件、系统调用、库函数等帮助信息。</p><p>📌<strong>man命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man [-options] [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>在所有的man帮助手册中搜索</td></tr><tr><td>-d</td><td>主要用于检查，如果用户加入了一个新的文件，就可以用这个参数检查是否出错</td></tr><tr><td>-f</td><td>显示给定关键字的简短描述信息</td></tr><tr><td>-p</td><td>指定内容时使用分页程序</td></tr><tr><td>-M</td><td>指定man手册搜索的路径</td></tr><tr><td>-w</td><td>显示文件所在位置</td></tr></tbody></table><p>📌<strong>man中各个section意义如下</strong>：</p><p>该手册分成很多章节（section），使用man时可以指定不同的章节来浏览。例：<code>man ls </code>; <code>man 2 printf</code>。</p><ol><li>Standard commands（标准命令）</li><li>System calls（系统调用，如open,write）</li><li>Library functions（库函数，如printf,fopen）</li><li>Special devices（设备文件的说明，/dev下各种设备）</li><li>File formats（文件格式，如passwd）</li><li>Games and toys（游戏和娱乐）</li><li>Miscellaneous（杂项、惯例与协定等，例如Linux档案系统、网络协定、ASCII 码；environ全局变量）</li><li>Administrative Commands（管理员命令，如ifconfig）</li></ol><p>man是按照手册的章节号的顺序进行搜索的。</p><p>📌<strong>man设置了如下的功能键</strong>：</p><table><thead><tr><th>功能键</th><th>功能</th></tr></thead><tbody><tr><td>空格键</td><td>显示手册页的下一屏</td></tr><tr><td>Enter键</td><td>一次滚动手册页的一行</td></tr><tr><td>b</td><td>回滚一屏</td></tr><tr><td>f</td><td>前滚一屏</td></tr><tr><td>q</td><td>退出man命令</td></tr><tr><td>h</td><td>列出所有功能键</td></tr><tr><td>/word</td><td>搜索word字符串</td></tr></tbody></table><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/eaa669cc38073241cb90af97af43bc92.png" alt="man"></p><p>⚠️ <strong>注意</strong>：实际上，我们不用指定第几个章节也用查看，如，<code>man ls</code></p><h2 id="tab键-自动补全">tab键 自动补全</h2><p>在敲出命令的前几个字母的同时，按下<kbd>tab</kbd>，系统会自动帮我们补全命令。</p><h2 id="clear-清屏">clear 清屏</h2><p>clear作用为清除终端上的显示(类似于DOS的cls清屏功能)，<kbd>Ctrl</kbd> + <kbd>I</kbd>。</p><p>📌<strong>clear命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br></pre></td></tr></table></figure><h2 id="history-命令行历史">history 命令行历史</h2><p>💾<u><code>/root/.bashrc</code></u></p><p>当系统执行过一些命令后，可按上下键翻看以前的命令，history将执行过的命令列举出来。</p><p>实际上history的历史命令是写入.bash_history 中的。 ~/.bash_history 记录的是前一次登陆所运行过的命令，而本次登陆所运行的命令都被缓存在内存中，当退出系统后，本次的命令记忆才会记录到 .bash_history 中。</p><p>📌<strong>history命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histroy [-options]</span><br></pre></td></tr></table></figure><p>通常都是直接 <code>history</code> 然后通过管道配合 <code>more</code>，<code>less</code>，<code>tail</code>，<code>head</code> 来使用。</p><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c</td><td>将目前的shell中的所有 history 内容全部清除</td></tr><tr><td>-a</td><td>将目前新增的history指令新增入 histfiles中，若没有 histfiles，则预设写入 ~/.bash_history</td></tr><tr><td>-r</td><td>将histfiles的内容读到目前这个shell的history记忆中</td></tr><tr><td>-w</td><td>将目前的history记忆内容写入histfiles</td></tr></tbody></table><p>📌<strong>常见用法</strong>：</p><p>history保留了最近执行的命令记录，默认可以保留1000。历史清单从0开始编号到最大值。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span> N<span class="comment"># 显示最近N条命令</span></span><br><span class="line"><span class="built_in">history</span> -c<span class="comment"># 清除所有的历史记录</span></span><br><span class="line"><span class="built_in">history</span> -w  xxx.txt<span class="comment"># 保存历史记录到文本xxx.txt</span></span><br></pre></td></tr></table></figure><h3 id="📕history生产环境优化">📕history生产环境优化</h3><p>在工作中，在不同终端下执行了一系列的命令后，翻不到历史记录、也没有汇总、也不知道每条命令的执行时间，所以需要对该命令进行优化。</p><p>📌<strong>配置文件位置</strong>:</p><ol><li>centos：<code>/root/.bashrc</code>；</li><li>ubuntu： <code>/etc/bash.bashrc</code>；</li><li>macos： <code>/etc/bashrc</code>。</li></ol><p>📌<strong>修改方法</strong>：</p><p>1️⃣打开配置文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /root/.bashrc</span><br></pre></td></tr></table></figure><p>2️⃣添加配置内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 添加日期和时间</span><br><span class="line">HISTTIMEFORMAT=&quot;%F %T &quot;</span><br><span class="line">export HISTTIMEFORMAT</span><br><span class="line"></span><br><span class="line"># 不同终端命令汇总</span><br><span class="line"># Avoid duplicates</span><br><span class="line">export HISTCONTROL=ignoredups:erasedups</span><br><span class="line"># When the shell exits, append to the history file instead of overwriting it</span><br><span class="line">shopt -s histappend</span><br><span class="line"></span><br><span class="line"># 在每个命令之后，追加到历史文件并重新读取它</span><br><span class="line"># After each command, append to the history file and reread it</span><br><span class="line">export PROMPT_COMMAND=&quot;$&#123;PROMPT_COMMAND:+$PROMPT_COMMAND$&#x27;\n&#x27;&#125;history -a; history -c; history -r&quot;</span><br><span class="line"></span><br><span class="line"># 调整记录命令长度</span><br><span class="line">export HISTSIZE=3000</span><br><span class="line"></span><br><span class="line"># 剔除连续重复的条目</span><br><span class="line"># Avoid duplicates</span><br><span class="line">export HISTCONTROL=ignoredups:erasedups</span><br></pre></td></tr></table></figure><p>3️⃣使配置生效：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /root/.bashrc</span><br></pre></td></tr></table></figure><h2 id="命令行中的快捷键">命令行中的快捷键</h2><p>📌<strong>linux常用的快捷键</strong>：</p><table><thead><tr><th>快捷键</th><th>功能</th></tr></thead><tbody><tr><td>Tab</td><td>补全命令或显示所有可选项</td></tr><tr><td>Ctrl + Alt + T</td><td>打开当前页面的终端。</td></tr><tr><td>Ctrl + Shift + [+]</td><td>放大终端</td></tr><tr><td>Ctrl + [-]</td><td>缩小终端</td></tr><tr><td>Ctrl + a</td><td>使光标快速到行首</td></tr><tr><td>Ctrl + e</td><td>光标快速移到行尾</td></tr><tr><td>Ctrl + r</td><td>在历史命令中搜索</td></tr><tr><td>Ctrl + c</td><td>强制终止当前命令</td></tr><tr><td>Ctrl + z</td><td>暂停在终端运行的任务</td></tr><tr><td>Ctrl + l 或者 clear</td><td>清屏</td></tr><tr><td>Ctrl + Shift + f</td><td>查找</td></tr><tr><td>Ctrl + Shift + g</td><td>查找上一个，按回车下一个</td></tr><tr><td>Ctrl + Shift + c</td><td>复制</td></tr><tr><td>Ctrl + Shift + v</td><td>粘贴</td></tr><tr><td>Ctrl + K</td><td>光标所处位置到行末的所有内容 和 ctrl + u对立</td></tr><tr><td>Ctrl + U</td><td>光标所处位置到行首的所有内容 和 ctrl + k对立</td></tr><tr><td>Ctrl + W</td><td>光标所处位置之前的一个词，以空格、标点为界</td></tr><tr><td>Alt + F4</td><td>关闭当前窗口</td></tr><tr><td>Shift + PgUp</td><td>向上翻页</td></tr><tr><td>Shift + PgUp</td><td>向下翻页</td></tr><tr><td>Alt]+ Tab</td><td>切换不同的程序窗口</td></tr><tr><td>Alt + Shift + Tab</td><td>往回切换</td></tr><tr><td>F11</td><td>使终端全屏，再次按下退出全屏</td></tr><tr><td>[PrtSc]</td><td>获取整个屏幕的截图并保存到Pictures目录</td></tr></tbody></table><p>📌<strong>linux其它快捷键</strong>：</p><table><thead><tr><th>快捷键</th><th>功能</th></tr></thead><tbody><tr><td>Ctrl + t</td><td>交换光标位置前的两个字符</td></tr><tr><td>Ctrl + y</td><td>粘贴最后一次被删除的单词</td></tr><tr><td>Ctrl + z</td><td>把命令放入后台</td></tr><tr><td>Alt + b</td><td>光标往回移动到前一个单词</td></tr><tr><td>Alt + d</td><td>删除从光标位置到当前所处单词的末尾</td></tr><tr><td>Alt + F1</td><td>访问菜单</td></tr><tr><td>Alt + F2</td><td>运行</td></tr><tr><td>Alt + F10</td><td>最大化当前窗口，再次缩小</td></tr><tr><td>Ctrl + Alt + F2</td><td>切换到文本终端，也可以通过命令chvt n 来实现。如果你希望知道终端的名字，可以使用命令fgconsole</td></tr><tr><td>Ctrl + Alt + F1</td><td>从文本终端切换到图形用户界面</td></tr><tr><td>Ctrl + Alt + Delete</td><td>在文本终端下使用时强制重启</td></tr><tr><td>Shift + PrtSc</td><td>获取屏幕的某个区域截图并保存到Pictures目录</td></tr><tr><td>Alt + PrtS]</td><td>获取 当前窗口的截图并保存到Pictures目录</td></tr><tr><td>Ctrl + PrtSc</td><td>获取整个屏幕的截图并存放到剪贴板</td></tr><tr><td>Shift + Ctrl + PrtSc</td><td>获取屏幕的某个区域截图并存放到剪贴板</td></tr><tr><td>Ctrl + Alt + PrtSc</td><td>获取当前窗口的截图并存放到剪贴板</td></tr><tr><td>ctrl +f</td><td>光标向右移动一个 等价于小键盘的 &lt;-- 键</td></tr><tr><td>ctrl +b</td><td>光标向左移动一个 等价于小键盘的 --&gt; 键</td></tr><tr><td>ctrl +d</td><td>退出当前登录，等同于exit logout；如果在当前使用了ssh远程其他机器，改指令会退回当前奇迹</td></tr><tr><td>ctrl + h</td><td>向前退格，等价于backspace</td></tr><tr><td>ctrl + p</td><td>显示上一条指令 等价于小键盘 ↑</td></tr><tr><td>ctrl + n</td><td>显示下一条指令 等价于小键盘 ↓</td></tr><tr><td>ctrl + s</td><td>锁定终端，使任何人不允许输入，但是输入操作会记录</td></tr><tr><td>ctrl + q</td><td>解除ctrl +s的锁定，同时会展示或执行ctrl +s锁定时输入的指令</td></tr></tbody></table><hr><h1 id="Linux命令">Linux命令</h1><h2 id="权限管理">权限管理</h2><h3 id="r、-w、-x-文件访问权限">(-r、-w、-x) 文件访问权限</h3><p>用户能够控制一个给定的文件或目录的访问程度，一个文件或目录可能有读、写及执行权限：</p><ul><li>读权限（r） ：对于文件，具有读取文件内容的权限；对于目录，具有浏览目录的权限。</li><li>写权限（w） ：对于文件，具有修改文件内容的权限；对于目录，具有删除、移动目录内文件的权限。</li><li>可执行权限（x）： 对于文件，具有执行文件的权限；对于目录，该用户具有进入目录的权限。</li></ul><p>通常，Unix/Linux系统只允许文件的属主(所有者)或超级用户改变文件的读写权限。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/rwx2.png" alt="rwx2"></p><p><code>-rwxrwxrwx</code>从左至右用0-9这些数字来表示。第0位确定文件类型，第1-3位确定属主（该文件的所有者）拥有该文件的权限。第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。</p><p>📌<strong>第一个字符的意义</strong>:</p><p>第一个字符代表这个文件是目录、文件或链接文件等等。</p><ul><li>当为[ <em>d</em> ]则是目录</li><li>当为[ <em>-</em> ]则是文件；</li><li>若是[ <em>l</em> ]则表示为链接文档(link file)；</li><li>若是[ <em>b</em> ]则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；</li><li>若是[ <em>c</em> ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。</li></ul><p><strong>📌权限对文件的作用</strong>：</p><p>对于文件来说，执行权限是最高权限。给用户或群组设定权限时，是否赋予执行权限需要慎重考虑，否则会对系统安装造成严重影响。</p><table><thead><tr><th>rwx 权限</th><th>对文件的作用</th></tr></thead><tbody><tr><td>读权限（r）</td><td>表示可读取此文件中的实际内容，例如，可以对文件执行 cat、more、less、head、tail 等文件查看命令。</td></tr><tr><td>写权限（w）</td><td>表示可以编辑、新增或者修改文件中的内容，例如，可以对文件执行 vim、echo 等修改文件数据的命令。<br />注意，无权限不赋予用户删除文件的权利，除非用户对文件的上级目录拥有写权限才可以。</td></tr><tr><td>执行权限（x）</td><td>表示该文件具有被系统执行的权限。Window系统中查看一个文件是否为可执行文件，是通过扩展名（.exe、.bat 等），<br />但在 Linux 系统中，文件是否能被执行，是通过看此文件是否具有 x 权限来决定的。也就是说，只要文件拥有 x 权限，<br />则此文件就是可执行文件。但是，文件到底能够正确运行，还要看文件中的代码是否正确。</td></tr></tbody></table><p>📌<strong>权限对目录的作用</strong>：</p><p>对目录来说，如果只赋予 r 权限，则此目录是无法使用的。很简单，只有 r 权限的目录，用户只能查看目录结构，根本无法进入目录（需要用 x 权限），更不用说使用了。因此，对于目录来说，常用来设定目录的权限其实只有 0（—）、5（r-x）、7（rwx）这 3 种。</p><table><thead><tr><th>rwx 权限</th><th>对目录的作用</th></tr></thead><tbody><tr><td>读权限（r）</td><td>表示具有读取目录结构列表的权限，也就是说，可以看到目录中有哪些文件和子目录。一旦对目录拥有 r 权限，就可以在此目录下执行 ls 命令，查看目录中的内容。</td></tr><tr><td>写权限（w）</td><td>对于目录来说，w 权限是最高权限。对目录拥有 w 权限，表示可以对目录做以下操作：<br />·在此目录中建立新的文件或子目录；<br />·删除已存在的文件和目录（无论子文件或子目录的权限是怎样的）；<br />·对已存在的文件或目录做更名操作；<br />·移动此目录下的文件和目录的位置。<br />一旦对目录拥有 w 权限，就可以在目录下执行 touch、rm、cp、mv 等命令。</td></tr><tr><td>执行权限（x）</td><td>目录是不能直接运行的，对目录赋予 x 权限，代表用户可以进入目录，也就是说，赋予 x 权限的用户或群组可以使用 cd 命令。</td></tr></tbody></table><h3 id="chmod-修改文件或目录的权限">chmod 修改文件或目录的权限</h3><p>Linux chmod（英文全拼：change mode）命令是控制用户对文件的权限的命令。</p><p><strong><font style="color:red;">只有<u>文件所有者</u>和<u>超级用户</u>可以修改文件或目录的权限</font></strong>。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Untitled.png" alt="chmod"></p><p>Linux/Unix 的文件调用权限分为三级 : 文件所有者（Owner）、用户组（Group）、其它用户（Other Users）。</p><p>📌<strong>chmod命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [<span class="built_in">who</span>] [-options] [operator] permission name</span><br></pre></td></tr></table></figure><p>📌<strong>chmod修改文件权限有两种使用格式</strong>：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/rwxNum.png" alt="rwxNum"></p><ul><li><p><strong>字母法</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [u/g/o/a] [+/-/=][rwx] 文件</span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">[who] 用户类型</th><th>含义</th></tr></thead><tbody><tr><td align="left">u</td><td>user 表示该文件的所有者</td></tr><tr><td align="left">g</td><td>group 表示与该文件的所有者属于同一组( group )者，即用户组</td></tr><tr><td align="left">o</td><td>other 表示其他以外的人</td></tr><tr><td align="left">a</td><td>all 表示这三者皆是</td></tr></tbody></table><table><thead><tr><th>[operator] 操作符</th><th>含义</th></tr></thead><tbody><tr><td>+</td><td>增加权限</td></tr><tr><td>-</td><td>撤销权限</td></tr><tr><td>=</td><td>设定权限</td></tr></tbody></table><table><thead><tr><th>permission 权限</th><th>含义</th></tr></thead><tbody><tr><td>r</td><td>read 表示可读取，对于一个目录，如果没有r权限，那么就意味着不能通过ls查看这个目录的内容。</td></tr><tr><td>w</td><td>write 表示可写入，对于一个目录，如果没有w权限，那么就意味着不能在目录下创建新的文件。</td></tr><tr><td>x</td><td>excute 表示可执行，对于一个目录，如果没有x权限，那么就意味着不能通过cd进入这个目录。</td></tr></tbody></table></li><li><p><strong>数字法</strong>：“rwx” 这些权限也可以用数字来代替</p><table><thead><tr><th>八进制语法</th><th>权限</th><th>rwx</th><th>二进制</th></tr></thead><tbody><tr><td>7</td><td>读 + 写 + 执行</td><td>rwx</td><td>111</td></tr><tr><td>6</td><td>读 + 写</td><td>rw-</td><td>110</td></tr><tr><td>5</td><td>读 + 执行</td><td>r-x</td><td>101</td></tr><tr><td>4</td><td>只读</td><td>r–</td><td>100</td></tr><tr><td>3</td><td>写 + 执行</td><td>-wx</td><td>011</td></tr><tr><td>2</td><td>只写</td><td>-w-</td><td>010</td></tr><tr><td>1</td><td>只执行</td><td>–x</td><td>001</td></tr><tr><td>0</td><td>无</td><td>—</td><td>000</td></tr></tbody></table></li></ul><p>📌<strong>示例说明</strong>：</p><ol><li><p>设定 .bashrc 文件的权限为 rwxr-xr-x，则可执行如下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># chmod u=rwx,go=rx .bashrc</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -al .bashrc</span></span><br><span class="line">-rwxr-xr-x. 1 root root 176 Sep 22 2004 .bashrc</span><br></pre></td></tr></table></figure></li><li><p>增加 .bashrc 文件的每种用户都可做写操作的权限，可以使用如下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -al .bashrc</span></span><br><span class="line">-rwxr-xr-x. 1 root root 176 Sep 22 2004 .bashrc</span><br><span class="line">[root@localhost ~]<span class="comment"># chmod a+w .bashrc</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -al .bashrc</span></span><br><span class="line">-rwxrwxrwx. 1 root root 176 Sep 22 2004 .bashrc</span><br></pre></td></tr></table></figure></li></ol><h3 id="chown-修改文件和目录的所有者和所属组">chown 修改文件和目录的所有者和所属组</h3><p>Linux chown（英文全拼：<strong>change owner</strong>）命令用于设置文件所有者和文件关联组的命令。</p><p><strong><font style="color:red;">只有<u>超级用户</u>和<u>属于组的文件所有者</u>才能变更文件关联组</font></strong>。非超级用户如需要设置关联组可能需要使用 <code>chgrp</code> 命令。</p><p>Linux/Unix 是多人多工操作系统，所有的文件皆有拥有者。利用 <code>chown</code> 将指定文件的拥有者改为指定的用户或组，用户可以是用户名或者用户 ID，组可以是组名或者组 ID，文件是以空格分开的要改变权限的文件列表，支持通配符。</p><p>📌<strong>chown命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> [-options] user[:group] file</span><br></pre></td></tr></table></figure><blockquote><ul><li>user : 新的文件拥有者的使用者 ID</li><li>group : 新的文件拥有者的使用者组(group)</li></ul></blockquote><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><font style="color:red;">-R</font></td><td>表示连同子目录中的所有文件，都更改所有者</td></tr><tr><td>-c</td><td>显示更改的部分的信息</td></tr><tr><td>-f</td><td>忽略错误信息</td></tr><tr><td>-v</td><td>显示详细的处理信息</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>修改文件的所有者，更多时候是为了得到更高的权限，举一个实例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#由root用户创建file文件</span></span><br><span class="line">[root@localhost ~]<span class="comment"># touch file</span></span><br><span class="line"><span class="comment">#文件的所有者是root，普通用户user对这个文件拥有只读权限</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ll file</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Apr 17 05:12 file</span><br><span class="line"><span class="comment">#修改文件的所有者</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chown user file</span></span><br><span class="line"><span class="comment">#所有者变成了user用户，这时user用户对这个文件就拥有了读、写权限</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ll file</span></span><br><span class="line">-rw-r--r--. 1 user root 0 Apr 17 05:12 file</span><br></pre></td></tr></table></figure><p>可以看到，通过修改 file 文件的所有者，user 用户从其他人身份（只对此文件有读取权限）转变成了所有者身份，对此文件拥有读和写权限。</p></li><li><p>Linux 系统中，用户等级权限的划分是非常清楚的，root 用户拥有最高权限，可以修改任何文件的权限，而普通用户只能修改自己文件的权限（所有者是自己的文件），例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入user用户的家目录</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /home/user</span></span><br><span class="line"><span class="comment">#由root用户新建文件test</span></span><br><span class="line">[root@localhost user]<span class="comment"># touch test</span></span><br><span class="line"><span class="comment">#文件所有者和所属组都是root用户</span></span><br><span class="line">[root@localhost user]<span class="comment"># ll test</span></span><br><span class="line">-rw-r--r--. 1 root root 0 Apr 17 05:37 <span class="built_in">test</span></span><br><span class="line"><span class="comment">#切换为user用户</span></span><br><span class="line">[root@localhost user]<span class="comment"># su - user</span></span><br><span class="line"><span class="comment">#user用户不能修改test文件的权限</span></span><br><span class="line">[user@localhost ~]$ <span class="built_in">chmod</span> 755 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">chmod</span>:更改<span class="string">&quot;test&quot;</span>的权限：不允许的操作</span><br><span class="line"><span class="comment">#退回到root身份</span></span><br><span class="line">[user@localhost ~]$ <span class="built_in">exit</span></span><br><span class="line"><span class="comment">#由root用户把test文件的所有者改为user用户</span></span><br><span class="line">[root@localhost user]<span class="comment"># chown user test</span></span><br><span class="line"><span class="comment">#切换为user用户</span></span><br><span class="line">[root@localhost user]<span class="comment"># su - user</span></span><br><span class="line"><span class="comment">#user用户由于是test文件的所有者，所以可以修改文件的权限</span></span><br><span class="line">[user@localhost ~]$ <span class="built_in">chmod</span> 755 <span class="built_in">test</span></span><br><span class="line"><span class="comment">#查看权限</span></span><br><span class="line">[user@localhost ~]$ ll <span class="built_in">test</span></span><br><span class="line">-rwxr-xr-x. 1 user root 0 Apr 17 05:37 <span class="built_in">test</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="chgrp-修改文件和目录的所属组">chgrp 修改文件和目录的所属组</h3><p>Linux chgrp（英文全拼：change group）命令用于变更文件或目录的所属群组。</p><p>与 <code>chown</code> 命令不同，<code>chgrp</code> 允许普通用户改变文件所属的组，只要该用户是该组的一员。</p><p>在 UNIX 系统家族里，文件或目录权限的掌控以拥有者及所属群组来管理。您可以使用 <code>chgrp</code> 指令去变更文件与目录的所属群组，设置方式采用群组名称或群组识别码皆可。</p><p>📌<strong>chgrp命令格式</strong>：使用此命令需要注意的一点是，要被改变的群组名必须是真实存在的，否则命令无法正确执行，会提示 “invaild group name”。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chgrp</span> [-options] group file</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-c</code>：<code>--changes</code></td><td>效果类似&quot;-v&quot;参数，但仅回报更改的部分</td></tr><tr><td><code>-f</code>：<code>--quiet</code>：<code>--silent</code></td><td>不显示错误信息</td></tr><tr><td><code>-h</code>：<code>--no-dereference</code></td><td>只对符号连接的文件作修改，而不改动其他任何相关文件</td></tr><tr><td><code>-R</code>：<code>--recursive</code></td><td>用于更改目录的所属组，表示更改连同子目录中所有文件的所属组信息</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示指令执行过</td></tr><tr><td><code>-reference=&lt;参考文件或目录&gt;</code></td><td>指定文件或目录的所属群组全部设成和参考文件或目录的所属群组相同。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>当以 root 身份登录 Linux 系统时，主目录中会存在一个名为 install.log 的文件，我们可以使用如下方法修改此文件的所属组：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# groupadd group1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">新建用于测试的群组 group1</span></span><br><span class="line">[root@localhost ~]# chgrp group1 install.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改install.log文件的所属组为group1</span></span><br><span class="line">[root@localhost ~]# ll install.log</span><br><span class="line">-rw-r--r--. 1 root group1 78495 Nov 17 05:54 install.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改生效</span></span><br><span class="line">[root@localhost ~]# chgrp testgroup install.log</span><br><span class="line">chgrp: invaild group name &#x27;testgroup&#x27;</span><br></pre></td></tr></table></figure><p>可以看到，在具有 group1 群组的前提下，我们成功修改了 install.log 文件的所属组，但我们再次试图将所属组修改为 testgroup 时，命令执行失败，就是因为系统的 /etc/group 文件中，没有 testgroup 群组。</p><h3 id="chattr-修改文件系统的权限属性">chattr 修改文件系统的权限属性</h3><p>管理 Linux 系统中的文件和目录，除了可以设定普通权限和特殊权限外，还可以利用文件和目录具有的一些隐藏属性。</p><p>chattr 命令，专门用来修改文件或目录的隐藏属性，<font style="color:red;">只有 root 用户可以使用</font>。</p><p>📌<strong>chattr命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chgrp</span> [-options] group file</span><br></pre></td></tr></table></figure><blockquote><p>+ 表示给文件或目录添加属性，- 表示移除文件或目录拥有的某些属性，= 表示给文件或目录设定一些属性。</p></blockquote><p>📌<strong>选项</strong>：</p><table>  <caption>    chattr 命令常用的属性选项及功能  </caption>  <tbody>    <tr>      <th>属性选项</th>      <th>功能</th>    </tr>    <tr>      <td>-i</td>      <td>        如果对文件设置 i        属性，那么不允许对文件进行删除、改名，也不能添加和修改数据；<br />        如果对目录设置 i        属性，那么只能修改目录下文件中的数据，但不允许建立和删除文件；      </td>    </tr>    <tr>      <td>-a</td>      <td>        如果对文件设置 a        属性，那么只能在文件中増加数据，但是不能删除和修改数据；<br />        如果对目录设置 a        属性，那么只允许在目录中建立和修改文件，但是不允许删除文件；      </td>    </tr>    <tr>      <td>-u</td>      <td>        设置此属性的文件或目录，在删除时，其内容会被保存，以保证后期能够恢复，常用来防止意外删除文件或目录。      </td>    </tr>    <tr>      <td>-s</td>      <td>        和 u 相反，删除文件或目录时，会被彻底删除（直接从硬盘上删除，然后用 0        填充所占用的区域），不可恢复。      </td>    </tr>  </tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>给文件赋予 i 属性</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># touch ftest</span></span><br><span class="line"><span class="comment">#建立测试文件</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chattr +i ftest</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf ftest</span></span><br><span class="line"><span class="built_in">rm</span>:cannot remove <span class="string">&#x27;ftest&#x27;</span>:Operation not permitted</span><br><span class="line"><span class="comment">#无法删除&quot;ftesr&quot;，操作不允许</span></span><br><span class="line"><span class="comment">#被赋予i属性后，root不能删除</span></span><br><span class="line">[root@localhost ~]<span class="comment"># echo 111&gt;&gt;ftest</span></span><br><span class="line">bash:ftest:Permission denied</span><br><span class="line"><span class="comment">#权限不够，不能修改文件中的数据</span></span><br></pre></td></tr></table></figure><p>可以看到，设置有 i 属性的文件，即便是 root 用户，也无法删除和修改数据。</p></li><li><p>为目录赋予 i 属性</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir dtest</span></span><br><span class="line"><span class="comment">#建立测试目录</span></span><br><span class="line">[root@localhost dtest]<span class="comment"># touch dtest/abc</span></span><br><span class="line"><span class="comment">#再建立一个测试文件abc</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chattr +i dtest</span></span><br><span class="line"><span class="comment">#给目录赋予i属性</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd dtest</span></span><br><span class="line">[root@localhost dtest]<span class="comment"># touch bed</span></span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;bed&#x27;</span>:Permission denied</span><br><span class="line"><span class="comment">#无法创建&quot;bcd&quot;，权限不够，dtest目录不能新建文件</span></span><br><span class="line">[root@localhost dtest]<span class="comment"># echo 11&gt;&gt;abc</span></span><br><span class="line">[root@localhost dtest]<span class="comment"># cat abc</span></span><br><span class="line">11</span><br><span class="line"><span class="comment">#可以修改文件内容</span></span><br><span class="line">[root@localhost dtest]<span class="comment"># rm -rf abc</span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;abc&#x27;</span>: Permission denied</span><br><span class="line"><span class="comment">#无法删除&quot;abc&quot;，权限不够</span></span><br></pre></td></tr></table></figure><p>一旦给目录设置 i 属性，即使是 root 用户，也无法在目录内部新建或删除文件，但可以修改文件内容。</p><p>给设置有 i 属性的文件删除此属性也很简单，只需将 chattr 命令中 + 改为 - 即可。</p></li><li><p>演示 a 属性的作用。假设有这样一种应用，我们每天自动实现把服务器的日志备份到指定目录，备份目录可设置 a 属性，变为只可创建文件而不可删除。命令如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir -p /back/log</span></span><br><span class="line"><span class="comment">#建立备份目录</span></span><br><span class="line">[root@localhost ~]<span class="comment"># chattr +a /back/log</span></span><br><span class="line"><span class="comment">#赋予a属性</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cp /var/log/messages /back/log</span></span><br><span class="line"><span class="comment">#可以复制文件和新建文件到指定目录中</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf /back/log/messages</span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;/back/log/messages&#x27;</span>: Permission denied</span><br><span class="line"><span class="comment">#无法删除 /back/log/messages，操作不允许</span></span><br></pre></td></tr></table></figure><p>注意，通常情况下，不要使用 chattr 命令修改 <code>/</code>、<code>/dev/</code>、<code>/tmp/</code>、<code>/var/</code> 等目录的隐藏属性，很容易导致系统无法启动。另外，chatrr 命令常与 lsattr 命令合用，前者修改文件或目录的隐藏属性，后者用于查看是否修改成功。</p></li></ol><h3 id="lsattr-查看特殊权限">lsattr 查看特殊权限</h3><p>lsattr 命令，用于显示文件或目录的隐藏属性。使用 chattr 命令配置文件或目录的隐藏属性后，可以使用 lsattr 命令查看。</p><p>📌<strong>lsattr命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr [-options] filename</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>后面不带文件或目录名，表示显示所有文件和目录（包括隐藏文件和目录）</td></tr><tr><td>-d</td><td>如果目标是目录，只会列出目录本身的隐藏属性，而不会列出所含文件或子目录的隐藏属性信息；</td></tr><tr><td>-R</td><td>和 -d 恰好相反，作用于目录时，会连同子目录的隐藏信息数据也一并显示出来。</td></tr></tbody></table><h3 id="sudo-以其他用户身份执行命令">sudo 以其他用户身份执行命令</h3><p>💾<u><code>/etc/sudoers</code></u></p><p>Linux sudo（execute a command as another user）命令以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自执行。</p><p>⚠️注意：对于ubuntu平台，只能通过sudo su进入root账号。</p><p>su 命令可以让普通用户切换到 root 身份去执行某些特权命令，但存在一些问题，比如说：</p><ul><li>仅仅为了一个特权操作就直接赋予普通用户控制系统的完整权限；</li><li>当多人使用同一台主机时，如果大家都要使用 su 命令切换到 root 身份，那势必就需要 root 的密码，这就导致很多人都知道 root 的密码；</li></ul><p>考虑到使用 su 命令可能对系统安装造成的隐患，最常见的解决方法是使用 sudo 命令，此命令也可以让你切换至其他用户的身份去执行命令。</p><p>📌<strong>sudo命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo [-options] <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-b</td><td>将后续的命令放到背景中让系统自行运行，不对当前的 shell 环境产生影响</td></tr><tr><td>-u UserName</td><td>后面可以接欲切换的用户名，若无此项则代表切换身份为 root</td></tr><tr><td>-l</td><td>此选项的用法为 sudo -l，用于显示当前用户可以用 sudo 执行那些命令</td></tr></tbody></table><p>📌<strong>sudo命令的配置文件</strong>：</p><p>修改 <code>/etc/sudoers</code>，不建议直接使用 vim，而是使用 visudo。因为修改 <code>/etc/sudoers</code> 文件需遵循一定的语法规则，使用 visudo 的好处就在于，当修改完毕 <code>/etc/sudoers</code> 文件，离开修改页面时，系统会自行检验 <code>/etc/sudoers</code> 文件的语法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># visudo</span></span><br><span class="line">…省略部分输出…</span><br><span class="line">root ALL=(ALL) ALL  &lt;--大约 76 行的位置</span><br><span class="line"><span class="comment">#用户名 被管理主机的地址=(可使用的身份) 授权命令(绝对路径)</span></span><br><span class="line"><span class="comment"># %wheel ALL=(ALL) ALL   &lt;--大约84行的位置</span></span><br><span class="line"><span class="comment"># %组名 被管理主机的地址=(可使用的身份) 授权命令(绝对路径)</span></span><br><span class="line">…省略部分输出…</span><br></pre></td></tr></table></figure><table><thead><tr><th>模块</th><th>含义</th></tr></thead><tbody><tr><td>用户名或群组名</td><td>表示系统中的那个用户或群组，可以使用 sudo 这个命令。</td></tr><tr><td>被管理主机的地址</td><td>用户可以管理指定 IP 地址的服务器。这里如果写 ALL，<br/>则代表用户可以管理任何主机；如果写固定 IP，则代表用户可以管理指定的服务器。<br/>如果我们在这里写本机的 IP 地址，不代表只允许本机的用户使用指定命令，<br/>而是代表指定的用户可以从任何 IP 地址来管理当前服务器。</td></tr><tr><td>可使用的身份</td><td>就是把来源用户切换成什么身份使用，（ALL）代表可以切换成任意身份。这个字段可以省略。</td></tr><tr><td>授权命令</td><td>表示 root 把什么命令命令授权给用户，换句话说，可以用切换的身份执行什么命令。需要注<br/>意的是，此命令必须使用绝对路径写。默认值是 ALL，表示可以执行任何命令。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>本例中，无法使用sshd登入。 su - sshd 的方式成功切换到 sshd 账户中，因为此用户的默认 Shell 是 /sbin/nologin。这时就显现出 sudo 的优势，我们可以使用 sudo 以 sshd 的身份在 /tmp 目录下创建 mysshd 文件，可以看到，新创建的 mysshd 文件的所有者确实是 sshd。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#  grep sshd /etc/passwd</span></span><br><span class="line">sshd:x:74:74:privilege-separated SSH:/var/empty/sshd:/sbin.nologin</span><br><span class="line">[root@localhost ~]<span class="comment">#  sudo -u sshd touch /tmp/mysshd</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  ll /tmp/mysshd</span></span><br><span class="line">-rw-r--r-- 1 sshd sshd 0 Feb 28 17:42 /tmp/mysshd</span><br></pre></td></tr></table></figure><h2 id="文件和目录管理">文件和目录管理</h2><h3 id="cd-切换工作目录">cd 切换工作目录</h3><p>Linux cd（英文全拼：change directory）命令用于切换当前工作目录。</p><p>其中 dirName 表示法可为绝对路径或相对路径。若目录名称省略，则变换至使用者的 home 目录 (也就是刚 login 时所在的目录)。另外，<strong>~</strong> 也表示为 home 目录 的意思， <strong>.</strong> 则是表示目前所在的目录， <strong>…</strong> 则表示目前目录位置的上一层目录。</p><p>📌<strong>cd命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> dirName</span><br></pre></td></tr></table></figure><p>📌<strong>cd的常用命令</strong>：</p><p>cd后面可跟绝对路径，也可以跟相对路径。如果省略目录，则默认切换到当前用户的主目录。Linux所有的目录和文件名大小写敏感。</p><table><thead><tr><th align="left">命令</th><th>含义</th></tr></thead><tbody><tr><td align="left">cd</td><td>相当于cd ~</td></tr><tr><td align="left">cd ~</td><td>切换到当前用户的主目录(/home/用户目录)</td></tr><tr><td align="left">cd .</td><td>切换到当前目录</td></tr><tr><td align="left">cd ..</td><td>切换到上级目录</td></tr><tr><td align="left">cd -</td><td>进入上次所在的目录</td></tr></tbody></table><h3 id="pwd-显示绝对路径">pwd 显示绝对路径</h3><p>📌<strong>pwd命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span> [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>pwd参数</strong>：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-L</code>：<code>–logical</code></td><td>显示当前的路径，有连接文件时，直接显示连接文件的路径(不加参数时默认此方式)。</td></tr><tr><td><font style="color:red;"><code>-p</code>：<code>–physical</code></font></td><td>显示当前的路径，有连接文件时，不使用连接路径，直接显示连接文件所指向的文件。<br />当包含多层连接文件时，显示连接文件最终指向的文件</td></tr></tbody></table><h3 id="ls-列出目录的内容">ls 列出目录的内容</h3><p>Linux ls（英文全拼： list directory contents）命令用于显示指定工作目录下之内容（列出目前工作目录所含之文件及子目录)。</p><p>Linux文件或者目录名称最长可以有265个字符，<code>.</code>代表当前目录，<code>…</code>代表上一级目录，以<code>.</code>开头的文件为隐藏文件，需要用 <code>-a</code> 参数才能显示。</p><p>📌<strong>ls命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> [-options] [file|path]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><span style="color:red;">-a</span></td><td>显示所有文件及目录 (<strong>.</strong> 开头的隐藏文件也会列出)</td></tr><tr><td><span style="color:red;">-l</span></td><td>除文件名称外，亦将文件型态、权限、拥有者、文件大小等资讯详细列出（等同于<code>ll</code>）</td></tr><tr><td>-r</td><td>将文件以相反次序显示(原定依英文字母次序)</td></tr><tr><td>-t</td><td>将文件依建立时间之先后次序列出</td></tr><tr><td><span style="color:red;">-h</span></td><td>配合 -l 以人性化的方式显示文件大小</td></tr><tr><td>-A</td><td>同 -a ，但不列出 “.” (目前目录) 及 “…” (父目录)</td></tr><tr><td>-F</td><td>在列出的文件名称后加一符号；例如可执行档则加 “*”, 目录则加 “/”</td></tr><tr><td>-R</td><td>若目录下有文件，则以下之文件亦皆依序列出</td></tr></tbody></table><p>📌<strong>ls支持通配符</strong>：</p><table><thead><tr><th align="left">通配符</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">*</td><td align="left">文件代表文件名中所有字符</td></tr><tr><td align="left">ls te*</td><td align="left">查找以te开头的文件</td></tr><tr><td align="left">ls *html</td><td align="left">查找结尾为html的文件</td></tr><tr><td align="left">？</td><td align="left">代表文件名中任意一个字符</td></tr><tr><td align="left">ls ?.c</td><td align="left">只找第一个字符任意，后缀为.c的文件</td></tr><tr><td align="left">ls a.?</td><td align="left">只找只有3个字符，前2字符为a.，最后一个字符任意的文件</td></tr><tr><td align="left">[]</td><td align="left">[”和“]”将字符组括起来，表示可以匹配字符组中的任意一个。“-”用于表示字符范围。</td></tr><tr><td align="left">[abc]</td><td align="left">匹配a、b、c中的任意一个</td></tr><tr><td align="left">[a-f]</td><td align="left">匹配从a到f范围内的的任意一个字符</td></tr><tr><td align="left">ls [a-f]*</td><td align="left">找到从a到f范围内的的任意一个字符开头的文件</td></tr><tr><td align="left">ls a-f</td><td align="left">查找文件名为a-f的文件,当“-”处于方括号之外失去通配符的作用</td></tr><tr><td align="left">\</td><td align="left">如果要使通配符作为普通字符使用，可以在其前面加上转义字符。“?”和“*”处于方括号内时不用使用转义字符就失去通配符的作用。</td></tr><tr><td align="left">ls \*a</td><td align="left">查找文件名为*a的文件</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll -h</span></span><br><span class="line">total 24K</span><br><span class="line">-rw-r--r-- 1 root root 1.6K Dec  1  2016 CentOS7-Base-163.repo.1</span><br><span class="line">-rw-r--r-- 1 root root 6.0K Nov 12  2015 mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">-rw-r--r-- 1 root root   90 Nov 23 10:26 passwd</span><br><span class="line">drwxr-xr-t 2 root root 4.0K Nov 22 21:15 <span class="built_in">test</span></span><br><span class="line">-rw-r--r-- 1 root root  276 Nov 24 10:01 user</span><br><span class="line">lrwxrwxrwx 1 root root   14 Nov  6 19:18 web -&gt; /var/www/html/</span><br></pre></td></tr></table></figure><p>列出的信息的含义：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/ccff78bd3a3c92ac11636923216ce3ed.png" alt="ls"></p><h3 id="stat-显示inode的内容">stat 显示inode的内容</h3><p>stat命令用于显示文件的状态信息。stat命令的输出信息比ls命令的输出信息要更详细。</p><p>📌<strong>stat命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> [-options] file</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th align="left">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">-L</td><td align="left">支持符号连接；</td></tr><tr><td align="left">-f</td><td align="left">显示文件系统状态而非文件状态；</td></tr><tr><td align="left">-c</td><td align="left">按照指定格式输出；</td></tr><tr><td align="left">-t</td><td align="left">以简洁方式输出信息；</td></tr><tr><td align="left">–help</td><td align="left">显示指令的帮助信息；</td></tr><tr><td align="left">–version</td><td align="left">显示指令的版本信息。</td></tr></tbody></table><p>📌<strong>查看的信息包括</strong>：</p><ol><li>File：显示文件名</li><li>Size：显示文件大小</li><li>Blocks：文件使用的数据块总数</li><li>IO Block：IO块大小</li><li>regular file：文件类型（常规文件）</li><li>Device：设备编号</li><li>Inode：Inode号</li><li>Links：链接数</li><li>Access：文件的权限</li><li>Gid、Uid：文件所有权的Gid和Uid</li><li>access time：表示我们最后一次访问（仅仅是访问，没有改动）文件的时间</li><li>modify time：表示我们最后一次修改文件的时间</li><li>change time：表示我们最后一次对文件属性改变的时间，包括权限，大小，属性等等</li><li>Birth time : 文件创建时间，crtime，不过据查此属性linux已废弃，目前状态显示结果均为-</li></ol><p>📌<strong>文件的有效格式序列</strong>：</p><table><thead><tr><th align="left">格式符</th><th align="left">格式符说明</th></tr></thead><tbody><tr><td align="left">%a</td><td align="left">八进制中的访问权限</td></tr><tr><td align="left">%A</td><td align="left">人类可读形式的访问权</td></tr><tr><td align="left">%b</td><td align="left">分配的块数（请参阅%B）</td></tr><tr><td align="left">%B</td><td align="left">%b报告的每个块的大小（字节）</td></tr><tr><td align="left">%C</td><td align="left">SELinux安全上下文字符串</td></tr><tr><td align="left">%d</td><td align="left">十进制设备编号</td></tr><tr><td align="left">%D</td><td align="left">十六进制的设备编号</td></tr><tr><td align="left">%f</td><td align="left">十六进制原始模式</td></tr><tr><td align="left">%F</td><td align="left">文件类型</td></tr><tr><td align="left">%g</td><td align="left">所有者的组ID</td></tr><tr><td align="left">%G</td><td align="left">所有者的组名称</td></tr><tr><td align="left">%h</td><td align="left">硬链接数</td></tr><tr><td align="left">%i</td><td align="left">inode数</td></tr><tr><td align="left">%m</td><td align="left">挂载点</td></tr><tr><td align="left">%n</td><td align="left">文件名</td></tr><tr><td align="left">%N</td><td align="left">带取消引用（如果是符号链接）的带引号的文件名</td></tr><tr><td align="left">%o</td><td align="left">最佳I/O传输大小提示</td></tr><tr><td align="left">%s</td><td align="left">总大小，以字节为单位</td></tr><tr><td align="left">%t</td><td align="left">主要设备类型（十六进制），用于字符/块设备特殊文件</td></tr><tr><td align="left">%T</td><td align="left">次要设备类型（十六进制），用于字符/块设备特殊文件</td></tr><tr><td align="left">%u</td><td align="left">所有者的用户ID</td></tr><tr><td align="left">%U</td><td align="left">所有者的用户名</td></tr><tr><td align="left">%w</td><td align="left">文件出生时间，人类可读；-如果未知</td></tr><tr><td align="left">%W</td><td align="left">文件生成时间，自纪元起的秒数；如果未知，则为0</td></tr><tr><td align="left">%x</td><td align="left">最后一次访问的时间，人类可读</td></tr><tr><td align="left">%X</td><td align="left">上次访问的时间，自纪元起的秒数</td></tr><tr><td align="left">%y</td><td align="left">上次修改的时间，人类可读</td></tr><tr><td align="left">%Y</td><td align="left">上次修改的时间，自纪元起的秒数</td></tr><tr><td align="left">%z</td><td align="left">最后更改的时间，人类可读</td></tr><tr><td align="left">%Z</td><td align="left">上次更改的时间，自新纪元起的秒数</td></tr></tbody></table><p>📌<strong>文件系统的有效格式序列</strong>：</p><table><thead><tr><th align="left">格式符</th><th align="left">格式符说明</th></tr></thead><tbody><tr><td align="left">%a</td><td align="left">非超级用户可用的空闲块</td></tr><tr><td align="left">%b</td><td align="left">文件系统中的数据块总数</td></tr><tr><td align="left">%c</td><td align="left">文件系统中的文件节点总数</td></tr><tr><td align="left">%d</td><td align="left">文件系统中的空闲文件节点</td></tr><tr><td align="left">%f</td><td align="left">文件系统中的空闲块</td></tr><tr><td align="left">%i</td><td align="left">十六进制文件系统ID</td></tr><tr><td align="left">%l</td><td align="left">文件名的最大长度</td></tr><tr><td align="left">%n</td><td align="left">文件名</td></tr><tr><td align="left">%s</td><td align="left">块大小（用于更快的传输）</td></tr><tr><td align="left">%S</td><td align="left">基本块大小（用于块计数）</td></tr><tr><td align="left">%t</td><td align="left">十六进制文件系统类型</td></tr><tr><td align="left">%T</td><td align="left">人类可读形式的文件系统类型</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># stat mysql-community-release-el7-5.noarch.rpm </span></span><br><span class="line">  File: ‘mysql-community-release-el7-5.noarch.rpm’</span><br><span class="line">  Size: 6140            Blocks: 16         IO Block: 4096   regular file</span><br><span class="line">Device: fd01h/64769d    Inode: 394398      Links: 1</span><br><span class="line">Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)</span><br><span class="line">Access: 2019-11-23 13:30:42.000000000 +0800</span><br><span class="line">Modify: 2015-11-12 15:58:42.000000000 +0800</span><br><span class="line">Change: 2019-11-23 13:30:42.400300171 +0800</span><br><span class="line"> Birth: -</span><br><span class="line"></span><br><span class="line">python@ubuntu:~/txt$ <span class="built_in">stat</span> find我的Mr.Right.txt </span><br><span class="line">  文件：<span class="string">&#x27;find我的Mr.Right.txt&#x27;</span></span><br><span class="line">  大小：64768           块：128        IO 块：4096   普通文件</span><br><span class="line">设备：801h/2049d        Inode：655501      硬链接：1</span><br><span class="line">权限：(0664/-rw-rw-r--)  Uid：( 1000/  python)   Gid：( 1000/  python)</span><br><span class="line">最近访问：2019-11-22 22:43:17.565105155 +0800</span><br><span class="line">最近更改：2019-11-22 22:42:42.000000000 +0800</span><br><span class="line">最近改动：2019-11-22 22:43:08.797116491 +0800</span><br><span class="line">创建时间：-</span><br></pre></td></tr></table></figure><h3 id="mkdir-创建一个新的目录">mkdir 创建一个新的目录</h3><p>Linux mkdir（英文全拼：make directory）命令用于创建目录。</p><p>📌<strong>mkdir命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> [-options] dirName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><span style="color:red;"><code>-p</code>：<code>--parents</code></span></td><td>如果目录不存在，根据需要创建父级目录</td></tr><tr><td><span style="color:red;"><code>-m</code>：<code>--mode=MODE</code></span></td><td>设置文件模式(chmod)</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示指令执行过程</td></tr><tr><td><code>-Z</code></td><td>创建目录的SELinux安全设置为默认类型</td></tr></tbody></table><h3 id="rmdir-删除一个空的目录">rmdir 删除一个空的目录</h3><p>Linux rmdir（英文全拼：remove directory）。rmdir 命令的功能是删除空目录，一个目录被删除之前必须是空的。（注意：rm - r dir 命令可代替rmdir，但是有很大危险性）删除某目录时也必须具有对父目录的写权限。</p><p>📌<strong>rkdir命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmkdir [-options] dirName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><span style="color:red;"><code>-p</code>：<code>--parents</code></span></td><td>删除指定目录后，若该目录的上层目录已变成空目录，则将其一并删除</td></tr><tr><td><code>--ignore-fail-on-non-empty</code></td><td>忽略非空目录的错误信息</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示指令执行过程</td></tr></tbody></table><h3 id="rm-删除文件或目录">rm 删除文件或目录</h3><p>可通过rm删除文件或目录。使用rm命令要小心，因为文件删除后不能恢复。为了防止文件误删，可以在rm后使用-i参数以逐个确认要删除的文件。</p><p>📌<strong>rm命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> [-options] name</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><span style="color:red;"><code>-f</code></span></td><td>忽略不存在的文件和参数，不要提示</td></tr><tr><td><code>-i</code></td><td>每次删除前都会提示</td></tr><tr><td><span style="color:red;"><code>-r</code></span></td><td>递归地删除目录及其内容</td></tr><tr><td><code>-d</code></td><td>删除空目录</td></tr><tr><td><code>-v</code></td><td>列出详细信息</td></tr></tbody></table><h3 id="touch-创建空文件">touch 创建空文件</h3><p>Linux touch命令用于修改文件或者目录的时间属性，包括存取时间和更改时间。若文件不存在，系统会建立一个新的文件。</p><p>📌<strong>touch命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> [-options] name</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-a</code></td><td>只更改访问时间</td></tr><tr><td><code>-c</code>：<code>--no-create</code></td><td>不创建任何文件</td></tr><tr><td><code>-d</code>：<code>--date=字符串</code></td><td>使用指定字符串表示时间而非当前时间</td></tr><tr><td><code>-h</code>：<code>--no-dereference</code></td><td>会影响符号链接本身，而非符号链接所指示的目的地<br/>(当系统支持更改符号链接的所有者时，此选项才有用)</td></tr><tr><td><code>-m</code></td><td>只更改修改时间</td></tr><tr><td><code>-r</code>：<code>--reference=FILE</code></td><td>使用file文件的时间戳（access、modify）更新文件的时间戳</td></tr><tr><td><code>-t</code></td><td>设定档案的时间记录，格式与 date 指令相同</td></tr></tbody></table><h3 id="mv-移动文件、目录或重命名">mv 移动文件、目录或重命名</h3><p>📌<strong>mv命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> [-options] <span class="built_in">source</span> directory</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-b</code></td><td>目标文件或目录存在时，在执行覆盖前，会为其创建一个备份</td></tr><tr><td><code>-i</code></td><td>如果指定移动的源目录或文件与目标的目录或文件同名，则会先询问是否覆盖旧文件，输入 y 表示直接覆盖，输入 n 表示取消该操作</td></tr><tr><td><code>-f</code></td><td>如果指定移动的源目录或文件与目标的目录或文件同名，不会询问，直接覆盖旧文件</td></tr><tr><td><code>-n</code></td><td>不要覆盖任何已存在的文件或目录</td></tr><tr><td><code>-u</code></td><td>当源文件比目标文件新或者目标文件不存在时，才执行移动操作</td></tr></tbody></table><h3 id="cp-复制文件或目录">cp 复制文件或目录</h3><p>Linux cp（英文全拼：copy file）命令主要用于复制文件或目录。</p><p>📌<strong>cp命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> [-options] <span class="built_in">source</span> directory</span><br></pre></td></tr></table></figure><blockquote><ul><li>source ：拷贝的文件</li><li>directory：拷贝到的路径</li></ul></blockquote><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-a</code></td><td>相当于 <code>-pdr</code> ，此选项通常在复制目录时使用，它保留链接、文件属性，并复制目录下的所有内容</td></tr><tr><td><code>-d</code></td><td>复制时保留链接。这里所说的链接相当于 Windows 系统中的快捷方式</td></tr><tr><td><code>-f</code></td><td>覆盖已经存在的目标文件而不给出提示</td></tr><tr><td><code>-i</code></td><td>与 <strong>f</strong> 选项相反，在覆盖目标文件之前给出提示，要求用户确认是否覆盖，回答 <strong>y</strong> 时目标文件将被覆盖</td></tr><tr><td><code>-p</code></td><td>除复制文件的内容外，还把修改时间和访问权限也复制到新文件中</td></tr><tr><td><font style="color:red;"><code>-r</code></font></td><td>若给出的源文件是一个目录文件，此时将复制该目录下所有的子目录和文件</td></tr><tr><td><code>-l</code></td><td>不复制文件，只是生成链接文件</td></tr></tbody></table><h3 id="ln-建立一个同步的链接">ln 建立一个同步的链接</h3><p>Linux ln（英文全拼：link files）命令是一个非常重要命令，它的功能是为某一个文件在另外一个位置建立一个同步的链接。</p><p>当我们需要在不同的目录，用到相同的文件时，我们不需要在每一个需要的目录下都放一个必须相同的文件，我们只要在某个固定的目录，放上该文件，然后在 其它的目录下用ln命令链接（link）它就可以，不必重复的占用磁盘空间。</p><p>Linux文件系统中，有所谓的链接(link)，我们可以将其视为档案的别名，而链接又可分为两种 : 硬链接(hard link)与软链接(symbolic link)，硬链接的意思是一个档案可以有多个名称，而软链接的方式则是产生一个特殊的档案，该档案的内容是指向另一个档案的位置。硬链接是存在同一个文件系统中，而软链接却可以跨越不同的文件系统。</p><p>📌<strong>ln命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> [optians] 源目录或目录 目标文件或目录</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-b</code>：<code>--backup</code></td><td>删除，覆盖目标文件之前的备份。</td></tr><tr><td><code>-d</code>：<code>-F</code>或<code>--directory</code></td><td>建立目录的硬连接。</td></tr><tr><td><code>-f</code>：<code>--force</code></td><td>强行建立文件或目录的连接，不论文件或目录是否存在。</td></tr><tr><td><code>-i</code>：<code>--interactive</code></td><td>覆盖既有文件之前先询问用户。</td></tr><tr><td><code>-n</code>：<code>--no-dereference</code></td><td>把符号连接的目的目录视为一般文件。</td></tr><tr><td><font style="color:red;"><code>-s</code>：<code>--symbolic</code></font></td><td>对源文件建立软链接(符号连接)，而非硬连接。</td></tr><tr><td><code>-S&lt;字尾备份字符串&gt;</code>：<code>--suffix=&lt;字尾备份字符串&gt;</code></td><td>用&quot;-b&quot;参数备份目标文件后，<br/>备份文件的字尾会被加上一个备份字符串，<br/>预设的字尾备份字符串是符号&quot;~“，可通过”-S&quot;参数来改变它。</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示指令执行过程。</td></tr><tr><td><code>-V&lt;备份方式&gt;</code>：<code>--version-control=&lt;备份方式&gt;</code></td><td>用&quot;-b&quot;参数备份目标文件后，<br/>备份文件的字尾会被加上一个备份字符串，<br/>这个字符串不仅可用&quot;-S&quot;参数</td></tr></tbody></table><h3 id="find-查找文件或者目录">find 查找文件或者目录</h3><p>💾<u><code>/bin/find</code></u> 🔗<a href="http://c.biancheng.net/view/779.html">Linux find命令：在目录中查找文件（超详解）</a></p><p>find 是 Linux 中强大的搜索命令，不仅可以按照文件名搜索文件，还可以按照权限、大小、时间、inode 号等来搜索文件。但是 find 命令是直接在硬盘中进行搜索的，如果指定的搜索范围过大，find命令就会消耗较大的系统资源，导致服务器压力过大。所以，在使用 find 命令搜索时，不要指定过大的搜索范围。</p><p>📌<strong>find命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [path] [expression] [[搜索内容][处理动作]]</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>path：查找开始的位置，为空字符串则为当前路径 <code>./</code> 。</p></li><li><p>expression：查找条件，如果为空字符串则使用 <code>-print</code> 为预设 。</p></li></ul></blockquote><p>📌<strong>选项</strong>：</p><table><thead><tr><th>查找条件</th><th>说明</th></tr></thead><tbody><tr><td><code>-amin n</code></td><td>在过去 n 分钟内被读取过</td></tr><tr><td><code>-anewer file</code></td><td>比文件 file 更晚被读取过的文件</td></tr><tr><td><code>-atime [[][+][-]]time</code></td><td>空字符：表示在前 n~n+1 天内读取过的文件; <br />+n：代表 n 天前读取的文件<br />-n：代表 n 天内读取的文件</td></tr><tr><td><code>-cmin n</code></td><td>在过去 n 分钟内被修改过</td></tr><tr><td><code>-cnewer file</code></td><td>比文件 file 更新的文件</td></tr><tr><td><code>-ctime [[][+][-]]time</code></td><td>空字符：表示在前 n~n+1 天内创建过的文件; <br />+n：代表 n 天前创建的文件<br />-n：代表 n 天内创建的文件</td></tr><tr><td><code>-empty</code></td><td>空的文件-gid n or -group name : gid 是 n 或是 group 名称是 name</td></tr><tr><td><code>-inum</code></td><td>按照 inode 号搜索</td></tr><tr><td><code>-ipath p</code>，<code>-path p</code></td><td>路径名称符合 p 的文件，ipath 会忽略大小写</td></tr><tr><td><code>-mtime [[][+][-]]time</code></td><td>空字符：表示在前 n~n+1 天内修改过的文件; <br />+n：代表 n 天前修改的文件<br />-n：代表 n 天内修改的文件</td></tr><tr><td><code>-mount, -xdev</code></td><td>只检查和指定目录在同一个文件系统下的文件，避免列出其它文件系统中的文件</td></tr><tr><td><font style="color:red;"><code>-name name</code>，<code>-iname name</code></font></td><td>文件名称符合 name 的文件。<strong>iname 会忽略大小写</strong></td></tr><tr><td><code>-size [[+][-]]&lt;size&gt;&lt;units&gt;</code></td><td><code>+-</code>：加号表大于（省），减号表小于；<br />size：大小；<br />units：单位 <code>c</code>-Byte,<code>k</code>-kb，<code>M</code>-mb;</td></tr><tr><td><code>-type 类型</code></td><td>b: 区块装置文件<br />c: 字型装置文件<br />d: 查找目录<br />f: 一般文件<br />l: 符号连结<br />p: 具名贮列<br />s: socket</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>将当前目录及其子目录下所有文件后缀为 <strong>.c</strong> 的文件列出来:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find . -name &quot;*.c&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>将当前目录及其子目录中的所有文件列出：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find . -type f</span></span><br></pre></td></tr></table></figure></li><li><p>将当前目录及其子目录下所有最近 20 天内更新过的文件列出:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find . -ctime  20</span></span><br></pre></td></tr></table></figure></li><li><p>查找 /var/log 目录中更改时间在 7 日以前的普通文件，并在删除之前询问它们：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find /var/log -type f -mtime +7 -ok rm &#123;&#125; \\;</span></span><br></pre></td></tr></table></figure></li><li><p>查找当前目录中文件属主具有读、写权限，并且文件所属组的用户和其他用户具有读权限的文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find . -type f -perm 644 -exec ls -l &#123;&#125; \\;</span></span><br></pre></td></tr></table></figure></li><li><p>查找系统中所有文件长度为 0 的普通文件，并列出它们的完整路径：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># find / -type f -size 0 -exec ls -l &#123;&#125; \\;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="locate-快速定位文件路径">locate 快速定位文件路径</h3><p>Linux locate命令用于查找符合条件的文档，他会去保存文档和目录名称的数据库内，查找合乎范本样式条件的文档或目录。<code>locate</code>命令要比<code>find -name</code>快得多，原因在于它不搜索具体目录，而是搜索一个数据库<code>/var/lib/mlocate/mlocate.db</code> 。这个数据库中含有本地所有文件信息。Linux系统自动创建这个数据库，并且每天自动更新一次，因此，我们在用<code>whereis</code>和<code>locate</code> 查找文件时，有时会找到已经被删除的数据，或者刚刚建立文件，却无法查找到，原因就是因为数据库文件没有被更新。为了避免这种情况，可以在使用<code>locate</code>之前，先使用<code>updatedb</code>命令，手动更新数据库。整个<code>locate</code>工作其实是由四部分组成的:</p><ol><li><code>/usr/bin/updatedb</code>  主要用来更新数据库，通过crontab自动完成的</li><li><code>/usr/bin/locate</code>     查询文件位置</li><li><code>/etc/updatedb.conf</code>  updatedb的配置文件</li><li><code>/var/lib/mlocate/mlocate.db</code> 存放文件信息的文件</li></ol><p>📌<strong>locate安装</strong>：</p><p>CentOS7 默认没有安装该命令。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mlocate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化文件库</span></span><br><span class="line">updatedb</span><br></pre></td></tr></table></figure><p>📌<strong>locate命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate [-options] [样式]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-f</td><td>将特定的档案系统排除在外，例如我们没有到理要把 proc 档案系统中的档案 放在资料库中。</td></tr><tr><td>-q</td><td>安静模式，不会显示任何错误讯息。</td></tr><tr><td>-n</td><td>至多显示 n个输出。</td></tr><tr><td>-r</td><td>使用正规运算式 做寻找的条件。</td></tr><tr><td>-o</td><td>指定资料库存的名称。</td></tr><tr><td>-d</td><td>指定资料库的路径</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>搜索etc目录下所有以sh开头的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# locate /etc/sh       </span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/shadow-</span><br><span class="line">/etc/shells</span><br><span class="line">[root@localhost ~]# locate -r &quot;/etc/\sh &quot;  # 正则，锚定词首</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/shadow-</span><br><span class="line">/etc/shells</span><br></pre></td></tr></table></figure></li><li><p>忽略大小写</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# locate -i ~/d</span><br><span class="line">/root/Desktop/root/Documents/root/Downloads</span><br><span class="line">/root/d1</span><br><span class="line">/root/dd</span><br><span class="line">/var/lib/pcp/pmdas/root/domain.h</span><br></pre></td></tr></table></figure></li><li><p>更新数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# locate ~/a</span><br><span class="line">/root/anaconda-ks.cfg</span><br><span class="line">[root@localhost ~]# updatedb</span><br><span class="line">[root@localhost ~]# locate ~/a</span><br><span class="line">/root/a.sh</span><br><span class="line">/root/anaconda-ks.cfg</span><br></pre></td></tr></table></figure></li></ol><h3 id="which-查看命令位置">which 查看命令位置</h3><p>which命令的作用是，在PATH变量指定的路径中，搜索某个系统命令的位置，并且返回第一个搜索结果。</p><p>📌<strong>which命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> [-options] programname</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n&lt;文件名长度&gt;</td><td>指定文件名长度，指定的长度必须大于或等于所有文件中最长的文件名；</td></tr><tr><td>-p&lt;文件名长度&gt;</td><td>与-n参数相同，但此处的&lt;文件名长度&gt;包括了文件的路径；</td></tr><tr><td>-w</td><td>指定输出时栏位的宽度</td></tr></tbody></table><h3 id="scp-安全拷贝">scp 安全拷贝</h3><p>secure copy (remote file copy program)，意思安全拷贝，安全复制的意思，是一个远程文件复制程序。准确来说就是不同服务器之间进行文件（包括目录）进行安全复制的命令。scp基于加州大学Regents的BSD源代码中的rcp程序。</p><p>📌<strong>scp命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp [option] /path/to/source/file user@server-ip:/path/to/destination/directory</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th style="text-align:center">选项</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">-C</td><td style="text-align:center">这会在复制过程中压缩文件或目录;</td></tr><tr><td style="text-align:center">-P</td><td style="text-align:center">如果默认 SSH 端口不是 22，则使用此选项指定 SSH 端口;</td></tr><tr><td style="text-align:center">-r</td><td style="text-align:center">此选项递归复制目录及其内容;</td></tr><tr><td style="text-align:center">-p</td><td style="text-align:center">保留文件的访问和修改时间。</td></tr></tbody></table><h3 id="source-执行脚本">source 执行脚本</h3><p>source命令也称为“点命令”，也就是一个点符号（.），是bash的内部命令。</p><p>本章节主要说明的是用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。因为linux所有的操作都会变成文件的格式存储。</p><p>关于“source filename”与“sh filename”、“./filename”这三个命令的区别，请戳 shell 编程篇。</p><p>📌<strong>source命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> filename<span class="comment"># filename必须是可执行的脚本文件</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">. filename <span class="comment"># 注意“.”号后面还有一个空格</span></span><br></pre></td></tr></table></figure><hr><h2 id="文本处理">文本处理</h2><h3 id="echo-输出内容到控制台">echo 输出内容到控制台</h3><p>Linux中 echo命令主要用于打印字符或者回显，一般起到一个提示的作用。</p><p>📌<strong>echo命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> [options] <span class="string">&quot;string&quot;</span></span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-n</td><td>不在最后自动换行</td></tr><tr><td>-e</td><td>使用-e扩展参数选项时，与如下参数一起使用，有不同含义，支持反斜线控制的字符转换</td></tr></tbody></table><p>📌<strong>-e的参数</strong>：</p>  <table>  <tr>      <td >-e的参数</td>      <td>说明</td>   </tr >  <tr >      <td>\a</td>      <td>发出警告声</td>  </tr>  <tr>      <td>\c</td>      <td>最后不加上换行符号</td>  </tr>  <tr>      <td>\f</td>      <td>换行但光标仍旧停留在原来的位置</td>  </tr>  <tr>      <td>\n</td>      <td>换行且光标移至行首</td>  </tr>  <tr>        <td>\r</td>      <td>光标移至行首，但不换行</td>  </tr>  <tr>      <td>\t </td>      <td>制表符，也就是Tab键</td>  </tr>  <tr>      <td>\v</td>      <td>与\f相同</td>  </tr>  <tr>      <td>\\</td>      <td>插入\字符</td>  </tr>   <tr>      <td colspan="2">\033[30m 黑色字 \033[0m</td>  </tr>   <tr>      <td colspan="2">\033[31m 红色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[32m 绿色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[33m 黄色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[34m 蓝色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[35m 紫色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[36m 天蓝字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[37m 白色字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[40;37m 黑底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[41;37m 红底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[42;37m 绿底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[43;37m 黄底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[44;37m 蓝底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[45;37m 紫底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[46;37m 天蓝底白字 \033[0m</td>  </tr>  <tr>      <td colspan="2">\033[47;30m 白底黑字 \033[0m</td>  </tr>  </table><h3 id="printf-格式化输出">printf 格式化输出</h3><p>printf 命令模仿 C 程序库（library）里的 printf() 程序。</p><p>标准所定义，因此使用 printf 的脚本比使用 echo 移植性好。</p><p>printf 使用引用文本或空格分隔的参数，外面可以在 printf 中使用格式化字符串，还可以制定字符串的宽度、左右对齐方式等。<strong>默认 printf 不会像 echo 自动添加换行符，我们可以手动添加 \n</strong>。</p><p>📌<strong>printf命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>  format-string  [arguments...]</span><br></pre></td></tr></table></figure><blockquote><ul><li><strong>format-string:</strong> 为格式控制字符串</li><li><strong>arguments:</strong> 为参数列表。</li></ul></blockquote><p>📌<strong>printf的转义序列</strong>：</p>  <table class="reference">    <tbody>      <tr>        <th>序列</th>        <th>说明</th>      </tr>      <tr>        <td>\a</td>        <td>警告字符，通常为 ASCII 的 BEL 字符</td>      </tr>      <tr>        <td>\b</td>        <td>后退</td>      </tr>      <tr>        <td>\c</td>        <td>          抑制（不显示）输出结果中任何结尾的换行字符（只在 %b          格式指示符控制下的参数字符串中有效），而且，任何留在参数里的字符、任何接下来的参数以及任何留在格式字符串中的字符，都被忽略        </td>      </tr>      <tr>        <td>\f</td>        <td>换页（formfeed）</td>      </tr>      <tr>        <td>\n</td>        <td>换行</td>      </tr>      <tr>        <td>\r</td>        <td>回车（Carriage return）</td>      </tr>      <tr>        <td>\t</td>        <td>水平制表符</td>      </tr>      <tr>        <td>\v</td>        <td>垂直制表符</td>      </tr>      <tr>        <td>\\</td>        <td>一个字面上的反斜杠字符</td>      </tr>      <tr>        <td>\ddd</td>        <td>表示 1 到 3 位数八进制值的字符。仅在格式字符串中有效</td>      </tr>      <tr>        <td>\0ddd</td>        <td>表示 1 到 3 位的八进制值字符</td>      </tr>    </tbody>  </table><p>📌<strong>示例说明</strong>：</p><p>我来用一个脚本来体现 printf 的强大功能：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4s\n&quot;</span> 姓名 性别 体重kg  </span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭靖 男 66.1234 </span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 杨过 男 48.6543 </span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;%-10s %-8s %-4.2f\n&quot;</span> 郭芙 女 47.9876 </span><br><span class="line"></span><br><span class="line"><span class="comment">#结果:</span></span><br><span class="line">姓名     性别   体重kg</span><br><span class="line">郭靖     男      66.12</span><br><span class="line">杨过     男      48.65</span><br><span class="line">郭芙     女      47.99</span><br></pre></td></tr></table></figure><blockquote><p>%s %c %d %f都是格式替代符</p><p>%-10s 指一个宽度为 10 个字符（-表示左对齐，没有则表示右对齐），任何字符都会被显示在 10 个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。</p><p>%-4.2f 指格式化为小数，其中 .2 指保留 2 位小数。</p></blockquote><h3 id="cat-查看文件内容">cat 查看文件内容</h3><p>cat（英文全拼：concatenate）命令用于连接文件并打印到标准输出设备上。<strong>由第一行开始显示文件内容</strong>。</p><p>📌<strong>cat命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-A</code>：<code>--show-all</code>：<code>-vET</code></td><td>相当于 -vET 选项的整合，用于列出所有隐藏符号；</td></tr><tr><td><code>-E</code>：<code>--show-ends</code></td><td>列出每行结尾的回车符 $；</td></tr><tr><td><font style="color:red;"><code>-n</code></font>：<code>--number</code></td><td>对输出的所有行进行编号；</td></tr><tr><td><code>-b</code>：<code>--number-nonblank</code></td><td>同 -n 不同，此选项表示只对非空行进行编号。</td></tr><tr><td><code>-T</code>：<code>--show-tabs</code></td><td>把 Tab 键 ^I 显示出来；</td></tr><tr><td><code>-V</code></td><td>列出特殊字符；</td></tr><tr><td><code>-s</code>：<code>--squeeze-blank</code></td><td>当遇到有连续 2 行以上的空白行时，就替换为 1 行的空白行。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>把 textfile1 的文档内容加上行号后输入 textfile2 这个文档里：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat -n textfile1 &gt; textfile2</span><br></pre></td></tr></table></figure></li><li><p>把 textfile1 和 textfile2 的文档内容加上行号（空白行不加）之后将内容附加到 textfile3 文档里：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat -b textfile1 textfile2 &gt;&gt; textfile3</span><br></pre></td></tr></table></figure></li><li><p>清空 /etc/test.txt 文档内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /dev/null &gt; /etc/test.txt</span><br></pre></td></tr></table></figure></li><li><p>cat 也可以用来制作镜像文件。例如要制作软盘的镜像文件，将软盘放好后输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /dev/fd0 &gt; OUTFILE</span><br></pre></td></tr></table></figure><p>相反的，如果想把 image file 写到软盘，输入：(通常用制作开机磁片)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat IMG_FILE &gt; /dev/fd0</span><br></pre></td></tr></table></figure><blockquote><ul><li><p>OUTFILE 指输出的镜像文件名。</p></li><li><p>IMG_FILE 指镜像文件。</p></li><li><p>若从镜像文件写回 device 时，device 容量需与相当。</p></li></ul></blockquote></li></ol><h3 id="tac-倒序查看文件内容">tac 倒序查看文件内容</h3><p>tac 命令用于按相反顺序逐行连接和打印文件内容。和 cat 命令一样，将每个文件连接到标准输出，但顺序相反，逐行打印，首先打印最后一行。<strong>从最后一行开始显示</strong>。</p><p>📌<strong>tac命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tac</span> [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-b</td><td>在行前而非行尾添加分隔标志；</td></tr><tr><td>-r</td><td>将分隔标志视作正则表达式来解析；</td></tr><tr><td>-s</td><td>使用指定字符串代替换行作为分隔标志。</td></tr></tbody></table><h3 id="nl-计算文件的行号">nl 计算文件的行号</h3><p>nl（英文全拼：number of lines）<code>nl</code>可以将输出的文件自动加上行号。其默认的结果与<code>cat -n</code>有点不太一样,<code>nl</code>可以自定义行号显示效果,包括位数和自动补全0。</p><p>📌<strong>nl命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-b</td><td>指定行号指定的方式，主要有两种<br />      -b a ：表示无论是否为空行，也同样列出行号(类似 cat -n)<br />      -b t：表示有空行，空的那一行不要列出行号(默认值)；</td></tr><tr><td>-n</td><td>列出行号表示的方法，主要有三种<br />      -n ln ：行号在萤幕的最左方显示；<br />      -n rn ：行号在自己栏位的最右方显示，且不加 0 ；<br />      -n rz ：行号在自己栏位的最右方显示，且加 0 ；</td></tr><tr><td>-w</td><td>行号栏位的占用的位数；</td></tr><tr><td>-p</td><td>在逻辑定界符处不重新开始计算。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>输出如下(文件中有空白行)：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># nl log2018.log</span></span><br><span class="line">     12018-01</span><br><span class="line">     22018-02</span><br><span class="line">     32018-03</span><br><span class="line">     42018-04</span><br><span class="line"> </span><br><span class="line">     52018-05</span><br><span class="line">     62018-06</span><br><span class="line">     72018-07</span><br><span class="line">     82018-08</span><br><span class="line">     92018-09</span><br><span class="line">    102018-10</span><br></pre></td></tr></table></figure><p>说明：文件中的空白行，nl 不会加上行号。</p></li><li><p>用 nl 列出 log2018.log 的内容，空白行也加上行号</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># nl -b a log2018.log</span></span><br><span class="line">     12018-01</span><br><span class="line">     22018-02</span><br><span class="line">     32018-03</span><br><span class="line">     42018-04</span><br><span class="line">     5</span><br><span class="line">     6</span><br><span class="line">     72018-05</span><br><span class="line">     82018-06</span><br><span class="line">     92018-07</span><br><span class="line">    102018-08</span><br><span class="line">    112018-09</span><br><span class="line">    122018-10</span><br></pre></td></tr></table></figure></li></ol><h3 id="more-文件内容分屏查看器">more 文件内容分屏查看器</h3><p>Linux more 命令类似 cat ，不过会以一页一页的形式显示，更方便使用者逐页阅读，而最基本的指令就是按空白键（space）就往下一页显示，按 b 键就会往回（back）一页显示，而且还有搜寻字串的功能（与 vi 相似），使用中的说明文件，请按 h 。</p><p>📌<strong>more命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>+n</td><td>从笫n行开始显示</td></tr><tr><td>-n</td><td>定义屏幕显示n行为一屏</td></tr><tr><td>+/字符串</td><td>在每个档案显示前搜寻该字串，然后从该字串前两行之后开始显示</td></tr><tr><td>-c</td><td>先清屏，然后显示要查看的文件或日志内容</td></tr><tr><td>-d</td><td>在显示内空中添加提示 “Press space to continue，’q’ to quit(按空格键继续，按q键退出)”，禁用响铃功能</td></tr><tr><td>-p</td><td>通过清除窗口而不是滚屏来对文件进行换页，与-c选项相似</td></tr><tr><td>-s</td><td>把连续的多个空行显示为一行</td></tr><tr><td>-u</td><td>把文件内容中的下画线去掉</td></tr></tbody></table><p>📌<strong>操作命令</strong>：</p><table><thead><tr><th>按键</th><th>说明</th></tr></thead><tbody><tr><td>Enter</td><td>向下n行。默认为1行；</td></tr><tr><td>F键 [空格键]</td><td>向下滚动一屏；</td></tr><tr><td>Ctrl+b键</td><td>返回上一屏，不过这动作只对文件有用，对管线无用；</td></tr><tr><td>/字串</td><td>代表在这个显示的内容当中，向下搜寻『字串』这个关键字；</td></tr><tr><td>=</td><td>输出当前行的行号；</td></tr><tr><td>V键</td><td>在使用more查看时，使用v调用vi编辑器；</td></tr><tr><td>!命令</td><td>调用Shell，并执行命令；</td></tr><tr><td>q</td><td>退出more。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># more /etc/man_db.config </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Generated automatically from man.conf.in by the</span></span><br><span class="line"><span class="comment"># configure script.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># man.conf from man-1.6d</span></span><br><span class="line">....(中间省略)....</span><br><span class="line">--More--(28%)  &lt;== 光标在这里等待命令</span><br></pre></td></tr></table></figure><h3 id="less-分屏显示文件内容">less 分屏显示文件内容</h3><p>Linux 中的 less 命令主要用来浏览文件内容，与 more 命令的用法相似，不同于 more 命令的是，less 命令可往回卷动浏览以看过的部分。less 的用法比起 more 更加的有弹性。在 more 的时候,我们并没有办法向前面翻,只能往后面看，但若使用了 less 时，就可以使用 <code>［pageup］</code> <code>［pagedown]</code>等按键的功能来往前往后翻看文件，更容易用来查看一个文件的内容！除此之外，在 less 里头可以拥有更多的搜索功能，不止可以向下搜，也可以向上搜。</p><p>📌<strong>less命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-N</td><td>显示每行的行号。</td></tr><tr><td>-S</td><td>行过长时将超出部分舍弃。</td></tr><tr><td>-e</td><td>当文件显示结束后，自动离开。</td></tr><tr><td>-g</td><td>只标志最后搜索到的关键同。</td></tr><tr><td>-Q</td><td>不使用警告音。</td></tr><tr><td>-i</td><td>忽略搜索时的大小写。</td></tr><tr><td>-m</td><td>显示类似 more 命令的百分比。</td></tr><tr><td>-f</td><td>强迫打开特殊文件，比如外围设备代号、目录和二进制文件。</td></tr><tr><td>-s</td><td>显示连续空行为一行。</td></tr><tr><td>-b &lt;缓冲区大小&gt;</td><td>设置缓冲区的大小。</td></tr><tr><td>-o &lt;文件名&gt;</td><td>将 less 输出的内容保存到指定文件中。</td></tr><tr><td>-x &lt;数字&gt;</td><td>将【Tab】键显示为规定的数字空格。</td></tr></tbody></table><p>📌<strong>操作命令</strong>：</p><table><thead><tr><th>交互指令</th><th>功能</th></tr></thead><tbody><tr><td><font style="color:red;">/字符串</font></td><td>向下搜索“字符串”的功能。</td></tr><tr><td><font style="color:red;">?字符串</font></td><td>向上搜索“字符串”的功能。</td></tr><tr><td><font style="color:red;">n</font></td><td>重复*前一个搜索（与 / 成 ? 有关）。</td></tr><tr><td><font style="color:red;">N</font></td><td>反向重复前一个搜索（与 / 或 ? 有关）。</td></tr><tr><td>b</td><td>向上移动一页。</td></tr><tr><td>d</td><td>向下移动半页。</td></tr><tr><td>h 或 H</td><td>显示帮助界面。</td></tr><tr><td>q 或 Q</td><td>退出 less 命令。</td></tr><tr><td>y</td><td>向上移动一行。</td></tr><tr><td>回车键</td><td>向下移动一行。</td></tr><tr><td><font style="color:red;"><code>[space]</code>或 [PgDn] 键</font></td><td>向下移动一页。</td></tr><tr><td><font style="color:red;">[PgUp] 键</font></td><td>向上移动一页。</td></tr><tr><td>Ctrl+f</td><td>向下移动一页。</td></tr><tr><td>Ctrl+b</td><td>向上移动一页。</td></tr><tr><td>Ctrl+d</td><td>向下移动一页。</td></tr><tr><td>Ctrl+u</td><td>向上移动半页。</td></tr><tr><td>j</td><td>向下移动一行。</td></tr><tr><td>k</td><td>向上移动一行。</td></tr><tr><td>G</td><td>移动至最后一行。</td></tr><tr><td>g</td><td>移动到第一行。</td></tr><tr><td>v</td><td>使用配置的编辑器编辑当前文件。</td></tr><tr><td>[</td><td>移动到本文档的上一个节点。</td></tr><tr><td>]</td><td>移动到本文档的下一个节点。</td></tr><tr><td>p</td><td>移动到同级的上一个节点。</td></tr><tr><td><font style="color:red;">q 或 ZZ</font></td><td>离开 less 这个程序。</td></tr><tr><td>u</td><td>向上移动半页。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>显示已有进程信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ps -ef | less</span></span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 2月16 ?       00:00:01 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root          2      0  0 2月16 ?       00:00:00 [kthreadd]</span><br><span class="line">root          4      2  0 2月16 ?       00:00:00 [kworker/0:0H]</span><br><span class="line">...忽略部分数据...</span><br><span class="line">root         15      2  0 2月16 ?       00:00:00 [khungtaskd]</span><br><span class="line">root         16      2  0 2月16 ?       00:00:00 [writeback]</span><br><span class="line">root         17      2  0 2月16 ?       00:00:00 [kintegrityd]</span><br><span class="line">root         18      2  0 2月16 ?       00:00:00 [bioset]</span><br><span class="line">:</span><br></pre></td></tr></table></figure><h3 id="head-输出文件头部内容">head 输出文件头部内容</h3><p>head 命令可用于查看文件的开头部分的内容。</p><p>📌<strong>head命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">head</span> [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-c 字节数</code></td><td>显示的字节数</td></tr><tr><td><font style="color:red;"><code>-n 行数</code></font></td><td>显示前x行</td></tr><tr><td><code>-q</code></td><td>隐藏文件名</td></tr><tr><td><code>-v</code></td><td>显示文件名</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>默认为显示前10行文件内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># head /etc/yum.conf </span></span><br><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line">keepcache=0</span><br><span class="line">debuglevel=2</span><br><span class="line">logfile=/var/log/yum.log</span><br><span class="line">exactarch=1</span><br><span class="line">obsoletes=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">plugins=1</span><br><span class="line">installonly_limit=5</span><br></pre></td></tr></table></figure><h3 id="tail-输出文件尾部内容">tail 输出文件尾部内容</h3><p>tail 命令可用于查看文件尾部的内容。</p><p>📌<strong>tail命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> [-options] fileName</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><font style="color:red;"><code>-f</code></font></td><td>循环读取，持续侦测后面所接的档名，要等到按下[ctrl]-c才会结束tail的侦测</td></tr><tr><td><code>-q</code></td><td>不显示处理信息</td></tr><tr><td><code>-v</code></td><td>显示详细的处理信息</td></tr><tr><td><code>-c 数目</code></td><td>显示的字节数</td></tr><tr><td><font style="color:red;"><code>-n 行数</code></font></td><td>显示文件的尾部 n 行内容</td></tr><tr><td><code>--pid=PID </code></td><td>与-f合用,表示在进程ID,PID死掉之后结束</td></tr><tr><td><code>-q</code>：<code>--quiet</code>：<code>--silent</code></td><td>从不输出给出文件名的首部</td></tr><tr><td><code>-s</code>：<code>--sleep-interval=S</code></td><td>与-f合用,表示在每次反复的间隔休眠S秒</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>用管道符号查看历史命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># tail -f | history</span></span><br><span class="line">  ...省略部分数据...</span><br><span class="line">  430  <span class="built_in">tail</span> <span class="built_in">test</span></span><br><span class="line">  431  ps -ef | less</span><br><span class="line">  432  <span class="built_in">head</span> /etc/yum.conf </span><br><span class="line">  433  <span class="built_in">tail</span> <span class="built_in">history</span></span><br><span class="line">  434   ~/.bash_history</span><br><span class="line">  435  <span class="built_in">tail</span>| <span class="built_in">history</span></span><br><span class="line"><span class="built_in">tail</span>: 警告：无限期跟随标准输入是无用的</span><br></pre></td></tr></table></figure></li><li><p>默认为显示后10行文件内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># tail /etc/yum.conf </span></span><br><span class="line"><span class="comment"># download the new metadata and &quot;pay&quot; for it by yum not having correct</span></span><br><span class="line"><span class="comment"># information.</span></span><br><span class="line"><span class="comment">#  It is esp. important, to have correct metadata, for distributions like</span></span><br><span class="line"><span class="comment"># Fedora which don&#x27;t keep old packages around. If you don&#x27;t like this checking</span></span><br><span class="line"><span class="comment"># interupting your command line usage, it&#x27;s much better to have something</span></span><br><span class="line"><span class="comment"># manually check the metadata once an hour (yum-updatesd will do this).</span></span><br><span class="line"><span class="comment"># metadata_expire=90m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PUT YOUR REPOS HERE OR IN separate files named file.repo</span></span><br><span class="line"><span class="comment"># in /etc/yum.repos.d</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="wc-字数统计">wc 字数统计</h3><p>wc（word count）命令用于统计文件字节、字符、单词与行的数量。</p><p>📌<strong>wc命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> [-options] [file]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c, --bytes</td><td>仅显示字节数</td></tr><tr><td>-m, --chars</td><td>仅显示字符数</td></tr><tr><td>-l, --lines</td><td>仅显示行数</td></tr><tr><td>–files0-from=F</td><td>从文件 F 中获取以 NULL 字符结尾的文件名作为输入，如果 F 等于连字符 -，则从标准输入读取</td></tr><tr><td>-L, --max-line-length</td><td>显示文件中最长行的字符数</td></tr><tr><td>-w, --words</td><td>显示单词数，单词以空格分隔</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>使用 wc 统计 <code>/etc/passwd</code> 行数、单词数和字节数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># wc /etc/passwd</span></span><br><span class="line">40   45 1719 /etc/passwd</span><br><span class="line"><span class="comment"># 40 是行数，45 是单词数，1719 是字节数。</span></span><br></pre></td></tr></table></figure></li><li><p>从文件读取输入文件名。如果有多个文件名，并且希望 wc 从一个文件中读取它们，那么使用 -files0-from 选项。这里将文件名称必须以 NULL 字符结束写在文件fileNames.txt 中。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> --files0-from=fileNames.txt</span><br></pre></td></tr></table></figure><p>在 <a href="https://so.csdn.net/so/search?q=vim&amp;spm=1001.2101.3001.7020">vim</a> 中输入 NULL 字符，可以通过 digraph 输入，具体操作步骤是：在输入模式按一下Ctrl+k，然后输入NU。</p></li></ol><h3 id="sort-排序">sort 排序</h3><p>sort命令将文件/文本的每一行作为一个单位，相互比较，比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。</p><p>📌<strong>sort命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> [-options] [file]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-b</td><td>忽略每行前面开始出的空格字符；</td></tr><tr><td>-c</td><td>检查文件是否已经按照顺序排序；</td></tr><tr><td>-d</td><td>排序时，处理英文字母、数字及空格字符外，忽略其他的字符；</td></tr><tr><td>-f</td><td>排序时，将小写字母视为大写字母；</td></tr><tr><td>-i</td><td>排序时，除了040至176之间的ASCII字符外，忽略其他的字符；</td></tr><tr><td>-m</td><td>将几个排序号的文件进行合并；</td></tr><tr><td>-M</td><td>将前面3个字母依照月份的缩写进行排序；</td></tr><tr><td>-n</td><td>依照数值的大小排序；</td></tr><tr><td><code>-o&lt;输出文件&gt;</code></td><td>将排序后的结果存入制定的文件；</td></tr><tr><td>-r</td><td>以相反的顺序来排序；</td></tr><tr><td><code>-t&lt;分隔字符&gt;</code></td><td>指定排序时所用的栏位分隔字符；</td></tr><tr><td><code>+&lt;起始栏位&gt;-&lt;结束栏位&gt;</code></td><td>以指定的栏位来排序，范围由起始栏位到结束栏位的前一栏位。</td></tr></tbody></table><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一些用法</span></span><br><span class="line"><span class="built_in">sort</span> -rnk2 <span class="comment">#k在第二列；n以数字；r大小逆序排列</span></span><br></pre></td></tr></table></figure><h3 id="uniq-去重">uniq 去重</h3><p>uniq命令用于报告或忽略文件中的重复行，一般与sort命令结合使用。</p><p>📌<strong>uniq命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uniq</span> [-options] [file]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-c或–count</td><td>在每列旁边显示该行重复出现的次数；</td></tr><tr><td>-d或–repeated</td><td>仅显示重复出现的行列；</td></tr><tr><td><code>-f&lt;栏位&gt;</code>或<code>--skip-fields=&lt;栏位&gt;</code></td><td>忽略比较指定的栏位；</td></tr><tr><td><code>-s&lt;字符位置&gt;</code>或<code>--skip-chars=&lt;字符位置&gt;</code></td><td>忽略比较指定的字符；</td></tr><tr><td>-u或–unique：</td><td>仅显示出一次的行列；</td></tr><tr><td><code>-w&lt;字符位置&gt;</code>或<code>--check-chars=&lt;字符位置&gt;</code></td><td>指定要比较的字符。</td></tr></tbody></table><h3 id="tee-将数据重定向到文件">tee 将数据重定向到文件</h3><p>tee命令用于将数据重定向到文件，另一方面还可以提供一份重定向数据的副本作为后续命令的 stdin 。简单的说就是把数据重定向到给定文件和屏幕上。</p><p>存在缓存机制，每1024个字节将输出一次。若从管道接收输入数据，应该是缓冲区满，才将数据转存到指定的文件中。若文件内容不到1024个字节，则接收完从标准输入设备读入的数据后，将刷新一次缓冲区，并转存数据到指定文件。</p><p>📌<strong>tee命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> [-options] [file]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>向文件中重定向时使用追加模式；</td></tr><tr><td>-i</td><td>忽略中断（interrupt）信号。</td></tr></tbody></table><h3 id="join-文件按行连接">join 文件按行连接</h3><p>join的连接操作简言之就是将两个具有相同域的纪录给挑选出来，再将这些纪录所有的域放到一行。</p><p>注意：join在对两个文件进行连接时，两个文件必须都是按照连接域排好序的，按其他域排序是无效的。</p><p>📌<strong>join命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">join</span> [-options] file1 file2</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a1或-a2</td><td>除了显示共同域的纪录之外，-a1显示第一个文件没有共同域的纪录，-a2显示第二个文件中没有共同域的纪录</td></tr><tr><td>-i</td><td>忽略大小写</td></tr><tr><td>-o</td><td>设置结果显示的格式</td></tr><tr><td>-t</td><td>改变域的分隔符</td></tr><tr><td>-v1或-v2</td><td>不显示共同域的纪录之外，-v1显示第一个文件没有共同域的纪录，-v2显示第二个文件中没有共同域的纪录</td></tr><tr><td>-1或-2</td><td>-1用来设置文件1连接的域，-2用来设置文件2连接的域</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>将两个文件的具有共同域的纪录连接在一起：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# cat file.db </span><br><span class="line"> A li:20:men:anhui</span><br><span class="line"> B wang:21:women:jiangsu</span><br><span class="line"> C zhang:22:men:anhui</span><br><span class="line"> D liu:23:women:Shanghai</span><br><span class="line"> E chen:23:women:Hefei</span><br><span class="line">[root@coonote ~]# cat file_hobby.db </span><br><span class="line"> A li:Song</span><br><span class="line"> B wang:shopping</span><br><span class="line"> C zhang:pingpong</span><br><span class="line"> D liu:chess</span><br><span class="line"> E Wang:reading</span><br><span class="line">[root@coonote ~]# join -t: file.db file_hobby.db </span><br><span class="line"> A li:20:men:anhui:Song</span><br><span class="line"> B wang:21:women:jiangsu:shopping</span><br><span class="line"> C zhang:22:men:anhui:pingpong</span><br><span class="line"> D liu:23:women:Shanghai:chess</span><br></pre></td></tr></table></figure><p>-a1还显示第一个文件中没有共同域的纪录，-a2则显示第二个：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# join -t: -a1 file.db file_hobby.db</span><br><span class="line"> A li:20:men:anhui:Song</span><br><span class="line"> B wang:21:women:jiangsu:shopping</span><br><span class="line"> C zhang:22:men:anhui:pingpong</span><br><span class="line"> D liu:23:women:Shanghai:chess</span><br><span class="line"> E chen:23:women:Hefei</span><br><span class="line">[root@coonote ~]# join -t: -a2 file.db file_hobby.db</span><br><span class="line"> A li:20:men:anhui:Song</span><br><span class="line"> B wang:21:women:jiangsu:shopping</span><br><span class="line"> C zhang:22:men:anhui:pingpong</span><br><span class="line"> D liu:23:women:Shanghai:chess</span><br><span class="line"> E Wang:reading</span><br></pre></td></tr></table></figure><p>设置指定格式的域来显示出来（将具有共同纪录的域按照姓名+性别+爱好的格式显示出来）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# join -t: -o1.1 1.3 2.2 file.db file_hobby.db </span><br><span class="line"> A li:men:Song</span><br><span class="line"> B wang:women:shopping</span><br><span class="line"> C zhang:men:pingpong</span><br><span class="line"> D liu:women:chess</span><br></pre></td></tr></table></figure><h3 id="paste-将多个文件对应行链接在一起">paste 将多个文件对应行链接在一起</h3><p>paste命令会把每个文件以列对列的方式，一列列地加以合并 ，他就是相当于把两个不同的文件内容粘贴在一起，形成新的文件。</p><p>注意：paste默认粘贴方式以列的方式粘贴，但是并不是不能以行的方式粘贴，加上-s选项就可以行方式粘贴。</p><p>📌<strong>paste命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">paste</span> [-options] file1 file2</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-d</td><td>默认域的分隔符是空格或tab键，设置新的域分隔符</td></tr><tr><td>-s</td><td>将每个文件粘贴成一行</td></tr><tr><td>–</td><td>从标准输入中读取数据</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>将file_2和file_2粘贴成一个新的文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# cat file_1</span><br><span class="line"> aaa </span><br><span class="line"> bbb</span><br><span class="line"> ccc</span><br><span class="line"> ddd</span><br><span class="line"> eee</span><br><span class="line">[root@coonote ~]# cat file_2</span><br><span class="line"> AAA</span><br><span class="line"> BBB</span><br><span class="line"> CCC</span><br><span class="line"> DDD</span><br><span class="line"> EEE</span><br><span class="line">[root@coonote ~]# paste file_1 file_2</span><br><span class="line"> aaa     AAA</span><br><span class="line"> bbb    BBB</span><br><span class="line"> ccc    CCC</span><br><span class="line"> ddd    DDD</span><br><span class="line"> eee    EEE</span><br></pre></td></tr></table></figure><p>设置域分隔符为：粘贴成新的文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# paste -d: file_1 file_2</span><br><span class="line"> aaa:AAA</span><br><span class="line"> bbb:BBB</span><br><span class="line"> ccc:CCC</span><br><span class="line"> ddd:DDD</span><br><span class="line"> eee:EEE</span><br></pre></td></tr></table></figure><p>将每个文件粘贴成一行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# cat file_1</span><br><span class="line"> aaa</span><br><span class="line"> bbb</span><br><span class="line"> ccc</span><br><span class="line"> ddd</span><br><span class="line"> eee</span><br><span class="line">[root@coonote ~]# cat file_2</span><br><span class="line"> AAA</span><br><span class="line"> BBB</span><br><span class="line"> CCC</span><br><span class="line"> DDD</span><br><span class="line"> EEE</span><br><span class="line">[root@coonote ~]# paste -d: -s file_1 file_2</span><br><span class="line"> aaa:bbb:ccc:ddd:eee</span><br><span class="line"> AAA:BBB:CCC:DDD:EEE</span><br></pre></td></tr></table></figure><p>从标准输入中读取数据，每行显示5个文件名：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# ls | paste -d&quot; &quot; - - - - - </span><br><span class="line"> anaconda-ks.cfg dir_1 file1 file_1 file_1.db</span><br><span class="line"> file_2 file_3 file_4 file_5 file_6</span><br><span class="line"> file.db file_hobby_1 file_hobby.db file_hobby_sort.db file_sort.db</span><br><span class="line"> initial-setup-ks.cfg testfile</span><br></pre></td></tr></table></figure><h3 id="split-文件切割">split 文件切割</h3><p>📌<strong>split命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">split</span> [-options] 要切割的文件 [输出文件名前缀]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-b&lt;字节&gt;</code>：</td><td>指定按多少字节进行拆分，也可以指定 K、M、G、T 等单位。</td></tr><tr><td><code>-&lt;行数&gt;或-l&lt;行数&gt;</code>：</td><td>指定每多少行要拆分成一个文件。</td></tr><tr><td>输出文件名前缀：</td><td>设置拆分后的文件的名称前缀，split 会自动在前缀后加上编号，默认从 aa 开始。</td></tr><tr><td><code>-a&lt;后缀长度&gt;</code>：</td><td>默认的后缀长度是 2，也就是按 aa、ab、ac 这样的格式依次编号。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>生成一个 700MB 文件来作为我们的拆分对象：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@roclinux ~]$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero bs=1024 count=700000 of=king_of_ring.avi</span><br><span class="line">700000+0 records <span class="keyword">in</span></span><br><span class="line">700000+0 records out</span><br><span class="line">716800000 bytes (717 MB) copied, 12.9189 s, 55.5 MB/s</span><br><span class="line"> </span><br><span class="line">[root@roclinux ~]$  <span class="built_in">ls</span> -l king_of_ring.avi</span><br><span class="line">-rw-r--r-- 1 root root 716800000 Apr 12 13:01 king_of_ring.avi</span><br></pre></td></tr></table></figure><p>把其中一份拆分成400M：（拆分时未指定文件名则随机生成文件名）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@roclinux ~]$ <span class="built_in">split</span> -b 400M king_of_ring.avi</span><br><span class="line"> </span><br><span class="line">[root@roclinux ~]$ <span class="built_in">ls</span> -l</span><br><span class="line">total 1400008</span><br><span class="line">-rw-r--r-- 1 root root 716800000 Apr 12 13:01 king_of_ring.avi</span><br><span class="line">-rw-r--r-- 1 root root 419430400 Apr 12 13:04 xaa</span><br><span class="line">-rw-r--r-- 1 root root 297369600 Apr 12 13:04 xab</span><br></pre></td></tr></table></figure><p>在把文件合并起来</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@roclinux ~]$ <span class="built_in">cat</span> xaa xab &gt; king_of_ring_merge.avi</span><br><span class="line"> </span><br><span class="line">[root@roclinux ~]$ <span class="built_in">ls</span> -l</span><br><span class="line">total 2100012</span><br><span class="line">-rw-r--r-- 1 root root 716800000 Apr 12 13:01 king_of_ring.avi</span><br><span class="line">-rw-r--r-- 1 root root 716800000 Apr 12 13:07 king_of_ring_merge.avi</span><br><span class="line">-rw-r--r-- 1 root root 419430400 Apr 12 13:04 xaa</span><br><span class="line">-rw-r--r-- 1 root root 297369600 Apr 12 13:04 xab</span><br></pre></td></tr></table></figure><h3 id="cut-选取部分内容">cut 选取部分内容</h3><p>cut的工作就是“剪”，具体的说就是在文件中负责剪切数据用的。cut 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段输出。</p><p>📌<strong>cut命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> [-options] filename</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-b</code></td><td>以字节为单位进行分割</td></tr><tr><td><code>-c</code></td><td>以字符 (characters) 的单位取出固定字符区间</td></tr><tr><td><font style="color:red;"><code>-d</code></font></td><td>分隔符，按照指定分隔符分割列。与 -f 一起使用</td></tr><tr><td><font style="color:red;"><code>-f</code></font></td><td>依据 -d 的分隔字符将一段信息分割成为数段，用 -f 取出第几段的意思（列号，提取第几列）</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ul><li><p><strong>准备数据</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim cut.txt</span></span><br><span class="line">dong shen</span><br><span class="line">guan zhen</span><br><span class="line">wo  wo</span><br><span class="line">lai  lai</span><br><span class="line">le  le</span><br></pre></td></tr></table></figure></li></ul><ol><li><p>切割cut.txt第一列</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cut -d &#x27; &#x27; -f 1 cut.txt </span></span><br><span class="line">dong</span><br><span class="line">guan</span><br><span class="line">wo</span><br><span class="line">lai</span><br><span class="line">le</span><br></pre></td></tr></table></figure></li><li><p>切割cut.txt第二、三列</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cut -d &#x27; &#x27; -f 2,3 cut.txt </span></span><br><span class="line">shen</span><br><span class="line">zhen</span><br><span class="line"> wo</span><br><span class="line"> lai</span><br><span class="line"> le</span><br></pre></td></tr></table></figure></li><li><p>切割cut.txt的第5-8个字符</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cut -c 5-8 cut.txt </span></span><br><span class="line"> she</span><br><span class="line"> zhe</span><br><span class="line">wo</span><br><span class="line"> lai</span><br><span class="line">le</span><br></pre></td></tr></table></figure></li><li><p>切割cut.txt的第2,4,6个字节</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cut -b 2,4,6 cut.txt </span></span><br><span class="line">ogs</span><br><span class="line">unz</span><br><span class="line">o o</span><br><span class="line">a l</span><br><span class="line">e e</span><br></pre></td></tr></table></figure></li></ol><h3 id="tr-对标准输入内容做替换">tr 对标准输入内容做替换</h3><p>tr (translate的简写)，主要用于压缩重复字符，主要用于将从标准输入(<code>stdin</code>)读取的数据进行结果集映射、字符压缩和字符删除。它首先会将读取的标准输入进行排序然后按照某种方式换行，然后再根据给出的命令行参数做相关处理。</p><p>📌<strong>tr命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tr</span> [options] [SET1] [SET2]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-c</code></td><td>使用SET1的补集</td></tr><tr><td><code>-d</code></td><td>删除字符</td></tr><tr><td><code>-s</code></td><td>压缩字符</td></tr><tr><td><code>-t</code></td><td>截断SET1，使得SET1的长度和SET2的长度相同</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>将输入的字符由大写转换成小写</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;HELLO&quot; | tr &#x27;A-Z&#x27; &#x27;a-z&#x27;</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure></li><li><p>ROT13 加解密 原理 就是两边都对称 所以加解密可以用一套相同的集合</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;hello&quot; | tr &#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27; \</span></span><br><span class="line">&gt; <span class="string">&#x27;NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm&#x27;</span></span><br><span class="line">uryyb</span><br></pre></td></tr></table></figure></li><li><p>删除指定字符</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;hello 123 world 234&quot; | tr -d &#x27;0-9&#x27;</span></span><br><span class="line">hello  world </span><br></pre></td></tr></table></figure></li><li><p>字符集补偿（删除补集）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo hello 1 char 2 next 4 | tr -d -c &#x27;0-9 \n&#x27;</span></span><br><span class="line"> 1  2  4</span><br></pre></td></tr></table></figure></li><li><p>压缩字符(压缩输入中重复的字符)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;tr    is    a   shell   order   &quot; | tr -s &#x27; &#x27;</span></span><br><span class="line"><span class="built_in">tr</span> is a shell order </span><br></pre></td></tr></table></figure></li><li><p>字符类</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo acniu | tr &#x27;[:lower:]&#x27; &#x27;[:upper:]&#x27;</span></span><br><span class="line">ACENIU</span><br></pre></td></tr></table></figure><table><thead><tr><th>字符类</th><th>说明</th></tr></thead><tbody><tr><td><code>[:digit:]</code></td><td>所有数字</td></tr><tr><td><code>[:lower:]</code></td><td>所有小写字符</td></tr><tr><td><code>[:upper:]</code></td><td>所有大写字符</td></tr><tr><td><code>[:graph:]</code></td><td>所有可打印字符，不包括空格</td></tr><tr><td><code>[:print:]</code></td><td>所有可打印字符，包括空格</td></tr><tr><td><code>[:punct:]</code></td><td>所有的标点字符</td></tr><tr><td><code>[:space:]</code></td><td>所有横向或者纵向的空白</td></tr></tbody></table></li></ol><h3 id="输出重定向">&gt; 输出重定向</h3><p>可将本应显示在终端上的内容保存到指定文件中。</p><p><code>&gt;</code> 覆盖，会覆盖目标的原有内容，当文件存在时，会先删除原文件，再重新创建文件，然后把内容写入该文件，若文件不存在，则创建文件。</p><p><code>&gt;&gt;</code> 追加，会在目标原有内容后追加内容，当文件存在时直接在文件末尾进行内容追加，不会删除原文件，否则直接创建文件。</p><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表的内容写入文件 test.txt 中 （覆盖写）</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -l &gt; test.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表的内容追加到文本 test.txt 的末尾</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls -al &gt;&gt; test.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;：就是标准输入重定向（等同0&lt;），意思将某某文件作为程序输入，也就是从某文件读取而不是键盘。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># command &lt; file</span></span><br></pre></td></tr></table></figure><h3 id="用文本模式指定行区间-管道符">| 用文本模式指定行区间 管道符</h3><p>管道是一种通信机制，通常用于进程间的通信。它表现出来的形式将<strong>前面每一个进程的输出（stdout）直接作为下一个进程的输入（stdin）</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/ad572909f7df4a43a732b1b8ccdf5d6a.png" alt="|"></p><p>📌<strong>示例说明</strong>：</p><p>过滤功能：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls / | grep &quot;y&quot;</span><br><span class="line">mydata</span><br><span class="line">sys</span><br></pre></td></tr></table></figure><p>针对上面这个命令说明：以管道作为分界线，前面的命令有个输出，后面需要先输入（缺少查找范围），然后再过滤，最后再输出，通俗的讲就是管道前面的输出就是后面指令的输入。</p><p>为了便于理解，上述的指令变相实现可以如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> / &gt; xxx.txt<span class="comment"># 将ls /的结果保存到xxx.txt文件中</span></span><br><span class="line">grep <span class="string">&quot;y&quot;</span> xxx.txt<span class="comment"># 使用grep指令搜索xxx.txt中的包含y的行</span></span><br></pre></td></tr></table></figure><h3 id="xargs-参数代换">xargs 参数代换</h3><p>管道实现的是将前面的输出<code>stdout</code>作为后面的输入<code>stdin</code>，但是有些命令不接受管道的传递方式。例如：<code>ls</code>，这是为什么呢？</p><p>因为有些命令希望管道传递过来的是参数，但是**直接使用管道有时无法传递到命令的参数位。**这时候就需要<code>xargs</code>，<code>xargs</code>实现的是将管道传递过来的<code>stdin</code>进行处理然后传递到命令的参数位置上。</p><p>📌<strong>xargs命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">somecommand |xargs [-options]  <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>后跟文件名；</td></tr><tr><td>-n</td><td>指定要传递给命令的参数个数；</td></tr><tr><td>-t</td><td>在执行之前先打印；</td></tr><tr><td>-i或者-I</td><td>自定义一个传递参数符号；</td></tr><tr><td>-d或者–delimiter</td><td>设置自定义分隔符。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p><strong>xargs与find一起使用</strong></p><p>之所以能用到这个命令，关键是由于很多命令不支持|管道来传递参数，而日常工作中有这个需要，所以就有了 xargs 命令。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name <span class="string">&quot;*.conf&quot;</span> | <span class="built_in">ls</span> -l<span class="comment"># (错误)</span></span><br><span class="line">find /etc -name <span class="string">&quot;*.conf&quot;</span> | xargs <span class="built_in">ls</span> -l<span class="comment"># (正确)</span></span><br></pre></td></tr></table></figure><blockquote><p>xargs 可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。<br>xargs 也可以将单行或多行文本输入转换为其他格式，例如多行变单行，单行变多行。<br>xargs 默认的命令是 echo，这意味着通过管道传递给 xargs 的输入将会包含换行和空白，不过通过 xargs 的处理，换行和空白将被空格取代。<br>xargs 是一个强有力的命令，它能够捕获一个命令的输出，然后传递给另外一个命令。</p></blockquote></li><li><p>我们用管道符传输到xargs，并为每个参数运行touch命令，-t表示在执行之前先打印，创建三个文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;file1 file2 file3&quot;|xargs -t touch</span></span><br><span class="line"><span class="built_in">touch</span> file1 file2 file3</span><br></pre></td></tr></table></figure></li><li><p>限制参数的数量</p><p>默认情况下，传递给命令的参数数量由系统限制决定。-n选项指定要传递给命令的参数个数。xargs根据需要多次运行指定的命令，直到所有参数都用完为止。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;file1 file2 file3&quot;|xargs -n1 -t touch</span></span><br><span class="line"><span class="built_in">touch</span> file1 </span><br><span class="line"><span class="built_in">touch</span> file2 </span><br><span class="line"><span class="built_in">touch</span> file3</span><br></pre></td></tr></table></figure></li><li><p>运行多个命令</p><p>要使用xargs运行多个命令，请使用-i或者-I选项。在-i或者-I后面自定义一个传递参数符号，所有匹配的项都会替换为传递给xargs的参数。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo &quot;file1 file2 file3&quot;|xargs -t -I % sh -c &#x27;touch %;ls -l %&#x27;</span></span><br><span class="line">sh -c <span class="built_in">touch</span> file1 file2 file3;<span class="built_in">ls</span> -l file1 file2 file3 </span><br><span class="line">-rw-r--r--. 1 root root 0 Jan 30 00:18 file1</span><br><span class="line">-rw-r--r--. 1 root root 0 Jan 30 00:18 file2</span><br><span class="line">-rw-r--r--. 1 root root 0 Jan 30 00:18 file3</span><br></pre></td></tr></table></figure></li><li><p>指定一个分隔符</p><p>使用-d或者–delimiter选项设置自定义分隔符，可以是单个字符，也可以是以\ 开头的转义字符。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># echo -n file1#file2#file3#file4|xargs -d \# -t touch</span></span><br><span class="line"><span class="built_in">touch</span> file1 file2 file3 file4</span><br></pre></td></tr></table></figure></li><li><p>从文件中读取条目</p><p>xargs命令还可以从文件读取条目，而不是从标准输入读取条目。使用-a选项，后跟文件名。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat ip.txt </span></span><br><span class="line">114.114.114.114</span><br><span class="line">www.linuxprobe.com</span><br><span class="line">202.102.128.68</span><br><span class="line">[root@localhost ~]<span class="comment"># xargs -a ip.txt -t -L 1 ping -c 1</span></span><br><span class="line">ping -c 1 114.114.114.114 </span><br><span class="line">PING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.</span><br><span class="line">64 bytes from 114.114.114.114: icmp_seq=1 ttl=93 time=11.0 ms</span><br><span class="line"></span><br><span class="line">--- 114.114.114.114 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 11.026/11.026/11.026/0.000 ms</span><br><span class="line">ping -c 1 www.linuxprobe.com </span><br><span class="line">PING www.linuxprobe.com.w.kunlunno.com (221.15.65.202) 56(84) bytes of data.</span><br><span class="line">64 bytes from hn.kd.jz.adsl (221.15.65.202): icmp_seq=1 ttl=48 time=20.9 ms</span><br><span class="line"></span><br><span class="line">--- www.linuxprobe.com.w.kunlunno.com ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 20.934/20.934/20.934/0.000 ms</span><br><span class="line">ping -c 1 202.102.128.68 </span><br><span class="line">PING 202.102.128.68 (202.102.128.68) 56(84) bytes of data.</span><br><span class="line">64 bytes from 202.102.128.68: icmp_seq=1 ttl=83 time=8.71 ms</span><br><span class="line"></span><br><span class="line">--- 202.102.128.68 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 8.710/8.710/8.710/0.000 ms</span><br></pre></td></tr></table></figure></li></ol><h3 id="grep-行选取命令">grep 行选取命令</h3><p>Linux grep 命令用于查找文件里符合条件的字符串。</p><p>grep 命令的由来可以追溯到 UNIX 诞生的早期，在 UNIX 系统中，搜索的模式（patterns）被称为正则表达式（regular expressions），为了要彻底搜索一个文件，有的用户在要搜索的字符串前加上前缀 global（全面的），一旦找到相匹配的内容，用户就像将其输出（print）到屏幕上，而将这一系列的操作整合到一起就是 global regular expressions print，而这也就是 grep 命令的全称。</p><p>📌<strong>grep命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [-options] [patterns] filename</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-c</code>：<code>--count</code></td><td>仅列出文件中包含模式的行数。</td></tr><tr><td><code>-i</code>：<code>--ignore-case</code></td><td>忽略模式中的字母大小写。</td></tr><tr><td><code>-l</code>：<code>--file-with-matches</code></td><td>列出带有匹配行的文件名。</td></tr><tr><td><code>-n</code>：<code>--line-number</code></td><td>在每一行的最前面列出行号。</td></tr><tr><td><font style="color:red;"><code>-v</code>：<code>--invert-match</code></font></td><td>列出没有匹配模式的行。（反转）</td></tr><tr><td><code>-w</code>：<code>--word-regexp</code></td><td>把表达式当做一个完整的单字符来搜寻，忽略那些部分匹配的行。</td></tr><tr><td><font style="color:red;"><code>-r 关键字 目录</code></font></td><td>在目录下搜索关键字</td></tr></tbody></table><p>📌<strong>patterns 正则表达式的通配符</strong>：</p><table><thead><tr><th>通配符</th><th>功能</th></tr></thead><tbody><tr><td>c*</td><td>将匹配 0 个（即空白）或多个字符 c（c 为任一字符）。</td></tr><tr><td>.</td><td>将匹配任何一个字符，且只能是一个字符。</td></tr><tr><td>[xyz]</td><td>匹配方括号中的任意一个字符。</td></tr><tr><td>[^xyz]</td><td>匹配除方括号中字符外的所有字符。</td></tr><tr><td>^</td><td>锁定行的开头。</td></tr><tr><td>$</td><td>锁定行的结尾。</td></tr></tbody></table><p>⚠️ 需要注意的是，在基本正则表达式中，如通配符 *、+、{、|、( 和 )等，已经失去了它们原本的含义，而若要恢复它们原本的含义，则要在之前添加反斜杠 \，如 *、+、{、|、( 和 )。</p><h3 id="egrep-文件选取命令">egrep 文件选取命令</h3><p><strong>Linux egrep命令</strong>用于在文件内查找指定的字符串。egrep执行效果与<code>grep -E</code>相似，使用的语法及参数可参照grep指令，与grep的不同点在于解读字符串的方法。egrep是用extended regular expression语法来解读的，而grep则用basic regular expression 语法解读，extended regular expression比basic regular expression的表达更规范。</p><p>📌<strong>grep命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep [-options] [patterns] filename</span><br></pre></td></tr></table></figure><h3 id="sed">sed</h3><h3 id="awk">awk</h3><h3 id="gzip-gunzip-压缩-解压缩">gzip/gunzip 压缩/解压缩</h3><p>gzip 是 Linux 系统中经常用来对文件进行压缩和解压缩的命令，通过此命令压缩得到的新文件，其扩展名通常标记为<code>.gz</code>。</p><p>1️⃣<strong>gzip 压缩</strong></p><p><font style="color:red;">gzip 命令<strong>只能用来压缩文件</strong>，<strong>不能压缩目录</strong>。即便指定了目录，也只能压缩目录内的所有文件。</font></p><p>📌<strong>gzip命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip [-options] 源文件</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-c</code></td><td>将压缩数据输出到标准输出中，并保留源文件。</td></tr><tr><td><code>-d</code></td><td>对压缩文件进行解压缩。</td></tr><tr><td><code>-r</code></td><td>递归压缩指定目录下以及子目录下的所有文件。</td></tr><tr><td><code>-v</code></td><td>对于每个压缩和解压缩的文件，显示相应的文件名和压缩比。</td></tr><tr><td><code>-l</code></td><td>对每一个压缩文件，显示以下字段：<br />压缩文件的大小；<br />未压缩文件的大小；<br />压缩比；<br />未压缩文件的名称。</td></tr><tr><td><code>-数字</code></td><td>用于指定压缩等级，-1 压缩等级最低，压缩比最差；-9 压缩比最高。默认压缩比是 -6。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>gzip 压缩命令非常简单，甚至不需要指定压缩之后的压缩包名，只需指定源文件名即可:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# gzip install.log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩instal.log 文件</span></span><br><span class="line">[root@localhost ~]# ls</span><br><span class="line">anaconda-ks.cfg install.log.gz install.log.syslog</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩文件生成，但是源文件也消失了</span></span><br></pre></td></tr></table></figure></li><li><p>在使用 gzip 命令压缩文件时，源文件会消失，从而生成压缩文件。使用选项<code>-c</code>保留源文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# gzip -c anaconda-ks.cfg &gt;anaconda-ks.cfg.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用-c选项，但是不让压缩数据输出到屏幕上，而是重定向到压缩文件中，这样可以缩文件的同时不删除源文件</span></span><br><span class="line">[root@localhost ~]# ls</span><br><span class="line">anaconda-ks.cfg anaconda-ks.cfg.gz install.log.gz install.log.syslog</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以看到压缩文件和源文件都存在</span></span><br></pre></td></tr></table></figure></li><li><p>试试用 gzip 命令可以压缩目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir test</span><br><span class="line">[root@localhost ~]# touch test/test1</span><br><span class="line">[root@localhost ~]# touch test/test2</span><br><span class="line">[root@localhost ~]# touch test/test3 #建立测试目录，并在里面建立几个测试文件</span><br><span class="line">[root@localhost ~]# gzip -r test/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩目录，并没有报错</span></span><br><span class="line">[root@localhost ~]# ls</span><br><span class="line">anaconda-ks.cfg anaconda-ks.cfg.gz install.log.gz install.log.syslog test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">但是查看发现<span class="built_in">test</span>目录依然存在，并没有变为压缩文件</span></span><br><span class="line">[root@localhost ~]# ls test/</span><br><span class="line">testl .gz test2.gz test3.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">原来gzip命令不会打包目录，而是把目录下所有的子文件分别压缩</span></span><br></pre></td></tr></table></figure><p>在 Linux 中，打包和压缩是分开处理的。而 gzip 命令只会压缩，不能打包，所以才会出现没有打包目录，而只把目录下的文件进行压缩的情况。</p></li></ol><p>2️⃣<strong>gunzip 解压缩</strong></p><p>gunzip 是一个使用广泛的解压缩命令，它用于解压被 gzip 压缩过的文件（扩展名为 .gz）</p><p>📌<strong>gunzip命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip [-options] 文件</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-r</code></td><td>递归处理，解压缩指定目录下以及子目录下的所有文件。</td></tr><tr><td><code>-c</code></td><td>把解压缩后的文件输出到标准输出设备。</td></tr><tr><td><code>-f</code></td><td>强制解压缩文件，不理会文件是否已存在等情况。</td></tr><tr><td><code>-l</code></td><td>列出压缩文件内容。</td></tr><tr><td><code>-v</code></td><td>显示命令执行过程。</td></tr><tr><td><code>-t</code></td><td>测试压缩文件是否正常，但不对其做解压缩操作。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>直接解压缩文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# gunzip install.log.gz</span><br></pre></td></tr></table></figure></li><li><p>“gunzip -r&quot;依然只会解压缩目录下的文件，而不会解打包。要想解压缩”.gz&quot;格式，还可以使用 &quot;gzip -d&quot;命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# gunzip -r test/</span><br></pre></td></tr></table></figure></li><li><p>注意，如果我们压缩的是一个纯文本文件，则可以直接使用 zcat 命令在不解压缩的情况下查看这个文本文件中的内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# zcat anaconda-ks.cfg.gz</span><br></pre></td></tr></table></figure></li></ol><h3 id="zip-unzip-压缩-解压缩">zip/unzip 压缩/解压缩</h3><p>我们经常会在 Windows 系统上使用 “.zip”格式压缩文件，其实“.zip”格式文件是 Windows 和 Linux 系统都通用的压缩文件类型，属于几种主流的压缩格式（zip、rar等）之一，是一种相当简单的分别压缩每个文件的存储格式。</p><p>1️⃣<strong>zip 压缩</strong></p><p>zip 命令，类似于 Windows 系统中的 winzip 压缩程序。</p><p>📌<strong>zip命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip [-options] 源文件</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-r</code></td><td>递归压缩目录，及将制定目录下的所有文件以及子目录全部压缩。</td></tr><tr><td><code>-m</code></td><td>将文件压缩之后，删除原始文件，相当于把文件移到压缩文件中。</td></tr><tr><td><code>-v</code></td><td>显示详细的压缩过程信息。</td></tr><tr><td><code>-q</code></td><td>在压缩的时候不显示命令的执行过程。</td></tr><tr><td><code>-压缩级别</code></td><td>压缩级别是从 1~9 的数字，-1 代表压缩速度更快，-9 代表压缩效果更好。</td></tr><tr><td><code>-u</code></td><td>更新压缩文件，即往压缩文件中添加新文件。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>zip 命令的基本使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# zip ana.zip anaconda-ks.cfg</span><br><span class="line">adding: anaconda-ks.cfg (deflated 37%)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩</span></span><br><span class="line">[root@localhost ~]# ll ana.zip</span><br><span class="line">-rw-r--r-- 1 root root 935 6月 1716:00 ana.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩文件生成</span></span><br></pre></td></tr></table></figure><p>所有的压缩命令都可以同时压缩多个文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# zip test.zip install.log install.log.syslog</span><br><span class="line">adding: install.log (deflated 72%)</span><br><span class="line">adding: install.log.syslog (deflated 85%)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">同时压缩多个文件到test.zip压缩包中</span></span><br><span class="line">[root@localhost ~]#ll test.zip</span><br><span class="line">-rw-r--r-- 1 root root 8368 6月 1716:03 test.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩文件生成</span></span><br></pre></td></tr></table></figure></li><li><p>使用 zip 命令压缩目录，需要使用“-r”选项</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir dir1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">建立测试目录</span></span><br><span class="line">[root@localhost ~]# zip -r dir1.zip dir1</span><br><span class="line">adding: dir1/(stored 0%)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩目录</span></span><br><span class="line">[root@localhost ~]# ls -dl dir1.zip</span><br><span class="line">-rw-r--r-- 1 root root 160 6月 1716:22 dir1.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩文件生成</span></span><br></pre></td></tr></table></figure></li></ol><p>2️⃣<strong>unzip 解压缩</strong></p><p>unzip 命令可以查看和解压缩 zip 文件。</p><p>📌<strong>unzip命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip [-options] 文件</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-d 目录名</code></td><td>将压缩文件解压到指定目录下。</td></tr><tr><td><code>-n</code></td><td>解压时并不覆盖已经存在的文件。</td></tr><tr><td><code>-o</code></td><td>解压时覆盖已经存在的文件，并且无需用户确认。</td></tr><tr><td><code>-v</code></td><td>查看压缩文件的详细信息，包括压缩文件中包含的文件大小、文件名以及压缩比等，但并不做解压操作。</td></tr><tr><td><code>-t</code></td><td>测试压缩文件有无损坏，但并不解压。</td></tr><tr><td><code>-x 文件列表</code></td><td>解压文件，但不包含文件列表中指定的文件。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>不论是文件压缩包，还是目录压缩包，都可以直接解压缩</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# unzip dir1.zip</span><br><span class="line">Archive: dir1.zip</span><br><span class="line">creating: dirl/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压缩</span></span><br></pre></td></tr></table></figure></li><li><p>使用 -d 选项手动指定解压缩位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# unzip -d /tmp/ ana.zip</span><br><span class="line">Archive: ana.zip</span><br><span class="line">inflating: /tmp/anaconda-ks.cfg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把压缩包解压到指定位置</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="tar-打包">tar 打包</h3><p>tar（英文全拼：tape archive ）tape是磁带的意思，也即把数据打包成磁带文件，然后利用 gzip 和 bzip2 命令对磁带文件进行压缩存储。</p><p>📌<strong>tar命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar [-options] 源文件或目录</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><p>打包常用选项：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-c</code>:<code>--directory=&lt;目的目录&gt;</code></td><td>将多个文件或目录进行打包。</td></tr><tr><td><code>-A</code>:<code>--catenate</code></td><td>追加 tar 文件到归档文件。</td></tr><tr><td><code>-f 包名</code>：<code>--file=&lt;备份文件&gt;</code></td><td>指定包的文件名。包的扩展名是用来给管理员识别格式的，所以一定要正确指定扩展名；</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示打包文件过程</td></tr></tbody></table><p>解包常用选项：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td><code>-x</code>：<code>--extract</code>：<code>--get</code></td><td>对 tar 包做解打包操作。</td></tr><tr><td><code>-f</code>：<code>--file=&lt;备份文件&gt;</code></td><td>指定要解压的 tar 包的包名。</td></tr><tr><td><code>-t</code>：<code>--list</code></td><td>只查看 tar 包中有哪些文件或目录，不对 tar 包做解打包操作。</td></tr><tr><td><code>-C 目录</code>:<code>--directory=&lt;目的目录&gt;</code></td><td>指定解打包位置。</td></tr><tr><td><code>-v</code>：<code>--verbose</code></td><td>显示解打包的具体过程</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>常用命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#  tar -cvf 打包后名字.tar 文件名1 文件名2 ...    # 打包并压缩</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  tar -xvf 需解压的文件.tar -C 解压的位置    # 解压</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .gz 文件</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  tar -zcvf 打包后名字.tar.gz 文件名1 文件名2 ...    # 打包并压缩</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  tar -zxvf 需解压的文件.tar.gz     # 解压</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .bz2 文件</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  tar -jcvf 打包后名字.tar.bz2 文件名1 文件名2 ...    # 打包并压缩</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  tar -jxvf 需解压的文件.tar.bz2     # 解压</span></span><br></pre></td></tr></table></figure><hr><h2 id="用户和用户组管理">用户和用户组管理</h2><h3 id="📂-etc-passwd-用户配置文件">📂<code>/etc/passwd</code> 用户配置文件</h3><p>Linux 系统中的 <code>/etc/passwd</code> 文件，是系统用户配置文件，存储了系统中所有用户的基本信息，并且所有用户都可以对此文件执行读操作。</p><p>📌<strong>文件内容</strong>：</p><p>可以看到，<code>/etc/passwd</code> 文件中的内容非常规律，每行记录对应一个用户。这些用户中的绝大多数是系统或服务正常运行所必需的用户，这种用户通常称为系统用户或伪用户。系统用户无法用来登录系统，但也不能删除，因为一旦删除，依赖这些用户运行的服务或程序就不能正常执行，会导致系统问题。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vi /etc/passwd</span></span><br><span class="line"><span class="comment">#查看一下文件内容</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">...省略部分输出...</span><br><span class="line"><span class="comment"># 用户名：密码：UID（用户ID）：GID（组ID）：描述性信息：主目录：默认Shell</span></span><br></pre></td></tr></table></figure><p>📌<strong>字段详解</strong>：</p><ul><li><p><strong>用户名</strong></p><p>用户名仅是为了方便用户记忆，Linux 系统是通过 UID 来识别用户身份，分配用户权限的。<code>/etc/passwd</code> 文件中就定义了用户名和 UID 之间的对应关系。</p></li><li><p><strong>密码</strong></p><p>“x” 表示此用户设有密码，但不是真正的密码，真正的密码保存在 <code>/etc/shadow</code> 文件中。在早期的 UNIX 中，这里保存的就是真正的加密密码串，但由于所有程序都能读取此文件，非常容易造成用户数据被窃取（虽然密码是加密的，但是采用暴力破解的方式也是能够进行破解的）。因此，现在 Linux 系统把真正的加密密码串放置在 <code>/etc/shadow</code> 文件中，此文件只有 root 用户可以浏览和操作，这样就最大限度地保证了密码的安全。</p><p>需要注意的是，虽然 “x” 并不表示真正的密码，但也不能删除，如果删除了 “x”，那么系统会认为这个用户没有密码，从而导致只输入用户名而不用输入密码就可以登陆。（只能在本地使用无密码登录，远程是不可以的）</p></li><li><p><strong>UID</strong></p><p>UID，也就是用户 ID。每个用户都有唯一的一个 UID，Linux 系统通过 UID 来识别不同的用户。实际上，UID 就是一个 0~65535 之间的数，不同范围的数字表示不同的用户身份。</p><table><thead><tr><th>UID 范围</th><th>用户身份</th></tr></thead><tbody><tr><td>0</td><td>超级用户。UID 为 0 就代表这个账号是管理员账号。在 Linux 中，如何把普通用户升级成管理员呢？只需把其他用户的 UID 修改为 0 就可以了，这一点和 Windows 是不同的。不过不建议建立多个管理员账号。</td></tr><tr><td>1~499</td><td>系统用户（伪用户）。也就是说，此范围的 UID 保留给系统使用。其中，1~99 用于系统自行创建的账号；100~499 分配给有系统账号需求的用户。  其实，除了 0 之外，其他的 UID 并无不同，这里只是默认 500 以下的数字给系统作为保留账户，只是一个公认的习惯而已。</td></tr><tr><td>500~65535</td><td>普通用户。通常这些 UID 已经足够用户使用了。但不够用也没关系，2.6.x 内核之后的 Linux 系统已经可以支持 232 个 UID 了。</td></tr></tbody></table></li><li><p><strong>GID</strong></p><p>全称“Group ID”，简称“组ID”，表示用户初始组的组 ID 号。这里需要解释一下初始组和附加组的概念。</p><p><strong>初始组</strong>：指用户登陆时就拥有这个用户组的相关权限。每个用户的初始组只能有一个，通常就是将和此用户的用户名相同的组名作为该用户的初始组。比如说，我们手工添加用户 lamp，在建立用户 lamp 的同时，就会建立 lamp 组作为 lamp 用户的初始组。</p><p><strong>附加组</strong>：指用户可以加入多个其他的用户组，并拥有这些组的权限。每个用户只能有一个初始组，除初始组外，用户再加入其他的用户组，这些用户组就是这个用户的附加组。附加组可以有多个，而且用户可以有这些附加组的权限。</p><p>当然，初始组和附加组的身份是可以修改的，但是我们在<strong>工作中不修改初始组，只修改附加组，因为修改了初始组有时会让管理员逻辑混乱</strong>。需要注意的是，在 <code>/etc/passwd</code> 文件的第四个字段中看到的 ID 是这个用户的初始组。</p></li><li><p><strong>描述性信息</strong></p><p>这个字段并没有什么重要的用途，只是用来解释这个用户的意义而已。</p></li><li><p><strong>主目录</strong></p><p>也就是用户登录后有操作权限的访问目录，通常称为用户的主目录。</p><p>root 超级管理员账户的主目录为 <code>/root</code>，普通用户的主目录为 <code>/home/yourIDname</code>。</p></li><li><p><strong>默认的Shell</strong></p><p>Shell 就是 Linux 的命令解释器，是用户和 Linux 内核之间沟通的桥梁。</p><p>通常情况下，Linux 系统默认使用的命令解释器是 <code>bash</code>（<code>/bin/bash</code>），当然还有其他命令解释器，例如 sh、csh 等。</p><p>这里不能随便写入和登陆没有关系的命令（如 ls），系统不会识别这些命令，同时也就意味着这个用户不能登录。</p><p>把 lamp 用户的 Shell 命令解释器修改为 <code>/sbin/nologin</code>，那么，这个用户就不能登录了，例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#vi /etc/passwd</span><br><span class="line">lamp:x:502:502::/home/lamp:/usr/bin/passwd</span><br></pre></td></tr></table></figure></li></ul><h3 id="📂-etc-shadow-影子文件">📂<code>/etc/shadow</code> 影子文件</h3><p><code>/etc/shadow</code> 文件，用于存储 Linux 系统中用户的密码信息，又称为“影子文件”。</p><p>前面介绍了 <code>/etc/passwd</code> 文件，由于该文件允许所有用户读取，易导致用户密码泄露，因此 Linux 系统将用户的密码信息从<code>/etc/passwd</code> 文件中分离出来，并单独放到了此文件中。</p><p><code>/etc/shadow</code> 文件只有 root 用户拥有读权限，其他用户没有任何权限，这样就保证了用户密码的安全性。</p><p>📌<strong>文件内容</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#vim /etc/shadow</span></span><br><span class="line">root: $6<span class="variable">$9w5Td6lg</span></span><br><span class="line"><span class="variable">$bgpsy3olsq9WwWvS5Sst2W3ZiJpuCGDY</span>.4w4MRk3ob/i85fl38RH15wzVoom ff9isV1 PzdcXmixzhnMVhMxbvO:15775:0:99999:7:::</span><br><span class="line">bin:*:15513:0:99999:7:::</span><br><span class="line">daemon:*:15513:0:99999:7:::</span><br><span class="line">…省略部分输出…</span><br><span class="line"><span class="comment"># 用户名：加密密码：最后一次修改时间：最小修改时间间隔：密码有效期：密码需要变更前的警告天数：密码过期后的宽限时间：账号失效时间：保留字段</span></span><br></pre></td></tr></table></figure><p>📌<strong>字段详解</strong>：</p><ul><li><p><strong>用户名</strong></p><p>同 <code>/etc/passwd</code> 文件的用户名有相同的含义。</p></li><li><p><strong>加密密码</strong></p><p>这里保存的是真正加密的密码。目前 Linux 的密码采用的是 SHA512 散列加密算法，原来采用的是 MD5 或 DES 加密算法。SHA512 散列加密算法的加密等级更高，也更加安全。</p><blockquote><p>⚠️**注意！**这串密码产生的乱码不能手工修改，如果手工修改，系统将无法识别密码，导致密码失效。很多软件透过这个功能，在密码串前加上 “!”、“*” 或 “x” 使密码暂时失效。</p></blockquote><p>所有伪用户的密码都是 “!!” 或 “*”，代表没有密码是不能登录的。当然，新创建的用户如果不设定密码，那么它的密码项也是 “!!”，代表这个用户没有密码，不能登录。</p></li><li><p><strong>最后一次修改时间</strong></p><p>此字段表示最后一次修改密码的时间，可是，为什么 root 用户显示的是 15775 呢？</p><p>这是因为，Linux 计算日期的时间是以 1970 年 1 月 1 日作为 1 不断累加得到的时间，到 1971 年 1 月 1 日，则为 366 天。这里显示 15775 天，也就是说，此 root 账号在 1970 年 1 月 1 日之后的第 15775 天修改的 root 用户密码。</p><p>那么，到底 15775 代表的是哪一天呢？可以使用如下命令进行换算：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># date -d &quot;1970-01-01 15775 days&quot;</span></span><br><span class="line">2013年03月11日 星期一 00:00:00 CST</span><br></pre></td></tr></table></figure><p>可以看到，通过以上命令，即可将其换算为我们习惯的系统日期。</p></li><li><p><strong>最小修改时间间隔</strong></p><p>最小修改间隔时间，也就是说，该字段规定了从第 3 字段（最后一次修改密码的日期）起，多长时间之内不能修改密码。如果是 0，则密码可以随时修改；如果是 10，则代表密码修改后 10 天之内不能再次修改密码。</p><p>此字段是为了针对某些人频繁更改账户密码而设计的。</p></li><li><p><strong>密码有效期</strong></p><p>经常变更密码是个好习惯，为了强制要求用户变更密码，这个字段可以指定距离第 3 字段（最后一次更改密码）多长时间内需要再次变更密码，否则该账户密码进行过期阶段。该字段的默认值为 99999，也就是 273 年，可认为是永久生效。如果改为 90，则表示密码被修改 90 天之后必须再次修改，否则该用户即将过期。管理服务器时，通过这个字段强制用户定期修改密码。</p></li><li><p><strong>密码需要变更前的警告天数</strong></p><p>与第 5 字段相比较，当账户密码有效期快到时，系统会发出警告信息给此账户，提醒用户 “再过 n 天你的密码就要过期了，请尽快重新设置你的密码！”。</p><p>该字段的默认值是 7，也就是说，距离密码有效期的第 7 天开始，每次登录系统都会向该账户发出 “修改密码” 的警告信息。</p></li><li><p><strong>密码过期后的宽限天数</strong></p><p>也称为“口令失效日”，简单理解就是，在密码过期后，用户如果还是没有修改密码，则在此字段规定的宽限天数内，用户还是可以登录系统的；如果过了宽限天数，系统将不再让此账户登陆，也不会提示账户过期，是完全禁用。</p><p>比如说，此字段规定的宽限天数是 10，则代表密码过期 10 天后失效；如果是 0，则代表密码过期后立即失效；如果是 -1，则代表密码永远不会失效。</p></li><li><p><strong>账号失效时间</strong></p><p>同第 3 个字段一样，使用自 1970 年 1 月 1 日以来的总天数作为账户的失效时间。该字段表示，账号在此字段规定的时间之外，不论你的密码是否过期，都将无法使用！</p><p>该字段通常被使用在具有收费服务的系统中。</p></li><li><p><strong>保留</strong></p><p>这个字段目前没有使用，等待新功能的加入。</p></li><li><p><strong>忘记密码怎么办</strong></p><p>经常有读者会忘记自己的账户密码，该怎么处理呢？</p><p>对于普通账户的密码遗失，可以通过 root 账户解决，它会重新给你配置好指定账户的密码，而不需知道你原有的密码（利用 root 的身份使用 passwd 命令即可）。</p><p>如果 root 账号的密码遗失，则需要重新启动进入单用户模式，系统会提供 root 权限的 bash 接口，此时可以用 passwd 命令修改账户密码；也可以通过挂载根目录，修改 /etc/shadow，将账户的 root 密码清空的方法，此方式可使用 root 无法密码即可登陆，建议登陆后使用 passwd 命令配置 root 密码。</p></li></ul><h3 id="📂-etc-group-用户组配置文件">📂<code>/etc/group</code> 用户组配置文件</h3><p><code>/ect/group</code> 文件是用户组配置文件，即用户组的所有信息都存放在此文件中。</p><p>此文件是记录组 ID（GID）和组名相对应的文件。前面讲过，<code>/etc/passwd</code> 文件中每行用户信息的第四个字段记录的是用户的初始组 ID，那么，此 GID 的组名到底是什么呢？就要从 /etc/group 文件中查找。</p><p>📌<strong>文件内容</strong>：</p><p>可以看到，<code>/etc/group</code> 中每一行各代表一个用户组。在前面章节中，我们曾创建 lamp 用户，系统默认生成一个 lamp 用户组，在此可以看到，此用户组的 GID 为 502，目前它仅作为 lamp 用户的初始组。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#vim /etc/group</span></span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:bin,daemon</span><br><span class="line">daemon:x:2:bin,daemon</span><br><span class="line">…省略部分输出…</span><br><span class="line">lamp:x:502:</span><br><span class="line"><span class="comment"># 组名：密码：GID：该用户组中的用户列表</span></span><br></pre></td></tr></table></figure><p>📌<strong>字段详解</strong>：</p><ul><li><p><strong>组名</strong></p><p>也就是是用户组的名称，有字母或数字构成。同 <code>/etc/passwd</code> 中的用户名一样，组名也不能重复。</p></li><li><p><strong>组密码</strong></p><p>和 <code>/etc/passwd</code> 文件一样，这里的 “x” 仅仅是密码标识，真正加密后的组密码默认保存在 <code>/etc/gshadow</code> 文件中。</p><p>不过，用户设置密码是为了验证用户的身份，那用户组设置密码是用来做什么的呢？用户组密码主要是用来指定组管理员的，由于系统中的账号可能会非常多，root 用户可能没有时间进行用户的组调整，这时可以给用户组指定组管理员，如果有用户需要加入或退出某用户组，可以由该组的组管理员替代 root 进行管理。但是这项功能目前很少使用，我们也很少设置组密码。如果需要赋予某用户调整某个用户组的权限，则可以使用 sudo 命令代替。</p></li><li><p><strong>组ID (GID)</strong></p><p>就是群组的 ID 号，Linux 系统就是通过 GID 来区分用户组的，同用户名一样，组名也只是为了便于管理员记忆。</p><p>这里的组 GID 与 <code>/etc/passwd</code> 文件中第 4 个字段的 GID 相对应，实际上，<code>/etc/passwd</code> 文件中使用 GID 对应的群组名，就是通过此文件对应得到的。</p></li><li><p><strong>组中的用户</strong></p><p>此字段列出每个群组包含的所有用户。需要注意的是，如果该用户组是这个用户的初始组，则该用户不会写入这个字段，可以这么理解，该字段显示的用户都是这个用户组的附加用户。</p><p>举个例子，lamp 组的组信息为 “<code>lamp:x:502:</code>”，可以看到，第四个字段没有写入 lamp 用户，因为 lamp 组是 lamp 用户的初始组。如果要查询这些用户的初始组，则需要先到 <code>/etc/passwd</code> 文件中查看 GID（第四个字段），然后到 /etc/group 文件中比对组名。每个用户都可以加入多个附加组，但是只能属于一个初始组。所以我们在实际工作中，如果需要把用户加入其他组，则需要以附加组的形式添加。例如，我们想让 lamp 也加入 root 这个群组，那么只需要在第一行的最后一个字段加入 lamp，即 <code>root:x:0:lamp</code> 就可以了。</p></li></ul><h3 id="📂-etc-gshadow-安全组账户信息">📂<code>/etc/gshadow</code> 安全组账户信息</h3><p>前面讲过，/etc/passwd 文件存储用户基本信息，同时考虑到账户的安全性，将用户的密码信息存放另一个文件 /etc/shadow 中。本节要将的 /etc/gshadow 文件也是如此，组用户信息存储在 /etc/group 文件中，而将组用户的密码信息存储在 /etc/gshadow 文件中。</p><p>📌<strong>文件内容</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#vim /etc/gshadow</span></span><br><span class="line">root:::</span><br><span class="line">bin:::bin, daemon</span><br><span class="line">daemon:::bin, daemon</span><br><span class="line">...省略部分输出...</span><br><span class="line">lamp:!::</span><br><span class="line"><span class="comment"># 组名：加密密码：组管理员：组附加用户列表</span></span><br></pre></td></tr></table></figure><p>📌<strong>字段详解</strong>：</p><ul><li><p><strong>组名</strong></p><p>同 /etc/group 文件中的组名相对应。</p></li><li><p><strong>组密码</strong></p><p>对于大多数用户来说，通常不设置组密码，因此该字段常为空，但有时为 “!”，指的是该群组没有组密码，也不设有群组管理员。</p></li><li><p><strong>组管理员</strong></p><p>从系统管理员的角度来说，该文件最大的功能就是创建群组管理员。那么，什么是群组管理员呢？</p><p>考虑到 Linux 系统中账号太多，而超级管理员 root 可能比较忙碌，因此当有用户想要加入某群组时，root 或许不能及时作出回应。这种情况下，如果有群组管理员，那么他就能将用户加入自己管理的群组中，也就免去麻烦 root 了。</p><p>不过，由于目前有 sudo 之类的工具，因此群组管理员的这个功能已经很少使用了。</p></li><li><p><strong>组中的附加用户</strong></p><p>该字段显示这个用户组中有哪些附加用户，和 /etc/group 文件中附加组显示内容相同。</p></li></ul><h3 id="📂-etc-login-defs-Shadow密码套件配置">📂<code>/etc/login.defs</code> Shadow密码套件配置</h3><h3 id="📂-etc-skel-新用户配置文件">📂<code>/etc/skel</code> 新用户配置文件</h3><h3 id="w-who-whoami-who-am-i-查看登陆用户信息">w who whoami <code>who am i</code>  查看登陆用户信息</h3><p>💾<u><code>/etc/passwd</code></u></p><p>0️⃣<strong>它们的区别</strong>：</p><blockquote><ul><li>w</li></ul><p>显示服务器用户登录的详细信息（会打印每一列的表头）</p><p>包含用户名、终端设备、登录IP地址、登录时间等等。</p><ul><li>who</li></ul><p>显示用户登录信息，但是没有w命令显示的详细。</p><p>注意：w和who命令打印的结果是所有登录当前服务器的所有会话。</p><ul><li>whoami</li></ul><p>查看当前登录（当前会话）的用户名</p><ul><li>who am i</li></ul><p>查看当前登录（当前会话）的用户的详细登录信息</p></blockquote><p>1️⃣<strong>w</strong></p><p>w 命令除了能知道目前已登陆的用户信息，还可以知道每个用户执行任务的情况。</p><p>📌<strong>w命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w [-options] [username]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-h</td><td>不显示输出信息的标题</td></tr><tr><td>-l</td><td>用长格式输出</td></tr><tr><td>-s</td><td>用短格式输出，不显示登陆时间，JCPU 和 PCPU 时间</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>显示当前用户登陆信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# w</span><br><span class="line"> 13:13:56 up 13:00,  1 user,  load average: 0.08, 0.02, 0.01</span><br><span class="line">USER   TTY    FROM              LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root    tty1    -                        11:04       0.00s  0.36s   0.00s  -bash</span><br><span class="line">root    pts/0  192.168.0.108   13:15       0.00s   0.06s   0.02s   w</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前的系统时间、系统从启动至今已运行的时间、登陆到系统中的用户数和系统平均负载(平均负载（load average）指的是在 1 分钟、5 分钟、15 分钟内系统的负载状况)</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>标题</th><th>含义</th></tr></thead><tbody><tr><td>USER</td><td>登录到系统的用户。</td></tr><tr><td>TTY</td><td>登录终端。</td></tr><tr><td>FROM</td><td>表示用户从哪里登陆进来，一般显示远程登陆主机的 IP 地址或者主机名。</td></tr><tr><td>LOGIN@</td><td>用户登陆的日期和时间。</td></tr><tr><td>IDLE</td><td>表示某个程序上次从终端开始执行到现在所持续的时间。</td></tr><tr><td>JCPU</td><td>和该终端连接的所有进程占用的 CPU 运算时间。这个时间里并不包括过去的后台作业时间，但是包括当前正在运行的后台作业所占用的时间。</td></tr><tr><td>PCPU</td><td>当前进程所占用的 CPU 运算时间。</td></tr><tr><td>WHAT</td><td>当前用户正在执行的进程名称和选项，换句话说，就是表示用户当前执行的是什么命令。</td></tr></tbody></table><p>2️⃣<strong>who</strong></p><p>who 命令只能显示当前登陆的用户信息，但无法知晓每个用户正在执行的命令。</p><p>who 命令默认是通过 <code>/var/run/utmp</code> 文件来获取登陆用户信息，但如果通过 file 指定另一个文件，则 who 命令将不再默认读取 <code>/var/run/utmp</code> 文件，而是读取该指定文件来获取信息。</p><p>📌<strong>who命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">who</span> [-options] [username]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>列出所有信息，相当于所有选项。</td></tr><tr><td>-b</td><td>列出系统最近启动的时间日期。</td></tr><tr><td><code>-H</code>或<code>-–heading</code></td><td>显示列标题</td></tr><tr><td>-l</td><td>列出所有可登陆的终端信息。</td></tr><tr><td><code>-m</code>或<code>am i</code></td><td>仅列出关于当前终端的信息，<code>who -m</code> 命令等同于 <code>who am i</code>。</td></tr><tr><td><code>-q</code>或<code>--count</code></td><td>列出在本地系统上的用户和用户数的清单。</td></tr><tr><td>-r</td><td>显示当前系统的运行级别。</td></tr><tr><td>-s</td><td>仅显示名称、线路和时间字段信息，这是 who 命令的默认选项。</td></tr><tr><td>-u</td><td>显示当前每个用户的用户名、登陆终端、<strong>登陆时间</strong>、线路活动和进程标识。</td></tr><tr><td><code>-w</code>或 <code>-T </code></td><td>显示 tty 终端的状态，“+”表示对任何人可写，“-”表示仅对 root 用户或所有者可写，“？”表示遇到线路故障</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>显示系统最新启动日期，以及每个用户的登陆详情、终端状态。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# who     &lt;--等同于 who -s</span><br><span class="line">root tty1 2013-06-07 09：53</span><br><span class="line">root pts/0 2013-06-07 09：53 (192.168.0.108)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用户名 登录终端 登录时间（登录来源IP）</span></span><br></pre></td></tr></table></figure><p>3️⃣<strong>whoami</strong></p><p>4️⃣<strong>who am i</strong></p><p>仅列出关于当前终端的信息。详请查阅who命令，等同于<code>who -m</code>。</p><h3 id="exit-退出登入账户">exit 退出登入账户</h3><p>如果是图形界面，退出当前终端；</p><p>如果是使用ssh远程登录，退出登陆账户；</p><p>如果是切换后的登陆用户，退出则返回上一个登陆账号。</p><h3 id="useradd-添加新用户">useradd 添加新用户</h3><p>💾<u><code>/etc/passwd</code></u></p><p>Linux useradd 命令用于建立用户帐号。帐号建好之后，再用 <code>passwd</code> 设定帐号的密码。可用 <code>userdel</code> 删除帐号。使用 <code>useradd</code> 指令所建立的帐号。</p><p>📌<strong>useradd命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>作用</th></tr></thead><tbody><tr><td>-u UID</td><td>手工指定用户的 UID，注意 UID 的范围（不要小于 500）。</td></tr><tr><td>-d 主目录</td><td>手工指定用户的主目录。主目录必须写绝对路径，而且如果需要手工指定主目录，则一定要注意权限；</td></tr><tr><td>-c 用户说明</td><td>手工指定/etc/passwd文件中各用户信息中第 5 个字段的描述性内容，可随意配置；</td></tr><tr><td>-g 组名</td><td>手工指定用户的初始组。一般以和用户名相同的组作为用户的初始组，在创建用户时<br/>会默认建立初始组。一旦手动指定，则系统将不会在创建此默认的初始组目录。</td></tr><tr><td>-G 组名</td><td>指定用户的附加组。我们把用户加入其他组，一般都使用附加组；</td></tr><tr><td>-s shell</td><td>手工指定用户的登录 Shell，默认是 /bin/bash；</td></tr><tr><td>-e 曰期</td><td>指定用户的失效曰期，格式为 “YYYY-MM-DD”。也就是 /etc/shadow 文件的第八个字段；</td></tr><tr><td>-o</td><td>允许创建的用户的 UID 相同。例如，执行 “useradd -u 0 -o usertest” 命令<br>建立用户 usertest，它的 UID 和 root 用户的 UID 相同，都是 0；</td></tr><tr><td>-m</td><td>建立用户时强制建立用户的家目录。在建立系统用户时，该选项是默认的；</td></tr><tr><td>-r</td><td>创建系统用户，也就是 UID 在 1~499 之间，供系统程序使用的用户。<br/>由于系统用户主要用于运行系统所需服务的权限配置，因此系统用户的创建默认不会创建主目录。</td></tr></tbody></table><p>其实，系统已经帮我们规定了非常多的默认值，在没有特殊要求下，无需使用任何选项即可成功创建用户。</p><p>📌<strong>示例说明</strong>：</p><p><strong>创建</strong>lamp<strong>用户的流程</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.创建 lamp 普通用户</span></span><br><span class="line">[root@localhost ~]<span class="comment"># useradd lamp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.查看/etc/passwd，文件中创建一行与 lamp 用户相关的数据：</span></span><br><span class="line"><span class="comment"># 用户名：密码：UID（用户ID）：GID（组ID）：描述性信息：主目录：默认Shell</span></span><br><span class="line"><span class="comment"># 可以看到，用户的 UID 是从 500 开始计算的。同时默认指定了用户的家目录为 /home/lamp/，用户的登录 Shell 为 /bin/bash。</span></span><br><span class="line"><span class="comment"># 当然，这个用户还没有设置密码，所以密码字段是 &quot;x&quot;，代表这个用户没有合理密码，不能正常登录。同时会按照默认值设定时间字段，例如密码有效期有 99999 天，距离密码过期 7 天系统会提示用户“密码即将过期”等。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;lamp&quot; /etc/passwd</span></span><br><span class="line">lamp:x:500:500::/home/lamp:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.查看/etc/group，文件中创建一行与用户名一模一样的群组</span></span><br><span class="line"><span class="comment"># 该群组会作为新建用户的初始组。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;lamp&quot; /etc/group</span></span><br><span class="line">lamp:x:500:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.查看/etc/gshadow，文件中新增一行与新增群组相关的密码信息</span></span><br><span class="line"><span class="comment"># 当然，我们没有设定组密码，所以这里没有密码，也没有组管理员。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;lamp&quot; /etc/gshadow</span></span><br><span class="line">lamp:!::</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.默认创建用户的主目录和邮箱</span></span><br><span class="line"><span class="comment"># 注意这两个文件的权限，都要让 lamp 用户拥有相应的权限。</span></span><br><span class="line">[root@localhost ~]<span class="comment">#ll -d /home/lamp/</span></span><br><span class="line">drwx------ 3 lamp lamp 4096 1月6 00:19 /home/lamp/</span><br><span class="line">[root@localhost ~]<span class="comment">#ll /var/spod/mail/lamp</span></span><br><span class="line">-rw-rw---- 1 lamp mail 0 1月6 00:19 /var/spool/mail/lamp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.将 /etc/skel 目录中的配置文件复制到新用户的主目录中（新增用户配置文件目录）</span></span><br><span class="line"><span class="comment"># 这个目录下的所有文件会自动被复制到新添加的用户家目录下，可以为新创建的用户提供统一、标准的、初始化用户环境。</span></span><br></pre></td></tr></table></figure><blockquote><p>新增用户组时初始化数据，文件<code>/etc/default/useradd</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment">#vim /etc/default/useradd</span></span><br><span class="line"><span class="comment"># useradd defaults file</span></span><br><span class="line">GR0UP=100</span><br><span class="line">HOME=/home</span><br><span class="line">INACTIVE=-1</span><br><span class="line">EXPIRE=</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">SKEL=/etc/skel</span><br><span class="line">CREATE_MAIL_SPOOL=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>也可以用选项查看</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># useradd -D</span></span><br><span class="line">GROUP=100</span><br><span class="line">HOME=/home</span><br><span class="line">INACTIVE=-1</span><br><span class="line">EXPIRE=</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">SKEL=/etc/skel</span><br><span class="line">CREATE_MAIL_SPOOL=<span class="built_in">yes</span></span><br></pre></td></tr></table></figure><blockquote><p>文件内容：</p><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>GR0UP=100</td><td>这个选项用于建立用户的默认组，也就是说，在添加每个用户时，用户的初始组就是 GID 为 100 的这个用户组。但 CentOS 并不是这样的，而是在添加用户时会自动建立和用户名相同的组作为此用户的初始组。也就是说这个选项并不会生效。  Linux 中默认用户组有两种机制：一种是私有用户组机制，系统会创建一个和用户名相同的用户组作为用户的初始组；另一种是公共用户组机制，系统用 GID 是 100 的用户组作为所有新建用户的初始组。目前我们采用的是私有用户组机制。</td></tr><tr><td>HOME=/home</td><td>指的是用户主目录的默认位置，所有新建用户的主目录默认都在 /home/下，刚刚新建的 lamp1 用户的主目录就为 /home/lamp1/。</td></tr><tr><td>INACTIVE=-1</td><td>指的是密码过期后的宽限天数，也就是 /etc/shadow 文件的第七个字段。这里默认值是 -1，代表所有新建立的用户密码永远不会失效。</td></tr><tr><td>EXPIRE=</td><td>表示密码失效时间，也就是 /etc/shadow 文件的第八个字段。默认值是空，代表所有新建用户没有失效时间，永久有效。</td></tr><tr><td>SHELL=/bin/bash</td><td>表示所有新建立的用户默认 Shell 都是 /bin/bash。</td></tr><tr><td>SKEL=/etc/skel</td><td>在创建一个新用户后，你会发现，该用户主目录并不是空目录，而是有 .bash_profile、.bashrc 等文件，这些文件都是从 /etc/skel 目录中自动复制过来的。因此，更改 /etc/skel 目录下的内容就可以改变新建用户默认主目录中的配置文件信息。</td></tr><tr><td>CREATE_MAIL_SPOOL=yes</td><td>指的是给新建用户建立邮箱，默认是创建。也就是说，对于所有的新建用户，系统都会新建一个邮箱，放在 /var/spool/mail/ 目录下，和用户名相同。</td></tr></tbody></table></blockquote></blockquote><p>📌<strong>示例说明</strong>：</p><h3 id="passwd-设置用户密码">passwd 设置用户密码</h3><p>一些Linux 发行版为了系统安装，都使用了 PAM 模块进行密码的检验，设置密码太短、与用户名相同、是常见字符串等，都会被 PAM 模块检查出来，从而禁止用户使用此类密码。</p><p>📌<strong>passwd命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-S</code></td><td>查询用户密码的状态，也就是 /etc/shadow 文件中此用户密码的内容（仅 root 用户可用）</td></tr><tr><td><font style="color:red;"><code>-l</code></font></td><td>暂时锁定用户，该选项会在 /etc/shadow 文件中指定用户的加密密码串前添加 “!”，使密码失效<br/>（仅 root 用户可用）</td></tr><tr><td><font style="color:red;"><code>-u</code></font></td><td>解锁用户，和 -l 选项相对应（ 仅 root 用户使用）</td></tr><tr><td><font style="color:red;"><code>-d</code></font></td><td>删除密码</td></tr><tr><td><font style="color:red;"><code>-f</code></font></td><td>强迫用户下次登录时必须修改口令</td></tr><tr><td><code>--stdin</code></td><td>可以将通过管道符输出的数据作为用户的密码。主要在批量添加用户时使用</td></tr><tr><td><code>-k</code></td><td>更新只能发送在过期之后</td></tr><tr><td><code>-n</code></td><td>设置该用户修改密码后，多长时间不能再次修改密码，也就是修改 /etc/shadow 文件中各行密码<br/>的第 4 个字段</td></tr><tr><td><code>-x</code></td><td>设置该用户的密码有效期，对应 /etc/shadow 文件中各行密码的第 5 个字段</td></tr><tr><td><code>-w</code></td><td>设置用户密码过期前的警告天数，对于 /etc/shadow 文件中各行密码的第 6 个字段</td></tr><tr><td><code>-i</code></td><td>设置用户密码失效日期，对应 /etc/shadow 文件中各行密码的第 7 个字段</td></tr></tbody></table><p>⚠️<strong>注意：</strong></p><ol><li>普通用户只能使用 passwd 命令修改自己的密码，而不能修改其他用户的密码。</li><li>与使用 root 账户修改普通用户的密码不同，普通用户修改自己的密码需要先输入自己的旧密码，只有旧密码输入正确才能输入新密码。不仅如此，此种修改方式对密码的复杂度有严格的要求，新密码太短、太简单，都会被系统检测出来并禁止用户使用。</li><li><code>--stdin</code> 选项，用于批量给用户设置初始密码。使用此方式批量给用户设置初始密码，当然好处就是方便快捷，但需要注意的是，这样设定的密码会把密码明文保存在历史命令中，如果系统被攻破，别人可以在 /root/.bash_history 中找到设置密码的这个命令，存在安全隐患。（①手工清除历史命令；②强制这些新添加的用户在第一次登录时必须修改密码。）</li></ol><p>📌<strong>示例说明</strong>：</p><ol><li><p>使用 root 账户修改 lamp 普通用户的密码，可以使用如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# passwd lamp</span><br><span class="line">Changing password for user lamp.</span><br><span class="line">New password: &lt;==直接输入新的口令，但屏幕不会有任何反应</span><br><span class="line">BAD PASSWORD: it is WAY too short &lt;==口令太简单或过短的错误！这里只是警告信息，输入的密码依旧能用</span><br><span class="line">Retype new password:  &lt;==再次验证输入的密码，再输入一次即可</span><br><span class="line">passwd: all authentication tokens updated successfully.  &lt;==提示修改密码成功</span><br></pre></td></tr></table></figure></li><li><p>使用 passwd 命令修改当前系统已登录用户的密码，但要注意的是，需省略掉 “选项” 和 “用户名”。登陆 lamp 用户：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#passwd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">passwd直接回车代表修改当前用户的密码</span></span><br><span class="line">Changing password for user vbird2.</span><br><span class="line">Changing password for vbird2</span><br><span class="line">(current) UNIX password: &lt;==这里输入『原有的旧口令』</span><br><span class="line">New password: &lt;==这里输入新口令</span><br><span class="line">BAD PASSWORD: it is WAY too short &lt;==口令检验不通过，请再想个新口令</span><br><span class="line">New password: &lt;==这里再想个来输入吧</span><br><span class="line">Retype new password: &lt;==通过口令验证！所以重复这个口令的输入</span><br><span class="line">passwd: all authentication tokens updated successfully. &lt;==成功修改用户密码</span><br></pre></td></tr></table></figure></li></ol><h3 id="usermod-修改用户信息">usermod 修改用户信息</h3><p>Linux usermod命令用于修改用户帐号信息。使用 Vi 文本编辑器手动修改涉及用户信息的相关文件（/etc/passwd、/etc/shadow、/etc/group、/etc/gshadow），另一个方法就是使用本节介绍了 usermod 命令，该命令专门用于修改用户信息。</p><p>其实 usermod 命令提供的选项和 useradd 命令的选项相似，因为 usermod 命令就是用来调整使用 useradd 命令添加的用户信息的。usermod 命令还多出了几个选项，即 -L 和 -U，作用分别与 passwd 命令的 -l 和-u 相同。此命令对用户的临时锁定，同 passwd 命令一样，都是在 /etc/passwd 文件目标用户的加密密码字段前添加 “!”，使密码失效；反之，解锁用户就是将添加的 “!” 去掉。</p><p>📌<strong>usermod命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-c 用户说明</code></td><td>修改用户的说明信息，即修改 <code>/etc/passwd</code> 文件目标用户信息的第 5 个字段</td></tr><tr><td><font style="color:red;"><code>-d 主目录</code></font></td><td>修改用户的主目录，即修改 <code>/etc/passwd</code> 文件中目标用户信息的第 6 个字段，需要注意的是，主目录必须写绝对路径</td></tr><tr><td><code>-e 日期</code></td><td>修改用户的失效曰期，格式为 “YYYY-MM-DD”，即修改 /etc/shadow 文件目标用户密码信息的第 8 个字段</td></tr><tr><td><font style="color:red;"><code>-g 组名</code></font></td><td>修改用户的初始组，即修改 <code>/etc/passwd</code> 文件目标用户信息的第 4 个字段（GID）</td></tr><tr><td><code>-u UID</code></td><td>修改用户的UID，即修改 <code>/etc/passwd</code> 文件目标用户信息的第 3 个字段（UID）</td></tr><tr><td><code>-G 组名</code></td><td>修改用户的附加组，其实就是把用户加入其他用户组，即修改 /etc/group 文件</td></tr><tr><td><code>-l 用户名</code></td><td>修改用户名称</td></tr><tr><td><code>-L</code></td><td>临时锁定用户（Lock）</td></tr><tr><td><code>-U</code></td><td>解锁用户（Unlock），和 -L 对应</td></tr><tr><td><code>-s shell</code></td><td>修改用户的登录 Shell，默认是 <code>/bin/bash</code></td></tr></tbody></table><h3 id="userdel-删除用户">userdel 删除用户</h3><p>Linux userdel命令用于删除用户帐号。userdel还可以删除用户帐号与相关的文件。若不加参数，则仅删除用户帐号，但是不删除用户的家目录，那么家目录就会变成没有属主和属组的目录，也就是垃圾文件。</p><p><strong><span style="color:red;">※注意：如果要删除的用户已经使用过系统一段时间，那么此用户可能在系统中留有其他文件，因此，如果我们想要从系统中彻底的删除某个用户，最好在使用 userdel 命令之前，先通过 <code>find -user 用户名</code> 命令查出系统中属于该用户的文件，然后在加以删除。</span></strong></p><p>📌<strong>userdel命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-r</td><td>删除用户登入目录以及目录中所有文件</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>手动删除用户，仅是为了对 userdel 命令理解地更透彻，实际使用中，使用 userdel 删除用户更方便。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建立新 lamp 用户</span></span><br><span class="line">[root@localhost ~]<span class="comment"># useradd lamp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为 lamp 用户设置密码，由此 lamp 用户才算是创建成功</span></span><br><span class="line">[root@localhost ~]<span class="comment"># passwd lamp</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下面开始手动删除 lamp</span></span><br><span class="line"><span class="comment">#修改用户信息文件，删除lamp用户行</span></span><br><span class="line">[root@localhost ~]<span class="comment"># vi /etc/passwd</span></span><br><span class="line">lamp:x:501:501::/home/lamp:/bin/bash   &lt;--删除此行</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改影子文件，删除lamp用户密码行，注意，这个文件的权限是000，所以要强制保存</span></span><br><span class="line">[root@localhost ~]<span class="comment">#vi /etc/shadow</span></span><br><span class="line">lamp:$6<span class="variable">$KoOYtcOJ</span> <span class="variable">$56Xk9vp3D2vMRBxibNOn</span>.21cVJ9onbW8IHx4WrOx6qBqfGa9U3mjMsGjqYnj L/4t3zt3YxElce2X8rbb12x4a0:15716:0:99999:7:::   &lt;--删除此行</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改组信息文件，删除lamp群组信息</span></span><br><span class="line">[root@localhost ~]<span class="comment">#vi /etc/group</span></span><br><span class="line">lamp:x:501:  &lt;--删除此行</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改组影子文件，删除lamp群组密码信息。同样注意需要强制保存</span></span><br><span class="line">[root@localhost ~]<span class="comment">#vi /etc/gshadow</span></span><br><span class="line">lamp:!::  &lt;--删除此行</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf /var/spod/mail/lamp  #删除用户邮箱</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rm -rf/home/lamp/  #删除用户的家目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#至此，用户彻底删除，再新建用户lamp。如果可以正常建立，则说明我们手工删除干净了</span></span><br><span class="line">[root@localhost ~]<span class="comment"># useradd lamp</span></span><br><span class="line">[root@localhost ~]<span class="comment"># passwd lamp</span></span><br></pre></td></tr></table></figure><h3 id="id-查看用户的UID和GID">id 查看用户的UID和GID</h3><p>📌<strong>id命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">id</span> [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-g</code>：<code>--group</code></td><td>显示用户所属群组的ID</td></tr><tr><td><code>-G</code>：<code>--groups</code></td><td>显示用户所属附加群组的ID</td></tr><tr><td><code>-n</code>：<code>--name</code></td><td>显示用户，所属群组或附加群组的名称</td></tr><tr><td><code>-r</code>：<code>--real</code></td><td>显示实际ID</td></tr><tr><td><code>-u</code>：<code>--user</code></td><td>显示用户ID</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><pre><code class="language-sh">[root@localhost ~]# id lampuid=501(lamp) gid=501(lamp) groups=501(lamp)#能看到uid(用户ID)、gid(初始组ID), groups是用户所在组，这里既可以看到初始组，如果有附加组，则也能看到附加组<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```sh</span><br><span class="line">   [root@localhost ~]# usermod -G root lamp</span><br><span class="line">   #把用户加入root组</span><br><span class="line">   [root@localhost ~]# id lamp</span><br><span class="line">   uid=501(lamp) gid=501(lamp) groups=501(lamp),0(root)</span><br><span class="line">   #大家发现root组中加入了lamp用户的附加组信息</span><br></pre></td></tr></table></figure></code></pre></li></ol><h3 id="su-用户间切换">su 用户间切换</h3><p>Linux su（英文全拼：switch user）命令用于变更为其他使用者的身份，除 root 外，需要键入该使用者的密码。</p><p>📌<strong>su命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su [-options] username</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><font style="color:red;"><code>-</code></font></td><td>当前用户不仅切换为指定用户的身份，同时所用的工作环境也切换为此用户的环境<br/>（包括 PATH 变量、MAIL 变量等），使用 - 选项可省略用户名，默认会切换为 root 用户。</td></tr><tr><td><code>-l</code></td><td>同 - 的使用类似，也就是在切换用户身份的同时，完整切换工作环境，但后面需要添加欲切换的使用者账号。</td></tr><tr><td><code>-p</code>：<code>-m</code></td><td>表示切换为指定用户的身份，但不改变当前的工作环境（不使用切换用户的配置文件）。</td></tr><tr><td><code>-c 命令</code></td><td>仅切换用户执行一次命令，执行后自动切换回来，该选项后通常会带有要执行的命令。</td></tr></tbody></table><p>📌<strong><code>su</code> 和 <code>su -</code> 的区别</strong></p><p>使用 su 命令时，有 <code>- </code>和没有 <code>-</code> 是完全不同的，<code>-</code> 选项表示在切换用户身份的同时，连当前使用的环境变量也切换成指定用户的。我们知道，环境变量是用来定义操作系统环境的，因此如果系统环境没有随用户身份切换，很多命令无法正确执行。</p><p>📌<strong>示例说明</strong>：</p><ol><li><pre><code class="language-sh">#查询用户身份，我是lamp[lamp@localhost ~]$ whoamilamp#切换到root，但是没有切换环境变量。注意：普通用户切换到root需要密码[lamp@localhost ~]$ su root密码：&lt;-输入root密码[root@localhost ~]# env | grep lampUSER=lamp#查看环境变量，提取包含lamp的行PATH=/usr/lib/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/lamp/bin#命令査找的路径不包含超级用户路径MAIL=/var/spool/mail/lamp#邮箱、主目录、目前用户名还是lampPWD=/home/lampLOGNAME=lamp<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```sh</span><br><span class="line">   #当前我是lamp</span><br><span class="line">   [lamp@localhost ~]$ whoami</span><br><span class="line">   lamp</span><br><span class="line">   </span><br><span class="line">   #不切换成root，但是执行useradd命令添加user1用户</span><br><span class="line">   [lamp@localhost ~]$ su - -c &quot;useradd user1&quot; root</span><br><span class="line">   密码：</span><br><span class="line">   </span><br><span class="line">   #我还是lamp</span><br><span class="line">   [lamp@localhost ~]$ whoami</span><br><span class="line">   lamp</span><br><span class="line">   </span><br><span class="line">   #user用户已经添加了</span><br><span class="line">   [lamp@localhost ~]$ grep &quot;user1&#x27; /etc/passwd</span><br><span class="line">   userl:x:502:504::/home/user1:/bin/bash</span><br></pre></td></tr></table></figure></code></pre></li></ol><h3 id="groupadd-添加用户组">groupadd 添加用户组</h3><p>💾<code>/etc/group</code> <code>/etc/gshadow</code> <code>/etc/login.defs</code></p><p>📌<strong>groupadd命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd [-options] groupname</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-g</td><td>指定新建工作组的 id</td></tr><tr><td>-r</td><td>创建系统工作组，系统工作组的组 ID 小于 500</td></tr><tr><td>-K</td><td>覆盖配置文件 <code>/etc/login.defs</code></td></tr><tr><td>-o</td><td>允许添加组 ID 号不唯一的工作组</td></tr><tr><td>-f：–force</td><td>如果指定的组已经存在，此选项将失明了仅以成功状态退出。当与 -g 一起使用，并且指定的 GID_MIN 已经存在时，选择另一个唯一的 GID（即 -g 关闭）</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加group1组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># groupadd group1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;group1&quot; /etc/group</span></span><br><span class="line">/etc/group:group1:x:502:</span><br><span class="line">/etc/gshadow:group1:!::</span><br></pre></td></tr></table></figure><h3 id="groupmod-修改用户组">groupmod 修改用户组</h3><p>Linux groupmod命令用于更改群组识别码或名称。需要更改群组的识别码或名称时，可用groupmod指令来完成这项工作。</p><p>⚠️ <font style="color:red;">**注意！**用户名不要随意修改，组名和 GID 也不要随意修改，因为非常容易导致管理员逻辑混乱。如果非要修改用户名或组名，则建议大家先删除旧的，再建立新的。</font></p><p>📌<strong>groupmod命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupmod [-options] groupname</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-g &lt;群组识别码&gt;</td><td>设置欲使用的群组识别码</td></tr><tr><td>-o</td><td>重复使用群组识别码</td></tr><tr><td>-n &lt;新群组名称&gt;</td><td>设置欲使用的群组名称</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#把组名group1修改为testgrp</span></span><br><span class="line">[root@localhost ~]<span class="comment"># groupmod -n testgrp group1</span></span><br><span class="line"><span class="comment">#注意GID还是502，但是组名已经改变</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;testgrp&quot; /etc/group</span></span><br><span class="line">testgrp:x:502:</span><br></pre></td></tr></table></figure><p><strong>groupdel 刪除用户组</strong></p><p>Linux groupdel命令用于删除群组。需要从系统上删除群组时，可用groupdel(group delete)指令来完成这项工作。倘若该群组中仍包括某些用户，则必须先删除这些用户后，方能删除群组。</p><p>⚠️ <font style="color:red;">**注意！**不能使用 groupdel 命令随意删除群组。此命令仅适用于删除那些 “不是任何用户初始组” 的群组，换句话说，如果有群组还是某用户的初始群组，则无法使用 groupdel 命令成功删除。</font></p><p>📌<strong>groupdel命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupdel groupname</span><br></pre></td></tr></table></figure><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># useradd temp</span></span><br><span class="line"><span class="comment">#运行如下命令，可以看到 temp 用户建立的同时，还创建了 temp 群组，且将其作为 temp用户的初始组（组ID都是 505）</span></span><br><span class="line">[root@localhost ~]<span class="comment"># grep &quot;temp&quot; /etc/passwd /etc/group /etc/gshadow</span></span><br><span class="line">/etc/passwd:temp:x:505:505::/home/temp:/bin/bash</span><br><span class="line">/etc/group:temp:x:505:</span><br><span class="line">/etc/gshadow:temp:!::</span><br><span class="line"><span class="comment">#下面尝试删除 temp 群组</span></span><br><span class="line">[root@localhost ~]<span class="comment"># groupdel temp</span></span><br><span class="line">groupdel:cannot remove the primary group of user <span class="string">&#x27;temp&#x27;</span></span><br></pre></td></tr></table></figure><p>可以看到，groupdel 命令删除 temp 群组失败，且提示“不能删除 temp 用户的初始组”。如果一定要删除 temp 群组，要么修改 temp 用户的 GID，也就是将其初始组改为其他群组，要么先删除 temp 用户。</p><h3 id="gpasswd-把用户添加进组或从组中删除">gpasswd 把用户添加进组或从组中删除</h3><p>可设置多个普通用户作为群组的管理员，但也只能做“将用户加入群组”和“将用户移出群组”的操作。</p><p>📌<strong>gpasswd命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpasswd [-options] groupname</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td></td><td>选项为空时，表示给群组设置密码（仅 root 用户可用）</td></tr><tr><td><code>-A user1,...</code></td><td>将群组的控制权交给 user1,… 等用户管理，也就是说，设置 user1,… 等用户为群组的管理员（仅 root 用户可用）</td></tr><tr><td><code>-M user1,...</code></td><td>将 user1,… 加入到此群组中（仅 root 用户可用）</td></tr><tr><td><code>-r</code></td><td>移除群组的密码（仅 root 用户可用）</td></tr><tr><td><code>-R</code></td><td>让群组的密码失效（仅 root 用户可用）</td></tr><tr><td><code>-a user</code></td><td>将 user 用户加入到群组中</td></tr><tr><td><code>-d user</code></td><td>将 user 用户从群组中移除</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>设置 lamp 用户为 group1 群组的管理员：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建新群组 group1，并将群组交给 lamp 管理</span></span><br><span class="line">[root@localhost ~]# groupadd group1  &lt;-- 创建群组</span><br><span class="line">[root@localhost ~]# gpasswd group1   &lt;-- 设置密码吧！</span><br><span class="line">Changing the password for group group1</span><br><span class="line">New Password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">[root@localhost ~]# gpasswd -A lamp group1  &lt;==加入群组管理员为 lamp</span><br><span class="line">[root@localhost ~]# grep &quot;group1&quot; /etc/group /etc/gshadow</span><br><span class="line">/etc/group:group1:x:506:</span><br><span class="line">/etc/gshadow:group1:$1$I5ukIY1.$o5fmW.cOsc8.K.FHAFLWg0:lamp:</span><br></pre></td></tr></table></figure></li><li><p>用群主管理员加入群主成员:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以lamp用户登陆系统，并将用户 lamp 和 lamp1 加入group1群组。</span></span><br><span class="line">[lamp@localhost ~]#gpasswd -a lamp group1</span><br><span class="line">[lamp@localhost ~]#gpasswd -a lamp1 group1</span><br><span class="line">[lamp@localhost ~]#grep &quot;group1&quot; /etc/group</span><br><span class="line">group1:x:506:lamp,lamp1</span><br></pre></td></tr></table></figure></li><li><p>使用 <code>usermod -G</code> 命令也可以将用户加入群组，但会产生一个问题，即使用此命令将用户加入到新的群组后，该用户之前加入的那些群组都将被清空:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">新创建一个群组group2</span></span><br><span class="line">[root@localhost ~]# groupadd group2</span><br><span class="line">[root@localhost ~]# usermod -G group2 lamp</span><br><span class="line">[root@localhost ~]# grep &quot;group2&quot; /etc/group</span><br><span class="line">group2:x:509:lamp</span><br><span class="line">[root@localhost ~]# grep &quot;group1&quot; /etc/group</span><br><span class="line">group1:x:506:lamp1</span><br></pre></td></tr></table></figure><p>对比例 2 可以发现，虽然使用 usermod 命令成功地将 lamp 用户加入在 group2 群组中，但 lamp 用户原本在 group1 群组中，此时却被移出，这就是使用 usermod 命令造成的。因此，将用户加入或移出群组，最好使用 gpasswd 命令。</p></li></ol><h3 id="newgrp-切换用户的有效组">newgrp 切换用户的有效组</h3><p>newgrp 命令可以从用户的附加组中选择一个群组，作为用户新的初始组。</p><p>每个用户可以属于一个初始组（用户是这个组的初始用户），也可以属于多个附加组（用户是这个组的附加用户）。用户可以属于这么多用户组，用户在创建文件后，初始用户组的组身份生效。既然用户属于多个用户组，能不能改变用户的初始组呢？使用命令 newgrp 就可以。</p><p>📌<strong>newgrp命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newgp groupname</span><br></pre></td></tr></table></figure><p>📌<strong>命令的底层实现</strong>：</p><p>newgrp 命令每一次切换用户的初始组，该用户都会以另外一个 shell（新进程，也可以说是子进程）登陆，只不过在新 shell 上登陆的该用户，其初始组改变了而已。</p><blockquote><p>以下实例中，通过添加 shell 内置命令 “echo $$” 就可以发现，每次使用 newgrp 命令，都会切换到一个新的进程。</p></blockquote><p>在本节实例中，使用 newgrp 命令切换用户初始组的整个过程：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2-1Z4121K230D9.gif" alt="newgrp 切换初始组程序运行过程图"></p><p>📌<strong>示例说明</strong>：</p><p>通过一个实例，讲解此命令的具体用法和功能：</p><ol><li><p>首先，建立 3 个用户组 group1、group2 和 group3，命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# groupadd group1</span><br><span class="line">[root@localhost ~]# groupadd group2</span><br><span class="line">[root@localhost ~]# groupadd group3</span><br></pre></td></tr></table></figure></li><li><p>创建一个用户 user1，同时指定 user1 的初始组为 group1，附加组为 group2 和 group3，执行命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# useradd -g group1 -G group2,group3 user1</span><br><span class="line">\#由于指定了初始组，因此不会在创建 user1 默认群组</span><br><span class="line">[root@localhost ~]# more /etc/group | grep user1</span><br><span class="line">group2:x:501:user1</span><br><span class="line">group3:x:502:user1</span><br></pre></td></tr></table></figure></li><li><p>对用户 user1 设置密码，执行命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# passwd user1</span><br><span class="line">Changing password for user user1.</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure></li><li><p>切换至 user1 用户，通过 newgrp 切换用户组进行下列操作，读者可从中体会出 newgrp 命令的作用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">\#切换至 user1 用户</span><br><span class="line">[root@localhost ~]# su - user1</span><br><span class="line">[root@localhost ~]# whoami</span><br><span class="line">user1</span><br><span class="line">\#使用 newgrp 命令一边切换 user1 的初始组，一边创建文件</span><br><span class="line">[root@localhost ~]# mkdir user1_doc</span><br><span class="line">[root@localhost ~]# newgrp group2</span><br><span class="line">[root@localhost ~]# mkdir user2_doc</span><br><span class="line">[root@localhost ~]# newgrp group3</span><br><span class="line">[root@localhost ~]# mkdir user3_doc</span><br><span class="line">\#查看各文件的详细信息</span><br><span class="line">[root@localhost ~]# ll</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 user1 group1 4096 Oct 24 01:18 user1_doc</span><br><span class="line">drwxr-xr-x 2 user1 group2 4096 Oct 24 01:18 user2_doc</span><br><span class="line">drwxr-xr-x 2 user1 group3 4096 Oct 24 01:19 user3_doc</span><br></pre></td></tr></table></figure></li></ol><p>​   通过使用 newgrp 命令切换用户的初始组，所创建的文件各自属于不同的群组，这就是 newgrp 所发挥的作用，即通过切换附加组成为新的初始组，从而让用户获得使用各个附加组的权限。</p><hr><h2 id="系统管理">系统管理</h2><h3 id="进程管理">进程管理</h3><p>无论是 Linux 系统管理员还是普通用户，监视系统进程的运行情况并适时终止一些失控的进程，是每天的例行事务。和 Linux 系统相比，进程管理在 Windows 中更加直观，它主要是使用&quot;任务管理器&quot;来进行进程管理的。</p><p><strong>📌使用&quot;任务管理器&quot;目的</strong></p><ol><li><p>利用&quot;应用程序&quot;和&quot;进程&quot;标签来査看系统中到底运行了哪些程序和进程；</p></li><li><p>利用&quot;性能&quot;和&quot;用户&quot;标签来判断服务器的健康状态；</p></li><li><p>在&quot;应用程序&quot;和&quot;进程&quot;标签中强制中止任务和进程；</p></li></ol><p>📌<strong>进程和程序</strong></p><p>进程是正在执行的一个程序或命令，每个进程都是一个运行的实体，都有自己的地址空间，并占用一定的系统资源。程序是人使用计算机语言编写的可以实现特定目标或解决特定问题的代码集合。</p><p>这么讲很难理解，那我们换一种说法。程序是人使用计算机语言编写的，可以实现一定功能，并且可以执行的代码集合。而进程是正在执行中的程序。当程序被执行时，执行人的权限和属性，以及程序的代码都会被加载入内存，操作系统给这个进程分配一个 ID，称为 PID（进程 ID）。</p><p>也就是说，在操作系统中，所有可以执行的程序与命令都会产生进程。只是有些程序和命令非常简单，如 ls 命令、touch 命令等，它们在执行完后就会结束，相应的进程也就会终结，所以我们很难捕捉到这些进程。但是还有一些程和命令，比如 httpd 进程，启动之后就会一直驻留在系统当中，我们把这样的进程称作常驻内存进程。</p><p>某些进程会产生一些新的进程，我们把这些进程称作子进程，而把这个进程本身称作父进程。比如，我们必须正常登录到 Shell 环境中才能执行系统命令，而 Linux 的标准 Shell 是 bash。我们在 bash 当中执行了 ls 命令，那么 bash 就是父进程，而 ls 命令是在 bash 进程中产生的进程，所以 ls 进程是 bash 进程的子进程。也就是说，子进程是依赖父进程而产生的，如果父进程不存在，那么子进程也不存在了。</p><p>📌<strong>进程管理的作用</strong></p><p>在使用 Windows 系统的过程中，使用任务管理器，很大程度上是为了强制关闭“未反应”的软件，也就是杀死进程。的确，这是很多使用进程管理工具或进程管理命令的人最常见的使用方法。不过，杀死进程（强制中止进程）只是进程管理工作中最不常用的手段，因为每个进程都有自己正确的结束方法，而杀死进程是在正常方法已经失效的情况下的后备手段。</p><p>进程管理主要有以下 3 个作用：</p><ol><li><p>判断服务器的健康状态</p><p>运维工程师最主要的工作就是保证服务器安全、稳定地运行。理想的状态是，在服务器出现问题，但是还没有造成服务器宕机或停止服务时，就人为干预解决了问题。</p><p>进程管理最主要的工作就是判断服务器当前运行是否健康，是否需要人为干预。如果服务器的 CPU 占用率、内存占用率过高，就需要人为介入解决问题了。这又出现了一个问题，我们发现服务器的 CPU 或内存占用率很高，该如何介入呢？是直接终止高负载的进程吗？</p><p>当然不是，应该判断这个进程是否是正常进程，如果是正常进程，则说明你的服务器已经不能满足应用需求，你需要更好的硬件或搭建集群了；如果是非法进程占用了系统资源，则更不能直接中止进程，而要判断非法进程的来源、作用和所在位置，从而把它彻底清除。</p><p>当然，如果服务器数量很少，我们完全可以人为通过进程管理命令来进行监控与干预，但如果服务器数量较多，那么人为手工监控就变得非常困难了，这时我们就需要相应的监控服务，如 cacti 或 nagios。总之，进程管理工作中最重要的工作就是判断服务器的健康状 态，最理想的状态是服务器宕机之前就解决问题，从而避免服务器的宕机。</p></li><li><p>查看系统中所有的进程</p><p>我们需要查看看系统中所有正在运行的进程，通过这些进程可以判断系统中运行了哪些服务、是否有非法服务在运行。</p></li><li><p>杀死进程</p><p>这是进程管理中最不常用的手段。当需要停止服务时，会通过正确关闭命令来停止服务（如 apache 服务可以通过 service httpd stop 命令来关闭）。只有在正确终止进程的手段失效的情况下，才会考虑使用 kill 命令杀死进程。</p><p>其实，进程管理和 Windows 中任务管理器的作用非常类似，不过大家在使用任务管理器时是为了杀死进程，而不是为了判断服务器的健康状态。</p></li></ol><h3 id="ps-查看正在运行的进程">ps 查看正在运行的进程</h3><p>📌<strong>ps命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps [[-]options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><p>ps 命令有些与众不同，它的部分选项不能加入&quot;-“，比如命令&quot;ps aux”，其中&quot;aux&quot;是选项，但是前面不能带“-”。</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>a</td><td>显示一个终端的所有进程，除会话引线外；</td></tr><tr><td>u</td><td>显示进程的归属用户及内存的使用情况；</td></tr><tr><td>x</td><td>显示没有控制终端的进程；</td></tr><tr><td>-l</td><td>长格式显示更加详细的信息；</td></tr><tr><td>-e</td><td>显示所有进程；</td></tr><tr><td>-f</td><td>查看子父进程的关系；</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p><code>-ef</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ps -ef|grep nginx</span></span><br><span class="line">root        841      1  0 2月17 ?       00:00:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">nginx       843    841  0 2月17 ?       00:00:02 nginx: worker process</span><br><span class="line">nginx       916    819  0 2月17 ?       00:00:15 php-fpm: pool www</span><br><span class="line">nginx       923    819  0 2月17 ?       00:00:16 php-fpm: pool www</span><br><span class="line">...省略部分数据...</span><br></pre></td></tr></table></figure></li><li><p><code>aux</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps aux</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看系统中所有的进程</span></span><br><span class="line">USER PID %CPU %MEM  VSZ  RSS   TTY STAT START TIME COMMAND</span><br><span class="line">root   1  0.0  0.2 2872 1416   ?   Ss   Jun04 0:02 /sbin/init</span><br><span class="line">root   2  0.0  0.0    0    0   ?    S   Jun04 0:00 [kthreadd]</span><br><span class="line">root   3  0.0  0.0    0    0   ?    S   Jun04 0:00 [migration/0]</span><br><span class="line">root   4  0.0  0.0    0    0   ?    S   Jun04 0:00 [ksoftirqd/0]</span><br><span class="line">…省略部分输出…</span><br></pre></td></tr></table></figure><table><thead><tr><th>表头</th><th>含义</th></tr></thead><tbody><tr><td>USER</td><td>该进程是由哪个用户产生的。</td></tr><tr><td>PID</td><td>进程的 ID。</td></tr><tr><td>%CPU</td><td>该进程占用 CPU 资源的百分比，占用的百分比越高，进程越耗费资源。</td></tr><tr><td>%MEM</td><td>该进程占用物理内存的百分比，占用的百分比越高，进程越耗费资源。</td></tr><tr><td>VSZ</td><td>该进程占用虚拟内存的大小，单位为 KB。</td></tr><tr><td>RSS</td><td>该进程占用实际物理内存的大小，单位为 KB。</td></tr><tr><td>TTY</td><td>该进程是在哪个终端运行的。其中，tty1 ~ tty7 代表本地控制台终端（可以通过 Alt+F1 ~ F7 快捷键切换不同的终端），tty1~tty6 是本地的字符界面终端，tty7 是图形终端。pts/0 ~ 255 代表虚拟终端，一般是远程连接的终端，第一个远程连接占用 pts/0，第二个远程连接占用 pts/1，依次増长。</td></tr><tr><td>STAT</td><td>进程状态。常见的状态有以下几种：-D：不可被唤醒的睡眠状态，通常用于 I/O 情况。-R：该进程正在运行。-S：该进程处于睡眠状态，可被唤醒。-T：停止状态，可能是在后台暂停或进程处于除错状态。-W：内存交互状态（从 2.6 内核开始无效）。-X：死掉的进程（应该不会出现）。-Z：僵尸进程。进程已经中止，但是部分程序还在内存当中。-&lt;：高优先级（以下状态在 BSD 格式中出现）。-N：低优先级。-L：被锁入内存。-s：包含子进程。-l：多线程（小写 L）。-+：位于后台。</td></tr><tr><td>START</td><td>该进程的启动时间。</td></tr><tr><td>TIME</td><td>该进程占用 CPU 的运算时间，注意不是系统时间。</td></tr><tr><td>COMMAND</td><td>产生此进程的命令名。</td></tr></tbody></table></li><li><p><code>-le</code></p><p>&quot;ps aux&quot;命令可以看到系统中所有的进程，&quot;ps -le&quot;命令也能看到系统中所有的进程。由于 “-l” 选项的作用，所以 “ps -le” 命令能够看到更加详细的信息，比如父进程的 PID、优先级等。但是这两个命令的基本作用是一致的，掌握其中一个就足够了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps -le</span><br><span class="line">F S UID PID PPID C  PRI Nl ADDR  SZ WCHAN TTY      TIME  CMD</span><br><span class="line">4 S   0   1    0 0  80   0 -    718 -     ?    00:00:02  init</span><br><span class="line">1 S   0   2    0 0  80   0 -      0 -     ?    00:00:00  kthreadd</span><br><span class="line">1 S   0   3    2 0 -40   - -      0 -     ?    00:00:00  migration/0</span><br><span class="line">1 S   0   4    2 0  80   0 -      0 -     ?    00:00:00  ksoflirqd/0</span><br><span class="line">1 S   0   5    2 0 -40   - -      0 -     ?    00:00:00  migration/0</span><br><span class="line">…省略部分输出…</span><br></pre></td></tr></table></figure><table><thead><tr><th>表头</th><th>含义</th></tr></thead><tbody><tr><td>F</td><td>进程标志，说明进程的权限，常见的标志有两个: 1：进程可以被复制，但是不能被执行；4：进程使用超级用户权限；</td></tr><tr><td>S</td><td>进程状态。具体的状态和&quot;psaux&quot;命令中的 STAT 状态一致；</td></tr><tr><td>UID</td><td>运行此进程的用户的 ID；</td></tr><tr><td>PID</td><td>进程的 ID；</td></tr><tr><td>PPID</td><td>父进程的 ID；</td></tr><tr><td>C</td><td>该进程的 CPU 使用率，单位是百分比；</td></tr><tr><td>PRI</td><td>进程的优先级，数值越小，该进程的优先级越高，越早被 CPU 执行；</td></tr><tr><td>NI</td><td>进程的优先级，数值越小，该进程越早被执行；</td></tr><tr><td>ADDR</td><td>该进程在内存的哪个位置；</td></tr><tr><td>SZ</td><td>该进程占用多大内存；</td></tr><tr><td>WCHAN</td><td>该进程是否运行。&quot;-&quot;代表正在运行；</td></tr><tr><td>TTY</td><td>该进程由哪个终端产生；</td></tr><tr><td>TIME</td><td>该进程占用 CPU 的运算时间，注意不是系统时间；</td></tr><tr><td>CMD</td><td>产生此进程的命令名；</td></tr></tbody></table></li></ol><h3 id="top-持续监听进程运行状态">top 持续监听进程运行状态</h3><p>top 命令可以动态地持续监听进程地运行状态，与此同时，该命令还提供了一个交互界面，用户可以根据需要，人性化地定制自己的输出，进而更清楚地了进程的运行状态。</p><p>📌<strong>top命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-d 秒数</td><td>指定 top 命令每隔几秒更新。默认是 3 秒；</td></tr><tr><td>-b</td><td>使用批处理模式输出。一般和&quot;-n&quot;选项合用，用于把 top 命令重定向到文件中；</td></tr><tr><td>-n 次数</td><td>指定 top 命令执行的次数。一般和&quot;-&quot;选项合用；</td></tr><tr><td>-p 进程PID</td><td>仅查看指定 ID 的进程；</td></tr><tr><td>-s</td><td>使 top 命令在安全模式中运行，避免在交互模式中出现错误；</td></tr><tr><td>-u 用户名</td><td>只监听某个用户的进程。</td></tr></tbody></table><p>📌<strong>交互命令</strong>：</p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>?：h</td><td>显示交互模式的帮助；</td></tr><tr><td>P</td><td>按照 CPU 的使用率排序，默认就是此选项；</td></tr><tr><td>M</td><td>按照内存的使用率排序；</td></tr><tr><td>N</td><td>按照 PID 排序；</td></tr><tr><td>T</td><td>按照 CPU 的累积运算时间排序，也就是按照 TIME+ 项排序；</td></tr><tr><td>k</td><td>按照 PID 给予某个进程一个信号。一般用于中止某个进程，信号 9 是强制中止的信号；</td></tr><tr><td>r</td><td>按照 PID 给某个进程重设优先级（Nice）值；</td></tr><tr><td>q</td><td>退出 top 命令。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>top 命令的执行结果</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# top</span><br><span class="line">top - 12:26:46 up 1 day, 13:32, 2 users, load average: 0.00, 0.00, 0.00</span><br><span class="line">Tasks: 95 total, 1 running, 94 sleeping, 0 stopped, 0 zombie</span><br><span class="line">Cpu(s): 0.1%us, 0.1%sy, 0.0%ni, 99.7%id, 0.1%wa, 0.0%hi, 0.1%si, 0.0%st</span><br><span class="line">Mem: 625344k total, 571504k used, 53840k free, 65800k buffers</span><br><span class="line">Swap: 524280k total, 0k used, 524280k free, 409280k cached</span><br><span class="line">PID   USER PR NI VIRT  RES  SHR S %CPU %MEM   TIME+ COMMAND</span><br><span class="line">19002 root 20  0 2656 1068  856 R  0.3  0.2 0:01.87 top</span><br><span class="line">1     root 20  0 2872 1416 1200 S  0.0  0.2 0:02.55 init</span><br><span class="line">2     root 20  0    0    0    0 S  0.0  0.0 0:00.03 kthreadd</span><br><span class="line">3     root RT  0    0    0    0 S  0.0  0.0 0:00.00 migration/0</span><br><span class="line">4     root 20  0    0    0    0 S  0.0  0.0 0:00.15 ksoftirqd/0</span><br><span class="line">5     root RT  0    0    0    0 S  0.0  0.0 0:00.00 migration/0</span><br><span class="line">6     root RT  0    0    0    0 S  0.0  0.0 0:10.01 watchdog/0</span><br><span class="line">7     root 20  0    0    0    0 S  0.0  0.0 0:05.01 events/0</span><br><span class="line">8     root 20  0    0    0    0 S  0.0  0.0 0:00.00 cgroup</span><br><span class="line">9     root 20  0    0    0    0 S  0.0  0.0 0:00.00 khelper</span><br><span class="line">10    root 20  0    0    0    0 S  0.0  0.0 0:00.00 netns</span><br><span class="line">11    root 20  0    0    0    0 S  0.0  0.0 0:00.00 async/mgr</span><br><span class="line">12    root 20  0    0    0    0 S  0.0  0.0 0:00.00 pm</span><br><span class="line">13    root 20  0    0    0    0 S  0.0  0.0 0:01.70 sync_supers</span><br><span class="line">14    root 20  0    0    0    0 S  0.0  0.0 0:00.63 bdi-default</span><br><span class="line">15    root 20  0    0    0    0 S  0.0  0.0 0:00.00 kintegrityd/0</span><br><span class="line">16    root 20  0    0    0    0 S  0.0  0.0 0:02.52 kblockd/0</span><br><span class="line">17    root 20  0    0    0    0 S  0.0  0.0 0:00.00 kacpid</span><br><span class="line">18    root 20  0    0    0    0 S  0.0  0.0 0:00.00 kacpi_notify</span><br></pre></td></tr></table></figure><p>我们解释一下命令的输出。top 命令的输出内容是动态的，默认每隔 3 秒刷新一次。命令的输出主要分为两部分：</p><p><strong>第一部分</strong>是前五行（显示的是整个系统的资源使用状况，我们就是通过这些输出来判断服务器的资源使用状态的）</p><p>1.第一行为任务队列信息</p><table><thead><tr><th>内 容</th><th>说 明</th></tr></thead><tbody><tr><td>12:26:46</td><td>系统当前时间</td></tr><tr><td>up 1 day, 13:32</td><td>系统的运行时间.本机己经运行 1 天 13 小时 32 分钟</td></tr><tr><td>2 users</td><td>当前登录了两个用户</td></tr><tr><td>load average: 0.00,0.00，0.00</td><td>系统在之前 1 分钟、5 分钟、15 分钟的平均负载。如果 CPU 是单核的，则这个数值超过 1 就是高负载：如果 CPU 是四核的，则这个数值超过 4 就是高负载 （这个平均负载完全是依据个人经验来进行判断的，一般认为不应该超过服务器 CPU 的核数）</td></tr></tbody></table><p>2.第二行为进程信息</p><table><thead><tr><th>内 容</th><th>说 明</th></tr></thead><tbody><tr><td>Tasks: 95 total</td><td>系统中的进程总数</td></tr><tr><td>1 running</td><td>正在运行的进程数</td></tr><tr><td>94 sleeping</td><td>睡眠的进程数</td></tr><tr><td>0 stopped</td><td>正在停止的进程数</td></tr><tr><td>0 zombie</td><td>僵尸进程数。如果不是 0，则需要手工检查僵尸进程</td></tr></tbody></table><p>3.第三行为 CPU 信息</p><table><thead><tr><th>内 容</th><th>说 明</th></tr></thead><tbody><tr><td>Cpu(s): 0.1 %us</td><td>用户模式占用的 CPU 百分比</td></tr><tr><td>0.1%sy</td><td>系统模式占用的 CPU 百分比</td></tr><tr><td>0.0%ni</td><td>改变过优先级的用户进程占用的 CPU 百分比</td></tr><tr><td>99.7%id</td><td>空闲 CPU 占用的 CPU 百分比</td></tr><tr><td>0.1%wa</td><td>等待输入/输出的进程占用的 CPU 百分比</td></tr><tr><td>0.0%hi</td><td>硬中断请求服务占用的 CPU 百分比</td></tr><tr><td>0.1%si</td><td>软中断请求服务占用的 CPU 百分比</td></tr><tr><td>0.0%st</td><td>st（steal time）意为虚拟时间百分比，就是当有虚拟机时，虚拟 CPU 等待实际 CPU 的时间百分比</td></tr></tbody></table><p>4.四行为物理内存信息</p><table><thead><tr><th>内 容</th><th>说 明</th></tr></thead><tbody><tr><td>Mem: 625344k total</td><td>物理内存的总量，单位为KB</td></tr><tr><td>571504k used</td><td>己经使用的物理内存数量</td></tr><tr><td>53840k&amp;ee</td><td>空闲的物理内存数量。我们使用的是虚拟机，共分配了 628MB内存，所以只有53MB的空闲内存</td></tr><tr><td>65800k buffers</td><td>作为缓冲的内存数量</td></tr></tbody></table><p>5.第五行为交换分区（swap）信息</p><table><thead><tr><th>内 容</th><th>说 明</th></tr></thead><tbody><tr><td>Swap: 524280k total</td><td>交换分区（虚拟内存）的总大小</td></tr><tr><td>Ok used</td><td>已经使用的交换分区的大小</td></tr><tr><td>524280k free</td><td>空闲交换分区的大小</td></tr><tr><td>409280k cached</td><td>作为缓存的交换分区的大小</td></tr></tbody></table><p>我们通过 top 命令的第一部分就可以判断服务器的健康状态。如果 1 分钟、5 分钟、15 分钟的平均负载高于 1，则证明系统压力较大。如果 CPU 的使用率过高或空闲率过低，则证明系统压力较大。如果物理内存的空闲内存过小，则也证明系统压力较大。</p><p>这时，我们就应该判断是什么进程占用了系统资源。如果是不必要的进程，就应该结束这些进程；如果是必需进程，那么我们该増加服务器资源（比如増加虚拟机内存），或者建立集群服务器。</p><p>解释一下缓冲（buffer）和缓存（cache）的区别：<font style="color:red;">（缓存（cache）是用来加速数据从硬盘中&quot;读取&quot;的，而缓冲（buffer）是用来加速数据&quot;写入&quot;硬盘的）</font></p><ul><li>缓存（cache）是在读取硬盘中的数据时，把最常用的数据保存在内存的缓存区中，再次读取该数据时，就不去硬盘中读取了，而在缓存中读取。</li></ul></li></ol><ul><li>缓冲（buffer）是在向硬盘写入数据时，先把数据放入缓冲区,然后再一起向硬盘写入，把分散的写操作集中进行，减少磁盘碎片和硬盘的反复寻道，从而提高系统性能。</li></ul><p><strong>第二部分</strong>从第六行开始（显示的是系统中进程的信息）</p><ul><li><p>PID：进程的 ID。</p></li><li><p>USER：该进程所属的用户。</p><ul><li><p>PR：优先级，数值越小优先级越高。</p></li><li><p>NI：优先级，数值越小、优先级越高。</p></li><li><p>VIRT：该进程使用的虚拟内存的大小，单位为 KB。</p></li><li><p>RES：该进程使用的物理内存的大小，单位为 KB。</p></li><li><p>SHR：共享内存大小，单位为 KB。</p></li><li><p>S：进程状态。</p></li><li><p>%CPU：该进程占用 CPU 的百分比。</p></li><li><p>%MEM：该进程占用内存的百分比。</p></li><li><p>TIME+：该进程共占用的 CPU 时间。</p></li><li><p>COMMAND：进程的命令名。</p></li></ul></li></ul><ol start="2"><li><p>top 命令如果不正确退出，则会持续运行。在 top 命令的交互界面中按 “q” 键会退出 top 命令；也可以按 “?” 或 “h” 键得到 top 命令交互界面的帮助信息；还可以按键中止某个进程。比如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># top</span></span><br><span class="line">top - 14:10:15 up 1 day, 15:15， 3 <span class="built_in">users</span>, load average: 0.00，0.00, 0.00</span><br><span class="line">Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie</span><br><span class="line">Cpu(s): 0.0%us, 0.0%sy, 0.0%ni,100.0%<span class="built_in">id</span>, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st</span><br><span class="line">Mem: 625344k total, 574248k used, 51096k free, 66840k buffers</span><br><span class="line">Swap: 524280k total, Ok used, 524280k free, 409324k cached</span><br><span class="line">PID to <span class="built_in">kill</span>:15273</span><br><span class="line"><span class="comment">#按&quot;k&quot;键，会提示输入要杀死进程的PID</span></span><br><span class="line">PID     USER PR NI VIRT  RES SHR S %CPU %MEM   TIME+ COMMAND</span><br><span class="line">15273 daemon 20  0 4520 1192 580 S  0.0 0.2  0:00.00 httpd</span><br><span class="line">..省略部分输出...</span><br></pre></td></tr></table></figure></li><li><p>输入要中止进程的 PID，比如要中止 <code>15273</code> 这个 apache 进程，接下来 top 命令提示我们输入信号，信号 <code>9</code> 代表强制中止，这时就能够强制中止 15273 进程了：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   top - 14:11:42 up 1 day, 15:17， 3 <span class="built_in">users</span>, load average: 0.00，0.00, 0.00</span><br><span class="line">   Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie</span><br><span class="line">   Cpu(s): 0.0%us, 0.3%sy, 0.0%ni, 99.7%<span class="built_in">id</span>, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st</span><br><span class="line">   Mem: 625344k total, 574248k used, 51096k free, 66856k buffers</span><br><span class="line">   Swap: 524280k total, 0k used, 524280k free, 409324k cached</span><br><span class="line">   Kill PID 15273 with signal [15]:9</span><br><span class="line">   <span class="comment">#提示输入信号，信号9代表强制中止</span></span><br><span class="line">   PID     USER PR NI VIRT  RES SHR S %CPU %MEM   TIME+ COMMAND</span><br><span class="line">   15273 daemon 20  0 4520 1192 580 S 0.0   0.2 0:00.00 httpd</span><br><span class="line">   …省略部分输出…</span><br><span class="line"></span><br><span class="line">4. 改变某个进程的优先级，就要利用 `r` 交互命令：需要注意的是，我们能够修改的只有 NI（Nice） 的优先级，而不能修改 PR（Priority） 的优先级。</span><br><span class="line"></span><br><span class="line">   ```sh</span><br><span class="line">   [root@localhost ~]<span class="comment"># top -p 18977</span></span><br><span class="line">   top - 14:17:09 up 1 day, 15:22, 3 <span class="built_in">users</span>, load average: 0.00，0.00, 0.00</span><br><span class="line">   Tasks: 97 total, 1 running, 96 sleeping, 0 stopped, 0 zombie</span><br><span class="line">   Cpu(s): 0.3%us, 0.0%sy, 0.0%ni, 99.7%<span class="built_in">id</span>, 0.0%wa, 0.0%hi, 0.0%si, 0.0%st</span><br><span class="line">   Mem: 625344k total, 574124k used, 51220k free, 66896k buffers</span><br><span class="line">   Swap: 524280k total, 0k used, 524280k free, 409324k cached</span><br><span class="line">   PID to renice:</span><br><span class="line">   <span class="comment">#输入&quot;r&quot;交互命令之后，提示输入要修改优先级的进程的PID</span></span><br><span class="line">   PID   USER PR NI  VIRT  RES SHR  S %CPU %MEM   TIME+ COMMAND</span><br><span class="line">   18977 root 20 0  11592 3304 2572 S  0.0 0.5  0:04.37 sshd</span><br></pre></td></tr></table></figure><p>输入 “r” 交互命令，会提示输入需要修改优先级的进程的 PID:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Renice PID 18977 to value: 10</span><br><span class="line"><span class="comment">#输入PID后，需要输入Nice的优先级号</span></span><br><span class="line"><span class="comment">#我们把18977进程的优先级调整为10,回车后就能看到</span></span><br><span class="line">PID   USER PR NI  VIRT  RES SHR  S %CPU %MEM   TIME+ COMMAND</span><br><span class="line">18977 root 30 10 11592 3304 2572 R  0.0 0.5  0:04.38 sshd</span><br><span class="line"><span class="comment">#18977进程的优先级已经被修改了</span></span><br></pre></td></tr></table></figure></li><li><p>如果在操作终端执行 top 命令，则并不能看到系统中所有的进程，默认看到的只是 CPU 占比靠前的进程。如果我们想要看到所有的进程，则可以把 top 命令的执行结果重定向到文件中。不过 top 命令是持续运行的，这时就需要使用 “-b” 和 “-n” 选项了。具体命令如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># top -b -n 1 &gt; /root/top.log</span></span><br><span class="line"><span class="comment">#让top命令只执行一次，然后把执行结果保存到top.log文件中，这样就能看到所有的进程了</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="lsof-列出进程调用或打开的文件信息">lsof 列出进程调用或打开的文件信息</h3><p>lsof 命令，“list opened files”的缩写，直译过来，就是列举系统中已经被打开的文件。通过 lsof 命令，我们就可以根据文件找到对应的进程信息，也可以根据进程信息找到进程打开的文件。</p><p>📌<strong>lsof命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td><code>-c 字符串</code></td><td>只列出以字符串开头的进程打开的文件；</td></tr><tr><td><code>+d 目录名</code></td><td>列出某个目录中所有被进程调用的文件；</td></tr><tr><td><code>-u 用户名</code></td><td>只列出某个用户的进程打开的文件；</td></tr><tr><td><code>-p pid</code></td><td>列出某个 PID 进程打开的文件。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p><code>lsof</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsof | more</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询系统中所有进程调用的文件</span></span><br><span class="line">COMMAND PID  USER  FD    TYPE  DEVICE  SIZE/OFF  NODE  NAME</span><br><span class="line">init               1      root    cwd  DIR    8，3       4096        2           /</span><br><span class="line">init               1      root    rtd    DIR    8，3       4096        2           /</span><br><span class="line">init               1      root    txt     REG   8，3       145180    130874 /sbin/init</span><br><span class="line">init               1      root    mem REG   8，3       142472    665291 /lib/ld-2.12.so</span><br><span class="line">init               1      root    mem REG   8，3       58704      655087 /lib/libnss_files-2.12.so</span><br><span class="line">…省略部分输出…</span><br></pre></td></tr></table></figure><p>这个命令的输出非常多。它会按照 PID，从 1 号进程开始列出系统中所有的进程正在调用的文件名。</p></li><li><p><code>lsof 路径</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsof /sbin/init</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询某个文件被哪个进程调用</span></span><br><span class="line">COMMAND PID USER  FD  TYPE  DEVICE  SIZE/OFF  NODE    NAME</span><br><span class="line">init               1     root    txt  REG   8，3      145180     130874   /sbin/init</span><br></pre></td></tr></table></figure><p>lsof 命令也可以反过来查询某个文件被哪个进程调用。这个例子就查询到 /sbin/init 文件是被 init 进程调用的。</p></li></ol><h3 id="pstree-查看进程树">pstree 查看进程树</h3><p>Linux pstree(英文全称：display a tree of processes）) 命令将所有进程以树状图显示，树状图将会以 pid (如果有指定) 或是以 init 这个基本进程为根 (root)，如果有指定使用者 id，则树状图会只显示该使用者所拥有的进程。</p><p>📌<strong>pstree安装</strong>：</p><p>CentOS7 默认没有安装该命令。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install psmisc</span><br></pre></td></tr></table></figure><p>📌<strong>pstree命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree [-options] [[PID][userName]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-a</td><td>显示启动每个进程对应的完整指令，包括启动进程的路径、参数等。</td></tr><tr><td>-c</td><td>不使用精简法显示进程信息，即显示的进程中包含子进程和父进程。</td></tr><tr><td>-n</td><td>根据进程 PID 号来排序输出，默认是以程序名排序输出的。</td></tr><tr><td>-p</td><td>显示进程的 PID。</td></tr><tr><td>-u</td><td>显示进程对应的用户名称。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p><code>-p</code> 显示进程的 PID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]# pstree -p</span><br><span class="line">systemd(1)─┬─NetworkManager(542)─┬─dhclient(628)</span><br><span class="line">           │                     ├─&#123;NetworkManager&#125;(563)</span><br><span class="line">           │                     └─&#123;NetworkManager&#125;(567)</span><br><span class="line">...省略部分输出...</span><br><span class="line">           ├─sshd(893)───sshd(1146)─┬─bash(1150)───pstree(8599)#Pstree命令进程是在远程连接中被执行的</span><br><span class="line">           │                        ├─bash(1171)───top(1248)</span><br><span class="line">           │                        ├─bash(8589)───sleep(8598)</span><br><span class="line">           │                        └─sftp-server(1165)</span><br><span class="line">           ├─systemd-journal(367)</span><br><span class="line">           ├─systemd-logind(547)</span><br><span class="line">           ├─systemd-udevd(397)</span><br><span class="line">           ├─tuned(891)─┬─&#123;tuned&#125;(1139)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1140)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1142)</span><br><span class="line">           │            └─&#123;tuned&#125;(1143)</span><br><span class="line">           └─vmtoolsd(535)─┬─&#123;vmtoolsd&#125;(562)</span><br><span class="line">                           └─&#123;vmtoolsd&#125;(575)</span><br></pre></td></tr></table></figure></li><li><p>如果想知道某个用户都启动了哪些进程，使用 pstree 命令可以很容易实现：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@1ocalhost ~]# pstree mysql</span><br><span class="line">mysqid---6*[&#123;mysqid&#125;]</span><br></pre></td></tr></table></figure><p>此输出结果显示了 mysql 用户对应的进程为 mysqid，并且 mysqid 进程拥有 5 个子进程（外加 1 个父进程，共计 6 个进程）。</p></li></ol><h3 id="kill-终止进程">kill 终止进程</h3><p>kill 命令的执行原理是这样的，kill 命令会向操作系统内核发送一个信号（多是终止信号）和目标进程的 PID，然后系统内核根据收到的信号类型，对指定进程进行相应的操作。</p><p>⚠️ <font style="color:red;"><strong>注意！</strong><code>/user/sbin/sshd -D</code> 此守护进程不能关闭，否则将无法远程登录，需要去机房重启sshd服务守护进程要谨慎的处理否则可能会造成重大故障！</font></p><p>kill 命令只是“发送”一个信号，因此，只有当信号被程序成功“捕获”，系统才会执行 kill 命令指定的操作；反之，如果信号被“封锁”或者“忽略”，则 kill 命令将会失效。</p><p>📌<strong>kill命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> [-options] PID</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-l &lt;信息编号&gt;</code></td><td>打印指定编号的信息名称；<br />若不加&lt;信息编号&gt;选项，则 -l 参数会列出全部的信息名称</td></tr><tr><td><code>-&lt;信息名称或编号&gt; &lt;程序&gt;</code><br /><code>-s &lt;信息名称或编号&gt; &lt;程序&gt;</code></td><td>指定要送出的信息。<br /><code>-1 nginx</code>    #（以信息1为例）nginx 进程重启。<br />详情请看常用信息名称表。<br />&lt;程序&gt;可以是程序的PID或是PGID，也可以是工作编号。</td></tr></tbody></table><p>📌<strong>信息名称表</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]<span class="comment"># kill -l</span></span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX   </span><br></pre></td></tr></table></figure><p>常用信息名称表：</p><table><thead><tr><th>信息编号</th><th>信息名</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td>EXIT</td><td>程序退出时收到该信息。</td></tr><tr><td>1</td><td>HUP</td><td>挂掉电话线或终端连接的挂起信号，这个信号也会造成某些进程在没有终止的情况下重新初始化。</td></tr><tr><td>2</td><td>INT</td><td>表示结束进程，但并不是强制性的，常用的 “Ctrl+C” 组合键发出就是一个 kill -2 的信号。</td></tr><tr><td>3</td><td>QUIT</td><td>退出。</td></tr><tr><td>9</td><td>KILL</td><td>杀死进程，即强制结束进程。</td></tr><tr><td>11</td><td>SEGV</td><td>段错误。</td></tr><tr><td>15</td><td>TERM</td><td>正常结束进程，是 kill 命令的默认信号。</td></tr><tr><td>19</td><td>STOP</td><td>让进程暂停</td></tr></tbody></table><h3 id="killall-终止特定的一类进程">killall 终止特定的一类进程</h3><p>📌<strong>kill命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall [-options] [-signal] PID</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-i</code></td><td>交互式，询问是否要杀死某个进程</td></tr><tr><td><code>-l</code></td><td>忽略进程名的大小写</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>杀死 httpd 进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service httpd start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动RPM包默认安装的apache服务</span></span><br><span class="line">[root@localhost ~]# ps aux | grep &quot;httpd&quot; | grep -v &quot;grep&quot;</span><br><span class="line">root 1600 0.0 0.2 4520 1696? Ss 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line">daemon 1601 0.0 0.1 4520 1188? S 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line">daemon 1602 0.0 0.1 4520 1188? S 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line">daemon 1603 0.0 0.1 4520 1188? S 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line">daemon 1604 0.0 0.1 4520 1188? S 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line">daemon 1605 0.0 0.1 4520 1188? S 19:42 0:00 /usr/local/apache2/bin/httpd -k start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看httpd进程</span></span><br><span class="line">[root@localhost ~]# killall httpd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀死所有进程名是httpd的进程</span></span><br><span class="line">[root@localhost ~]# ps aux | grep &quot;httpd&quot; | grep -v &quot;grep&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询发现所有的httpd进程都消失了</span></span><br></pre></td></tr></table></figure></li><li><p>交互式杀死 sshd 进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ps aux | grep &quot;sshd&quot; | grep -v &quot;grep&quot;</span><br><span class="line">root 1733 0.0 0.1 8508 1008? Ss 19:47 0:00/usr/sbin/sshd</span><br><span class="line">root 1735 0.1 0.5 11452 3296? Ss 19:47 0:00 sshd: root@pts/0</span><br><span class="line">root 1758 0.1 0.5 11452 3296? Ss 19:47 0:00 sshd: root@pts/1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询系统中有3个sshd进程。1733是sshd服务的进程，1735和1758是两个远程连接的进程</span></span><br><span class="line">[root@localhost ~]# killall -i sshd</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">交互式杀死sshd进程</span></span><br><span class="line">杀死sshd(1733)?(y/N)n</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个进程是sshd的服务进程，如果杀死，那么所有的sshd连接都不能登陆</span></span><br><span class="line">杀死 sshd(1735)?(y/N)n</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是当前登录终端，不能杀死我自己吧</span></span><br><span class="line">杀死 sshd(1758)?(y/N)y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀死另一个sshd登陆终端</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="crontab-循环执行定时任务">crontab 循环执行定时任务</h3><p>💾<u><code>/var/spool/cron/</code></u></p><p>Linux crontab 是用来定期执行程序的命令。</p><p>crontab 命令需要 crond 服务支持。crond 是 Linux 下用来周期地执行某种任务或等待处理某些事件的一个守护进程，和 Windows 中的计划任务有些类似。</p><p>在安装完成操作系统后，默认会安装 crond 服务工具，且 crond 服务默认就是自启动的。crond 进程每分钟会定期检查是否有要执行的任务，如果有，则会自动执行该任务。</p><p><strong>通过 <code>/etc/cron.allow</code> 和 <code>/etc/cron.deny</code> 文件来限制某些用户是否可以使用 crontab 命令:</strong></p><ul><li>当系统中有 <code>/etc/cron.allow</code> 文件时，只有写入此文件的用户可以使用 crontab 命令，没有写入的用户不能使用 crontab 命令。同样，如果有此文件，<code>/etc/cron.deny</code> 文件会被忽略，因为 <code>/etc/cron.allow</code> 文件的优先级更高。</li><li>当系统中只有 /etc/cron.deny 文件时，写入此文件的用户不能使用 crontab 命令，没有写入文件的用户可以使用 crontab 命令。</li><li>这个规则基本和 at 命令的规则一致，同样是 <code>/etc/cron.allow</code> 文件比 <code>/etc/cron.deny</code> 文件的优先级高，Linux 系统中默认只有 <code>/etc/cron.deny</code> 文件。</li></ul><p>📌<strong>crontab命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><p>每个用户都可以实现自己的 crontab 定时任务，只需使用这个用户身份执行“<code>crontab -e</code>”命令即可。当然，这个用户不能写入 <code>/etc/cron.deny</code> 文件。</p><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td>-u user</td><td>用来设定某个用户的 crontab 服务，例如 “-u demo” 表示设备 demo 用户的 crontab 服务，此选项一般有 root 用户来运行。</td></tr><tr><td>-e</td><td>编辑某个用户的 crontab 文件内容。如果不指定用户，则表示编辑当前用户的 crontab 文件。</td></tr><tr><td>-l</td><td>显示某用户的 crontab 文件内容，如果不指定用户，则表示显示当前用户的 crontab 文件内容。</td></tr><tr><td>-r</td><td>从 /var/spool/cron 删除某用户的 crontab 文件，如果不指定用户，则默认删除当前用户的 crontab 文件。</td></tr><tr><td>-i</td><td>在删除用户的 crontab 文件时，给确认提示。</td></tr></tbody></table><p>📌<strong>crontab文件格式</strong>：</p><p>其实 crontab 定时任务非常简单，只需执行“crontab -e”命令，然后输入想要定时执行的任务即可。不过，当我们执行“crontab -e”命令时，打开的是一个空文件，而且操作方法和 Vim 是一致的。那么，这个文件的格式才是我们真正需要学习的内容。文件格式如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ！]<span class="comment"># crontab -e</span></span><br><span class="line"><span class="comment">#进入 crontab 编辑界面。会打开Vim编辑你的任务</span></span><br><span class="line">* * * * * 执行的任务</span><br></pre></td></tr></table></figure><p>这个文件中是通过 5 个“*”来确定命令或任务的执行时间的</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*    *    *    *    *</span><br><span class="line">-    -    -    -    -</span><br><span class="line">|    |    |    |    |</span><br><span class="line">|    |    |    |    +----- 星期中星期几 (0 - 6) (星期天 为0)</span><br><span class="line">|    |    |    +---------- 月份 (1 - 12)</span><br><span class="line">|    |    +--------------- 一个月中的第几天 (1 - 31)</span><br><span class="line">|    +-------------------- 小时 (0 - 23)</span><br><span class="line">+------------------------- 分钟 (0 - 59)</span><br></pre></td></tr></table></figure><p>在时间表示中，还有一些特殊符号需要学习</p><table><thead><tr><th>特殊符号</th><th>含义</th></tr></thead><tbody><tr><td>*（星号）</td><td>代表任何时间。比如第一个&quot;*&quot;就代表一小时种每分钟都执行一次的意思。</td></tr><tr><td>,（逗号）</td><td>代表不连续的时间。比如&quot;0 8,12,16 * * * 命令&quot;就代表在每天的 8 点 0 分、12 点 0 分、16 点 0 分都执行一次命令。</td></tr><tr><td>-（中杠）</td><td>代表连续的时间范围。比如&quot;0 5 * * 1-6 命令&quot;，代表在周一到周六的凌晨 5 点 0 分执行命令。</td></tr><tr><td>/（正斜线）</td><td>代表每隔多久执行一次。比如&quot;* /10* * * * 命令&quot;，代表每隔 10 分钟就执行一次命令。</td></tr></tbody></table><p>当“crontab -e”编辑完成之后，一旦保存退出，那么这个定时任务实际就会写入 <code>/var/spool/cron/</code> 目录中，每个用户的定时任务用自己的用户名进行区分。而且 crontab 命令只要保存就会生效，只要 crond 服务是启动的。</p><p><strong>在书写 crontab 定时任务时，需要注意以下几个事项：</strong></p><ul><li>6 个选项都不能为空，必须填写。如果不确定，则使用“*”代表任意时间。</li><li>crontab 定时任务的最小有效时间是分钟，最大有效时间是月。像 2018 年某时执行、3 点 30 分 30 秒这样的时间都不能被识别。</li><li>在定义时间时，日期和星期最好不要在一条定时任务中出现，因为它们都以天为单位，非常容易让管理员混淆。</li><li>在定时任务中，不管是直接写命令，还是在脚本中写命令，最好都使用绝对路径。有时使用相对路径的命令会报错。</li></ul><h3 id="free-查看内存使用状态">free 查看内存使用状态</h3><p>free 命令用来显示系统内存状态，包括系统物理内存、虚拟内存（swap 交换分区）、共享内存和系统缓存的使用情况，其输出和 top 命令的内存部分非常相似。</p><p>📌<strong>free命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>-b</td><td>以 Byte（字节）为单位，显示内存使用情况。</td></tr><tr><td>-h</td><td>显示人性化的内存大小信息</td></tr><tr><td>-k</td><td>以 KB 为单位，显示内存使用情况，此选项是 free 命令的默认选项。</td></tr><tr><td>-l</td><td>显示占用内存的高低</td></tr><tr><td>-m</td><td>以 MB 为单位，显示内存使用情况。</td></tr><tr><td>-g</td><td>以 GB 为单位，显示内存使用情况。</td></tr><tr><td>-t</td><td>在输出的最终结果中，输出内存和 swap 分区的总量。</td></tr><tr><td>-o</td><td>不显示系统缓冲区这一列。</td></tr><tr><td>-s 间隔秒数</td><td>根据指定的间隔时间，持续显示内存使用情况。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># free -m</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1819         762         276          18         779         868</span><br><span class="line">Swap:          2047           0        2047</span><br></pre></td></tr></table></figure><ul><li>total 是总内存数；</li><li>used 是已经使用的内存数；</li><li>free 是空闲的内存数；</li><li>shared 是多个进程共享的内存总数；</li><li>buffers 是缓冲内存数；</li><li>cached 是缓存内存数。</li></ul><h3 id="cal-查看日历">cal 查看日历</h3><p>📌<strong>cal命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cal [-options] [[[day] month] year]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-1</code>： <code>-one</code></td><td>只显示当前月份(默认)</td></tr><tr><td><code>-3</code>：<code>--three</code></td><td>显示上个月、当月和下个月</td></tr><tr><td><code>-s</code>： <code>--sunday</code></td><td>周日作为一周第一天</td></tr><tr><td><code>-m</code>：<code>--monday</code></td><td>周一作为一周第一天</td></tr><tr><td><code>-j</code>： <code>--julian</code></td><td>输出儒略日（显示每一天是本年的第几天）</td></tr><tr><td><code>-y</code>：<code>--year</code></td><td>输出整年</td></tr></tbody></table><h3 id="date-日期与时间">date 日期与时间</h3><p>📌<strong>date命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> [-options] [MMDDhhmm[[CC]YY][.ss]] +format</span><br></pre></td></tr></table></figure><p>MM为月，DD为天，hh为小时，mm为分钟；CC为年前两位，YY为年的后两位，ss为秒。如： date 010203042016.55。</p><p>显示时间格式（date ‘+%y,%m,%d,%H,%M,%S’）</p><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-d</code>：<code>--date=STRING</code></td><td>显示 datestr 中所设定的时间 (非系统时间)</td></tr><tr><td><code>-s</code>,：<code>--set=STRING</code></td><td>将系统时间设为 datestr 中所设定的时间</td></tr><tr><td><code>-u</code>： <code>--utc</code>：<code>--universal</code></td><td>打印或设置协调世界时（UTC）</td></tr></tbody></table><p>📌<strong>format格式</strong>：</p><table>  <caption>    0. 常用格式  </caption>  <thead>    <tr>      <th align="left">format格式</th>      <th>含义</th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">%Y，%y</td>      <td>年</td>    </tr>    <tr>      <td align="left">%m</td>      <td>月</td>    </tr>    <tr>      <td align="left">%d</td>      <td>日</td>    </tr>    <tr>      <td align="left">%H</td>      <td>时</td>    </tr>    <tr>      <td align="left">%M</td>      <td>分</td>    </tr>    <tr>      <td align="left">%S</td>      <td>秒</td>    </tr>  </tbody></table><table>  <caption>      1. 时间格式  </caption>  <thead>    <tr>      <th align="left">format格式</th>      <th align="left">说明</th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">%</td>      <td align="left">印出 %</td>    </tr>    <tr>      <td align="left">%n</td>      <td align="left">下一行</td>    </tr>    <tr>      <td align="left">%t</td>      <td align="left">跳格</td>    </tr>    <tr>      <td align="left">%H</td>      <td align="left">小时(00…23)</td>    </tr>    <tr>      <td align="left">%I</td>      <td align="left">小时(01…12)</td>    </tr>    <tr>      <td align="left">%k</td>      <td align="left">小时(0…23)</td>    </tr>    <tr>      <td align="left">%l</td>      <td align="left">小时(1…12)</td>    </tr>    <tr>      <td align="left">%M</td>      <td align="left">分钟(00…59)</td>    </tr>    <tr>      <td align="left">%p</td>      <td align="left">显示本地 AM 或 PM</td>    </tr>    <tr>      <td align="left">%r</td>      <td align="left">直接显示时间 (12 小时制，格式为 hh:mm:ss [AP]M)</td>    </tr>    <tr>      <td align="left">%R</td>      <td align="left">24小时制方式显示时间，相当于%H:%M</td>    </tr>    <tr>      <td align="left">%s</td>      <td align="left">从 1970 年 1 月 1 日 00:00:00 UTC 到目前为止的秒数</td>    </tr>    <tr>      <td align="left">%S</td>      <td align="left">秒(00…60)</td>    </tr>    <tr>      <td align="left">%T</td>      <td align="left">直接显示时间 (24 小时制)</td>    </tr>    <tr>      <td align="left">%X</td>      <td align="left">相当于 %H:%M:%S</td>    </tr>    <tr>      <td align="left">%z</td>      <td align="left">数字方式显示时区</td>    </tr>    <tr>      <td align="left">%Z</td>      <td align="left">字母缩写方式显示时区</td>    </tr>  </tbody></table><table>  <caption>    2. 日期格式  </caption>  <thead>    <tr>      <th align="left">format格式</th>      <th align="left">说明</th>    </tr>  </thead>  <tbody>    <tr>      <td align="left">%a</td>      <td align="left">星期几 ，缩写(Sun…Sat)</td>    </tr>    <tr>      <td align="left">%A</td>      <td align="left">星期几 ，完整英文星期(Sunday…Saturday)</td>    </tr>    <tr>      <td align="left">%b</td>      <td align="left">月份 (Jan…Dec)</td>    </tr>    <tr>      <td align="left">%B</td>      <td align="left">月份 (January…December)</td>    </tr>    <tr>      <td align="left">%c</td>      <td align="left">直接显示日期与时间</td>    </tr>    <tr>      <td align="left">%d</td>      <td align="left">日 (01…31)</td>    </tr>    <tr>      <td align="left">%D</td>      <td align="left">直接显示日期 (mm/dd/yy)</td>    </tr>    <tr>      <td align="left">%e</td>      <td align="left">一个月中的第几天，类似%_d</td>    </tr>    <tr>      <td align="left">%F</td>      <td align="left">完整的日期，相当于%Y-%m-%d</td>    </tr>    <tr>      <td align="left">%h</td>      <td align="left">同 %b</td>    </tr>    <tr>      <td align="left">%j</td>      <td align="left">一年中的第几天 (001…366)</td>    </tr>    <tr>      <td align="left">%m</td>      <td align="left">月份 (01…12)</td>    </tr>    <tr>      <td align="left">%u</td>      <td align="left">一周中的第几天 (1…7) (1是星期一)</td>    </tr>    <tr>      <td align="left">%U</td>      <td align="left">        一年中的第几周 (00…53) (以 Sunday 为一周的第一天的情形)      </td>    </tr>    <tr>      <td align="left">%w</td>      <td align="left">一周中的第几天 (0…6)(0是星期天)</td>    </tr>    <tr>      <td align="left">%W</td>      <td align="left">        一年中的第几周 (00…53) (以 Monday 为一周的第一天的情形)      </td>    </tr>    <tr>      <td align="left">%x</td>      <td align="left">直接显示日期 (mm/dd/yy)</td>    </tr>    <tr>      <td align="left">%y</td>      <td align="left">年份的最后两位数字 (00.99)</td>    </tr>    <tr>      <td align="left">%Y</td>      <td align="left">完整年份 (0000…9999)</td>    </tr>  </tbody></table><h3 id="网络配置">网络配置</h3><p>💾 IP地址配置：　<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code></p><p>💾 网关配置：　　<code>/etc/sysconfig/network</code></p><p>💾 DNS配置：　　<code>/etc/resolv.conf</code></p><p>📌<strong>配置方法</strong>： （<em>静态ip只需执行步骤1、4</em>）</p><ol><li><p>首先要编辑<strong>网卡配置</strong>文件，CentOS7的网卡配置文件路径是：(虚拟机一般为ifcfg-ens33)</p><p><code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>，此路径非常重要，以后企业主机网络不通，可从此配置文件中查看。万一有一天，忘记了，怎么办呢？这里大家 一定要善用find命令；因为我只是知道网卡配置文件在/etc目录下，名字是eth0结尾，因此find命令为：<code>find /etc -iname *eth0</code> 。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/b44a9b802c0a42ecafbcb03d8e99cf2a.png" alt="img"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /etc/sysconfig/network-script/ifcfg-eth0</span><br><span class="line"> DEVICE=eth0                   # 物理设备名</span><br><span class="line"> IPADDR=192.168.1.10           # IP地址</span><br><span class="line"> NETMASK=255.255.255.0         # 掩码值</span><br><span class="line"> NETWORK=192.168.1.0           # 网络地址 ( 可不要 )</span><br><span class="line"> BROADCAST=192.168.1.255       # 广播地址（ 可不要 ）</span><br><span class="line"> GATEWAY=192.168.1.1           # 网关地址</span><br><span class="line"> ONBOOT=yes                    # [yes|no]（引导时是否激活设备）--开机自启</span><br><span class="line"> USERCTL=no                    # [yes|no]（非root用户是否可以控制该设备）</span><br><span class="line"> BOOTPROTO=static              # [none|static|bootp|dhcp]（引导时不使用协议|静态分配|BOOTP协议|DHCP协议）</span><br></pre></td></tr></table></figure></li><li><p><strong>网关配置：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/sysconfig/network</span><br><span class="line"> NETWORKING=yes</span><br><span class="line"> HOSTNAME=localhost.localdomain</span><br><span class="line"> GATEWAY=192.168.1.1</span><br></pre></td></tr></table></figure></li><li><p><strong>DNS配置：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/resolv.conf </span><br><span class="line">nameserver 192.168.237.200</span><br><span class="line">nameserver 114.114.114.114       # 主DNS</span><br><span class="line">nameserver 8.8.8.8               # 次DNS</span><br></pre></td></tr></table></figure><p>第三方的 DNS 服务器：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/1049141419-0.jpg" alt="img"></p></li><li><p><strong>重启网络服务：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务重启</span></span><br><span class="line">[root@localhost ~]# systemctl restart network</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">脚本重启,一般不必这样执行</span></span><br><span class="line">[root@localhost ~]# /etc/init.d/network restart</span><br></pre></td></tr></table></figure></li></ol><h3 id="ss-网络状态工具">ss 网络状态工具</h3><p>📄<a href="https://blog.csdn.net/qq_34493319/article/details/124764072">Linux系统–ss命令详解</a></p><p>ss 是 Socket Statistics 的缩写。ss 命令可以用来获取 socket 统计信息，它显示的内容和 netstat 类似。但 ss 的优势在于它能够显示更多更详细的有关 TCP 和连接状态的信息，而且比 netstat 更快。当服务器的 socket 连接数量变得非常大时，无论是使用 netstat 命令还是直接 cat /proc/net/tcp，执行速度都会很慢。ss 命令利用到了 TCP 协议栈中 tcp_diag。tcp_diag 是一个用于分析统计的模块，可以获得 Linux 内核中第一手的信息，因此 ss 命令的性能会好很多。</p><p>ss命令可以提供如下信息：</p><ul><li><p>所有的TCP sockets</p></li><li><p>所有的UDP sockets</p></li><li><p>所有ssh/ftp/ttp/https持久连接</p></li><li><p>所有连接到Xserver的本地进程，使用state（例如：connected, synchronized, SYN-RECV, SYN-SENT,TIME-WAIT）、地址、端口过滤</p></li><li><p>所有的state FIN-WAIT-1 tcpsocket连接以及更多</p></li></ul><p>📌<strong>ss命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss [-options] [filter]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><p>常用选项</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-s</td><td>列出当前socket详细信息</td></tr><tr><td>-t, --tcp</td><td>显示 TCP 协议的 sockets</td></tr><tr><td>-u, --udp</td><td>显示 UDP 协议的 sockets</td></tr><tr><td>-x, --unix</td><td>显示 unix domain sockets，与 -f 选项相同</td></tr><tr><td>-n, --numeric</td><td>不解析服务的名称，如 “22” 端口不会显示成 “ssh”</td></tr><tr><td>-l, --listening</td><td>只显示处于监听状态的端口</td></tr><tr><td>-p, --processes</td><td>显示监听端口的进程(Ubuntu 上需要 sudo)</td></tr><tr><td>-a, --all</td><td>对 TCP 协议来说，既包含监听的端口，也包含建立的连接</td></tr><tr><td>-r, --resolve</td><td>把 IP 解释为域名，把端口号解释为协议名称</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p><code>-lntup</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ss -lntup | grep nginx</span></span><br><span class="line">tcp    LISTEN     0      128       *:80       *:*       <span class="built_in">users</span>:((&quot;nginx&quot;,pid=<span class="number">843</span>,fd=<span class="number">6</span>),(&quot;nginx&quot;,pid=<span class="number">841</span>,fd=<span class="number">6</span>))</span><br></pre></td></tr></table></figure><h3 id="netstat-查看网络状态">netstat 查看网络状态</h3><p>📌<strong>netstat安装</strong>：</p><p>CentOS7 默认没有安装该命令。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install net-tools</span><br></pre></td></tr></table></figure><p>📌<strong>netstat命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><strong>-a或–all</strong></td><td>显示所有连线中的Socket。</td></tr><tr><td>-A&lt;网络类型&gt;或–&lt;网络类型&gt;</td><td>列出该网络类型连线中的相关地址。</td></tr><tr><td>-c或–continuous</td><td>持续列出网络状态。</td></tr><tr><td>-C或–cache</td><td>显示路由器配置的快取信息。</td></tr><tr><td>-e或–extend</td><td>显示网络其他相关信息。</td></tr><tr><td>-F或–fib</td><td>显示路由缓存。</td></tr><tr><td>-g或–groups</td><td>显示多重广播功能群组组员名单。</td></tr><tr><td>-h或–help</td><td>在线帮助。</td></tr><tr><td>-i或–interfaces</td><td>显示网络界面信息表单。</td></tr><tr><td><strong>-l或–listening</strong></td><td>显示监控中的服务器的Socket。</td></tr><tr><td>-M或–masquerade</td><td>显示伪装的网络连线。</td></tr><tr><td><strong>-n或–numeric</strong></td><td>直接使用IP地址，而不通过域名服务器。</td></tr><tr><td>-N或–netlink或–symbolic</td><td>显示网络硬件外围设备的符号连接名称。</td></tr><tr><td>-o或–timers</td><td>显示计时器。</td></tr><tr><td><strong>-p或–programs</strong></td><td>显示正在使用Socket的程序识别码和程序名称。</td></tr><tr><td><strong>-r或–route</strong></td><td>显示Routing Table。</td></tr><tr><td>-s或–statistics</td><td>显示网络工作信息统计表。</td></tr><tr><td>-t或–tcp</td><td>显示TCP传输协议的连线状况。</td></tr><tr><td>-u或–udp</td><td>显示UDP传输协议的连线状况。</td></tr><tr><td>-v或–verbose</td><td>显示指令执行过程。</td></tr><tr><td>-V或–version</td><td>显示版本信息。</td></tr><tr><td>-w或–raw</td><td>显示RAW传输协议的连线状况。</td></tr><tr><td>-x或–unix</td><td>此参数的效果和指定&quot;-A unix&quot;参数相同。</td></tr><tr><td>–ip或–inet</td><td>此参数的效果和指定&quot;-A inet&quot;参数相同。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># netstat -tunlp | grep nginx# 查看网络信息,也可填进程或端口</span></span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      841/nginx: master p </span><br><span class="line"></span><br><span class="line">[root@docker01 ~]<span class="comment"># netstat -anp | grep 80</span></span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      841/nginx: master p </span><br><span class="line">tcp6       0      0 127.0.0.1:10050         127.0.0.1:34680         TIME_WAIT   -                   </span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     28880    1107/master          private/defer</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     29681    1000/dockerd         /var/run/docker/libnetwork/a17803d03212.sock</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># netstat -anp | grep 3306 | wc -l # 统计进程数，如果接近预设值，说明不够用，需要增加</span></span><br></pre></td></tr></table></figure><h3 id="ping-测试网络的连通信">ping 测试网络的连通信</h3><p>不管在windows平台，还是在linux平台，ping都是非常常用的网络命令；ping命令通过ICMP（Internet控制消息协议）工作；ping可以用来测试本机与目标主机是否联通、联通速度如何、稳定性如何。</p><p>在网络中ping是一个十分强大的TCP/IP工具。它的作用主要为：</p><ul><li>用来检测网络的连通情况和分析网络速度</li><li>根据域名得到服务器IP</li><li>根据ping返回的TTL值来判断对方所使用的操作系统及数据包经过路由器数量。</li></ul><p>📌<strong>ping命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping [-options] address</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-d</td><td>使用Socket的SO_DEBUG功能。</td></tr><tr><td><font style="color:red;"><code>-c &lt;完成次数&gt;</code></font></td><td>设置完成要求回应的次数。</td></tr><tr><td>-f</td><td>极限检测。</td></tr><tr><td><font style="color:red;">-i&lt;间隔秒数&gt;</font></td><td>指定收发信息的间隔时间。</td></tr><tr><td><code>-I &lt;网络界面&gt;</code></td><td>使用指定的网络接口送出数据包。</td></tr><tr><td><code>-l &lt;前置载入&gt;</code></td><td>设置在送出要求信息之前，先行发出的数据包。</td></tr><tr><td>-n</td><td>只输出数值。</td></tr><tr><td><code>-p&lt;范本样式&gt;</code></td><td>设置填满数据包的范本样式。</td></tr><tr><td>-q</td><td>不显示指令执行过程，开头和结尾的相关信息除外。</td></tr><tr><td>-r</td><td>忽略普通的Routing Table，直接将数据包送到远端主机上。</td></tr><tr><td>-R</td><td>记录路由过程。</td></tr><tr><td><font style="color:red;"><code>-s&lt;数据包大小&gt;</code></font></td><td>设置数据包的大小。</td></tr><tr><td><font style="color:red;"><code>-t &lt;存活数值&gt;</code></font></td><td>设置存活数值TTL的大小。</td></tr><tr><td>-v</td><td>详细显示指令的执行过程。</td></tr><tr><td><code>-w &lt;deadline&gt;</code></td><td>在 deadline 秒后退出。</td></tr><tr><td><code>-W &lt;timeout&gt;</code></td><td>在等待 timeout 秒后开始执行。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ping baidu.com</span></span><br><span class="line">PING baidu.com (39.156.66.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=1 ttl=128 time=46.4 ms</span><br><span class="line">64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=2 ttl=128 time=46.2 ms</span><br><span class="line">64 bytes from 39.156.66.10 (39.156.66.10): icmp_seq=3 ttl=128 time=46.3 ms</span><br></pre></td></tr></table></figure><ul><li><p>bytes值：数据包大小，也就是字节。</p></li><li><p>time值：响应时间，这个时间越小，说明你连接这个地址速度越快。</p></li><li><p>TTL值：Time To Live,表示DNS记录在DNS服务器上存在的时间，它是IP协议包的一个值，告诉路由器该数据包何时需要被丢弃。可以通过Ping返回的TTL值大小，粗略地判断目标系统类型是Windows系列还是UNIX/Linux系列。</p></li></ul><h3 id="traceroute-追踪路由">traceroute 追踪路由</h3><p>📌<strong>traceroute安装</strong>：</p><p>CentOS7 默认没有安装该命令。</p><h3 id="ifconfig-显示或配置网络设备">ifconfig 显示或配置网络设备</h3><p>ifconfig可以手动启动、观察与修改网络接口的相关参数，可以修改的参数很多，包括 IP 参数以及 MTU 等都可以修改。</p><p>📌<strong>ifconfig命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig [interface] [options]</span><br></pre></td></tr></table></figure><ul><li>Interface，网卡接口代号，包括 eth0、eth1、ppp0 等</li><li>Options，可以接的选项</li></ul><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>参数</th></tr></thead><tbody><tr><td>Up或down</td><td>启动 (up) 或关闭 (down) 该网络接口(不涉及任何参数)</td></tr><tr><td>mtu</td><td>可以设置不同的 MTU 数值，例如MTU 1500 (单位为 byte)</td></tr><tr><td>netmask</td><td>子屏蔽网络</td></tr><tr><td>broadcast</td><td>广播地址</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>观察所有的网络接口(直接输入 ifconfig)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@linux ~]<span class="comment"># ifconfig</span></span><br><span class="line">eth0 Link encap:Ethernet  HWaddr 00:0F:EA:A3:06:A2</span><br><span class="line">      inet addr:192.168.10.100  Bcast:192.168.10.255  </span><br><span class="line">Mask:255.255.255.0</span><br><span class="line">      inet6 addr: fe80::20f:eaff:fe73:682/64 Scope:Link</span><br><span class="line">      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">      RX packets:3439 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">      TX packets:2735 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">      collisions:0 txqueuelen:1000</span><br><span class="line">      RX bytes:646935 (631.7 KiB)  TX bytes:562313 (549.1 KiB)</span><br><span class="line">      Interrupt:209 Memory:fb000000-0</span><br></pre></td></tr></table></figure><p>一般来说，直接输入 ifconfig 就会列出目前已经被启动的卡，不论这个卡是否有设置 IP，都会被显示出来。而如果是输入 ifconfig eth0，则会显示出这个接口的相关数据，而不管该接口是否启动。所以，如果你想要知道某个网卡的 Hardware Address，直接输入“ifconfig “网络接口代号””即可。至于上述代码中出现的各项数据是这样的（数据排列由上而下、由左而右）。</p><ul><li>eth0：网卡的代号，也有 lo 这个 loopback。</li><li>HWaddr：网卡的硬件地址，习惯称为 MAC。</li><li>inet addr：IPv4 的 IP 地址，后续的 Bcase、Mask 分别代表的是 Broadcast 与 Netmask。</li><li>inet6 addr：是 IPv6 的版本的 IP，我们没有使用，所以略过。</li><li>RX：那一行代表的是网络由启动到目前为止的数据包接收情况，packets 代表数据包数、errors 代表数据包发生错误的数量、dropped 代表数据包由于有问题而遭丢弃的数量等。</li><li>TX：与 RX 相反，为网络由启动到目前为止的传送情况。</li><li>collisions：代表数据包碰撞的情况，如果发生太多次，表示你的网络状况不太好。</li><li>txqueuelen：代表用来传输数据的缓冲区的储存长度。</li><li>RX Bytes、TX Bytes：总传送、接收的字节总量。</li><li>Interrupt、Memory：网卡硬件的数据，IRQ 岔断与内存地址。</li></ul><p>通过观察上述的资料，大致上可以了解到你的网络情况，尤其是 RX、TX 内的 error 数量，以及是否发生严重的 collision 情况，都是需要注意的。</p></li><li><p>暂时修改网络接口</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@linux ~]<span class="comment"># ifconfig eth0 192.168.100.100</span></span><br><span class="line"><span class="comment"># 如果不加任何其他参数，则系统会依照该 IP 所在的 class 范围，</span></span><br><span class="line"><span class="comment"># 自动地计算出 netmask 以及 network, broadcast 等 IP 参数</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># ifconfig eth0 192.168.100.100 netmask 255.255.255.128 \</span></span><br><span class="line">&gt; mtu 8000 </span><br><span class="line"><span class="comment"># 设置网络接口，同时设置 MTU 的数值</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># ifconfig eth0 MTU 9000</span></span><br><span class="line"><span class="comment"># 仅修改该接口的 MTU 数值，其他的保持不动</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># ifconfig eth0:0 192.168.50.50</span></span><br><span class="line"><span class="comment"># 仔细看那个接口， eth0:0 。那就是在该网络接口上，再仿真一个网络接口，</span></span><br><span class="line"><span class="comment"># 亦即是在一个网卡上面设置多个 IP 的意思啦</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0F:EA:A3:06:A2</span><br><span class="line">          inet addr:192.168.10.100 Bcast:192.168.10.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:3669 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:2892 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:667547 (651.9 KiB)  TX bytes:584799 (571.0 KiB)</span><br><span class="line">          Interrupt:209 Memory:fb000000-0</span><br><span class="line"></span><br><span class="line">eth0:0    Link encap:Ethernet  HWaddr 00:0F:EA:A3:06:A2</span><br><span class="line">          inet addr:192.168.200.2 Bcast:192.168.200.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          Interrupt:209 Memory:fb000000-0</span><br><span class="line"><span class="comment"># 仔细看，是否与硬件有关的信息都相同。没错。因为是同一个网卡。</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># ifconfig eth0:0 down</span></span><br><span class="line"><span class="comment"># 关掉 eth0:0 这个接口。如果想要启动 eth1 ，并且不设置任何网络参数</span></span><br><span class="line"><span class="comment"># ifconfig eth1 up 就可以实现</span></span><br><span class="line"></span><br><span class="line">[root@linux ~]<span class="comment"># /etc/init.d/network restart</span></span><br><span class="line"><span class="comment"># 刚刚设置的数据全部失效，会以 ifcfg-ethx 的设置为主</span></span><br></pre></td></tr></table></figure><p>使用 ifconfig 可以暂时用手动来设置或修改某个适配卡的相关功能，并且也可以通过 eth0:0 这种虚拟的网络接口来设置一张网卡上面的多个 IP。手动的方式是比较简单。而且设置错误也没有关系，因为我们可以利用 /etc/init.d/network restart 来重新启动整个网络接口，那么之前手动的设置数据会全部失效。另外，要启动某个网络接口，但又不让它具有 IP 参数时，直接给它 ifconfig eth0 up 即可。这个操作经常在无线网卡当中进行，因为我们需要启动无线网卡让它去检测 AP 存在与否。</p></li></ol><h3 id="ip-addr-查看IP地址">ip addr 查看IP地址</h3><p>💾<code>/etc/sysconfig/network-scripts/&lt;网卡名&gt;</code></p><p>使用命令的方式增加或者删除路由记录<strong>都是临时的</strong>，如果重启network服务，那么操作就失效了。想要永久生效可以编辑配置文件<code>/etc/sysconfig/network-scripts/route-eth*</code>。</p><p>📌<strong>ip addr命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr [[options] [interface]]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td></td><td>空选项，查看当前所有网卡信息</td></tr><tr><td><code>show device</code></td><td>查看指定网卡的信息</td></tr><tr><td><code>add ip/netmask dev 接口</code></td><td>增加ip</td></tr><tr><td><code>del ip/netmask dev 接口</code></td><td>删除ip</td></tr><tr><td><code>flush dev 接口</code></td><td>清空指定网卡的所有ip</td></tr><tr><td><code>add ip/netmask dev eth0 label eth0:1</code></td><td>给 <code>eh0</code> 取别名 <code>eth0:1</code></td></tr><tr><td><code>del ip/netmask dev eth0 [label eth0:1]</code></td><td>删除别名</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>虚拟机上执行<code>ip addr</code>命令结果有两部分，<code>lo</code>和<code>enp0s3</code>，如果有多块网卡，每块网卡都会显示一部分。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:30:e0:5a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.111/24 brd 10.0.0.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::423a:d794:f794:b784/64 scope <span class="built_in">link</span> noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><blockquote><p>lo：全称loopback，是回环地址，一般被分配到127.0.0.1地址上，用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。</p><p>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; - 网络设备状态标识：</p><p>UP：网卡处于启动状态。</p><p>BROADCAST：网卡可以发广播包。</p><p>MULTICAST：网卡可以发多播包。</p><p>LOWER_UP：L1是启动的，L1指的是物理层，即网线是插着的。</p><p>mtu：最大传输单元（mtu）。</p><p>enp0s3：网卡名，如果有多块网卡，会有多个类似这种名称的网卡。</p><p>link/ether：MAC地址，一块网卡有一个MAC地址。</p><p>inet：IPV4地址，一块网卡可以绑定多个IPV4地址。</p><p>inet6：IPV6地址，一块网卡可以绑定多个IPV6地址。</p><blockquote><p>scope {global|link|host}]：指明作用域</p><ul><li>global: 全局可用，即两个接口进来的数据我都可以响应。是默认状态</li><li>link: 仅链接可用，进来的数据只有直接相连的那个接口能够响应</li><li>host: 本机可用，即只能自己访问</li></ul></blockquote></blockquote><h3 id="shutdown-halt-poweroff-reboot-init-关机和重启"><code>shutdown</code> <code>halt</code> <code>poweroff</code> <code>reboot</code> <code>init</code> 关机和重启</h3><p>⚠️重启前请使用 <code>sync</code> 将数据从内存同步到硬盘。</p><p>📌<strong>shutdown</strong>：关机或重启</p><table>  <thead>    <tr>      <th>参数</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>-r</td>      <td>在指定时间重启计算机。</td>    </tr>    <tr>      <td>-h</td>      <td>在指定时间关闭计算机。</td>    </tr>    <tr>      <td>-p</td>      <td>关闭操作系统，并调用poweroff关闭电源。</td>    </tr>    <tr>      <td>-k</td>      <td>向系统中的登录者发送警告信息，并不真正执行关机操作。</td>    </tr>    <tr>      <td>-c</td>      <td>        取消目前正在执行的关机程序。这个选项没有时间参数，但是可以输入一个用来解释的讯息，而这信息将会送到每位系统登录者。      </td>    </tr>  </tbody></table><table>  <thead>    <tr>      <th>命令</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>shutdown -h 12:00</td>      <td>系统将在12时准时关机。</td>    </tr>    <tr>      <td>shutdown -h now</td>      <td>立刻关机。</td>    </tr>    <tr>      <td>shutdown -r now</td>      <td>立刻重启系统。</td>    </tr>    <tr>      <td>shutdown -h +10</td>      <td>系统将在10分钟后关机。</td>    </tr>  </tbody></table><p>📌<strong>halt</strong>：关闭正在运行的<a href="https://so.csdn.net/so/search?from=pc_blog_highlight&amp;q=linux">linux</a>操作系统</p><table>  <thead>    <tr>      <th>参数</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>-n</td>      <td>关机时不执行sync操作，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-w</td>      <td>不真正的关机，仅在日志文件‘/var/log/wtmp’中添加相应的记录。</td>    </tr>    <tr>      <td>-d</td>      <td>关机，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-f</td>      <td>强制关机，不调用shutdown操作。</td>    </tr>    <tr>      <td>-i</td>      <td>关机前关掉所有的网络接口。</td>    </tr>    <tr>      <td>-p</td>      <td>关机后切断系统电源。</td>    </tr>  </tbody></table><p>📌<strong>poweroff</strong>：关闭正在运行的linux操作系统并切断系统电源</p><table>  <thead>    <tr>      <th>参数</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>-n</td>      <td>关机时不执行sync操作，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-w</td>      <td>不真正的关机，仅在日志文件‘/var/log/wtmp’中添加相应的记录。</td>    </tr>    <tr>      <td>-d</td>      <td>关机，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-f</td>      <td>强制关机，不调用shutdown操作。</td>    </tr>    <tr>      <td>-i</td>      <td>关机前关掉所有的网络接口。</td>    </tr>  </tbody></table><p>📌<strong>reboot</strong>：重启正在运行的linux操作系统</p><table>  <thead>    <tr>      <th>参数</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>-n</td>      <td>重启时不执行sync操作，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-w</td>      <td>不真正的重启，仅在日志文件‘/var/log/wtmp’中添加相应的记录。</td>    </tr>    <tr>      <td>-d</td>      <td>重启，相关操作不写入日志文件‘/var/log/wtmp’中。</td>    </tr>    <tr>      <td>-f</td>      <td>强制重启，不调用shutdown操作。</td>    </tr>    <tr>      <td>-i</td>      <td>重启前关掉所有的网络接口。</td>    </tr>  </tbody></table><p>📌<strong>init</strong>：操作系统启动运行方式</p><table>  <thead>    <tr>      <th>命令</th>      <th>说明</th>    </tr>  </thead>  <tbody>    <tr>      <td>init 0</td>      <td>表示关机。</td>    </tr>    <tr>      <td>init 6</td>      <td>表示重启。</td>    </tr>    <tr>      <td>init 1</td>      <td>表示单用户命令行模式。</td>    </tr>    <tr>      <td>init 2</td>      <td>表示没有网络的多用户命令行模式。</td>    </tr>    <tr>      <td>init 3</td>      <td>表示多用户命令行模式（推荐使用这个模式）。</td>    </tr>    <tr>      <td>init 4</td>      <td>表示预留的未使用。</td>    </tr>    <tr>      <td>init 5</td>      <td>表示图形界面模式（安装有图形界面的系统的默认启动级别）。</td>    </tr>  </tbody></table><h3 id="服务运行级别">服务运行级别</h3><p>💾<u><code>vim /etc/inittab</code></u></p><p>Linux系统有7种运行级别（runlevel）：</p><ul><li>运行级别0：系统停机状态，系统默认运行级别不能设为0，否则无法正常启动</li><li>运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登录</li><li>运行级别2：多用户状态（没有NFS），不支持网络</li><li><font style="background:yellow">运行级别3</font>：完全的多用户状态（有NFS），无界面，登录后进入控制台命令行模式</li><li>运行级别4：系统未使用，保留</li><li>运行级别5：X11控制台，登录后进入图形GUI模式</li><li>运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动</li></ul><p>📌<strong>init</strong>：使用<code>init</code>控制上篇中已经列举。</p><p>📌<strong>开机流程</strong>：</p><p>1️⃣CentOS 6</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/18572620-3a9bd2a5777e5a78.png" alt="img"></p><ol><li>开机加电自检  — 检查bios中识别的硬件信息是否正常</li><li>开机MBR引导   — /boot分区引导系统启动的记录信息（MBR引导记录–系统启动文件信息/分区表信息）</li><li>grup选择菜单  — 可以选择系统内核信息/可以选择进入单用户模</li><li>加载内核信息  — 用于管理控制硬件</li><li>启动系统进程  — /sbin/init — 后续进程启动（串型—详见图）注：后续进程被第一个进程所管理。查看init下面的服务是第几号开机 是第几号关机。</li><li>加载启动级别文件  — 加载/etc/inittab     选择不同级别启动系统</li><li>运行初始化脚本    — /etc/rc.d/rc.sysinit 设置主机名称 设置网卡地址信息</li><li>执行服务运行脚本  — /etc/rc.d/rc         实现服务开机自动运行</li><li>启动mingetty进程  — 显示登录提示信息</li></ol><p>2️⃣CentOS 7</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/18572620-b1a779f51bd3ec82.png" alt="img"></p><ol><li>开机加电自检  — 检查bios中识别的硬件信息是否正常</li><li>开机MBR引导   — /boot分区引导系统启动的记录信息（MBR引导记录–系统启动文件信息/分区表信息）</li><li>grup选择菜单  — 可以选择系统内核信息/可以选择进入单用户模式</li><li>加载内核信息  — 用于管理控制硬件</li><li>启动系统进程  — /usr/lib/systemd/systemd — 后续进程启动（并型）</li><li>加载启动target文件  — /etc/systemd/system/default.target     选择不同级别启动系统</li><li>加载系统初始化文件  — /usr/lib/systemd/system/sysinit.target 设置主机名称 设置网卡地址信息</li><li>执行服务运行脚本    — /etc/systemd/system         实现服务开机自动运行<br>/usr/lib/systemd/system/    保存系统中所有程序启动文件</li><li>启动mingetty进程    — 显示登录提示信息</li></ol><p>📌<strong>运行级别操作</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前默认运行级别</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl get-default</span></span><br><span class="line"><span class="comment"># 修改默认运行级别</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl set-default TARGET.target</span></span><br></pre></td></tr></table></figure><blockquote><p>CentOS7后运行级别简化，如下：</p><p>multi-user.target # 等价于原运行级别3（多用户有网，无图形界面）</p><p>graphical.target # 等价于原运行级别5（多用户有网，有图形界面）</p></blockquote><h3 id="service-OS6">service (OS6)</h3><p>💾<u><code>/etc/init.d</code></u></p><p>服务(service)本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其它程序的请求，因此我们又称为守护进程。</p><p>service 指令管理的服务在 <code>/etc/init.d</code> 查看。<strong>在CentOS7.0后很多服务不再使用<code>service</code>，而是<code>systemctl</code>。</strong></p><p>📌<strong>service命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service 服务名 [start | stop | restart | status]</span><br></pre></td></tr></table></figure><p>📌<strong>示例说明</strong>：</p><p>配置 service 服务（以tomcat的服务为例）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/init.d/tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># description: Tomcat8 Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat8</span></span><br><span class="line"><span class="comment"># chkconfig: 345 99 10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CATALINA_HOME=/usr/local/tomcat8</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">                sh <span class="variable">$CATALINA_HOME</span>/bin/startup.sh</span><br><span class="line">                ;;</span><br><span class="line">        stop)</span><br><span class="line">                sh <span class="variable">$CATALINA_HOME</span>/bin/shutdown.sh</span><br><span class="line">                ;;</span><br><span class="line">        restart)</span><br><span class="line">                sh <span class="variable">$CATALINA_HOME</span>/bin/shutdown.sh</span><br><span class="line">                sh <span class="variable">$CATALINA_HOME</span>/bin/startup.sh</span><br><span class="line">                ;;</span><br><span class="line">        *)</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&#x27;please use : tomcat &#123;start | stop | restart&#125;&#x27;</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># chmod 755 /etc/init.d/tomcat</span></span><br></pre></td></tr></table></figure><h3 id="chkconfig-OS6">chkconfig (OS6)</h3><p>💾<u><code>/etc/init.d/rcN.d</code></u></p><p>chkconfig命令主要用来更新（启动或停止）和查询系统服务的运行级信息。谨记chkconfig不是立即自动禁止或激活一个服务，它只是简单的改变了符号连接。</p><p>📌<strong>chkconfig命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig -options</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><blockquote><p><code>--add name</code> 　增加所指定的系统服务，让chkconfig指令得以管理它，并同时在系统启动的叙述文件内增加相关数据。</p><p><code>--del name</code> 　删除所指定的系统服务，不再由chkconfig指令管理，并同时在系统启动的叙述文件内删除相关数据。</p><p><code>--level &lt;等级代号&gt;</code>：设置某一服务在指定的运行级是被启动，停止还是重置。</p><blockquote><p>level选项可以指定要查看的运行级而不一定是当前运行级。对于每个运行级，只能有一个启动脚本或者停止脚本。当切换运行级时，init不会重新启动已经启动的服务，也不会再次去停止已经停止的服务。等级代号:</p><ul><li><p>等级0表示：表示关机</p></li><li><p>等级1表示：单用户模式</p></li><li><p>等级2表示：无网络连接的多用户命令行模式</p></li><li><p>等级3表示：有网络连接的多用户命令行模式</p></li><li><p>等级4表示：不可用</p></li><li><p>等级5表示：带图形界面的多用户模式</p></li><li><p>等级6表示：重新启动</p></li></ul></blockquote><p><code>--list [name]</code>：显示所有运行级系统服务的运行状态信息（on或off）。如果指定了name，那么只显示指定的服务在不同运行级的状态。</p></blockquote><p>📌<strong>示例说明</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list        <span class="comment">#列出所有的系统服务</span></span><br><span class="line">chkconfig --add httpd        <span class="comment">#增加httpd服务</span></span><br><span class="line">chkconfig --del httpd        <span class="comment">#删除httpd服务</span></span><br><span class="line">chkconfig --level httpd 2345 on        <span class="comment">#设置httpd在运行级别为2、3、4、5的情况下都是on（开启）的状态</span></span><br><span class="line">chkconfig --list        <span class="comment">#列出系统所有的服务启动情况</span></span><br><span class="line">chkconfig --list mysqld        <span class="comment">#列出mysqld服务设置情况</span></span><br><span class="line">chkconfig --level 35 mysqld on        <span class="comment">#设定mysqld在等级3和5为开机运行服务，--level 35表示操作只在等级3和5执行，on表示启动，off表示关闭</span></span><br><span class="line">chkconfig mysqld on        <span class="comment">#设定mysqld在各等级为on，“各等级”包括2、3、4、5等级</span></span><br></pre></td></tr></table></figure><h3 id="systemctl-OS7">systemctl (OS7)</h3><p>💾 <code>/usr/lib/systemd/system</code></p><p>在Centos 中 systemctl 是设置系统服务的命令，即 service ,  它融合之前service和chkconfig的功能于一体。 可以使用它永久性或只在当前会话中启用/禁用服务。 CentOS 7 的 /etc/rc.d/rc.local 是没有执行权限的， 系统建议创建 systemd service 启动服务。</p><p>📌<strong>systemctl命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl [start|stop|restart|status] 服务名</span><br></pre></td></tr></table></figure><p>📌<strong>服务管理命令</strong>：</p><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><span style="background:yellow;"><strong>systemctl start 服务名</strong></span></td><td><strong>开启服务</strong></td></tr><tr><td><span style="background:yellow;"><strong>systemctl stop 服务名</strong></span></td><td><strong>关闭服务</strong></td></tr><tr><td><span style="background:yellow;"><strong>systemctl status 服务名</strong></span></td><td><strong>显示状态</strong></td></tr><tr><td><span style="background:yellow;"><strong>systemctl restart 服务名</strong></span></td><td><strong>重启服务</strong></td></tr><tr><td><span style="background:yellow;"><strong>systemctl enable 服务名</strong></span></td><td><strong>开机启动服务</strong></td></tr><tr><td><span style="background:yellow;"><strong>systemctl disable 服务名</strong></span></td><td><strong>禁止开机启动</strong></td></tr><tr><td>systemctl list-units</td><td>查看系统中所有正在运行的服务</td></tr><tr><td>systemctl list-unit-files</td><td>查看系统中所有服务的开机启动状态</td></tr><tr><td>systemctl list-dependencies 服务名</td><td>查看系统中服务的依赖关系</td></tr><tr><td>systemctl mask 服务名</td><td>冻结服务</td></tr><tr><td>systemctl unmask 服务名</td><td>解冻服务</td></tr><tr><td>systemctl set-default multi-user.target</td><td>开机时不启动图形界面</td></tr><tr><td>systemctl set-default graphical.target</td><td>开机时启动图形界面</td></tr><tr><td><span style="background:yellow;"><strong>systemctl daemon-reload</strong></span></td><td><strong>修改服务配置文件后，重新载入</strong></td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p><strong>配置 systemctl 服务</strong>（以nginx的服务为例）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]<span class="comment"># systemctl cat nginx</span></span><br><span class="line"><span class="comment"># /usr/lib/systemd/system/nginx.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx - high performance web server<span class="comment"># 注释、描述</span></span><br><span class="line">Documentation=http://nginx.org/en/docs/<span class="comment"># 帮助或文档</span></span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target<span class="comment"># 核心 nginx在这些服务后才能执行（依赖）</span></span><br><span class="line">Wants=network-online.target<span class="comment"># 依赖</span></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking<span class="comment"># 服务类型</span></span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line"><span class="comment"># Environment=&quot;&quot; # 环境</span></span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf<span class="comment"># 服务启动</span></span><br><span class="line">ExecReload=/bin/sh -c <span class="string">&quot;/bin/kill -s HUP <span class="subst">$(/bin/cat /var/run/nginx.pid)</span>&quot;</span><span class="comment"># 服务重启</span></span><br><span class="line">ExecStop=/bin/sh -c <span class="string">&quot;/bin/kill -s TERM <span class="subst">$(/bin/cat /var/run/nginx.pid)</span>&quot;</span><span class="comment"># 服务关闭</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target<span class="comment"># 指定运行级别</span></span><br></pre></td></tr></table></figure><h3 id="iptables（OS6）">iptables（OS6）</h3><p>💾<code>/etc/sysconfig/iptables</code></p><h3 id="span-id-firewall-firewall-span-（0S7）"><span id="firewall">firewall</span>（0S7）</h3><p>💾<code>/etc/firewalld/zones/public.xml </code>   💻<code>firewalld.service</code></p><p>⚠️<span style="color:orange;background:red">打开防火墙后一定要先添加ssh端口(22)到规则中，并重新载入</span></p><p>在真正是生产环境，往往需要将防火墙打开，但问题来了，如果我们把防火墙打开，那么外部请求数据包就不能跟服务器监听端口通讯。这时，需要打开指定的端口。CentOS7采用新的firewalld，CentOS6及以前版本采用iptables，不过firewalld底层仍然调用的是iptables</p><p>firewalld 配置文件在 <code>/etc/firewalld</code> 和 <code>/usr/lib/firewalld</code>。如果名称相同的配置文件同时存储 在两个位置中，则将使用 <code>/etc/firewalld</code> 中的版本。</p><p>📌<strong>firewall命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --options</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><blockquote><p>firewall-cmd 可以执行 firewall-config 能够执行的相同操作。在使用 firewall-cmd 命令时：</p><p><code>--permanent</code>：使所有命令永久生效。如果更改可能诱发危险，则可以不指定-–permanent 参数，使更改 仅在运行状态下生效。</p><p><code>--zone=</code>：用来指定所影响的区域，如果未指定–zone=参数，则将使用默认区域。</p><blockquote><p>firewalld防火墙为了简化管理，将所有网络流量分为多个区域（zone）。然后根据数据包的源IP地址或传入的网络接口等条件将流量传入相应区域，每个区域都定义了自己打开或者关闭的端口和服务列表。</p><ul><li>区域（zone）是针对特定位置或场景（例如家庭、公共、受信任等）可能具有的各种信任级别的规则集。</li><li>不同的区域（zone）可允许不同的网络服务和入站流量的类型，而拒绝其他任何流量。</li></ul><p>firewalld 的9个区域：</p><ul><li>public(公共) —— [默认]公网访问，不受任何限制。</li><li>work(工作) —— 用于工作区。基本信任的网络，仅仅接收经过选择的连接。</li><li>home(家庭) —— 用于家庭网络。基本信任的网络，仅仅接收经过选择的连接。</li><li>trusted(信任) —— 接收的外部网络连接是可信任、可接受的。</li><li>block(限制) —— 任何接收的网络连接都被IPv4的icmp-host-prohibited信息和IPv6的icmp6-adm-prohibited信息所拒绝。</li><li>dmz(隔离区) —— 英文&quot;demilitarized zone&quot;的缩写，此区域内可公开访问，它是非安全系统与安全系统之间的缓冲区。</li><li>drop(丢弃) —— 任何接收的网络数据包都被丢弃，没有任何回复。仅能有发送出去的网络连接。</li><li>external(外部) —— 允许指定的外部网络进入连接，特别是为路由器启用了伪装功能的外部网。</li><li>internal(内部) —— 内部访问。只限于本地访问，其他不能访问。</li></ul></blockquote><p><code>--reload</code>：重新载入规则。配置防火墙时，管理员如果使用–permanent 参数更改配置，再使用 firewall-cmd --reload 来使更改生效。</p><p><code>--timeout=</code>：指定某些更改在一定的时间后自动删除，从而防止意外锁定某个系统。</p><p><code>--state</code>：查看防火墙状态</p><p><code>--list-ports</code>：查看所有打开的端口</p><p><code>--get-active-zones</code>：查看区域信息</p><p><code>--add-port=22/tcp</code>：添加规则</p><p><code>--remove-port=22/tcp</code>：删除规则</p><p><code>--query-port=22/tcp</code>：查看规则状态</p><p><code>--panic-on</code>：拒绝所有包</p><p><code>--panic-off</code>：取消拒绝状态</p><p><code>--query-panic</code>：查看是否拒绝</p><p><code>--add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;10.1.1.14/32&quot; port protocol=&quot;tcp&quot; port=&quot;80&quot; accept&quot;</code>：开启某个端口（指定IP可访问）</p><p><code>--remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;10.1.1.14/32&quot; port protocol=&quot;tcp&quot; port=&quot;80&quot; accept&quot;</code>：关闭某个端口（删除策略）</p><p><code>--get-services</code>：显示服务列表</p><p><code>--add-service=ssh</code>：允许SSH服务通过</p><p><code>--remove-service=ssh</code>：禁止SSH服务通过</p><p><code>--list-services</code>：显示当前服务</p><p><code>--list-all</code>：查看防火墙，添加的端口也可以看到</p><p><code>--enable service=samba --timeout=600</code>：临时允许Samba服务通过600秒</p><p><code>--get-zone-of-interface=eth0</code>：查看指定接口所属区域</p><p><code>--complete-reload</code>：完全重新载入规则（会中断已连接的连接，类似于重启）</p><p><code>--list-all-zones</code>：列出所有区域的设置</p><p><code>--add-rich-rule='rule protocol value=icmp drop'</code>：禁止ping数据包</p></blockquote><h3 id="journalctl">journalctl</h3><h3 id="homenamectl-配置主机名">homenamectl 配置主机名</h3><p>💾<code>/etc/hostname</code></p><p>📌<strong>homenamectl常用命令</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl<span class="comment"># 查看主机名</span></span><br><span class="line">hostnamectl set-hostname newname<span class="comment"># 修改主机名</span></span><br></pre></td></tr></table></figure><p>📌<strong>修改配置文件修改主机名</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;newhostname&quot;</span> &gt; /etc/hostname</span><br></pre></td></tr></table></figure><h2 id="文件系统管理">文件系统管理</h2><h3 id="df-查看文件系统硬盘使用情况">df 查看文件系统硬盘使用情况</h3><p>Linux df（英文全拼：disk free） 命令用于显示目前在 Linux 系统上的文件系统磁盘使用情况统计。包括文件系统所在硬盘分区的总容量、已使用的容量、剩余容量等。</p><p>整个文件系统有关的数据，都保存在 Super block（超级块）中，而 df 命令主要读取的数据几乎都针对的是整个文件系统，所以 df 命令主要是从各文件系统的 Super block 中读取数据。</p><p>📌<strong>df命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> [-options] [目录或文件名]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>作用</th></tr></thead><tbody><tr><td><font style="color:red;"><code>-a</code></font></td><td>显示所有文件系统信息，包括系统特有的 /proc、/sysfs 等文件系统；</td></tr><tr><td><code>-m</code></td><td>以 MB 为单位显示容量；</td></tr><tr><td><code>-k</code></td><td>以 KB 为单位显示容量，默认以 KB 为单位；</td></tr><tr><td><font style="color:red;"><code>-h</code></font></td><td>使用人们习惯的 KB、MB 或 GB 等单位自行显示容量；</td></tr><tr><td><font style="color:red;"><code>-T</code></font></td><td>显示该分区的文件系统名称；</td></tr><tr><td><code>-i</code></td><td>不用硬盘容量显示，而是以含有 inode 的数量来显示。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>正常使用命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df</span><br><span class="line">Filesystem      1K-blocks      Used Available Use% Mounted on</span><br><span class="line">/dev/hdc2         9920624   3823112   5585444  41% /</span><br><span class="line">/dev/hdc3         4956316    141376   4559108   4% /home</span><br><span class="line">/dev/hdc1          101086     11126     84741  12% /boot</span><br><span class="line">tmpfs              371332         0    371332   0% /dev/shm</span><br></pre></td></tr></table></figure><blockquote><p>由 df 命令显示出的各列信息的含义分别是：</p><ul><li>Filesystem：表示该文件系统位于哪个分区，因此该列显示的是设备名称；</li><li>1K-blocks：此列表示文件系统的总大小，默认以 KB 为单位；</li><li>Used：表示用掉的硬盘空间大小；</li><li>Available：表示剩余的硬盘空间大小；</li><li>Use%：硬盘空间使用率。如果使用率高达 90% 以上，就需要额外注意，因为容量不足，会严重影响系统的正常运行；</li><li>Mounted on：文件系统的挂载点，也就是硬盘挂载的目录位置。</li></ul></blockquote></li><li><p>-aT</p><p>注意，使用 -a 选项，会将很多特殊的文件系统显示出来，这些文件系统包含的大多是系统数据，存在于内存中，不会占用硬盘空间，因此你会看到，它们所占据的硬盘总容量为 0。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df -aT</span><br><span class="line">Filesystem    Type 1K-blocks    Used Available Use% Mounted on</span><br><span class="line">/dev/hdc2     ext3   9920624 3823112   5585444  41% /</span><br><span class="line">proc          proc         0       0         0   -  /proc</span><br><span class="line">sysfs        sysfs         0       0         0   -  /sys</span><br><span class="line">devpts      devpts         0       0         0   -  /dev/pts</span><br><span class="line">/dev/hdc3     ext3   4956316  141376   4559108   4% /home</span><br><span class="line">/dev/hdc1     ext3    101086   11126     84741  12% /boot</span><br><span class="line">tmpfs        tmpfs    371332       0    371332   0% /dev/shm</span><br><span class="line">none   binfmt_misc         0       0         0   -  /proc/sys/fs/binfmt_misc</span><br><span class="line">sunrpc  rpc_pipefs         0       0         0   -  /var/lib/nfs/rpc_pipefs</span><br></pre></td></tr></table></figure></li></ol><h3 id="du-统计目录或文件所占磁盘空间大小">du 统计目录或文件所占磁盘空间大小</h3><p>du 是统计目录或文件所占磁盘空间大小的命令。</p><p>需要注意的是，使用&quot;ls -r&quot;命令是可以看到文件的大小的。但是大家会发现，在使用&quot;ls -r&quot;命令査看目录大小时，目录的大小多数是 4KB，这是因为目录下的子目录名和子文件名是保存到父目录的 block（默认大小为 4KB）中的，如果父目录下的子目录和子文件并不多，一个 block 就能放下，那么这个父目录就只占用了一个 block 大小。大家可以将其想象成图书馆的书籍目录和实际书籍。如果我们用&quot;ls-l&quot;命令査看，则只能看到这些书籍占用了 1 页纸的书籍目录，但是实际书籍到底有多少是看不到的，哪怕它堆满了几个房间。</p><p>但是我们在统计目录时，不是想看父目录下的子目录名和子文件名到底占用了多少空间，而是想看父目录下的子目录和子文件的总磁盘占用量大小，这时就需要使用 du 命令才能统计目录的真正磁盘占用量大小。</p><p>📌<strong>du命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> [-options] [目录或文件名]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-a</code></td><td>显示每个子文件的磁盘占用量。默认只统计子目录的磁盘占用量</td></tr><tr><td><code>-h</code></td><td>使用习惯单位显示磁盘占用量，如 KB、MB 或 GB 等</td></tr><tr><td><code>-s</code></td><td>统计总磁盘占用量，而不列出子目录和子文件的磁盘占用量</td></tr></tbody></table><p>📌<strong>du命令和df命令的区别</strong></p><p>有时我们会发现，使用 du 命令和 df 命令去统计分区的使用情况时，得到的数据是不一样的。那是因为df命令是从文件系统的角度考虑的，通过文件系统中未分配的空间来确定文件系统中已经分配的空间大小。也就是说，在使用 df 命令统计分区时，不仅要考虑文件占用的空间，还要统计被命令或程序占用的空间（最常见的就是文件已经删除，但是程序并没有释放空间）。</p><p>而 du 命令是面向文件的，只会计算文件或目录占用的磁盘空间。也就是说，df 命令统计的分区更准确，是真正的空闲空间。</p><h3 id="lsblk-查看设备挂载情况">lsblk 查看设备挂载情况</h3><p>lsblk命令的英文是“list block”，即用于列出所有可用块设备的信息，而且还能显示他们之间的依赖关系，但是它不会列出RAM盘的信息。</p><p>📌<strong>lsblk命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-d</code></td><td>仅列出磁盘本身，并不会列出该磁盘的分区数据</td></tr><tr><td><code>-f</code></td><td>同时列出该磁盘内的文件系统名称</td></tr><tr><td><code>-i</code></td><td>使用 ASCII的线段输出，不要使用复杂的编码（再某些环境下很有用）</td></tr><tr><td><code>-m</code></td><td>同时输出该装置在 /dev 底下的权限数据（rwx 的数据）</td></tr><tr><td><code>-p</code></td><td>列出该装置的完整文件名!而不是仅列出最后的名字而已。</td></tr><tr><td><code>-t</code></td><td>列出该磁盘装置的详细数据，包括磁盘队列机制、预读写的数据量大小等</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>-p参数之后就显示出了完整的文件名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]# lsblk -p</span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">/dev/sda      8:0    0   20G  0 disk </span><br><span class="line">├─/dev/sda1   8:1    0  300M  0 part /boot</span><br><span class="line">├─/dev/sda2   8:2    0    1G  0 part [SWAP]</span><br><span class="line">└─/dev/sda3   8:3    0 18.7G  0 part /</span><br><span class="line">/dev/sr0     11:0    1 1024M  0 rom  </span><br></pre></td></tr></table></figure></li><li><p>-f 参数之后就显示出了uuid</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]# lsblk -f</span><br><span class="line">NAME   FSTYPE LABEL UUID                                 MOUNTPOINT</span><br><span class="line">sda                                                      </span><br><span class="line">├─sda1 xfs          f8e94199-eac8-45d5-9cff-80f7696d8fe3 /boot</span><br><span class="line">├─sda2 swap         9aaf14d0-ed51-4220-b5fd-032b7ae14e36 [SWAP]</span><br><span class="line">└─sda3 xfs          0f37330d-bb9f-43b4-a71f-463043b5c786 /</span><br><span class="line">sr0   </span><br><span class="line">[root@loaclhost ~]#</span><br><span class="line">[root@loaclhost ~]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;f8e94199-eac8-45d5-9cff-80f7696d8fe3&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sda2: UUID=&quot;9aaf14d0-ed51-4220-b5fd-032b7ae14e36&quot; TYPE=&quot;swap&quot; </span><br><span class="line">/dev/sda3: UUID=&quot;0f37330d-bb9f-43b4-a71f-463043b5c786&quot; TYPE=&quot;xfs&quot;</span><br></pre></td></tr></table></figure><p>① 上面演示了使用-f参数显示分区的uuid,其实直接使用blkid也是可以显示uuid的。</p><p>② 使用parted命令可以显示分区的格式（Partition Table）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@loaclhost ~]# parted /dev/sda print</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sda: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system     标志</span><br><span class="line"> 1      1049kB  316MB   315MB   primary  xfs             启动</span><br><span class="line"> 2      316MB   1389MB  1074MB  primary  linux-swap(v1)</span><br><span class="line"> 3      1389MB  21.5GB  20.1GB  primary  xfs</span><br></pre></td></tr></table></figure></li></ol><h3 id="mount-umount-挂载-卸载">mount/umount 挂载/卸载</h3><p>💾<u><code>/etc/fatab</code></u></p><p>1️⃣<strong>mount 挂载</strong></p><p>所有的硬件设备必须挂载之后才能使用，只不过，有些硬件设备（比如硬盘分区）在每次系统启动时会自动挂载，而有些（比如 U 盘、光盘）则需要手动进行挂载。挂载指的是将硬件设备的文件系统和 Linux 系统中的文件系统，通过指定目录（作为挂载点）进行关联。而要将文件系统挂载到 Linux 系统上，就需要使用 mount 挂载命令。</p><p>📌<strong>mount命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount [-options] 设备文件名 挂载点</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-t 系统类型</td><td>指定欲挂载的文件系统类型。Linux 常见的支持类型有 EXT2、EXT3、EXT4、iso9660（光盘格式）、vfat、reiserfs 等。如果不指定具体类型，挂载时 Linux 会自动检测；</td></tr><tr><td>-L 卷标名</td><td>除了使用设备文件名（例如 /dev/hdc6）之外，还可以利用文件系统的卷标名称进行挂载；</td></tr><tr><td>-n</td><td>在默认情况下，系统会将实际挂载的情况实时写入 /etc/mtab 文件中，但在某些场景下（例如单人维护模式），为了避免出现问题，会刻意不写入，此时就需要使用这个选项；</td></tr><tr><td>-o 特殊选项</td><td>可以指定挂载的额外选项，比如读写权限、同步/异步等，如果不指定，则使用默认值（defaults）。具体的特殊选项参见表 1（挂载参数）。</td></tr></tbody></table><table><thead><tr><th>-o 特殊选项</th><th>功能</th></tr></thead><tbody><tr><td>rw/ro</td><td>是否对挂载的文件系统拥有读写权限，rw 为默认值，表示拥有读写权限；ro 表示只读权限。</td></tr><tr><td>async/sync</td><td>此文件系统是否使用同步写入（sync）或异步（async）的内存机制，默认为异步 async。</td></tr><tr><td>dev/nodev</td><td>是否允许从该文件系统的 block 文件中提取数据，为了保证数据安装，默认是 nodev。</td></tr><tr><td>auto/noauto</td><td>是否允许此文件系统被以 mount -a 的方式进行自动挂载，默认是 auto。</td></tr><tr><td>suid/nosuid</td><td>设定文件系统是否拥有 SetUID 和 SetGID 权限，默认是拥有。</td></tr><tr><td>exec/noexec</td><td>设定在文件系统中是否允许执行可执行文件，默认是允许。</td></tr><tr><td>user/nouser</td><td>设定此文件系统是否允许让普通用户使用 mount 执行实现挂载，默认是不允许（nouser），仅有 root 可以。</td></tr><tr><td>defaults</td><td>定义默认值，相当于 rw、suid、dev、exec、auto、nouser、async 这 7 个选项。</td></tr><tr><td>remount</td><td>重新挂载已挂载的文件系统，一般用于指定修改特殊权限。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>挂载分区</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir /mnt/disk1</span></span><br><span class="line"><span class="comment">#建立挂载点目录</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/sdb1 /mnt/disk1</span></span><br><span class="line"><span class="comment">#挂载分区</span></span><br></pre></td></tr></table></figure><p>2️⃣<strong>umount 卸载</strong></p><p>umount（英文全拼：unmount 命令用于卸载已经挂载的硬件设备。</p><p>📌<strong>umount命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount [-options] 设备文件名或挂载点</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>卸除/etc/mtab中记录的所有文件系统。</td></tr><tr><td>-h</td><td>显示帮助。</td></tr><tr><td>-n</td><td>卸除时不要将信息存入/etc/mtab文件中。</td></tr><tr><td>-r</td><td>若无法成功卸除，则尝试以只读的方式重新挂入文件系统。</td></tr><tr><td>-t&lt;文件系统类型&gt;</td><td>仅卸除选项中所指定的文件系统。</td></tr><tr><td>-v</td><td>执行时显示详细的信息。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>下面两条命令分别通过设备名和挂载点卸载文件系统，同时输出详细信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过设备名卸载</span></span><br><span class="line">[root@localhost ~]<span class="comment"># umount -v /dev/sda1         </span></span><br><span class="line">/dev/sda1 umounted  </span><br><span class="line"><span class="comment"># 通过挂载点卸载 </span></span><br><span class="line">[root@localhost ~]<span class="comment"># umount -v /mnt/mymount/</span></span><br><span class="line">/tmp/diskboot.img umounted </span><br></pre></td></tr></table></figure><p>如果设备正忙，卸载即告失败。卸载失败的常见原因是，我们已经进入了挂载点，在执行 umount 命令之前，用户须退出挂载目录。</p><p><font style="color:white;background:grey;">卸载硬件设备成功与否，除了执行 umount 命令不报错之外，还可以使用 <code>df</code> 命令或 <code>mount -l</code> 来查看目标设备是否还挂载在系统中。</font></p><h3 id="etc-fatab-配置-开机自动挂载硬件设备">/etc/fatab 配置-开机自动挂载硬件设备</h3><p>如果我们想实现开机自动挂载某个硬件设备，需要使用 root 身份在 /etc/fstab 文件中添加此设备即可。</p><p>📌<strong>查看 <code>/etc/fatab</code></strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vi /etc/fstab</span></span><br><span class="line">UUID=c2ca6f57-b15c-43ea-bca0-f239083d8bd2 / ext4 defaults 1 1</span><br><span class="line">UUID=0b23d315-33a7-48a4-bd37-9248e5c44345 /boot ext4 defaults 1 2</span><br><span class="line">UUID=4021be19-2751-4dd2-98cc-383368c39edb swap swap defaults 0 0</span><br><span class="line">\<span class="comment">#只有这三个是真正的硬盘分区，下面的都是虚拟文件系统或交换分区</span></span><br><span class="line">tmpfs /dev/shm tmpfs defaults 0 0</span><br><span class="line">devpts /dev/pts devpts gid=5, mode=620 0 0</span><br><span class="line">sysfs /sys sysfe defaults 0 0</span><br><span class="line">proc /proc proc defaults 0 0</span><br><span class="line"><span class="comment"># 字段的含义:</span></span><br><span class="line"><span class="comment"># UUID/文件名 挂载点 文件系统的类型 各种挂载参数 指定分区是否被dump备份 指定分区是否被fsck检测</span></span><br></pre></td></tr></table></figure><blockquote><p>tmpfs、devpts、sysfs 和 proc 这几行，它们分别是与共享内存、终端窗口、设备信息和内核参数相关联的特殊设备。</p></blockquote><p>📌<strong>字段的含义</strong></p><p><strong>UUID</strong></p><p>UUID 即通用唯一标识符，是一个 128 位比特的数字，可以理解为就是硬盘的 ID，UUID 由系统自动生成和管理。</p><p>① 用 dumpe2fs 命令（后续会讲）就可以查看到每个分区的 UUID:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# dumpe2fs /dev/sdb5</span><br><span class="line">dumpe2fs 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem volume name: test_label</span><br><span class="line">Last mounted on: &lt;not available&gt;</span><br><span class="line">Filesystem UUID: 63f238f0-a715-4821-8ed1-b3d18756a3ef</span><br><span class="line">\#UUID</span><br><span class="line">...省略部分输出..</span><br></pre></td></tr></table></figure><p>② 也可以通过查看每个硬盘UUID的链接文件名来确定UUID:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -l /dev/disk/by-uuid/</span><br><span class="line">总用量 0</span><br><span class="line">Irwxrwxrwx. 1 root root 10 4 月 11 00:17 0b23d315-33a7-48a4-bd37-9248e5c44345</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">../../sdal</span></span><br><span class="line">Irwxrwxrwx. 1 root root 10 4 月 11 00:17 4021 be19-2751 -4dd2-98cc-383368c39edb</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">../../sda2</span></span><br><span class="line">Irwxrwxrwx. 1 root root 10 4 月 11 00:17 63f238f0-a715-4821-8ed1-b3d18756a3ef</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">../../sdb5</span></span><br><span class="line">Irwxrwxrwx. 1 root root 10 4月 11 00:17 6858b440-ad9e-45cb-b411 -963c5419e0e8</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">../../sdb6</span></span><br><span class="line">Irwxrwxrwx. 1 root root 10 4月 11 00:17 c2ca6f57-b15c-43ea-bca0-f239083d8bd2</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">../../sda3</span></span><br></pre></td></tr></table></figure><p><strong>挂载点</strong></p><p>需要强调的是，挂载点一定要是已经建立的空目录。</p><p><strong>文件系统类型</strong></p><p>默认文件系统是 ext4。</p><table><thead><tr><th>文件系统</th><th>描 述</th></tr></thead><tbody><tr><td>Ext</td><td>Linux 中最早的文件系统，由于在性能和兼容性上具有很多缺陷，现在已经很少使用,是为 Linux 核心所做的第一个文件系统，最大可支持 2GB 的文件系统。</td></tr><tr><td>Ext2</td><td>是 Ext 文件系统的升级版本，Red Hat Linux 7.2 版本以前的系统默认都是 Ext2 文件系统。于 1993 年发布，支持最大 16TB 的分区和最大 2TB 的文件（1TB=1024GB=1024x1024KB) Linux正统的文件系统(如ext2、ext3)一个文件由目录项、inode和数据块组成。 目录项:包括文件名和inode节点号。 Inode：又称文件索引节点，是文件基本信息的存放地和数据块指针存放地。 数据块：文件的具体内容存放地。 将硬盘分区时会划分出目录块、inode Table区块和data block数据区域。一个文件由一个目录项、inode和数据区域块组成。 Inode包含文件的属性(如读写属性、owner等，以及指向数据块的指针)，数据区域块则是文件内容。 当查看某个文件时，会先从inode table中查出文件属性及数据存放点，再从数据块中读取数据</td></tr><tr><td>Ext3</td><td>是 Ext2 文件系统的升级版本，最大的区别就是带日志功能，以便在系统突然停止时提高文件系统的可靠性。支持最大 16TB 的分区和最大 2TB 的文件</td></tr><tr><td>Ext4</td><td>是 Ext3 文件系统的升级版。Ext4 在性能、伸缩性和可靠性方面进行了大量改进。Ext4 的变化可以说是翻天覆地的，比如向下兼容 Ext3、最大 1EB 文件系统和 16TB 文件、无限数量子目录、Extents 连续数据块 概念、多块分配、延迟分配、持久预分配、快速 FSCK、日志校验、无日志模式、在线碎片整理、inode 增强、默认启用 barrier 等。它是 CentOS 6.3 的默认文件系统</td></tr><tr><td>xfs</td><td>被业界称为最先进、最具有可升级性的文件系统技术，由 SGI 公司设计，目前最新的 CentOS 7 版本默认使用的就是此文件系统。</td></tr><tr><td>swap</td><td>swap 是 Linux 中用于交换分区的文件系统（类似于 Windows 中的虚拟内存)，当内存不够用时，使用交换分区暂时替代内存。一般大小为内存的 2 倍，但是不要超过 2GB。它是 Linux 的必需分区</td></tr><tr><td>NFS</td><td>NFS 是网络文件系统（Network File System）的缩写，是用来实现不同主机之间文件共享的一种网络服务，本地主机可以通过挂载的方式使用远程共享的资源</td></tr><tr><td>iso9660</td><td>光盘的标准文件系统。Linux 要想使用光盘，必须支持 iso9660 文件系统</td></tr><tr><td>fat</td><td>就是 Windows 下的 fatl6 文件系统，在 Linux 中识别为 fat</td></tr><tr><td>vfat</td><td>就是 Windows 下的 fat32 文件系统，在 Linux 中识别为 vfat。支持最大 32GB 的分区和最大 4GB 的文件</td></tr><tr><td>NTFS</td><td>就是 Windows 下的 NTFS 文件系统，不过 Linux 默认是不能识别 NTFS 文件系统的，如果需要识别，则需要重新编译内核才能支持。它比 fat32 文件系统更加安全，速度更快，支持最大 2TB 的分区和最大 64GB 的文件</td></tr><tr><td>ufs</td><td>Sun 公司的操作系统 Solaris 和 SunOS 所采用的文件系统</td></tr><tr><td>proc</td><td>Linux 中基于内存的虚拟文件系统，用来管理内存存储目录 /proc</td></tr><tr><td>sysfs</td><td>和 proc —样，也是基于内存的虚拟文件系统，用来管理内存存储目录 /sysfs</td></tr><tr><td>tmpfs</td><td>也是一种基于内存的虚拟文件系统，不过也可以使用 swap 交换分区</td></tr></tbody></table><p><strong>挂载参数</strong></p><p>参数和 mount 命令的挂载参数一致。</p><p><strong>指定分区是否被 dump 备份</strong></p><p>0 代表不备份，1 代表备份，2 代表不定期备份。</p><p><strong>指定分区是否被 fsck 检测</strong></p><p>0 代表不检测，其他数字代表检测的优先级，1 的优先级比 2 高。所以先检测 1 的分区，再检测 2 的分区。一般分区的优先级是 1，其他分区的优先级是 2。</p><h3 id="fdisk-磁盘分区">fdisk 磁盘分区</h3><p>⚠️<font style="color:red;"><strong>注意！</strong></font>千万不要在当前物理机的硬盘上尝试使用 fdisk，这会完整删除整个系统，一定要再找一块硬盘，或者使用虚拟机。</p><p>我们在安装操作系统的过程中已经对系统硬盘进行了分区，但如果新添加了一块硬盘，想要正常使用就需要使用fdisk分区。</p><p>在 Linux 中有专门的分区命令 fdisk 和 parted。其中 fdisk 命令较为常用，但不支持大于 2TB 的分区；如果需要支持大于 2TB 的分区，则需要使用 parted 命令，当然 parted 命令也能分配较小的分区。</p><p>📌<strong>fdisk命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdisk [-options]</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说 明</th></tr></thead><tbody><tr><td>-b <size></td><td>扇区大小(512、1024、2048或4096)</td></tr><tr><td>-c</td><td>兼容模式：“dos”或“nondos”(默认)</td></tr><tr><td>-l</td><td>列出指定的外围设备的分区表状况</td></tr><tr><td>-h</td><td>打印此帮助文本</td></tr><tr><td>-u <size></td><td>搭配&quot;-l&quot;参数列表，会用分区数目取代柱面数目，来表示每个分区的起始地址；<br />显示单位：“cylinders”(柱面)或“sectors”(扇区，默认)；</td></tr><tr><td>-v</td><td>打印版本信息</td></tr><tr><td>-C <number></td><td>指定柱面数</td></tr><tr><td>-H <number></td><td>指定磁头数</td></tr><tr><td>-S <number></td><td>指定每个磁道的扇区数</td></tr></tbody></table><p>📌<strong>分区交互界面的命令</strong>：</p><table><thead><tr><th>命令</th><th>说 明</th></tr></thead><tbody><tr><td>a</td><td>设置可引导标记</td></tr><tr><td>b</td><td>编辑 bsd 磁盘标签</td></tr><tr><td>c</td><td>设置 DOS 操作系统兼容标记</td></tr><tr><td>d</td><td>删除一个分区</td></tr><tr><td>1</td><td>显示已知的文件系统类型。82 为 Linux swap 分区，83 为 Linux 分区</td></tr><tr><td>m</td><td>显示帮助菜单</td></tr><tr><td>n</td><td>新建分区</td></tr><tr><td>0</td><td>建立空白 DOS 分区表</td></tr><tr><td>P</td><td>显示分区列表</td></tr><tr><td>q</td><td>不保存退出</td></tr><tr><td>s</td><td>新建空白 SUN 磁盘标签</td></tr><tr><td>t</td><td>改变一个分区的系统 ID</td></tr><tr><td>u</td><td>改变显示记录单位</td></tr><tr><td>V</td><td>验证分区表</td></tr><tr><td>w</td><td>保存退出</td></tr><tr><td>X</td><td>附加功能（仅专家）</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>显示当前分区情况：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># fdisk -l#查询本机可以识别的硬盘和分区</span></span><br><span class="line">Disk /dev/sda:32.2 GB, 32212254720 bytes<span class="comment">#硬盘文件名和硬盘大小</span></span><br><span class="line">255 heads, 63 sectors/track, 3916 cylinders<span class="comment">#共255个磁头、63个扇区和3916个柱面</span></span><br><span class="line">Units = cylinders of 16065 *512 = 8225280 bytes<span class="comment">#每个柱面的大小</span></span><br><span class="line">Sector size (logical/physical): 512 bytes/512 bytes<span class="comment">#每个扇区的大小</span></span><br><span class="line">I/O size (minimum/optimal): 512 bytes/512 bytes<span class="comment">#硬盘文件名和硬盘大小</span></span><br><span class="line">Disk identifier: 0x0009e098</span><br><span class="line"></span><br><span class="line">Device Boot Start End Blocks ld System<span class="comment">#设备文件名启动分区 起始柱面 终止柱面容量 ID 系统</span></span><br><span class="line">/dev/sda1 * 1 26 204800 83 Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.<span class="comment">#分区1没有占满硬盘</span></span><br><span class="line">/dev/sda2 26 281 2048000 82 Linux swap / Solaris</span><br><span class="line">Partition 2 does not end on cylinder boundary<span class="comment">#分区2没有占满硬盘</span></span><br><span class="line">/dev/sda3 281 3917 29203456 83 Linux</span><br><span class="line">Disk /dev/sdb: 21.5 GB, 21474836480 bytes<span class="comment">#第二个硬盘识别，这个硬盘的大小</span></span><br><span class="line">255 heads, 63 sectors/track, 2610 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes/512 bytes Disk identifier: 0x00000000</span><br></pre></td></tr></table></figure><blockquote><ul><li>Device：分区的设备文件名。</li><li>Boot：是否为启动引导分区，在这里 /dev/sda1 为启动引导分区。</li><li>Start：起始柱面，代表分区从哪里开始。</li><li>End：终止柱面，代表分区到哪里结束。</li><li>Blocks：分区的大小，单位是 KB。</li><li>id：分区内文件系统的 ID。在 fdisk 命令中，可以 使用 “i” 查看。</li><li>System：分区内安装的系统是什么。</li></ul></blockquote><h3 id="parted-大容量磁盘分区">parted 大容量磁盘分区</h3><p>⚠️<font style="color:red;"><strong>注意！</strong></font>parted 中所有的操作都是立即生效的，没有保存生效的概念。这一点和 fdisk 交互命令明显不同，所以做的所有操作大家要加倍小心。</p><p>虽然我们可以使用 fdisk命令对硬盘进行快速的分区，但对高于 2TB 的硬盘分区，此命令却无能为力，此时就需要使用 parted 命令。</p><p>📌<strong>parted命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parted 硬盘设备文件名<span class="comment">#进入交互模式</span></span><br></pre></td></tr></table></figure><p>📌<strong>分区交互界面的命令</strong>：</p><table><thead><tr><th>parted交互命令</th><th>说 明</th></tr></thead><tbody><tr><td>check NUMBER</td><td>做一次简单的文件系统检测</td></tr><tr><td>cp [FROM-DEVICE] FROM-NUMBER TO-NUMBER</td><td>复制文件系统到另一个分区</td></tr><tr><td>help [COMMAND]</td><td>显示所有的命令帮助</td></tr><tr><td>mklabel,mktable LABEL-TYPE</td><td>创建新的磁盘卷标（分区表）</td></tr><tr><td>mkfs NUMBER FS-TYPE</td><td>在分区上建立文件系统</td></tr><tr><td>mkpart PART-TYPE [FS-TYPE] START END</td><td>创建一个分区</td></tr><tr><td>mkpartfs PART-TYPE FS-TYPE START END</td><td>创建分区，并建立文件系统</td></tr><tr><td>move NUMBER START END</td><td>移动分区</td></tr><tr><td>name NUMBER NAME</td><td>给分区命名</td></tr><tr><td>print [devices|free|list,all|NUMBER]</td><td>显示分区表、活动设备、空闲空间、所有分区</td></tr><tr><td>quit</td><td>退出</td></tr><tr><td>rescue START END</td><td>修复丢失的分区</td></tr><tr><td>resize NUMBER START END</td><td>修改分区大小</td></tr><tr><td>rm NUMBER</td><td>删除分区</td></tr><tr><td>select DEVICE</td><td>选择需要编辑的设备</td></tr><tr><td>set NUMBER FLAG STATE</td><td>改变分区标记</td></tr><tr><td>toggle [NUMBER [FLAG]]</td><td>切换分区表的状态</td></tr><tr><td>unit UNIT</td><td>设置默认的单位</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p><strong>进入交互</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# parted /dev/sdb</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">打算继续划分/dev/sdb硬盘</span></span><br><span class="line">GNU Parted 2.1</span><br><span class="line">使用/dev/sdb</span><br><span class="line">Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.</span><br><span class="line">(parted)   &lt;--parted 的等待输入交互命令的位置，输入 help，可以看到在交互模式下支持的所有命令</span><br></pre></td></tr></table></figure><p><strong>查看分区表</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(parted) print</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入<span class="built_in">print</span>指令</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">硬盘参数，是虚拟机</span></span><br><span class="line">Disk/dev/sdb: 21.5GB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">硬盘大小</span></span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">扇区大小</span></span><br><span class="line">Partition Table: msdos</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区表类型，是MBR分区表</span></span><br><span class="line">Number Start End Size Type File system 标志</span><br><span class="line">1 32.3kB 5379MB 5379MB primary</span><br><span class="line">2 5379MB 21.5GB 16.1GB extended</span><br><span class="line">5 5379MB 7534MB 2155MB logical ext4</span><br><span class="line">6 7534MB 9689MB 2155MB logical ext4</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">看到了我们使用fdisk命令创建的分区，其中1分区没被格式化；2分区是扩展分区，不能被格式化</span></span><br></pre></td></tr></table></figure><blockquote><p>使用 print 命令可以査看分区表信息，包括硬盘参数、硬盘大小、扇区大小、分区表类型和分区信息。分区信息共有 7 列，分别如下：</p><ol><li>Number：分区号，比如，1号就代表 /dec/sdb1；</li><li>Start：分区起始位置。这里不再像 fdisk 那样用柱面表示，使用字节表示更加直观；</li><li>End：分区结束位置；</li><li>Size：分区大小；</li><li>Type：分区类型，有 primary、extended、logical 等类型；</li><li>Filesystem：文件系统类型；</li><li>标志：分区的标记。</li></ol></blockquote><p><strong>修改成 GPT 分区表</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(partcd) mklabel gpt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改分区表命令</span></span><br><span class="line">警告：正在使用/dev/sdb上的分区。由于/dev/sdb分区已经挂载，所以有警告。注意，如果强制修改，那么原有分区及数据会消失</span><br><span class="line">忽略/Ignore/放弃/Cancel? ignore</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入ignore忽略报错</span></span><br><span class="line">警告：The existing disk label on /dev/sdb will be destroyed and all data on this disk will be lost. Do you want to continue?</span><br><span class="line">是/Yes/否/No? yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入 <span class="built_in">yes</span></span></span><br><span class="line">警告：WARNING: the kernel failed to re-read the partition table on /dev/sdb (设 备或资源忙）.As a result, it may not reflect all of your changes until after reboot.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下次重启后才能生效</span></span><br><span class="line">(parted) print</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下分区表</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区表已经变成 GPT</span></span><br><span class="line">Number Start End Size File system Name 标志</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">所有的分区都消失了</span></span><br></pre></td></tr></table></figure><p>修改了分区表，如果这块硬盘上已经有分区了，那么原有分区和分区中的数据都会消失，而且需要重启系统才能生效。</p><p>另外，我们转换分区表的目的是支持大于 2TB 的分区，如果分区并没有大于 2TB，那么这一步是可以不执行的。</p><p><font style="color:red;">注意，一定要把 /etc/fstab 文件和原有分区中的内容删除才能重启，否则会报错。</font></p><p><strong>建立分区</strong></p><p>因为修改过了分区表，所以/dev/sdb硬盘中的所有数据都消失了，我们就可以重新对这块硬盘分区了。不过，在建立分区时，默认文件系统就只能是 ext2 了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(parted)mkpart</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入创建分区命令，后面不要参数，全部靠交互</span></span><br><span class="line">指定</span><br><span class="line">分区名称？ []?disk1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区名称，这里命名为disk 1</span></span><br><span class="line">文件系统系统？ [ext2]?</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件系统类型，直接回车，使用默认文件系统ext2</span></span><br><span class="line">起始点？ 1MB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区从1MB开始</span></span><br><span class="line">结束点？5GB分区到5GB结束</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区完成</span></span><br><span class="line">(parted) print</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk/dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B Partition Table: gpt</span><br><span class="line">Number Start End Size Rle system Name 标志</span><br><span class="line">1 1049kB 5000MB 4999MB disk1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区1已经出现</span></span><br></pre></td></tr></table></figure><p>不知道大家有没有注意到，我们现在用 print 查看的分区和第一次查看 MBR 分区表的分区时有些不一样了，少了 Type 这个字段，也就是分区类型字段，多了 Name（分区名）字段。分区类型是用于标识主分区、扩展分区和逻辑分区的，不过这种标识只在 MBR 分区表中使用，现在已经变成了 GPT 分区表，所以就不再有 Type 类型了。</p><p><strong>建立文件系统</strong></p><p>分区分完后，还需要进行格式化。我们知道，如果使用 parted 交互命令格式化，则只能格式化成 ext2 文件系统。我们在这里要演示一下 parted 命令的格式化方法，所以就格式化成 ext2 文件系统。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(parted) mkfs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">格式化命令（很奇怪，也是mkfs，但是这只是parted的交互命令）</span></span><br><span class="line">WARNING: you are attempting to use parted to operate on (mkfs) a file system.</span><br><span class="line">parted&#x27;s file system manipulation code is not as robust as what you&#x27;ll find in</span><br><span class="line">dedicated, file-system-specific packages like e2fsprogs. We recommend</span><br><span class="line">you use parted only to manipulate partition tables, whenever possible.</span><br><span class="line">Support for performing most operations on most types of file systems</span><br><span class="line">will be removed in an upcoming release.</span><br><span class="line">警告：The existing file system will be destroyed and all data on the partition will be lost. Do you want to continue?</span><br><span class="line">是/Yes/否/No? yes</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">警告你格式化丟失，没关系，已经丢失过了</span></span><br><span class="line">分区编号？ 1</span><br><span class="line">文件系统类型 [ext2]?</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定文件系统类型，写别的也没用，直接回车</span></span><br><span class="line">(parted) print #格式化完成，查看一下</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk/dev/sdb: 21,5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Number Start End Size File system Name标志</span><br><span class="line">1 1049kB 5000MB 4999MB ext2 diski</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拥有了文件系统</span></span><br></pre></td></tr></table></figure><p>如果要格式化成 ext4 文件系统，那么请 mkfs 命令帮忙吧（注意：不是 parted 交互命令中的 mkfs，而是系统命令 mkfs)。</p><p><strong>调整分区大小</strong></p><p>parted 命令还有一大优势，就是可以调整分区的大小（在 Windows 中也可以实现，不过要么需要转换成动态磁盘，要么需要依赖第三方工具，如硬盘分区魔术师）。起始 Linux 中 LVM 和 RAID 是可以支持分区调整的，不过这两种方法也可以看成动态磁盘方法，使用 parted 命令调整分区更加简单。</p><p><font style="color:red;">注意，parted 调整已经挂载使用的分区时，是不会影响分区中的数据的，也就是说，数据不会丢失。但是一定要先卸载分区，再调整分区大小，否则数据是会出现问题的。另外，要调整大小的分区必须已经建立了文件系统（格式化），否则会报错。</font></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(parted) resize</span><br><span class="line">分区编号？ 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定要修改的分区编号</span></span><br><span class="line">起始点？ [1049kB]? 1MB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区起始位置</span></span><br><span class="line">结束点？ [5000MB]? 6GB</span><br><span class="line">分区结束位置</span><br><span class="line">(parted) print</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk/dev/sdb: 21,5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Number Start End Size File system Name标志</span><br><span class="line">1 1049kB 6000MB 5999MB ext2 diski</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">分区大小改变</span></span><br></pre></td></tr></table></figure><p><strong>删除分区</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">命令如下：</span><br><span class="line">(parted) rm</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除分区命令</span></span><br><span class="line">分区编号？ 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定分区编号</span></span><br><span class="line">(parted) print</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk/dev/sdb: 21.5GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Number Start End Size File system Name 标志 #分区消失</span><br></pre></td></tr></table></figure><h3 id="mkfs-格式化分区">mkfs 格式化分区</h3><p>（为分区写入文件系统）</p><p>在磁盘分区上创建ext2、ext3、ext4、ms-dos、vfat文件系统，默认情况下会创建ext2。mkfs用于在设备上构建Linux文件系统，通常是硬盘分区。文件要么是设备名称(例如/dev/hda1，/dev/sdb2)，要么是包含文件系统的常规文件。成功返回0，失败返回1。</p><p>实际上，mkfs只是Linux下可用的各种文件系统构建器(mkfs.fstype)的前端，在可能/sbin、/sbin/fs、/sbin/fs.d、/etc/fs、/etc/fs等多个目录中搜索特定于文件系统的生成器(编译时定义了精确的列表，但至少包含/sbin和/sbin/fs)，最后在PATH环境变量中列出的目录中搜索。</p><p>📌<strong>mkfs命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs [-options] 分区设备文件名</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table>  <tbody>    <tr>      <td>device</td>      <td>预备检查的硬盘分区，例如：/dev/sda1</td>    </tr>    <tr>      <td>-t</td>      <td>给定档案系统的型式，Linux 的预设值为 ext2</td>    </tr>    <tr>      <td>-c</td>      <td>在制做档案系统前，检查该partition 是否有坏轨</td>    </tr>    <tr>      <td>-l bad_blocks_file</td>      <td>将有坏轨的block资料加到 bad_blocks_file 里面</td>    </tr>    <tr>      <td>block&nbsp;</td>      <td>给定 block 的大小</td>    </tr>  </tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>在 /dev/hda5 上建一个 msdos 的档案系统，同时检查是否有坏轨存在，并且将过程详细列出来:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]<span class="comment"># mkfs -V -t msdos -c /dev/hda5 </span></span><br></pre></td></tr></table></figure></li><li><p>将sda6分区格式化为ext3格式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]# mfks -t ext3 /dev/sda6   </span><br></pre></td></tr></table></figure></li></ol><h3 id="mke2fs-格式化分区">mke2fs 格式化分区</h3><p>mkfs 命令为硬盘分区写入文件系统时，无法手动调整分区的默认参数（比如块大小是 4096 Bytes），如果想要调整，就需要使用本节介绍的 mke2fs 命令。</p><p><strong>mke2fs命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mke2fs [-options] 分区设备文件名</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>功能</th></tr></thead><tbody><tr><td><code>-t 文件系统</code></td><td>指定格式化成哪个文件系统， 如 ext2、ext3、ext4；</td></tr><tr><td><code>-b 字节</code></td><td>指定 block 的大小；</td></tr><tr><td><code>-i 字节</code></td><td>指定&quot;字节 inode &quot;的比例，也就是多少字节分配一个 inode；</td></tr><tr><td><code>-j</code></td><td>建立带有 ext3 日志功能的文件系统；</td></tr><tr><td><code>-L 卷标名</code></td><td>给文件系统设置卷标名，就不使用 e2label 命令设定了；</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>格式化 <code>/dev/sdb6</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mke2fs -t ext4 -b 2048 /dev/sdb6</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">格式化分区，并指定block的大小为2048 Bytes</span></span><br><span class="line">mke2fe 1.41.12 (17-May-2010)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type：Linux</span><br><span class="line">Block size=2048 (log=1)  &lt;--block 的大小配置为 2K</span><br><span class="line">Fragment size=2048 (log=1)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks 131560</span><br><span class="line">inodes,1052240 blocks 52612 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=538968064 65 block groups</span><br><span class="line">16384 blocks per group, 16384 fragments per group</span><br><span class="line">2024 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">16384, 49152, 81920, 114688, 147456, 409600, 442368, 802816</span><br><span class="line">Writing inode tables: done</span><br><span class="line">Creating journal (32768 blocks):done</span><br><span class="line">Writing superblocks and filesystem accounting information:done</span><br><span class="line">This filesystem will be automatically checked every 38 mounts or 180 days, whichever comes first. Use tune2fs -c or-i to override.</span><br></pre></td></tr></table></figure><p>如果没有特殊需要，建议使用 mkfs 命令对硬盘分区进行格式化。</p><h3 id="fsck-磁盘检验">fsck 磁盘检验</h3><p>fsck（file system check）用来检查和维护不一致的文件系统。若系统掉电或磁盘发生问题，可利用fsck命令对文件系统进行检查。</p><p>📌<strong>fsck命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck [-options] 装置名称</span><br></pre></td></tr></table></figure><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>参数</th></tr></thead><tbody><tr><td>-t</td><td>给定档案系统的型式，若在 /etc/fstab 中已有定义或 kernel 本身已支援的则不需加上此参数</td></tr><tr><td>-s</td><td>依序一个一个地执行 fsck 的指令来检查</td></tr><tr><td>-A</td><td>对/etc/fstab 中所有列出来的 分区（partition）做检查</td></tr><tr><td>-C</td><td>显示完整的检查进度</td></tr><tr><td>-d</td><td>打印出 e2fsck 的 debug 结果</td></tr><tr><td>-p</td><td>同时有 -A 条件时，同时有多个 fsck 的检查一起执行</td></tr><tr><td>-R</td><td>同时有 -A 条件时，省略 / 不检查</td></tr><tr><td>-a</td><td>如果检查有错则自动修复</td></tr><tr><td>-r</td><td>如果检查有错则由使用者回答是否修复</td></tr><tr><td>-y</td><td>选项指定检测每个文件是自动输入yes，在不确定那些是不正常的时候，可以执行 # fsck -y 全部检查修复。</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>查看系统有多少文件系统支持的 fsck 命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]<span class="comment"># fsck[tab][tab]</span></span><br><span class="line">fsck         fsck.cramfs  fsck.ext2    fsck.ext3    fsck.msdos   fsck.vfat</span><br></pre></td></tr></table></figure></li><li><p>强制检测 /dev/hdc6 分区:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]<span class="comment"># fsck -C -f -t ext3 /dev/hdc6 </span></span><br><span class="line">fsck 1.39 (29-May-2006)</span><br><span class="line">e2fsck 1.39 (29-May-2006)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">vbird_logical: 11/251968 files (9.1% non-contiguous), 36926/1004046 blocks</span><br></pre></td></tr></table></figure><p>如果没有加上 -f 的选项，则由于这个文件系统不曾出现问题，检查的经过非常快速！若加上 -f 强制检查，才会一项一项的显示过程。</p></li><li><p>修复坏的分区文件系统：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@coonote ~]<span class="comment"># fsck -t ext3 -r /usr/local</span></span><br><span class="line"> fsck from util-linux 2.23.2</span><br><span class="line"> e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line"> fsck.ext3: Is a directory <span class="keyword">while</span> trying to open /usr/local</span><br><span class="line"> The superblock could not be <span class="built_in">read</span> or does not describe a correct ext2</span><br><span class="line"> filesystem.  If the device is valid and it really contains an ext2</span><br><span class="line"> filesystem (and not swap or ufs or something <span class="keyword">else</span>), <span class="keyword">then</span> the superblock</span><br><span class="line"> is corrupt, and you might try running e2fsck with an alternate superblock:</span><br><span class="line">     e2fsck -b 8193 </span><br><span class="line"> /usr/local: status 8, rss 1232, real 0.020288, user 0.002022, sys 0.005354</span><br></pre></td></tr></table></figure></li></ol><h3 id="添加磁盘及分区挂载">添加磁盘及分区挂载</h3><p>📌<strong>操作汇总</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /dev | grep <span class="string">&quot;^sb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#...(暂未整理)</span></span><br></pre></td></tr></table></figure><p>📌<strong>示例说明</strong>：</p><p>1️⃣<strong>使用虚拟机添加硬盘</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/39a1089d38a0400fb7f62a07b10c76bf.gif" alt="vmware添加硬盘"></p><p>2️⃣<strong>查看初始磁盘情况</strong><br>方法1：查看<code>/dev</code>下sd开头的文件<code>ls /dev</code>，没有sdb磁盘。方法2：<code>fdisk -l</code>命令 查看系统中的磁盘信息，此时是没有sdb磁盘。</p><p>3️⃣<strong>使用fdisk分区</strong></p><p>⚠如果提示 <strong>“Permission denied”</strong> 则是没有权限，在终端中输入 <strong><code>su</code></strong> 并填写密码进入到<strong>超级管理员模式</strong>即可。</p><p>使用命令查看分区：<code>fdisk -l</code></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/da9bf932811b424186a061792973b3b6.png" alt="fdisk分区1"></p><p>上图红色部分就是我们在 <strong>第二步</strong> 新建的磁盘 分区的路径名字为 <code>/dev/sdb</code></p><p>将这个空白分区分为两个20G的分区,输入分区的路径，也就是 <strong><code>fdisk /dev/sdb</code></strong> 进入到该分区下。</p><p>切换到该分区后我们输入 <code>p</code> 查看当前的分区的详细信息：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/a96b72eede464349a7ec4172635a44ef.png" alt="fdisk分区2"></p><p>可以看到，有40多G的空白分区接下来我们对磁盘进行操作，分出两个 <strong>20G</strong> 的分区</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/8eaff871f94e480e87bcf213e924efe6.gif" alt="fdisk分区3"></p><p>操作完成后，输入<code>w</code> <strong>保存并退出</strong>。这样我们就已经新建了一个<strong>20G</strong>的<strong>分区</strong>，重复上述操作两次即可新建出两个<strong>20G</strong>的<strong>分区</strong>。</p><p>在我们新建第二块分区时，可能会出现下面的问题。值超出范围<code>Value out of range.</code>。分区<strong>的大小要小于你定义的</strong>虚拟磁盘**大小。适当减少 **1G 就可以了。</p><p>此时输入 <code>fdisk -l</code> 查看新建的分区</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/91814c7ce1f54145af28d9aba2cb94e2.png" alt="fdisk分区4"></p><p><strong><code>/dev/sdb1</code></strong> 和 <strong><code>/dev/sdb2</code></strong> 就是我们新建的两个分区了</p><p>4️⃣<strong>格式化分区并挂载硬盘</strong></p><p>输入 <code>df -TH</code> 可以查看当前 <strong>分区格式</strong></p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/ab1e598cc8f747fcaf8c07729cb3c348.png" alt="格式化分区并挂载硬盘"></p><p>格式化改成 <strong>ext4</strong> 格式,输入 <code>mkfs.ext4 /dev/sdb1</code> 与 <code>mkfs.ext4 /dev/sdb2</code> 把这两个分区格式化一遍。</p><p>挂载分区，输入 <code>mkdir /sdb1</code> 与 <code>mkdir /sdb2</code>，再输入 <code>mount /dev/sdb1 /sdb1</code> 与 <code>mount /dev/sdb2 /sdb2</code> 将分区挂载到这两个目录。</p><h3 id="挂载光盘和永久挂载光盘">挂载光盘和永久挂载光盘</h3><p>📌<strong>挂载光盘</strong></p><p>1️⃣确认一下机器里面/dev文件夹下的CDROM文件是哪个：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ls -l /dev/ | grep -Fi cdrom</span></span><br><span class="line">lrwxrwxrwx. 1 root root           3 2月  18 22:46 cdrom -&gt; sr0</span><br><span class="line">crw-rw----. 1 root cdrom    21,   1 2月  18 22:46 sg1</span><br><span class="line">brw-rw----. 1 root cdrom    11,   0 2月  18 22:46 sr0</span><br></pre></td></tr></table></figure><p>我为了看起来直观用/dev/cdrom，其实用/dev/sr0也是一样的。</p><blockquote><p>sr0和sg0是什么?</p><p>Linux系统能够将大多数光学存储设备识别为SCSI设备，如<code>/dev/sr0</code>、<code>/dev/sr1</code>等。但是如果光驱使用的是老接口的话，可能会被识别为PATA设备。<code>/dev/sr*</code>设备是只读的，它们只用于从光盘上读取数据。可读写光盘驱动用<code>/dev/sg0</code>这样的设备文件表示，g代表“generic”。</p></blockquote><p>2️⃣挂载</p><p>准备一个文件夹。比如我看<code>/mnt</code>里面空的，就新建一个<code>/mnt/centos_cd</code>文件，然后挂载上去（复制下面的mount命令，用的时候改一下参数）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ls -a /mnt/</span></span><br><span class="line">.  ..  hgfs</span><br><span class="line">[root@docker01 ~]<span class="comment"># mkdir /mnt/centos_cd</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># mount --read-only --verbose --source /dev/cdrom --target /mnt/centos_cd</span></span><br><span class="line">mount：/dev/sr0 已挂臷到 /mnt/centos_cd。</span><br></pre></td></tr></table></figure><blockquote><p>mount: 在 /dev/sr0 上找不到媒体找不到媒体，添加如下：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/da3e613cc2eb4ef28b730f5953f3bcb0.png" alt="找不到媒体"></p></blockquote><p>检查centos_cd文件夹下面，已经能看到光盘里面的文件了：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># ls /mnt/centos_cd/</span></span><br><span class="line">CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL</span><br></pre></td></tr></table></figure><p>采用这种方法挂载的光盘在重启电脑之后就不再挂载，需要再重新手动挂载一次到/mnt/centos_cd（文件夹centos_cd还存在，但是重启之后不会自动mount挂载的，文件夹内是空的）。</p><p>📌<strong>永久挂载光盘</strong></p><p>反正办法挺多的，自己写个脚本开机后mount命令执行一下也不是不行。下面我用/etc/fstab文件配置的方式让系统在开机加载文件系统的时候去挂载光盘。</p><p>修改前，默认的fstab文件是这样的：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cat /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Tue Feb 14 06:06:34 2023</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=8ab7355e-d84a-4617-ae25-1f091f31d69e /                       xfs     defaults        0 0</span><br><span class="line">UUID=0cf20099-e008-460e-868b-c351fe0c1351 /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=7f08dacc-4765-4fbd-afcb-92cf37fce9c6 swap                    swap    defaults        0 0</span><br></pre></td></tr></table></figure><p>创建挂载的文件夹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/centos_cd</span><br></pre></td></tr></table></figure><p>备份一下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cp /etc/fstab /etc/fstab_backup</span></span><br></pre></td></tr></table></figure><p>查下uuid</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># blkid</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;0cf20099-e008-460e-868b-c351fe0c1351&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/sda2: UUID=<span class="string">&quot;7f08dacc-4765-4fbd-afcb-92cf37fce9c6&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span> </span><br><span class="line">/dev/sda3: UUID=<span class="string">&quot;8ab7355e-d84a-4617-ae25-1f091f31d69e&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/sr0: UUID=<span class="string">&quot;2020-11-04-11-36-43-00&quot;</span> LABEL=<span class="string">&quot;CentOS 7 x86_64&quot;</span> TYPE=<span class="string">&quot;iso9660&quot;</span> PTTYPE=<span class="string">&quot;dos&quot;</span> </span><br></pre></td></tr></table></figure><p>于是在/etc/fstab中新增</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UUID=2020-11-04-11-36-43-00  /mnt/centos_cd  iso9660  ro  0  0</span><br></pre></td></tr></table></figure><p>重启可以查看到</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># journalctl --no-pager --boot | grep -Fi mnt</span></span><br><span class="line">12月 15 13:45:09 localhost.localdomain systemd[1]: Mounting /mnt/centos_cd...</span><br><span class="line">12月 15 13:45:09 localhost.localdomain systemd[1]: Mounted /mnt/centos_cd.</span><br></pre></td></tr></table></figure><h3 id="虚拟内存和物理内存">虚拟内存和物理内存</h3><p>我们都知道，直接从内存读写数据要比从硬盘读写数据快得多，因此更希望所有数据的读取和写入都在内存中完成，然而内存是有限的，这样就引出了物理内存与虚拟内存的概念。</p><p>物理内存就是系统硬件提供的内存大小，是真正的内存。相对于物理内存，在 Linux 下还有一个虚拟内存的概念，虚拟内存是为了满足物理内存的不足而提出的策略，它是利用磁盘空间虚拟出的一块逻辑内存。用作虚拟内存的磁盘空间被称为交换空间（又称 swap 空间）。</p><p>作为物理内存的扩展，Linux 会在物理内存不足时，使用交换分区的虚拟内存，更详细地说，就是内核会将暂时不用的内存块信息写到交换空间，这样一来，物理内存得到了释放，这块内存就可以用于其他目的，当需要用到原始的内容时，这些信息会被重新从交换空间读入物理内存。</p><p>Linux 的内存管理采取的是分页存取机制，为了保证物理内存能得到充分的利用，内核会在适当的时候将物理内存中不经常使用的数据块自动交换到虚拟内存中，而将经常使用的信息保留到物理内存。</p><p>要深入了解 Linux 内存运行机制，需要知道下面提到的几个方面：</p><ul><li>首先，Linux 系统会不时地进行页面交换操作，以保持尽可能多的空闲物理内存，即使并没有什么事情需要内存，Linux 也会交换出暂时不用的内存页面，因为这样可以大大节省等待交换所需的时间。</li><li>其次，Linux 进行页面交换是有条件的，不是所有页面在不用时都交换到虚拟内存，Linux 内核根据“最近最经常使用”算法，仅仅将一些不经常使用的页面文件交换到虚拟内存。</li></ul><p>有时我们会看到这么一个现象，Linux 物理内存还有很多，但是交换空间也使用了很多，其实这并不奇怪。例如，一个占用很大内存的进程运行时，需要耗费很多内存资源，此时就会有一些不常用页面文件被交换到虚拟内存中，但后来这个占用很多内存资源的进程结束并释放了很多内存时，刚才被交换出去的页面文件并不会自动交换进物理内存（除非有这个必要），那么此时系统物理内存就会空闲很多，同时交换空间也在被使用，就出现了刚才所说的现象了。</p><p>最后，交换空间的页面在使用时会首先被交换到物理内存，如果此时没有足够的物理内存来容纳这些页面，它们又会被马上交换出去，如此一来，虚拟内存中可能没有足够的空间来存储这些交换页面，最终会导致 Linux 出现假死机、服务异常等问题。Linux 虽然可以在一段时间内自行恢复，但是恢复后的系统己经基本不可用了。</p><blockquote><p>因此，合理规划和设计 Linux 内存的使用是非常重要的，关于物理内存和交换空间的大小设置问题，取决于实际所用的硬盘大小，但大致遵循这样一个基本原则：</p><ol><li>如果内存较小（根据经验，物理内存小于 4GB），一般设置 swap 分区大小为内存的 2 倍；</li><li>如果物理内存大于 4GB，而小于 16GB，可以设置 swap 分区大小等于物理内存；</li><li>如果内存大小在 16GB 以上，可以设置 swap 为 0，但并不建议这么做，因为设置一定大小的 swap 分区是有一定作用的。</li></ol></blockquote><h3 id="swap分区">swap分区</h3><p>我们在安装系统的时候已经建立了 swap 分区。swap 分区通常被称为交换分区，这是一块特殊的硬盘空间，即当实际内存不够用的时候，操作系统会从内存中取出一部分暂时不用的数据，放在交换分区中，从而为当前运行的程序腾出足够的内存空间。</p><p>也就是说，当内存不够用时，我们使用 swap 分区来临时顶替。这种“拆东墙，补西墙”的方式应用于几乎所有的操作系统中。</p><p>使用 swap 交换分区，显著的优点是，通过操作系统的调度，应用程序实际可以使用的内存空间将远远超过系统的物理内存。由于硬盘空间的价格远比 RAM 要低，因此这种方式无疑是经济实惠的。当然，频繁地读写硬盘，会显著降低操作系统的运行速率，这也是使用 swap 交换分区最大的限制。相比较而言，Windows 不会为 swap 单独划分一个分区，而是使用分页文件实现相同的功能，在概念上，Windows 称其为虚拟内存，从某种意义上将，这个叫法更容易理解。因此，初学者将 swap 交换分区理解为虚拟内存是没有任何问题的。有时服务器的访问量确实很大，有可能出现 swap 分区不够用的情况，所以我们需要学习 swap 分区的构建方法。</p><p>📌<strong>du命令格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化swap文件系统</span></span><br><span class="line">mkswap [options] device [size]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动交换分区、观察交换分区信息-s等</span></span><br><span class="line">swapon [options] [specialfile...]</span><br><span class="line"></span><br><span class="line"><span class="comment">#内存交换分区关闭使用</span></span><br><span class="line">swapon [options] [specialfile...]</span><br></pre></td></tr></table></figure><p>📌<strong>推荐分区大小</strong>：</p><table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="background-color:#0000cc;text-align:center;"><span style="color:#f3f3f4;">内存大小</span></td><td style="background-color:#0000cc;text-align:center;"><span style="color:#f3f3f4;">swap大小</span></td></tr><tr><td style="text-align:center;">&lt;4G</td><td style="text-align:center;">2G</td></tr><tr><td style="text-align:center;">4G~16G</td><td style="text-align:center;">4G</td></tr><tr><td style="text-align:center;">16G~64G</td><td style="text-align:center;">8G</td></tr><tr><td style="text-align:center;">64G~256G</td><td style="text-align:center;">16G</td></tr><tr><td style="text-align:center;">256G~512G</td><td style="text-align:center;">32G</td></tr></tbody></table><p>oracle推荐的：</p><table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="background-color:#0000cc;text-align:center;"><span style="color:#f3f3f4;">物理内存大小</span></td><td style="background-color:#0000cc;text-align:center;"><span style="color:#f3f3f4;">swap大小</span></td></tr><tr><td style="text-align:center;">1G~2G</td><td style="text-align:center;">物理内存1.5倍</td></tr><tr><td style="text-align:center;">2G~16G</td><td style="text-align:center;">等于物理内存</td></tr><tr><td style="text-align:center;">&gt;16G</td><td style="text-align:center;">16G</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>1️⃣<strong>通过物理分区构建swap分区</strong>（推荐）</p><p>创建swap前提条件,需要有一块没有使用完的硬盘（就是一块物理硬盘需要有剩余空间未分配）。</p><p>首先<strong>查看磁盘</strong>的方式有很多，我这里用<code>lsblk</code>：(sdb物理硬盘，一共有10G，才用了不到7G，还有3G可以用)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda            8:0    0   10G  0 disk </span><br><span class="line">└─sda1         8:1    0   10G  0 part /</span><br><span class="line">sdb            8:16   0   10G  0 disk </span><br><span class="line">├─sdb1         8:17   0    5G  0 part </span><br><span class="line">│ └─vg0-lvm1 253:0    0  772M  0 lvm  </span><br><span class="line">└─sdb2         8:18   0  512M  0 part </span><br><span class="line">sr0           11:0    1 1024M  0 rom </span><br></pre></td></tr></table></figure><p><strong>查看现在的swap空间</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># free -lm</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:           979        892         87         14          0        144</span><br><span class="line">Low:           979        892         87</span><br><span class="line">High:            0          0          0</span><br><span class="line">-/+ buffers/cache:        747        232</span><br><span class="line">Swap:            0          0          0 <span class="comment"># 可以看到现在是没有swap空间的</span></span><br></pre></td></tr></table></figure><p><strong>使用fdisk创建</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># fdisk /dev/sdb 【硬盘根据实际情况选择】</span></span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p【打印】</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x229e658e</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    10487807     5242880   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n【创建分区】</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p【主分区】</span><br><span class="line">Partition number (2-4, default 2):  【直接回车即可】</span><br><span class="line">First sector (10487808-20971519, default 10487808): 【选择开始块，直接回车即可】</span><br><span class="line">Using default value 10487808</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (10487808-20971519, default 20971519): +512M 【自定义大小】</span><br><span class="line">Partition 2 of <span class="built_in">type</span> Linux and of size 512 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): t 【转换格式】</span><br><span class="line">Partition number (1,2, default 2): 2【选择硬盘<span class="built_in">id</span>】</span><br><span class="line">Hex code (<span class="built_in">type</span> L to list all codes): L【查看所有序号】</span><br><span class="line"> 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        </span><br><span class="line"> 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-</span><br><span class="line"> 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-</span><br><span class="line"> 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-</span><br><span class="line"> 4  FAT16 &lt;32M      40  Venix 80286     85  Linux extended  c7  Syrinx         </span><br><span class="line"> 5  Extended        41  PPC PReP Boot   86  NTFS volume <span class="built_in">set</span> da  Non-FS data    </span><br><span class="line"> 6  FAT16           42  SFS             87  NTFS volume <span class="built_in">set</span> db  CP/M / CTOS / .</span><br><span class="line"> 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   </span><br><span class="line"> 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       <span class="built_in">df</span>  BootIt         </span><br><span class="line"> 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     </span><br><span class="line"> a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        </span><br><span class="line"> b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      </span><br><span class="line"> c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        </span><br><span class="line"> e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            </span><br><span class="line"> f  W95 Ext<span class="string">&#x27;d (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/</span></span><br><span class="line"><span class="string">10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b</span></span><br><span class="line"><span class="string">11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      </span></span><br><span class="line"><span class="string">12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      </span></span><br><span class="line"><span class="string">14  Hidden FAT16 &lt;3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  </span></span><br><span class="line"><span class="string">16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    </span></span><br><span class="line"><span class="string">17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE </span></span><br><span class="line"><span class="string">18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto</span></span><br><span class="line"><span class="string">1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        </span></span><br><span class="line"><span class="string">1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            </span></span><br><span class="line"><span class="string">1e  Hidden W95 FAT1 80  Old Minix      </span></span><br><span class="line"><span class="string">Hex code (type L to list all codes): 82 【直接输入序号回车（如82就是swap分区）</span></span><br><span class="line"><span class="string">Changed type of partition &#x27;</span>Linux<span class="string">&#x27; to &#x27;</span>Linux swap / Solaris<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): p【打印，看刚才修改的id磁盘是否变为linux swap】</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span></span><br><span class="line"><span class="string">Units = sectors of 1 * 512 = 512 bytes</span></span><br><span class="line"><span class="string">Sector size (logical/physical): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">I/O size (minimum/optimal): 512 bytes / 512 bytes</span></span><br><span class="line"><span class="string">Disk label type: dos</span></span><br><span class="line"><span class="string">Disk identifier: 0x229e658e</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">   Device Boot      Start         End      Blocks   Id  System</span></span><br><span class="line"><span class="string">/dev/sdb1            2048    10487807     5242880   8e  Linux LVM</span></span><br><span class="line"><span class="string">/dev/sdb2        10487808    11536383      524288   82  Linux swap / Solaris</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): w 【保存】</span></span><br><span class="line"><span class="string">The partition table has been altered!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Calling ioctl() to re-read partition table.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span></span><br><span class="line"><span class="string">The kernel still uses the old table. The new table will be used at</span></span><br><span class="line"><span class="string">the next reboot or after you run partprobe(8) or kpartx(8)</span></span><br><span class="line"><span class="string">Syncing disks.</span></span><br><span class="line"><span class="string">Command (m for help): w 【保存】</span></span><br><span class="line"><span class="string">The partition table has been altered!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Calling ioctl() to re-read partition table.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span></span><br><span class="line"><span class="string">The kernel still uses the old table. The new table will be used at</span></span><br><span class="line"><span class="string">the next reboot or after you run partprobe(8) or kpartx(8)</span></span><br><span class="line"><span class="string">Syncing disks.</span></span><br><span class="line"><span class="string">[root@server0 ~]# </span></span><br><span class="line"><span class="string">[root@server0 ~]# partprobe /dev/sdb  #更新硬盘信息</span></span><br></pre></td></tr></table></figure><p><strong>格式化</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># lsblk   #fdisk –l 也可以看到分区信息</span></span><br><span class="line">NAME         MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda            8:0    0   10G  0 disk </span><br><span class="line">└─sda1         8:1    0   10G  0 part /</span><br><span class="line">sdb            8:16   0   10G  0 disk </span><br><span class="line">├─sdb1         8:17   0    5G  0 part </span><br><span class="line">│ └─vg0-lvm1 253:0    0  772M  0 lvm  </span><br><span class="line">└─sdb2         8:18   0  512M  0 part </span><br><span class="line">sr0           11:0    1 1024M  0 rom  </span><br><span class="line">[root@server0 ~]<span class="comment"># mkswap /dev/sdb2  #格式化为swap，注意分区别搞错了</span></span><br><span class="line">Setting up swapspace version 1, size = 524284 KiB</span><br><span class="line">no label, UUID=38f22d84-e4fb-4d6a-b157-48912f761bfe  <span class="comment">#无标签，uuid=…</span></span><br></pre></td></tr></table></figure><p><strong>永久挂载</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@station ~]<span class="comment"># blkid【查看swap对应的分区uuid并复制】 </span></span><br><span class="line">[root@server0 ~]<span class="comment"># vim /etc/fstab  # 最后一行添加下面内容</span></span><br><span class="line">[root@server0 ~]<span class="comment"># tail -n 1 /etc/fstab # 查询最后一行的内容</span></span><br><span class="line">UUID=74bb6046-bf04-49c6-a4a2-d4fb3aebc6b7    swap   swap   defaults 0 0  </span><br><span class="line">[root@server0 ~]<span class="comment">#</span></span><br><span class="line">[root@server0 ~]<span class="comment"># swapon -a #立即挂载</span></span><br></pre></td></tr></table></figure><p>swap属于特殊文件，<code>mount -a</code> 是不会自动挂载的，需要输入<code>swapon -a </code>才会自动挂载。</p><p><strong>激活swap分区</strong><font style="color:red;">（如果上面永久挂载中执行了<code>swapon -a</code>后，忽略该步骤！）</font></p><p>激活swap命令：<code>swapon /dev/sd*</code>,如果不激活的话，即使挂载了 swap 依然不会生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server0 ~]<span class="comment"># free -l</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:       1003456     927988      75468      15172        372     160828</span><br><span class="line">Low:       1003456     927988      75468</span><br><span class="line">High:            0          0          0</span><br><span class="line">-/+ buffers/cache:     766788     236668</span><br><span class="line">Swap:            0          0          0</span><br><span class="line"></span><br><span class="line">[root@server0 ~]<span class="comment">#</span></span><br><span class="line">[root@server0 ~]<span class="comment"># swapon /dev/sdb2 #激活swap</span></span><br><span class="line">[root@server0 ~]<span class="comment"># free –l #激活后swap 就有值了，这样 swap分区也全部完成</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:       1003456     928344      75112      15172        376     160888</span><br><span class="line">Low:       1003456     928344      75112</span><br><span class="line">High:            0          0          0</span><br><span class="line">-/+ buffers/cache:     767080     236376</span><br><span class="line">Swap:       524284          0     524284</span><br></pre></td></tr></table></figure><p>2️⃣<strong>通过文件来构建swap分区</strong></p><p>上面的方法适合磁盘留有剩余空间没有使用。但如果磁盘空间全部分区完毕，那么该如何创建swap分区呢？我们可以通过制作一个大的文件来构建swap分区。虽然磁盘的空间已经全部分完了，但只要其中任意一个分区还有剩余空间，该方法就可以使用。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建swap目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /var/swap</span><br><span class="line"><span class="comment">#创建swap文件,这里表示创建一个swapfile文件，文件大小count为1G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/var/swap/swapfile bs=1024 count=1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#转换为swap文件</span></span><br><span class="line">mkswap /var/swap/swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载激活swap文件</span></span><br><span class="line">swapon /var/swap/swapfile</span><br><span class="line"><span class="comment">#附：卸载命令</span></span><br><span class="line"><span class="comment">#swapoff /var/swap/swapfile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置开机自启动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/var/swap/swapfile   swap  swap  defaults  0  0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><p>🔰修改内核 (优化，如果没有需求则不改)</p><p>vm.swappiness参数如果为0，表示关闭swap，即使配置了swap也不会生效，所以我们这里要配置下vm.swappiness的值。</p><p>centos7默认vm.swappiness为30，也就是说，你的物理内存使用到100-30=70%时，就开始使用swap，因为内存的速度要比磁盘的速度快的多，一旦使用到swap，会加大磁盘IO，造成大量页的换进换出，影响系统性能，所以正常情况下，我们应该尽可能的使用物理内存，减少对swap虚拟内存的使用。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/vm/swappiness</span><br><span class="line">或</span><br><span class="line">sysctl -a | grep swappiness</span><br></pre></td></tr></table></figure><p>我这里调整值为10</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line">vm.swappiness=10</span><br></pre></td></tr></table></figure><p>保存后，执行以下命令，使其生效</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>此时就是说，当物理内存使用到100-10=90%时，开始使用swap。</p><hr><h1 id="软件安装">软件安装</h1><h2 id="软件包">软件包</h2><p>Linux下的软件包众多，且几乎都是经 GPL 授权、免费开源（无偿公开源代码）的。这意味着如果你具备修改软件源代码的能力，只要你愿意，可以随意修改。</p><blockquote><p>GPL，全称 General Public License，中文名称“通用性公开许可证”，简单理解 GPL 就是一个保护软件自由的一个协议，经 GPL 协议授权的软件必须开源。</p></blockquote><p>Linux下的软件包可细分为两种，分别是源码包和二进制包。</p><h3 id="Linux源码包">Linux源码包</h3><p>实际上，源码包就是一大堆源代码程序，是由程序员按照特定的格式和语法编写出来的。</p><p>我们都知道，计算机只能识别机器语言，也就是二进制语言，所以源码包的安装需要一名“翻译官”将“abcd”翻译成二进制语言，这名“翻译官”通常被称为编译器。</p><p>虽然源码包免费开源，但用户不会编程怎么办？一大堆源代码程序不会使用怎么办？源码包容易安装吗？等等这些都是使用源码包安装方式无法解答的问题。</p><p>另外，由于源码包的安装需要把源代码编译为二进制代码，因此安装时间较长。比如，大家应该都在 Windows下安装过 QQ，QQ 功能较多，程序相对较大（有 70 MB左右），但由于其并非是以源码包的形式发布，而是编译后才发布的，因此只需几分钟（经过简单的配置）即可安装成功。但如果我们以源码包安装的方式在 Linux 中安装一个 MySQL 数据库，即便此软件的压缩包仅有 23 MB左右，也需要 30 分钟左右的时间（根据硬件配置不同，略有差异）。</p><p>通过对比你会发现，源码包的编译是很费时间的，况且绝多大数用户并不熟悉程序语言，在安装过程中我们只能祈祷程序不要报错，否则初学者很难解决。</p><p>为了解决使用源码包安装方式的这些问题，Linux 软件包的安装出现了使用二进制包的安装方式。</p><h3 id="Linux二进制包">Linux二进制包</h3><p>二进制包，也就是源码包经过成功编译之后产生的包。由于二进制包在发布之前就已经完成了编译的工作，因此用户安装软件的速度较快（同 Windows下安装软件速度相当），且安装过程报错几率大大减小。</p><p>二进制包是 Linux 下默认的软件安装包，因此二进制包又被称为默认安装软件包。目前主要有以下 2 大主流的二进制包管理系统：</p><ul><li>RPM 包管理系统：功能强大，安装、升级、査询和卸载非常简单方便，因此很多 Linux 发行版都默认使用此机制作为软件安装的管理方式，例如 Fedora、CentOS、SuSE 等。</li><li>DPKG 包管理系统：由 Debian Linux 所开发的包管理机制，通过 DPKG 包，Debian Linux 就可以进行软件包管理，主要应用在 Debian 和 Ubuntu 中。</li></ul><h2 id="RPM包">RPM包</h2><h3 id="RPM包统一命名规则">RPM包统一命名规则</h3><p>RPM 二进制包的命名需遵守统一的命名规则，用户通过名称就可以直接获取这类包的版本、适用平台等信息。</p><p>RPM 二进制包命名的一般格式如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">包名-版本号-发布次数-发行商-Linux平台-适合的硬件平台-包扩展名</span><br></pre></td></tr></table></figure><p>例如，RPM 包的名称是<code>httpd-2.2.15-15.el6.centos.1.i686.rpm</code>，其中：</p><ul><li><p>httped：软件包名。这里需要注意，httped 是包名，而 httpd-2.2.15-15.el6.centos.1.i686.rpm 通常称为包全名，包名和包全名是不同的，在某些 Linux 命令中，有些命令（如包的安装和升级）使用的是包全名，而有些命令（包的查询和卸载）使用的是包名，一不小心就会弄错。</p></li><li><p>2.2.15：包的版本号，版本号的格式通常为<code>主版本号.次版本号.修正号</code>。</p></li><li><p>15：二进制包发布的次数，表示此 RPM 包是第几次编程生成的。</p></li><li><p>el*：软件发行商，el6 表示此包是由 Red Hat 公司发布，适合在 RHEL 6.x (Red Hat Enterprise Unux) 和 CentOS 6.x 上使用。</p></li><li><p>centos：表示此包适用于 CentOS 系统。</p></li><li><p>i686：表示此包使用的硬件平台，目前的 RPM 包支持的平台如表所示：</p><table><thead><tr><th>平台名称</th><th>适用平台信息</th></tr></thead><tbody><tr><td>i386</td><td>386 以上的计算机都可以安装</td></tr><tr><td>i586</td><td>686 以上的计算机都可以安装</td></tr><tr><td>i686</td><td>奔腾 II 以上的计算机都可以安装，目前所有的 CPU 是奔腾 II 以上的，所以这个软件版本居多</td></tr><tr><td>x86_64</td><td>64 位 CPU 可以安装</td></tr><tr><td>noarch</td><td>没有硬件限制</td></tr></tbody></table></li><li><p>rpm：RPM 包的扩展名，表明这是编译好的二进制包，可以使用 rpm 命令直接安装。此外，还有以 src.rpm 作为扩展名的 RPM 包，这表明是源代码包，需要安装生成源码，然后对其编译并生成 rpm 格式的包，最后才能使用 rpm 命令进行安装。</p></li></ul><p>Linux 系统不靠扩展名分区文件类型，那为什么包全名中要包含 .rpm 扩展名呢？其实，这里的扩展名是为系统管理员准备的，如果我们不对 RPM 包标注扩展名，管理员很难知道这是一个 RPM 包，当然也就无法正确使用。</p><h3 id="RPM包安装、卸载和升级">RPM包安装、卸载和升级</h3><p>我们以安装 apache 程序为例。因为后续章节还会介绍使用源码包的方式安装 apache 程序，读者可以直观地感受到源码包和 RPM 包的区别。</p><p>📌<strong>RPM包默认安装路径</strong></p><p>通常情况下，RPM 包采用系统默认的安装路径，所有安装文件会按照类别分散安装到下表所示的目录中：</p><table><thead><tr><th>安装路径</th><th>含 义</th></tr></thead><tbody><tr><td>/etc/</td><td>配置文件安装目录</td></tr><tr><td>/usr/bin/</td><td>可执行的命令安装目录</td></tr><tr><td>/usr/lib/</td><td>程序所使用的函数库保存位置</td></tr><tr><td>/usr/share/doc/</td><td>基本的软件使用手册保存位置</td></tr><tr><td>/usr/share/man/</td><td>帮助文件保存位置</td></tr></tbody></table><p>RPM 包的默认安装路径是可以通过命令查询的。</p><p>除此之外，RPM 包也支持手动指定安装路径，但此方式并不推荐。因为一旦手动指定安装路径，所有的安装文件会集中安装到指定位置，且系统中用来查询安装路径的命令也无法使用（需要进行手工配置才能被系统识别），得不偿失。</p><p>与 RPM 包不同，源码包的安装通常采用手动指定安装路径（习惯安装到 /usr/local/ 中）的方式。既然安装路径不同，同一 apache 程序的源码包和 RPM 包就可以安装到一台 Linux 服务器上（但同一时间只能开启一个，因为它们需要占用同一个 80 端口）。</p><p>实际情况中，一台服务器几乎不会同时包含两个 apache 程序，管理员不好管理，还会占用过多的服务器磁盘空间。</p><p>📌<strong>RPM命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm [-options] 包全名</span><br></pre></td></tr></table></figure><p>注意一定是包全名。涉及到包全名的命令，一定要注意路径，可能软件包在光盘中，因此需提前做好设备的挂载工作。</p><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-i</td><td>安装（install）</td></tr><tr><td>-v</td><td>显示更详细的信息（verbose）</td></tr><tr><td>-h</td><td>打印 #，显示安装进度（hash)</td></tr><tr><td>-e</td><td>卸载，也就是 erase 的首字母</td></tr><tr><td>-U</td><td>（大写）如果该软件没安装过则直接安装；若没安装则升级至最新版本</td></tr><tr><td>-F</td><td>（大写）如果该软件没有安装，则不会安装，必须安装有较低版本才能升级</td></tr><tr><td>–nodeps</td><td>不检测依赖性安装。软件安装时会检测依赖性，确定所需的底层软件是否安装，如果没有安装则会报错。<br />如果不管依赖性，想强制安装，则可以使用这个选项。注意，这样不检测依赖性安装的软件基本上是不能使用的，所以不建议这样做</td></tr><tr><td>–replacefiles</td><td>替换文件安装。如果要安装软件包，但是包中的部分文件已经存在，那么在正常安装时会报&quot;某个文件已经存在&quot;的错误，<br />从而导致软件无法安装。使用这个选项可以忽略这个报错而覆盖安装</td></tr><tr><td>–replacepkgs</td><td>替换软件包安装。如果软件包已经安装，那么此选项可以把软件包重复安装一遍</td></tr><tr><td>–force</td><td>强制安装。不管是否已经安装，都重新安装。也就是 -replacefiles 和 -replacepkgs 的综合</td></tr><tr><td>–test</td><td>测试安装。不会实际安装，只是检测一下依赖性</td></tr><tr><td>–prefix</td><td>指定安装路径。为安装软件指定安装路径，而不使用默认安装路径</td></tr></tbody></table><table><thead><tr><th>常用选项</th><th>说明</th></tr></thead><tbody><tr><td>-ivh</td><td>安装显示安装进度–install–verbose–hash;</td></tr><tr><td>-Uvh</td><td>升级软件包–Update；</td></tr><tr><td>-qpl</td><td>列出RPM软件包内的文件信息[Query Package list]；</td></tr><tr><td>-qpi</td><td>列出RPM软件包的描述信息[Query Package install package(s)]；</td></tr><tr><td>-qf</td><td>查找指定文件属于哪个RPM软件包[Query File]；</td></tr><tr><td>-Va</td><td>校验所有的RPM软件包，查找丢失的文件[View Lost]；</td></tr><tr><td>-e</td><td>删除包</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><ol><li><p>使用此命令安装 apache 软件包，如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh \</span></span><br><span class="line">/mnt/cdrom/Packages/httpd-2.2.15-15.el6.centos.1.i686.rpm</span><br><span class="line">Preparing...</span><br><span class="line"><span class="comment">####################</span></span><br><span class="line">[100%]</span><br><span class="line">1:httpd</span><br><span class="line"><span class="comment">####################</span></span><br><span class="line">[100%]</span><br></pre></td></tr></table></figure><p>注意，直到出现两个 100% 才是真正的安装成功，第一个 100% 仅表示完成了安装准备工作。</p><p>此命令还可以一次性安装多个软件包，仅需将包全名用空格分开即可，如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -ivh a.rpm b.rpm c.rpm</span></span><br></pre></td></tr></table></figure></li><li><p>使用如下命令即可实现 RPM 包的升级：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -Uvh 包全名# -U（大写）选项的含义是：如果该软件没安装过则直接安装；若没安装则升级至最新版本。</span></span><br><span class="line">[root@localhost ~]<span class="comment"># rpm -Fvh 包全名# -F（大写）选项的含义是：如果该软件没有安装，则不会安装，必须安装有较低版本才能升级。</span></span><br></pre></td></tr></table></figure></li><li><p>RPM包的卸载</p><p>RPM 软件包的卸载要考虑包之间的依赖性。例如，我们先安装的 httpd 软件包，后安装 httpd 的功能模块 mod_ssl 包，那么在卸载时，就必须先卸载 mod_ssl，然后卸载 httpd，否则会报错。（<em>软件包卸载和拆除大楼是一样的，本来先盖的 2 楼，后盖的 3 楼，那么拆楼时一定要先拆除 3 楼。</em>）</p><p>如果卸载 RPM 软件不考虑依赖性，执行卸载命令会包依赖性错误，例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -e httpd</span></span><br><span class="line">error: Failed dependencies:</span><br><span class="line">httpd-mmn = 20051115 is needed by (installed) mod_wsgi-3.2-1.el6.i686</span><br><span class="line">httpd-mmn = 20051115 is needed by (installed) php-5.3.3-3.el6_2.8.i686</span><br><span class="line">httpd-mmn = 20051115 is needed by (installed) mod_ssl-1:2.2.15-15.el6.</span><br><span class="line">centos.1.i686</span><br><span class="line">httpd-mmn = 20051115 is needed by (installed) mod_perl-2.0.4-10.el6.i686</span><br><span class="line">httpd = 2.2.15-15.el6.centos.1 is needed by (installed) httpd-manual-2.2.</span><br><span class="line">15-15.el6.centos.1 .noarch</span><br><span class="line">httpd is needed by (installed) webalizer-2.21_02-3.3.el6.i686</span><br><span class="line">httpd is needed by (installed) mod_ssl-1:2.2.15-15.el6.centos.1.i686</span><br><span class="line">httpd=0:2.2.15-15.el6.centos.1 is needed by(installed)mod_ssl-1:2.2.15-15.el6.centos.1.i686</span><br></pre></td></tr></table></figure></li></ol><h2 id="yum-包管理工具">yum 包管理工具</h2><p>yum，全称“Yellow dog Updater, Modified”，是一个专门为了解决包的依赖关系而存在的软件包管理器。</p><p>可以这么说，yum 是改进型的 RPM 软件管理器，它很好的解决了 RPM 所面临的软件包依赖问题。yum 在服务器端存有所有的 RPM 包，并将各个包之间的依赖关系记录在文件中，当管理员使用 yum 安装 RPM 包时，yum 会先从服务器端下载包的依赖性文件，通过分析此文件从服务器端一次性下载所有相关的 RPM 包并进行安装。</p><p>📌<strong>查看 yum 是否已安装</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># rpm -qa | grep yum</span></span><br><span class="line">yum-metadata-parser-1.1.2-16.el6.i686</span><br><span class="line">yum-3.2.29-30.el6.centos.noarch</span><br><span class="line">yum-utils-1.1.30-14.el6.noarch</span><br><span class="line">yum-plugin-fastestmirror-1.1.30-14.el6.noarch</span><br><span class="line">yum-plugin-security-1.1.30-14.el6.noarch</span><br></pre></td></tr></table></figure><p>可以看到，系统上已经安装了 yum 。如果未安装 yum 可查看《<a href="https://jingyan.baidu.com/article/e3c78d6483a02a3c4d85f578.html">Linux怎么安装yum</a>》。</p><p>📌<strong>网络 yum 源</strong>:</p><p>一般情况下，只要你的主机网络正常，可以直接使用网络 yum 源，不需要对配置文件做任何修改，这里对 yum 源配置文件做一下简单介绍。网络 yum 源配置文件位于 <code>/etc/yum.repos.d/</code> 目录下，文件扩展名为&quot;<em>.repo&quot;（只要扩展名为 &quot;</em>.repo&quot; 的文件都是 yum 源的配置文件）。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls /etc/yum.repos.d/</span></span><br><span class="line">CentOS-Base.repo</span><br><span class="line">CentOS-Media.repo</span><br><span class="line">CentOS-Debuginfo.repo.bak</span><br><span class="line">CentOS-Vault.repo</span><br></pre></td></tr></table></figure><p>可以看到，该目录下有 4 个 yum 配置文件，通常情况下是 CentOS-Base.repo 文件生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Base</span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/? release= <span class="variable">$releasever</span>&amp;<span class="built_in">arch</span>=<span class="variable">$basearch</span>&amp;repo=os</span><br><span class="line">baseurl=http://mirror.centos.org/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span><br><span class="line">…省略部分输出…</span><br></pre></td></tr></table></figure><blockquote><p>此文件中含有 5 个 yum 源容器，这里只列出了 base 容器，其他容器和 base 容器类似。base 容器中各参数的含义分别为：</p><ul><li>[base]：容器名称，一定要放在[]中。</li><li>name：容器说明，可以自己随便写。</li><li>mirrorlist：镜像站点，这个可以注释掉。</li><li>baseurl：我们的 yum 源服务器的地址。默认是 CentOS 官方的 yum 源服务器，是可以使用的。如果你觉得慢，则可以改成你喜欢的 yum 源地址。</li><li>enabled：此容器是否生效，如果不写或写成 enabled 则表示此容器生效，写成 enable=0 则表示此容器不生效。</li><li>gpgcheck：如果为 1 则表示 RPM 的数字证书生效；如果为 0 则表示 RPM 的数字证书不生效。</li><li>gpgkey：数字证书的公钥文件保存位置。不用修改。</li></ul></blockquote><p>📌<strong>本地 yum 源</strong></p><p>在无法联网的情况下，yum 可以考虑用本地光盘（或安装映像文件）作为 yum 源。</p><p>Linux 系统安装映像文件中就含有常用的 RPM 包，我们可以使用压缩文件打开映像文件（iso文件），进入其 Packages 子目录，如图所示：</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2-1Z32P9423J01.gif" alt="安装映像文件的 Packages 子目录"></p><p>可以看到，该子目录下含有几乎所有常用的 RPM 包，因此使用系统安装映像作为本地 yum 源没有任何问题。</p><p>在 <code>/etc/yum.repos.d/</code> 目录下有一个 CentOS-Media.repo 文件，此文件就是以本地光盘作为 yum 源的模板文件，只需进行简单的修改即可，步骤如下：</p><ol><li><p>放入 CentOS 安装光盘，并挂载光盘到指定位置。命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /mnt/cdrom</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建cdrom目录，作为光盘的挂载点</span></span><br><span class="line">[root@localhost ~]# mount /dev/cdrom /mnt/cdrom/</span><br><span class="line">mount: block device/dev/srO is write-protected, mounting read-only</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">挂载光盘到/mnt/cdrom目录下</span></span><br></pre></td></tr></table></figure></li><li><p>修改其他几个 yum 源配置文件的扩展名，让它们失效，因为只有扩展名是&quot;*.repo&quot;的文件才能作为 yum 源配置文件。当也可以删除其他几个 yum 源配置文件，但是如果删除了，当又想用网络作为 yum 源时，就没有了参考文件，所以最好还是修改扩展名。 命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@localhost yum.repos.d]# mv CentOS-Base, repo CentOS-Base.repo.bak</span><br><span class="line">[root@localhost yum.repos.d]#mv CentOS-Debuginfo.repo CentOS-Debuginfo.repo.bak</span><br><span class="line">[root@localhost yum.repos.d]# mv CentOS-Vault.repo CentOS-Vault.repo.bak</span><br></pre></td></tr></table></figure></li><li><p>修改光盘 yum 源配置文件 CentOS-Media.repo，参照以下方修改：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]# vim CentOS-Media.repo</span><br><span class="line">[c6-media]</span><br><span class="line">name=CentOS-$releasever - Media</span><br><span class="line">baseurl=file:///mnt/cdrom</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">地址为你自己的光盘挂载地址</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">file:///media/cdrom/</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">file:///media/cdrecorder/</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注释这两个的不存在地址</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把enabled=0改为enabled=1, 让这个yum源配置文件生效</span></span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span><br></pre></td></tr></table></figure><p>如此，本地 yum 源就配置完成了。</p></li></ol><h3 id="更换国内-yum-源">更换国内 yum 源</h3><p>📌<strong>更换yum源</strong>：</p><p>首先备份/etc/yum.repos.d/CentOS-Base.repo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><p>执行替换：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">[root@localhost ~]<span class="comment"># wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mv CentOS6-Base-163.repo CentOS-Base.repo</span></span><br></pre></td></tr></table></figure><p>运行以下命令生成缓存：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum clean all</span></span><br><span class="line">[root@localhost ~]<span class="comment"># yum makecache</span></span><br></pre></td></tr></table></figure><p>📌<strong>国内yum源</strong>：</p><ol><li>网易（163）yum 源: <a href="http://mirrors.163.com/.help/centos.html">http://mirrors.163.com/.help/centos.html</a><ul><li>CentOS5 ：<a href="http://mirrors.163.com/.help/CentOS5-Base-163.repo">http://mirrors.163.com/.help/CentOS5-Base-163.repo</a></li><li>CentOS6 ：<a href="http://mirrors.163.com/.help/CentOS6-Base-163.repo">http://mirrors.163.com/.help/CentOS6-Base-163.repo</a></li><li>CentOS7 ：<a href="http://mirrors.163.com/.help/CentOS7-Base-163.repo">http://mirrors.163.com/.help/CentOS7-Base-163.repo</a></li></ul></li><li>中科大的 yum 源，安装方法查看：<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/centos">https://lug.ustc.edu.cn/wiki/mirrors/help/centos</a></li><li>清华大学的 yum 源安装方法查看: <a href="https://mirrors.tuna.tsinghua.edu.cn/help/centos/">https://mirrors.tuna.tsinghua.edu.cn/help/centos/</a></li><li>aliyun 的 yum 源安装方法查看: <a href="https://developer.aliyun.com/mirror/centos">https://developer.aliyun.com/mirror/centos</a></li></ol><h3 id="yum-命令">yum 命令</h3><p>📌<strong>yum命令的格式</strong>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum [-options] [<span class="built_in">command</span>] [package ...]</span><br></pre></td></tr></table></figure><p>📌<strong>常用命令</strong>：</p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>check-update</td><td>列出所有可更新的软件清单命令</td></tr><tr><td>update</td><td>更新所有软件命令</td></tr><tr><td>install &lt;package_name&gt;</td><td>仅安装指定的软件命令</td></tr><tr><td>update &lt;package_name&gt;</td><td>仅更新指定的软件命令</td></tr><tr><td>remove &lt;package_name&gt;</td><td>删除软件包命令</td></tr><tr><td>list [package_name]</td><td>查询所有已安装和可安装的软件包<br />[package_name] 查询执行软件包的安装情况</td></tr><tr><td>search <keyword></td><td>查找软件包命令</td></tr><tr><td>info &lt;package_name&gt;</td><td>查询执行软件包的详细信息</td></tr><tr><td>clean packages</td><td>清除缓存目录下的软件包</td></tr><tr><td>clean header</td><td>清除缓存目录下的 headers</td></tr><tr><td>clean oldheaders</td><td>清除缓存目录下旧的 headers</td></tr><tr><td>clean 或 clean all (= yum clean packages; yum clean oldheaders)</td><td>清除缓存目录下的软件包及旧的 headers</td></tr></tbody></table><p>📌<strong>选项</strong>：</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-y</code></td><td>当安装过程提示选择全部为 “yes”</td></tr><tr><td><code>-q</code></td><td>不显示安装的过程</td></tr></tbody></table><p>📌<strong>示例说明</strong>：</p><p>查看支持的所有可安装版本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">已安装的软件包</span><br><span class="line">可安装的软件包</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line">docker-ce.x86_64            3:23.0.1-1.el7                     docker-ce-stable </span><br><span class="line">docker-ce.x86_64            3:23.0.1-1.el7                     @docker-ce-stable</span><br><span class="line">docker-ce.x86_64            3:23.0.0-1.el7                     docker-ce-stable </span><br><span class="line">docker-ce.x86_64            3:20.10.9-3.el7                    docker-ce-stable </span><br><span class="line">...省略部分数据...</span><br><span class="line"><span class="comment"># @号为当前安装版本</span></span><br></pre></td></tr></table></figure><h2 id="dnf-包管理工具">dnf 包管理工具</h2><p>CentOS7 并未集成dnf包管理工具</p><hr><h1 id="Seliunx">Seliunx</h1><p>Linux被认为是当今最安全的操作系统之一，这是因为它杰出的安全特性，如SELinux(安全增强的Linux)。</p><p>对于初学者，SELinux被描述为在内核中执行的强制访问控制(MAC)安全结构。SELinux提供了一种强制执行某些安全策略的方法，否则系统管理员将无法有效地实现这些策略。当您安装RHEL/CentOS或其他衍生工具时，SELinux服务是默认启用的，因此您系统上的一些应用程序可能不支持这种安全机制。因此，要使此类应用程序正常运行，必须禁用或关闭SELinux。</p><p><strong>SELinux一共有3种状态，分别是Enforcing，Permissive和Disabled状态</strong>。第一种是默认状态，表示强制启用，第二种是宽容的意思，即大部分规则都放行。第三种是禁用，即不设置任何规则。只能通过setenforce命令来设置前面两种状态，而如果想修改为disable状态，需要修改配置文件，同时重启系统。</p><p>📌<strong>查询</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sestatus</span><br><span class="line">getenforce</span><br></pre></td></tr></table></figure><p>📌<strong>临时禁用</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0 &gt; /selinux/enforce</span><br><span class="line">setenforce 0</span><br><span class="line">setenforce Permissive</span><br></pre></td></tr></table></figure><p>📌<strong>永久禁用</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/selinux</span><br><span class="line"></span><br><span class="line"><span class="comment">#将配置SELinux=enforcing改为SELinux=disabled</span></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure><p>保存退出后使配置生效，需要重新启动系统</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><hr><h1 id="系统备份">系统备份</h1><h2 id="1-备份的重要性">1.备份的重要性</h2><p>虽然 Linux 系统难免会因内部环境、底层硬件、外来黑客等因素的影响出现问题，但作为一名系统管理人员，自身的职责并不是要保证系统永远不出问题（事实上也是不可能做到的），而是要在系统出现故障或者崩溃时，能以最快的速度，用最短时间恢复系统的运行，保证数据的安全，从而将故障带来的损失降到最低。</p><p>要实现这样的目标，就要求系统管理人员对系统和业务应用有一个合理的备份恢复策略，完美的备份策略可以保证业务的 0 宕机时间和数据的完全恢复。有人说，既然数据备份非常重要，那我把重要数据在硬盘中保存一份，在移动硬盘中也保存一份，再刻录一张光盘，这样数据应该非常安全了吧？</p><p>对个人用户来讲，这样保存数据已经足够了；但是对企业用户来讲，还是有安全隐患的，因为这些数据还是放在同一个地方的。还记得美国的“9·11”事件吗？像美国纽约世贸中心那样的庞然大物也轰然倒塌。当然，相比这样的灾难来讲，数据的损失已经是微不足道的了，不过这仍然说明异地备份的重要性。所以，我们在备份数据的时候，不仅要把数据保存在多个存储介质中，还要考虑把重要数据异地保存。</p><h2 id="2-备份策略">2.备份策略</h2><p>常用的备份策略有完全备份和增量备份，而增量备份有可细分为累计增量备份和差异增量备份。下面来分别讲述不同备份策略以及之间的区别。</p><ul><li><p><strong>完全备份</strong></p><p>完全备份是指把所有需要备份的数据全部备份。当然，完全备份可以备份整块硬盘、整个分区或某个具体的目录。对于 Linux 操作系统来说，完全备份指的就是将根目录下的所有文件进行备份。</p><p>完全备份的好处是，所有数据都进行了备份，系统中任何数据丢失都能恢复，且恢复效率较高。如果完全备份备份的是整块硬盘，那么甚至不需要数据恢复，只要把备份硬盘安装上，服务器就会恢复正常。</p><p>完全备份的缺点也很明显，那就是需要备份的数据量较大，备份时间较长，备份了很多无用数据，占用的空间较大，所以完全备份不可能每天执行。</p><p>我们一般会对关键服务器进行整盘完全备份，如果出现问题，则可以很快地使用备份硬盘进行替换，从而减少损失。我们甚至会对关键服务器搭设一台一模一样的服务器，这样只要远程几个命令（或使用 Shell 脚本自动检测，自动进行服务器替换），备份服务器就会接替原本的服务器，使故障响应时间大大缩短。</p></li><li><p><strong>累计增量备份</strong></p><p>在一个数据量很大的业务应用中，每天对 Linux 系统进行完全备份是不现实的，这就需要用到增量备份策略。</p><p>累计增量备份是指先进行一次完全备份，服务器运行一段时间之后，比较当前系统和完全备份的备份数据之间的差异，只备份有差异的数据。服务器继续运行，再经过一段时间，进行第二次增量备份。在进行第二次增量备份时，当前系统和第一次增量备份的数据进行比较，也是只备份有差异的数据。第三次增量备份是和第二次增量备份的数据进行比较，以此类推。</p><p>因此，累计增量备份就是只备份每天增加或者变化的数据，而不备份系统中没有变动的数据。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2-1Q0291641164c.jpg" alt="累计增量备份"></p><p>假设我们在第一天进行一次完全备份。第二天增量备份时，只会备份第二天和第一天之间的差异数据，但是第二天的总备份数据是完全备份加第一次增量备份的数据。第三天增量备份时，只会备份第三天和第二天之间的差异数据，但是第三天的总备份数据是完全备份加第一次增量备份的数据，再加第二次增量备份的数据。当然，第四天增量备份时，只会备份第四天和第三天的差异数据，但是第四天的总备份数据是完全备份加第一次增量备份的数据，加第二次增量备份的数据，再加第三次增量备份的数据。</p><p>采用累计增量备份的好处是，每次备份需要备份的数据较少，耗时较短，占用的空间较小；坏处是数据恢复比较麻烦，如果图上的例子，那么当进行数据恢复时，就要先恢复完全备份的数据，再依次恢复第一次增量备份的数据、第二次增量备份的数据和第三次增量备份的数据，最终才能恢复所有的数据。</p></li><li><p><strong>差异增量备份</strong></p><p>差异增量备份（后续简称差异备份）也要先进行一次完全备份，但是和累计增量备份不同的是，每次差异备份都备份和原始的完全备份不同的数据。也就是说，差异备份每次备份的参照物都是原始的完全备份，而不是上一次的差异备份。</p><p><img src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2-1Q02916415T37.jpg" alt="差异增量备份"></p><p>假设我们在第一天也进行一次完全备份。第二天差异备份时，会备份第二天和第一天之间的差异数据，而第二天的备份数据是完全备份加第一次差异备份的数据。第三天进行差异备份时，仍和第一天的原始数据进行对比，把第二天和第三天所有的数据都备份在第二次差异备份中，第三天的备份数据是完全备份加第二次差异备份的数据。第四天进行差异备份时，仍和第一天的原始数据进行对比，把第二天、第三天和第四天所有的不同数据都备份到第三次差异备份中，第四天的备份数据是完全备份加第三次差异备份的数据。</p><p>相比较而言，差异备份既不像完全备份一样把所有数据都进行备份，也不像增量备份在进行数据恢复时那么麻烦，只要先恢复完全备份的数据，再恢复差异备份的数据即可。不过，随着时间的增加，和完全备份相比，变动的数据越来越多，那么差异备份也可能会变得数据量庞大、备份速度缓慢、占用空间较大。</p></li></ul><h2 id="3-tar命令备份数据">3.tar命令备份数据</h2><p>下面通过 tar 命令做的一个 Web 服务器的备份脚本，详细了解 tar 命令作为备份工具时的具体用法。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">BAKDATE=`<span class="built_in">date</span> +%y%m%d`</span><br><span class="line">DATA3=`<span class="built_in">date</span> -d <span class="string">&quot;3 days ago&quot;</span> +%y%m%d`</span><br><span class="line">osdata=/disk1</span><br><span class="line">userdata=/disk2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;backup OS data starting&quot;</span></span><br><span class="line">tar -zcvf /<span class="variable">$osdata</span>/etc.data/etc_<span class="variable">$BAKDATE</span>.tar.gz /etc</span><br><span class="line">tar -zcvf /<span class="variable">$osdata</span>/boot.data/boot_<span class="variable">$BAKDATE</span>.tar.gz /boot</span><br><span class="line">tar -zcvf /<span class="variable">$osdata</span>/home.data/home_<span class="variable">$BAKDATE</span>.tar.gz /home</span><br><span class="line">tar -zcvf /<span class="variable">$osdata</span>/root.data/root_<span class="variable">$BAKDATE</span>.tar.gz /root</span><br><span class="line">tar -zcvf /<span class="variable">$userdata</span>/usr_data/usrlocal_<span class="variable">$BAKDATE</span>.tar.gz /usr/local</span><br><span class="line">tar -zcvf /<span class="variable">$userdata</span>/var_www/www_<span class="variable">$BAKDATE</span>.tar.gz /var/www</span><br><span class="line"><span class="built_in">cp</span> -r /<span class="variable">$osdata</span>/* /<span class="variable">$userdata</span></span><br><span class="line"><span class="built_in">cp</span> -r /<span class="variable">$userdata</span>/* /<span class="variable">$osdata</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Backup OS data complete!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;delete OS data 3 days ago&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/etc.data/etc_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/boot.data/boot_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/home.data/home_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/root.data/root_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/usr_data/usrlocal_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$osdata</span>/var_www/www_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/etc.data/etc_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/boot.data/boot_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/home.data/home_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/root.data/root_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/usr_data/usrlocal_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -rf /<span class="variable">$userdata</span>/var_www/www_<span class="variable">$DATA3</span>.tar.gz</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;delete cws ok!&quot;</span></span><br></pre></td></tr></table></figure><p>上面这段脚本完成的工作是，将系统和用户的备份数据分别保存在两个不同的本地磁盘 disk1 和 disk2 中，并且保留最近 3 天的数据，3 天前的数据自动删除。主要备份的数据有 /etc 目录、/boot 目录、/home 目录、/root 目录、/usr/local 目录和 /var/www 目录。当然这里只是举个例子，凡是存放数据的重要目录，都需要进行备份。</p>]]></content>
      
      
      <categories>
          
          <category> Program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title></title>
      <link href="/manifest.json"/>
      <url>/manifest.json</url>
      
        <content type="html"><![CDATA[{"name":"Aceniu'Blog","short_name":"Aceniu","theme_color":"#3b70fc","background_color":"#3b70fc","display":"standalone","scope":"/","start_url":"/","icons":[{"src":"/img/siteicon/16.png","sizes":"16x16","type":"image/png"},{"src":"/img/siteicon/32.png","sizes":"32x32","type":"image/png"},{"src":"/img/siteicon/48.png","sizes":"48x48","type":"image/png"},{"src":"/img/siteicon/64.png","sizes":"64x64","type":"image/png"},{"src":"/img/siteicon/128.png","sizes":"128x128","type":"image/png"}],"splash_pages":null}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/custom.css"/>
      <url>/css/custom.css</url>
      
        <content type="html"><![CDATA[@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400&display=swap');div#menus {    font-family: 'Noto Sans SC', sans-serif;}h1#site-title {    font-family: 'Noto Sans SC', sans-serif;    font-size: 3em !important;}a.article-title,a.blog-slider__title,a.categoryBar-list-link,h1.post-title {    font-family: 'Noto Sans SC', sans-serif;}.iconfont {    font-family: "iconfont" !important;    font-size: 3em;    /* 可以定义图标大小 */    font-style: normal;    -webkit-font-smoothing: antialiased;    -moz-osx-font-smoothing: grayscale;}/* 时间轴生肖icon */svg.icon {    /* 这里定义svg.icon，避免和Butterfly自带的note标签冲突 */    width: 1em;    height: 1em;    /* width和height定义图标的默认宽度和高度*/    vertical-align: -0.15em;    fill: currentColor;    overflow: hidden;}.icon-zhongbiao::before {    color: #f7c768;}/* bilibli番剧插件 */#article-container .bangumi-tab.bangumi-active {    background: var(--anzhiyu-theme);    color: var(--anzhiyu-ahoverbg);    border-radius: 10px;}a.bangumi-tab:hover {    text-decoration: none !important;}.bangumi-button:hover {    background: var(--anzhiyu-theme) !important;    border-radius: 10px !important;    color: var(--anzhiyu-ahoverbg) !important;}a.bangumi-button.bangumi-nextpage:hover {    text-decoration: none !important;}.bangumi-button {    padding: 5px 10px !important;}a.bangumi-tab {    padding: 5px 10px !important;}svg.icon.faa-tada {    font-size: 1.1em;}.bangumi-info-item {    border-right: 1px solid #f2b94b;}.bangumi-info-item span {    color: #f2b94b;}.bangumi-info-item em {    color: #f2b94b;}/* 解决artitalk的图标问题 */#uploadSource>svg {    width: 1.19em;    height: 1.5em;}/*top-img黑色透明玻璃效果移除，不建议加，除非你执着于完全一图流或者背景图对比色明显 */#page-header:not(.not-top-img):before {    background-color: transparent !important;}/* 首页文章卡片 */#recent-posts>.recent-post-item {    background: rgba(255, 255, 255, 0.9);}/* 首页侧栏卡片 */#aside-content .card-widget {    background: rgba(255, 255, 255, 0.9);}/* 文章页面正文背景 */div#post {    background: rgba(255, 255, 255, 0.9);}/* 分页页面 */div#page {    background: rgba(255, 255, 255, 0.9);}/* 归档页面 */div#archive {    background: rgba(255, 255, 255, 0.9);}/* 标签页面 */div#tag {    background: rgba(255, 255, 255, 0.9);}/* 分类页面 */div#category {    background: rgba(255, 255, 255, 0.9);}/*夜间模式伪类遮罩层透明*/[data-theme="dark"] #recent-posts>.recent-post-item {    background: #121212;}[data-theme="dark"] .card-widget {    background: #121212 !important;}[data-theme="dark"] div#post {    background: #121212 !important;}[data-theme="dark"] div#tag {    background: #121212 !important;}[data-theme="dark"] div#archive {    background: #121212 !important;}[data-theme="dark"] div#page {    background: #121212 !important;}[data-theme="dark"] div#category {    background: #121212 !important;}[data-theme="dark"] div#category {    background: transparent !important;}/* 页脚透明 */#footer {    background: transparent !important;}/* 头图透明 */#page-header {    background: transparent !important;}#rightside>div>button {    border-radius: 5px;}/* 滚动条 */::-webkit-scrollbar {    width: 10px;    height: 10px;}::-webkit-scrollbar-thumb {    background-color: #3b70fc;    border-radius: 2em;}::-webkit-scrollbar-corner {    background-color: transparent;}::-moz-selection {    color: #fff;    background-color: #3b70fc;}/* 音乐播放器 *//* .aplayer .aplayer-lrc {  display: none !important;} */.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {    left: -66px !important;    transition: all 0.3s;    /* 默认情况下缩进左侧66px，只留一点箭头部分 */}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {    left: 0 !important;    transition: all 0.3s;    /* 鼠标悬停是左侧缩进归零，完全显示按钮 */}.aplayer.aplayer-fixed {    z-index: 999999 !important;}/* 评论框  */.vwrap {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 30px 0px;}/* 设置评论框 */.vcard {    box-shadow: 2px 2px 5px #bbb;    background: rgba(255, 255, 255, 0.3);    border-radius: 8px;    padding: 30px;    margin: 30px 0px 0px 0px;}/* 鼠标图标 */body {    cursor: default;}a,[type="button"]:not(:disabled),[type="reset"]:not(:disabled),[type="submit"]:not(:disabled),button:not(:disabled) {    cursor: url("/img/x2.cur"), auto !important;}/* md网站下划线 */#article-container a:hover {    text-decoration: none !important;}#article-container #hpp_talk p img {    display: inline;}/* 404页面 */#error-wrap {    position: absolute;    top: 40%;    right: 0;    left: 0;    margin: 0 auto;    padding: 0 1rem;    max-width: 1000px;    transform: translate(0, -50%);}#error-wrap .error-content {    display: flex;    flex-direction: row;    justify-content: center;    align-items: center;    margin: 0 1rem;    height: 18rem;    border-radius: 8px;    background: var(--card-bg);    box-shadow: var(--card-box-shadow);    transition: all 0.3s;}#error-wrap .error-content .error-img {    box-flex: 1;    flex: 1;    height: 100%;    border-top-left-radius: 8px;    border-bottom-left-radius: 8px;    background-color: #3b70fc;    background-position: center;    background-size: cover;}#error-wrap .error-content .error-info {    box-flex: 1;    flex: 1;    padding: 0.5rem;    text-align: center;    font-size: 14px;    font-family: Titillium Web, "PingFang SC", "Hiragino Sans GB", "Microsoft JhengHei", "Microsoft YaHei", sans-serif;}#error-wrap .error-content .error-info .error_title {    margin-top: -4rem;    font-size: 9em;}#error-wrap .error-content .error-info .error_subtitle {    margin-top: -3.5rem;    word-break: break-word;    font-size: 1.6em;}#error-wrap .error-content .error-info a {    display: inline-block;    margin-top: 0.5rem;    padding: 0.3rem 1.5rem;    background: var(--btn-bg);    color: var(--btn-color);}#body-wrap.error .aside-list {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    bottom: 0px;    position: absolute;    padding: 1rem;    width: 100%;    overflow: scroll;}#body-wrap.error .aside-list .aside-list-group {    display: flex;    flex-direction: row;    flex-wrap: nowrap;    max-width: 1200px;    margin: 0 auto;}#body-wrap.error .aside-list .aside-list-item {    padding: 0.5rem;}#body-wrap.error .aside-list .aside-list-item img {    width: 100%;    object-fit: cover;    border-radius: 12px;}#body-wrap.error .aside-list .aside-list-item .thumbnail {    overflow: hidden;    width: 230px;    height: 143px;    background: var(--anzhiyu-card-bg);    display: flex;}#body-wrap.error .aside-list .aside-list-item .content .title {    -webkit-line-clamp: 2;    overflow: hidden;    display: -webkit-box;    -webkit-box-orient: vertical;    line-height: 1.5;    justify-content: center;    align-items: flex-end;    align-content: center;    padding-top: 0.5rem;    color: white;}#body-wrap.error .aside-list .aside-list-item .content time {    display: none;}/* 代码框主题 */#article-container figure.highlight {    border-radius: 10px;}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>images</title>
      <link href="/images/index.html"/>
      <url>/images/index.html</url>
      
        <content type="html"><![CDATA[<head><meta http-equiv="refresh" content="0;url=https://images.halfsummer.xyz"></head>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/ali_font.js"/>
      <url>/js/ali_font.js</url>
      
        <content type="html"><![CDATA[window._iconfont_svg_string_3890337='<svg><symbol id="icon-bilibili-line" viewBox="0 0 1024 1024"><path d="M306.005333 117.632L444.330667 256h135.296l138.368-138.325333a42.666667 42.666667 0 0 1 60.373333 60.373333L700.330667 256H789.333333A149.333333 149.333333 0 0 1 938.666667 405.333333v341.333334a149.333333 149.333333 0 0 1-149.333334 149.333333h-554.666666A149.333333 149.333333 0 0 1 85.333333 746.666667v-341.333334A149.333333 149.333333 0 0 1 234.666667 256h88.96L245.632 177.962667a42.666667 42.666667 0 0 1 60.373333-60.373334zM789.333333 341.333333h-554.666666a64 64 0 0 0-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0 0 57.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0 0 63.701334-57.856L853.333333 746.666667v-341.333334A64 64 0 0 0 789.333333 341.333333zM341.333333 469.333333a42.666667 42.666667 0 0 1 42.666667 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666666-42.666667z m341.333334 0a42.666667 42.666667 0 0 1 42.666666 42.666667v85.333333a42.666667 42.666667 0 0 1-85.333333 0v-85.333333a42.666667 42.666667 0 0 1 42.666667-42.666667z" fill="#FF6EC7" ></path></symbol><symbol id="icon-Rss" viewBox="0 0 1024 1024"><path d="M677.7 512c0-91.135-74.565-165.7-165.7-165.7s-165.7 74.565-165.7 165.7c0 77.879 53.852 143.33 126.761 160.73-1.657 4.143-2.486 8.285-2.486 13.257v281.692c0 23.198 18.227 41.425 41.425 41.425s41.425-18.227 41.425-41.425v-281.692c0-4.143-0.83-9.114-2.486-13.257 72.909-17.398 126.761-82.851 126.761-160.73zM512 603.135c-50.539 0-91.135-40.597-91.135-91.135s40.597-91.135 91.135-91.135 91.135 40.597 91.135 91.135-40.597 91.135-91.135 91.135z" fill="#eba33a" ></path><path d="M512 14.897c-274.235 0-497.103 222.867-497.103 497.103 0 166.53 82.022 314.004 207.126 404.309l48.054-67.108c-104.391-75.395-172.329-198.842-172.329-337.201 0-228.667 185.584-414.253 414.253-414.253s414.253 185.584 414.253 414.253c0 138.359-67.938 261.808-173.157 336.373l48.054 67.108c125.933-90.307 207.126-237.78 207.126-404.309 0.83-273.407-222.039-496.274-496.274-496.274z" fill="#eba33a" ></path><path d="M512 180.598c-183.099 0-331.402 148.302-331.402 331.402 0 111.019 54.682 209.612 138.359 269.264l48.054-67.108c-62.966-45.568-103.563-119.306-103.563-202.156 0-137.533 111.019-248.551 248.551-248.551s248.551 111.019 248.551 248.551c0 82.851-40.597 156.588-103.563 202.156l48.054 67.108c83.679-59.652 138.359-158.244 138.359-269.264 0-183.099-148.302-331.402-331.402-331.402z" fill="#eba33a" ></path></symbol><symbol id="icon-icon_github-circle" viewBox="0 0 1024 1024"><path d="M512 115.456c-219.005156 0-396.544 177.539982-396.544 396.542862 0 219.005156 177.539982 396.545138 396.544 396.545138S908.544 731.004018 908.544 512c0-219.005156-177.538844-396.544-396.544-396.544z m128.58368 530.008747c7.764196 15.530667 10.225209 31.064747 7.949653 49.186133v98.377956c0 15.532942-10.06592 25.888996-25.6 25.888995S597.333333 808.561778 597.333333 793.028836v-100.9664c0-18.120249-5.65248-36.242773-18.594702-49.186134-5.178027-5.175751-8.004267-15.530667-5.414684-25.88672 2.587307-10.358329 10.234311-18.127076 20.591502-18.127075 75.07968-7.76192 144.917618-33.650916 144.917618-155.331698 0-31.065884-10.385636-59.542187-31.095467-80.253156-7.764196-5.175751-7.778987-15.531804-5.192818-25.887857 7.767609-20.710969 7.759644-41.421938 2.582756-62.135183-10.354916 2.589582-33.660018 10.356053-67.315485 33.657743-5.178027 2.589582-12.944498 5.179164-20.713244 2.589582-54.365298-15.532942-113.910898-15.532942-168.275058 0-7.768747 2.587307-15.53408 2.587307-23.301689-2.589582-31.065884-23.300551-54.36416-31.067022-67.309795-33.657743-5.178027 20.714382-5.178027 41.425351 2.589582 64.724765 2.586169 7.767609 2.586169 18.1248-5.179165 25.888995-20.712107 23.300551-31.065884 49.188409-31.065884 80.256569 0 121.676231 69.897102 144.975644 144.974507 155.333974 10.357191 2.586169 18.120249 7.76192 20.712106 18.120248 5.176889 7.766471 2.929778 18.1248-4.835555 25.888996C472.46336 658.41152 467.626667 673.942187 467.626667 692.062436v100.9664c0 15.532942-10.635947 25.888996-26.168889 25.888995s-26.168889-10.356053-26.168889-25.888995v-44.009245c-77.368889 10.358329-111.383893-31.064747-134.682169-62.135182-10.358329-12.942222-20.741689-23.298276-28.50816-25.888996-12.945636-2.583893-20.730311-18.120249-18.138453-31.067022 2.587307-12.942222 18.115698-20.710969 31.059057-18.120249 28.478578 5.178027 44.069547 25.888996 57.011769 44.009245C342.74304 684.300516 361.813333 705.009209 415.288889 694.65088v-2.588444c0-15.532942 2.52928-31.067022 7.705031-49.186134-72.486684-15.530667-150.185529-59.544462-150.185529-199.345493 0-36.242773 12.926293-72.486684 36.22912-103.553707-10.357191-33.653191-7.777849-67.310933 7.756231-100.967538 2.589582-7.765333 7.765333-12.942222 15.529529-15.53408 10.354916-2.585031 44.010382-7.764196 113.907485 36.243912 54.366436-12.942222 113.907484-12.942222 170.863502 0 69.900516-44.010382 103.55712-38.831218 113.912035-36.243912 7.764196 2.591858 12.942222 7.768747 15.532943 15.53408 12.942222 31.067022 15.531804 67.314347 7.764195 100.967538 23.301689 31.067022 36.338347 64.723627 36.338347 103.553707 0.002276 147.56864-87.926329 188.98944-150.058098 201.933938z" fill="#707070" ></path></symbol><symbol id="icon-icon_qq-circle" viewBox="0 0 1024 1024"><path d="M512 115.456c-219.005156 0-396.544 177.539982-396.544 396.542862 0 219.005156 177.538844 396.545138 396.544 396.545138 219.004018 0 396.544-177.539982 396.544-396.544 0-219.005156-177.539982-396.544-396.544-396.544z m248.242631 543.352604c-11.301547 5.999502-28.98944-7.715271-45.587342-32.967111-6.549049 27.511467-22.831787 52.453831-46.058382 72.397938 24.392818 9.197796 40.289849 24.23808 40.289849 41.230791 0 27.898311-43.10016 50.573084-96.244623 50.573085-47.928889 0-87.748836-18.39104-95.079537-42.548338a282.532978 282.532978 0 0 0-11.451734 0c-7.328427 24.157298-47.069867 42.548338-94.999893 42.548338-53.151289 0-96.24576-22.59968-96.24576-50.573085 0-16.996124 15.897031-32.032996 40.285298-41.228515-23.218631-20.030578-39.431964-44.888747-46.056107-72.400214-16.596764 25.252978-34.368853 39.041707-45.665849 32.96256-16.443164-8.726756-13.093547-55.637333 7.326151-104.813226 16.048356-38.656 37.950578-67.099307 54.471111-73.41056-0.230969-2.497422-0.310613-4.911787-0.310613-7.406934 0-14.959502 4.05504-28.75392 10.912427-39.979235 0-0.855609-0.076231-1.794276-0.076231-2.647609a43.292444 43.292444 0 0 1 4.36224-18.859805c4.133547-100.453262 68.189298-180.179627 171.762346-180.179626 103.574187 0 167.55712 79.726364 171.763485 180.176213 2.727253 5.535289 4.364516 12.004693 4.364515 18.859805 0 0.86016 0 1.795413-0.157013 2.651022 6.940444 11.224178 10.985244 25.093689 10.985244 39.979235 0 2.414364-0.1536 4.98688-0.386844 7.40352 16.596764 6.315804 38.423893 34.760249 54.472249 73.413974 20.494791 49.098524 23.765902 96.091022 7.325013 104.817777z" fill="#1296db" ></path></symbol><symbol id="icon-icon_wechat-circle" viewBox="0 0 1024 1024"><path d="M349.904213 353.878471c-16.288427 0-32.965973 10.775893-32.965973 27.319182 0 16.512569 16.675271 27.326009 32.965973 27.326009 16.684373 0 27.544462-11.1616 27.544463-27.322595 0-16.546702-11.2128-27.322596-27.544463-27.322596zM575.067022 511.654116c-10.860089 0-22.109298 11.163876-22.109298 21.935217 0 11.160462 11.249209 21.932942 22.109298 21.932943 16.677547 0 27.539911-10.773618 27.539911-21.932943 0-11.122916-10.862364-21.935218-27.539911-21.935217zM503.622542 408.523662c16.675271 0 27.53536-11.1616 27.53536-27.322595 0-16.546702-10.860089-27.322596-27.53536-27.322596-16.331662 0-32.971662 10.775893-32.971662 27.319182 0 16.512569 16.637724 27.326009 32.971662 27.326009zM695.811413 511.654116c-10.934044 0-21.797547 11.163876-21.797546 21.935217 0 11.160462 10.899911 21.932942 21.797546 21.932943 16.642276 0 27.539911-10.773618 27.539911-21.932943 0-11.122916-10.897636-21.935218-27.539911-21.935217z" fill="#1afa29" ></path><path d="M512 115.456c-219.004018 0-396.544 177.539982-396.544 396.542862 0 219.005156 177.539982 396.545138 396.544 396.545138S908.544 731.004018 908.544 512c0-219.005156-177.539982-396.544-396.544-396.544z m-90.955093 516.377031c-27.188338 0-49.298773-5.38624-76.84096-10.778169l-76.87168 38.099627 22.104746-65.422222c-54.766933-38.136036-87.735182-87.391573-87.735182-147.115805 0-103.590116 98.90816-185.173333 219.615005-185.596586 107.944391 0 202.701938 65.496178 221.5936 153.156266-7.022364-0.616676-14.082276-1.268622-21.139912-1.268622l0.039823 0.037547c-104.379733 0-186.682027 77.195947-186.998329 172.169671a166.387484 166.387484 0 0 0 6.708338 45.788729c-6.704924 0.623502-13.420089 0.929564-20.475449 0.929564z m324.066417 76.806827l16.637725 54.337991-60.197547-32.708836c-22.069476 5.424924-44.174222 10.81344-65.97632 10.81344-104.377458 0-186.684302-70.880142-186.684302-158.235306 0-87.045689 82.306844-158.198898 186.684302-158.198898 98.986667 0 186.725262 71.152071 186.725262 158.198898 0 48.908516-32.971662 92.470613-77.18912 125.792711z" fill="#1afa29" ></path></symbol><symbol id="icon-youxiang" viewBox="0 0 1024 1024"><path d="M512 62.584C263.8 62.584 62.584 263.8 62.584 512S263.8 961.416 512 961.416 961.416 760.2 961.416 512 760.2 62.584 512 62.584z m232.022 584.767c0 24.81-20.876 45.112-46.4 45.112H326.377c-25.523 0-46.4-20.301-46.4-45.112l0.213-222.877 226.25 119.983a11.907 11.907 0 0 0 11.12 0l226.462-120.096v222.99z m-231.91-145.259L280.216 376.237c0.225-24.624 20.788-44.7 46.162-44.7h371.246c25.336 0 46.1 20.001 46.4 44.575l-231.91 125.98z" fill="#1296db" ></path></symbol><symbol id="icon-dragon_chen" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#D6B196" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-498.122105 265.620211L431.157895 754.526316V485.052632h-66.074948c-14.470737 110.645895-44.355368 197.066105-102.696421 260.742736l-39.747368-36.432842C306.526316 617.876211 323.368421 462.901895 323.368421 242.526316V215.578947h377.263158v53.894737H377.182316c-0.404211 58.260211-2.209684 112.128-6.359579 161.684211H700.631579v53.894737h-122.152421a481.172211 481.172211 0 0 0 76.826947 119.70021l66.479158-39.855158 27.728842 46.214737-54.460631 32.687158c29.507368 24.953263 63.757474 45.675789 102.80421 58.098526l-16.303158 51.361684c-134.224842-42.711579-222.773895-167.073684-261.551158-268.207157H485.052632v221.857684l68.985263-41.391158 27.728842 46.214737-109.783579 65.886316zM646.736842 377.263158h-215.578947v-53.894737h215.578947v53.894737z" fill="#231F20" ></path></symbol><symbol id="icon-dog_xu" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#D6B196" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-375.592421 150.393263c33.684211 44.544 75.210105 74.698105 124.739369 90.812632l11.425684 3.718737 10.401684-6.009264C781.204211 727.740632 808.421053 622.565053 808.421053 592.842105h-53.894737c0 22.069895-19.132632 80.869053-33.711158 103.504842-34.816-14.605474-64.538947-39.262316-89.249684-74.13221 48.316632-55.269053 92.079158-117.328842 120.535579-179.900632l-49.044211-22.285473c-23.767579 52.250947-59.742316 104.717474-100.055579 152.656842-24.010105-50.930526-41.148632-115.927579-51.658105-195.395369H700.631579v-53.894737h-155.189895A1848.050526 1848.050526 0 0 1 538.947368 161.684211h-53.894736c0 58.206316 2.155789 112.074105 6.494315 161.68421H323.368421v26.947368c0 216.549053-13.177263 263.545263-100.702316 359.046737l39.747369 36.432842c63.326316-69.093053 92.806737-118.272 105.714526-206.848H485.052632v-53.894736h-111.319579a1742.147368 1742.147368 0 0 0 3.449263-107.789474h120.158316c12.611368 98.250105 35.031579 177.475368 67.395368 238.187789-61.978947 65.536-128.053895 117.975579-173.298526 142.282106l25.519158 47.481263c47.589053-25.573053 114.095158-77.446737 177.55621-142.821053z m125.170526-411.971368l-80.842105-80.842106-38.103579 38.103579 80.842105 80.842106 38.103579-38.103579z" fill="#231F20" ></path></symbol><symbol id="icon-dog" viewBox="0 0 1024 1024"><path d="M894.814316 904.434526l83.240421-183.134315-13.824-13.204211c-0.485053-0.458105-45.648842-47.589053-47.939369-185.263158-0.134737-7.922526-0.134737-33.953684-0.134736-55.996631-30.693053 15.306105-70.090105 19.887158-106.09179 19.887157-92.752842 0-163.624421-23.983158-210.647579-71.275789a192.512 192.512 0 0 1-27.944421-36.513684H377.263158v377.263158c342.662737 0 403.105684 51.092211 494.592 128.377263 7.922526 6.682947 15.521684 13.312 22.959158 19.86021z" fill="#85C3DE" ></path><path d="M326.063158 282.947368c0 34.250105-13.231158 44.463158-29.642105 44.463158s-29.642105-10.213053-29.642106-44.463158c0-34.223158 13.231158-44.463158 29.642106-44.463157s29.642105 10.24 29.642105 44.463157zM269.473684 430.295579v311.646316L190.275368 916.210526h59.203369L323.368421 753.637053V377.263158h-26.947368c-119.403789 0-172.732632-53.382737-185.505685-107.789474h35.624421c51.092211 0 68.581053-15.764211 120.535579-62.544842 12.773053-11.506526 28.079158-25.276632 47.023158-41.741474l18.351158-15.952842-69.658947-99.139368-44.085895 30.989474 41.768421 59.472842c-11.183158 9.862737-20.884211 18.593684-29.480421 26.327579C180.736 212.156632 176.235789 215.578947 146.539789 215.578947H53.894737v26.947369c0 88.710737 66.910316 178.149053 215.578947 187.769263z m216.710737-161.414737c2.290526 71.733895 28.698947 136.326737 75.048421 182.918737C618.711579 509.628632 702.437053 538.947368 810.091789 538.947368c18.593684 0 36.190316-1.158737 52.628211-3.449263 3.745684 111.265684 33.630316 170.334316 51.496421 196.015158l-38.507789 84.722526C782.174316 742.049684 688.774737 700.631579 377.263158 700.631579v53.894737c34.277053 0 65.697684 0.512 94.639158 1.509052L374.595368 970.105263h59.203369l96.013474-211.240421c66.182737 4.338526 117.005474 11.829895 157.911578 22.016L626.229895 916.210526h59.176421l54.16421-119.134315c47.616 18.405053 79.737263 42.091789 113.125053 69.739789L805.753263 970.105263h59.203369l113.071157-248.778105-13.824-13.204211c-0.485053-0.458105-45.648842-47.589053-47.939368-185.263158C985.168842 498.553263 1024 447.811368 1024 377.263158c0-95.205053-66.506105-161.684211-161.684211-161.684211v53.894737c65.482105 0 107.789474 42.307368 107.789474 107.789474 0 89.088-87.013053 107.789474-160.013474 107.789474-92.752842 0-163.624421-23.983158-210.647578-71.27579-30.315789-30.504421-45.891368-65.832421-53.35579-98.735158 11.210105 6.952421 22.932211 13.338947 35.274105 19.186527l23.04-48.720843c-92.106105-43.654737-148.992-128.646737-219.243789-243.981473l-46.026105 28.05221c49.448421 81.246316 92.968421 148.506947 147.051789 199.302737z" fill="#231F20" ></path></symbol><symbol id="icon-goat" viewBox="0 0 1024 1024"><path d="M548.378947 646.736842a952.32 952.32 0 0 1 140.90779-161.68421H107.789474c0 107.600842 0 107.600842-63.649685 169.283368l-13.069473 12.665263L66.721684 754.526316h417.172211c20.345263-41.472 43.654737-77.446737 64.485052-107.789474z" fill="#F7C768" ></path><path d="M608.256 144.734316C555.762526 115.577263 506.098526 107.789474 485.052632 107.789474V53.894737c32.579368 0 91.270737 11.452632 149.369263 43.735579 75.290947 41.822316 130.694737 94.531368 171.385263 150.878316C755.873684 288.013474 697.101474 323.368421 646.736842 323.368421h-107.789474v-53.894737h107.789474c20.506947 0 48.424421-11.210105 80.437895-31.285895a471.04 471.04 0 0 0-118.918737-93.453473zM832.673684 342.231579c-16.384 0-29.642105 10.24-29.642105 44.463158 0 34.250105 13.231158 44.463158 29.642105 44.463158s29.642105-10.213053 29.642105-44.463158c0-34.223158-13.231158-44.463158-29.642105-44.463158zM1024 619.789474C1024 347.109053 901.066105 122.448842 686.753684 3.395368l-26.165895 47.104C914.324211 191.461053 964.688842 440.400842 969.647158 592.842105h-84.506947c-17.92-35.624421-45.352421-69.12-87.013053-101.995789l-16.788211-13.285053-16.734315 13.392842c-66.128842 52.897684-134.629053 127.083789-187.311158 209.677474H102.965895l-8.272842-20.318316C159.043368 617.013895 161.684211 603.109053 161.684211 485.052632v-53.894737h485.052631v-53.894737H161.684211c0-80.384 14.309053-110.026105 66.586947-137.916632l-25.384421-47.535158C123.365053 234.226526 107.789474 291.920842 107.789474 377.263158v107.789474c0 107.600842 0 107.600842-63.649685 169.283368l-13.069473 12.665263L110.618947 862.315789h58.206316l-43.897263-107.789473h103.477895l43.897263 107.789473h58.206316l-43.897263-107.789473h259.47621C508.981895 824.939789 485.052632 899.152842 485.052632 970.105263h53.894736c0-68.688842 27.270737-144.060632 68.958316-215.578947H687.157895c7.410526 0 13.473684 6.063158 13.473684 13.473684V862.315789h53.894737v-94.315789c0-37.160421-30.208-67.368421-67.368421-67.368421h-44.65179c40.771368-58.017684 89.438316-111.427368 138.913684-153.626947C841.512421 600.037053 862.315789 655.225263 862.315789 754.526316h53.894737c0-38.912-2.748632-74.482526-11.102315-107.789474H1024v-26.947368z" fill="#231F20" ></path></symbol><symbol id="icon-goat_wei" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#D6B196" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-431.157895 50.202947c52.304842 70.925474 136.973474 152.144842 232.528843 190.383158l19.994947-50.041263c-109.271579-43.708632-202.805895-152.629895-238.780632-217.49221H808.421053v-53.894737H538.947368v-53.894737h215.578948v-53.894737h-215.578948V161.684211h-53.894736v161.68421h-215.578948v53.894737h215.578948v53.894737H215.578947v53.894737h255.757474c-35.974737 64.862316-129.536 173.783579-238.807579 217.49221l20.021895 50.041263c95.528421-38.238316 180.197053-119.484632 232.501895-190.383158V808.421053h53.894736v-246.218106z" fill="#231F20" ></path></symbol><symbol id="icon-dragon" viewBox="0 0 1024 1024"><path d="M366.376421 344.441263l152.980211-152.98021c43.142737-43.142737 141.204211-9.216 270.201263 115.738947-15.225263 9.835789-25.114947 15.818105-44.13979 32.256s-38.076632 35.489684-59.418947 56.832c-4.203789 4.203789-51.173053 53.221053-78.740211 82.027789-10.805895-12.126316-22.743579-24.171789-34.654315-36.082526L493.136842 362.792421l-54.218105 54.218105-72.542316-72.569263zM862.315789 512c0 46.834526-45.352421 80.842105-107.789473 80.842105-108.948211 0-189.359158-28.806737-267.129263-56.697263C414.100211 509.871158 344.872421 485.052632 258.182737 485.052632 80.788211 485.052632 0 588.126316 0 683.897263h53.894737C73.216 659.779368 135.302737 646.736842 177.340632 646.736842c77.338947 0 223.124211 23.282526 291.893894 47.912421C547.462737 722.701474 615.989895 754.526316 734.315789 754.526316 862.315789 754.526316 916.210526 670.315789 916.210526 512h-53.894737z" fill="#FF8787" ></path><path d="M552.421053 1024c-69.766737 0-113.825684-13.958737-156.402527-27.459368-54.487579-17.273263-110.807579-35.004632-232.421052-26.516211l-3.826527-53.733053c131.718737-9.458526 195.934316 10.967579 252.52379 28.887579 42.226526 13.365895 78.686316 24.926316 140.126316 24.926316 92.752842 0 148.210526-57.936842 148.210526-113.960421 0-16.949895-5.524211-101.618526-114.634105-101.618526-64.970105 0-112.747789 23.336421-163.328 48.02021C365.325474 830.571789 300.301474 862.315789 204.288 862.315789 85.908211 862.315789 0 787.294316 0 683.897263 0 588.126316 80.788211 485.052632 258.182737 485.052632c86.689684 0 155.917474 24.818526 229.214316 51.09221 45.810526 16.410947 92.564211 33.172211 145.488842 44.166737 9.000421-7.033263 13.850947-16.276211 13.850947-26.758737 0-37.187368-37.672421-74.859789-74.13221-111.265684l-3.287579-3.287579 38.103579-38.103579 3.260631 3.287579C652.853895 446.275368 700.631579 494.026105 700.631579 553.552842c0 12.719158-2.802526 24.926316-7.976421 36.109474A594.997895 594.997895 0 0 0 754.526316 592.842105c62.437053 0 107.789474-34.007579 107.789473-80.842105 0-58.853053-52.870737-110.268632-108.840421-164.702316l-8.057263-7.841684c-19.024842 16.437895-38.076632 35.489684-59.418947 56.832l-38.103579-38.103579c74.805895-74.832842 134.898526-134.898526 268.314947-141.931789V55.619368c-63.407158 7.787789-120.993684 39.424-121.667368 39.801264l-15.818105 8.811789-14.120421-11.344842C731.701895 66.452211 709.712842 53.894737 673.684211 53.894737c-41.418105 0-74.347789 25.869474-109.190737 53.301895-26.624 20.911158-54.137263 42.549895-86.851369 53.194105L469.342316 161.684211h-69.093053l-105.525895 105.525894-38.103579-38.130526L324.015158 161.684211H161.684211V107.789474h303.104c22.231579-8.272842 43.708632-25.168842 66.398315-42.981053C569.829053 34.438737 613.618526 0 673.684211 0c48.909474 0 81.408 17.946947 110.888421 40.097684C813.702737 26.300632 877.729684 0 943.157895 0h26.947368v323.368421h-53.894737v-53.167158c-54.164211 3.098947-92.914526 15.845053-127.002947 36.675369l1.832421 1.778526C852.587789 368.505263 916.210526 430.376421 916.210526 512c0 60.928-43.708632 109.945263-107.789473 127.622737V700.631579h53.894736v-53.894737h53.894737v53.894737h53.894737v53.894737h-53.894737v53.894737h-53.894737v-53.894737h-53.894736c-29.722947 0-53.894737-24.171789-53.894737-53.894737v-53.894737c-118.325895 0-207.063579-31.797895-285.318737-59.877053C400.437895 562.229895 335.494737 538.947368 258.182737 538.947368 117.059368 538.947368 53.894737 611.732211 53.894737 683.897263 53.894737 757.221053 115.738947 808.421053 204.288 808.421053c11.910737 0 23.228632-0.538947 34.034526-1.536C248.454737 796.321684 269.473684 770.640842 269.473684 739.166316c0-33.118316-43.088842-70.979368-58.152421-81.596632l30.935579-44.139789c8.299789 5.793684 81.111579 58.664421 81.111579 125.736421 0 19.429053-4.527158 37.052632-10.994526 52.304842 30.773895-10.051368 58.314105-23.498105 86.662737-37.349053C452.877474 727.848421 508.577684 700.631579 585.997474 700.631579 702.410105 700.631579 754.526316 778.725053 754.526316 856.144842 754.526316 938.657684 678.912 1024 552.421053 1024z m-21.180632-623.104L493.136842 362.792421l137.889684-137.889684 38.103579 38.103579-137.889684 137.889684z m-126.760421-18.351158l-38.103579-38.103579 152.980211-152.98021 38.103579 38.103579-152.980211 152.98021z m282.004211-218.624c15.494737-9.754947 43.331368-31.447579 43.331368-31.447579-25.734737-27.809684-49.556211-33.333895-67.368421-29.07621-19.240421 4.608-37.753263 24.602947-37.753263 24.602947s42.253474 22.447158 61.790316 35.920842z" fill="#231F20" ></path></symbol><symbol id="icon-horse" viewBox="0 0 1024 1024"><path d="M776.003368 646.736842c16.599579-99.947789 43.439158-181.086316 83.213474-256.538947l6.817684-12.934737H269.473684c-36.756211 0-53.894737 54.945684-53.894737 92.05221 0 46.753684 6.656 77.527579 70.278737 176.074106l84.533895 128.269473L498.876632 646.736842h277.126736z" fill="#FFAF6E" ></path><path d="M1024 0v404.210526c0 33.333895 0 134.736842-92.079158 134.736842h-13.824l-78.362947-109.056c-22.743579 49.906526-40.340211 103.046737-53.490527 162.950737h115.092211C937.310316 592.842105 970.105263 625.637053 970.105263 661.638737c0 60.631579-69.389474 154.300632-77.312 164.75621l-43.008-32.471579C875.466105 759.861895 916.210526 693.813895 916.210526 661.638737c0-5.982316-8.919579-14.901895-14.901894-14.901895h-125.332211C761.128421 736.121263 754.526316 840.569263 754.526316 970.105263h-53.894737c0-283.971368 31.097263-453.605053 110.888421-605.049263l20.318316-38.534737 112.801684 156.995369c14.443789-4.419368 25.465263-20.938105 25.465263-79.306106V0h53.894737z m-161.684211 161.684211h53.894737V0h-53.894737v80.842105c-17.381053-14.955789-38.184421-26.947368-80.842105-26.947368h-134.736842v53.894737h134.736842c37.672421 0 80.842105 40.906105 80.842105 53.894737z m-107.789473 0h-215.578948v53.894736h161.684211l53.894737-53.894736zM300.894316 766.544842L400.680421 916.210526h64.754526l-95.043368-142.551579L498.876632 646.736842h167.855157a1212.631579 1212.631579 0 0 1 9.431579-53.894737h-199.383579l-175.885473 173.702737z m109.97221-184.400842l-37.861052-38.319158-132.419369 130.802526C173.729684 571.095579 161.684211 529.812211 161.684211 469.315368 161.684211 398.578526 199.464421 323.368421 269.473684 323.368421h323.368421l53.894737-53.894737H269.473684c-6.709895 0-13.258105 0.565895-19.698526 1.482105C234.927158 249.451789 204.638316 215.578947 160.633263 215.578947 65.967158 215.578947 0 349.291789 0 469.315368c0 70.170947 16.141474 136.650105 49.232842 202.671158L6.197895 723.833263l41.472 34.41179 66.128842-79.737264-8.704-16.033684C83.105684 622.133895 53.894737 558.214737 53.894737 469.315368 53.894737 368.451368 106.765474 269.473684 160.633263 269.473684c13.231158 0 25.815579 9.889684 35.43579 20.533895C142.874947 321.967158 107.789474 388.500211 107.789474 469.315368c0 78.201263 19.698526 130.937263 93.642105 243.981474l-55.296 54.622316L280.899368 970.105263h64.754527l-130.048-195.072 195.260631-192.889263z" fill="#231F20" ></path></symbol><symbol id="icon-monkey_shen" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#BBC4C9" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-431.157895 134.736842h161.684211v53.894737h53.894737V269.473684h-215.578948V161.684211h-53.894736v107.789473h-215.578948v431.157895h53.894737v-53.894737h161.684211v215.578947h53.894736v-215.578947z m0-161.68421h161.684211v107.789473h-161.684211v-107.789473z m-215.578947 0h161.684211v107.789473h-161.684211v-107.789473z m215.578947-161.684211h161.684211v107.789474h-161.684211v-107.789474z m-215.578947 0h161.684211v107.789474h-161.684211v-107.789474z" fill="#231F20" ></path></symbol><symbol id="icon-ox_chou" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#D6B196" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-161.68421 188.631579h-159.555369c13.985684-172.813474 43.115789-357.429895 70.817684-385.158737L700.631579 269.473684H323.368421v53.894737h107.169684c-1.940211 45.756632-8.192 103.962947-15.76421 161.684211H323.368421v53.894736h83.968c-9.862737 68.446316-20.264421 130.128842-25.734737 161.684211H215.578947v53.894737h592.842106v-53.894737z m-346.543158-161.684211h149.800421a3313.717895 3313.717895 0 0 0-16.842105 161.684211h-158.477474c6.036211-35.247158 16.114526-95.636211 25.519158-161.684211z m22.608842-215.578947h171.735579c-15.198316 41.121684-27.405474 100.594526-36.890948 161.684211h-150.123789c7.383579-57.505684 13.419789-115.361684 15.279158-161.684211z" fill="#231F20" ></path></symbol><symbol id="icon-monkey" viewBox="0 0 1024 1024"><path d="M757.733053 485.052632H565.894737a80.842105 80.842105 0 0 0-80.842105 80.842105v215.578947c0 40.96 43.546947 99.678316 77.446736 139.210105C596.426105 960.215579 603.055158 970.105263 603.055158 970.105263H754.526316s15.144421-18.674526 45.891368-58.071579S862.315789 809.984 862.315789 717.608421c0-89.573053-47.993263-166.346105-104.582736-232.555789z" fill="#C3D686" ></path><path d="M538.947368 1024h-53.894736c0-32.794947 25.869474-87.417263 77.446736-103.316211C528.599579 881.152 485.052632 822.433684 485.052632 781.473684c0-44.570947 36.271158-80.842105 80.842105-80.842105h80.842105v53.894737h-80.842105a26.947368 26.947368 0 0 0-26.947369 26.947368c0 19.725474 36.675368 77.473684 92.133053 134.736842h88.602947c20.210526-14.147368 88.737684-71.464421 88.737685-198.602105 0-108.382316-93.237895-202.967579-168.151579-278.986105-49.502316-50.202947-88.576-89.842526-98.735158-128.61979-11.749053-44.732632-21.584842-112.586105-26.327579-148.318315H377.263158c-45.136842 0-89.519158 8.434526-121.802105 53.894736H431.157895v53.894737c-97.28 0-107.789474 113.071158-107.789474 161.684211v53.894737h53.894737v161.68421h-53.894737v-107.789474h-26.947368c-170.253474 0-188.631579-94.234947-188.631579-134.736842 0-31.043368 35.220211-72.326737 55.727158-93.722947 2.694737-14.686316 5.847579-28.348632 9.431579-41.013895H161.684211V215.578947h31.528421C239.642947 120.993684 317.224421 107.789474 377.263158 107.789474h185.640421l2.802526 23.794526c0.134737 1.050947 12.719158 106.657684 27.944421 164.756211 6.494316 24.872421 44.624842 63.514947 84.965053 104.448C760.481684 483.813053 862.315789 587.129263 862.315789 717.608421c0 92.375579-31.124211 155.028211-61.898105 194.425263C904.919579 892.146526 970.105263 803.004632 970.105263 673.684211c0-91.405474-42.819368-154.381474-84.237474-215.255579C847.791158 402.458947 808.421053 344.576 808.421053 269.473684c0-119.349895 87.093895-161.684211 161.68421-161.68421v53.894737c-32.417684 0-107.789474 10.509474-107.789474 107.789473 0 58.502737 31.555368 104.933053 68.096 158.639158C974.282105 492.597895 1024 565.679158 1024 673.684211c0 177.286737-108.301474 296.421053-269.473684 296.421052h-161.684211c-37.672421 0-53.894737 40.906105-53.894737 53.894737zM229.214316 269.473684a384.808421 384.808421 0 0 0-14.012632 58.341053l-1.401263 8.488421-6.090105 6.117053c-22.878316 22.932211-44.813474 52.601263-46.026105 62.275368 0 56.805053 53.76 75.264 107.789473 79.386947V431.157895c0-58.691368 13.473684-119.619368 46.511158-161.684211h-86.770526zM323.368421 1024h-53.894737c0-32.794947 25.869474-87.417263 77.446737-103.316211C313.020632 881.152 269.473684 822.433684 269.473684 781.473684c0-44.570947 36.271158-80.842105 80.842105-80.842105h45.16379A188.847158 188.847158 0 0 1 565.894737 592.842105h134.736842v53.894737h-134.736842c-74.293895 0-134.736842 60.442947-134.736842 134.736842v26.516211l-53.894737 0.377263V781.473684c0-9.162105 0.646737-18.135579 1.913263-26.947368H350.315789c-14.848 0-26.947368 12.072421-26.947368 26.947368 0 19.725474 36.675368 77.473684 92.133053 134.736842H431.157895v53.894737h-53.894737c-37.672421 0-53.894737 40.906105-53.894737 53.894737z" fill="#231F20" ></path></symbol><symbol id="icon-horse_wu" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#FF8787" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-431.157895 26.947368h269.473685v-53.894736H538.947368v-161.684211h161.684211v-53.894737H411.001263c12.045474-33.28 20.156632-69.793684 20.156632-107.789473h-53.894737c0 121.963789-105.364211 233.391158-106.415158 234.496l38.858105 37.349052c2.883368-3.018105 43.816421-46.133895 77.392842-110.160842H485.052632v161.684211H215.578947v53.894736h269.473685v323.368421h53.894736V538.947368z" fill="#231F20" ></path></symbol><symbol id="icon-ox" viewBox="0 0 1025 1024"><path d="M540.294737 754.526316h215.578947c20.210526 0 35.112421 1.374316 53.894737 4.581052 91.863579 15.656421 145.354105 67.691789 161.684211 86.069895V916.210526h53.894736V635.580632l-7.895579-7.895579c-9.269895-9.269895-36.513684-49.232842-44.032-196.527158H540.294737a161.684211 161.684211 0 0 0-161.684211 161.68421v131.098948c43.304421 20.210526 97.28 30.585263 161.684211 30.585263z" fill="#FFAF6E" ></path><path d="M1025.347368 635.580632V916.210526h-53.894736v-71.033263c-16.330105-18.405053-69.820632-70.413474-161.684211-86.069895V916.210526h-53.894737v-161.68421h-107.789473v215.578947h-53.894737V700.631579h161.68421c100.998737 0 172.570947 38.669474 215.578948 71.868632v-115.738948c-33.684211-43.627789-51.712-137.458526-53.706106-279.498105H701.978947c-76.934737 0-127.218526-26.219789-175.804631-51.550316a1556.048842 1556.048842 0 0 0-26.839579-13.743158c-26.839579 26.004211-66.209684 44.921263-115.738948 55.511579 24.441263 22.986105 60.874105 52.116211 106.469053 72.838737l-22.312421 49.044211c-76.584421-34.816-129.589895-88.926316-150.824421-113.125053-10.644211 0.619789-21.477053 1.024-32.687158 1.024a473.734737 473.734737 0 0 1-123.365053-15.952842l-93.022315 186.314105 68.581052 53.86779C167.882105 579.557053 237.891368 538.947368 324.715789 538.947368v53.894737c-95.986526 0-170.361263 62.490947-171.088842 63.137684l-16.78821 14.282106-136.838737-107.358316 109.729684-219.809684C46.430316 314.448842 1.347368 267.371789 1.347368 199.868632 1.347368 89.815579 121.586526 53.894737 163.031579 53.894737v53.894737c-14.120421 0-107.789474 17.165474-107.789474 92.079158C55.242105 290.465684 192.188632 323.368421 284.240842 323.368421c67.907368 0 122.421895-12.988632 157.696-35.624421-42.711579-14.336-95.097263-23.120842-169.337263-18.324211l-3.503158-53.786947c95.878737-6.117053 160.148211 8.515368 211.429053 28.833684C484.244211 235.439158 486.4 225.818947 486.4 215.578947c0-48.855579-57.829053-76.288-58.394947-76.557473l22.393263-49.017263C454.063158 91.648 540.294737 131.826526 540.294737 215.578947c0 18.566737-3.422316 35.84-9.997474 51.631158 7.060211 3.584 13.985684 7.168 20.776421 10.698106C597.854316 302.322526 638.248421 323.368421 701.978947 323.368421h269.473685v26.947368c0 214.689684 35.220211 266.590316 45.999157 277.369264l7.895579 7.895579z m-729.384421 25.141894l-98.789052 118.541474 86.797473 137.835789 45.594948-28.725894-65.913263-104.690527 37.052631-44.43621C358.642526 785.192421 439.080421 808.421053 540.294737 808.421053v-53.894737c-99.893895 0-175.077053-24.549053-223.474526-72.946527l-20.857264-20.857263z" fill="#231F20" ></path></symbol><symbol id="icon-rabbit_mao" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#7DD47F" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-377.263158-188.631579h107.789474v323.368421c-20.48 0-39.936-11.264-40.016842-11.317895l-27.728842 46.214737c3.206737 1.940211 32.660211 18.997895 67.745684 18.997895 30.746947 0 53.894737-23.147789 53.894737-53.894737V269.473684h-215.578948v538.947369h53.894737V323.368421z m-107.789473 242.526316v-242.526316h-53.894737v196.904421l-107.789474 40.421053v-243.927579l169.094737-48.316632-14.821053-51.819789L269.473684 276.102737v304.801684l-36.405895 13.662316 18.917053 50.472421 178.741895-67.018105c-5.039158 69.928421-55.269053 106.981053-165.133474 122.933894l7.733895 53.328842C325.712842 746.657684 485.052632 723.536842 485.052632 565.894737z" fill="#231F20" ></path></symbol><symbol id="icon-rabbit" viewBox="0 0 1024 1024"><path d="M680.96 488.744421a1666.667789 1666.667789 0 0 0-54.433684-23.95621c-16.006737 12.234105-33.899789 20.264421-60.631579 20.264421h-80.842105c-36.810105 0-83.644632 30.396632-104.394106 67.772631-42.819368 77.123368-53.409684 117.813895-11.021473 201.701053C397.096421 808.879158 431.157895 876.409263 431.157895 970.105263h338.539789l68.338527-138.859789c20.129684-40.96 24.252632-73.701053 24.252631-110.349474 0.026947-57.397895-25.061053-159.717053-181.328842-232.151579z" fill="#FFBDD8" ></path><path d="M862.315789 720.896c0 36.621474-4.122947 69.389474-24.252631 110.349474L769.697684 970.105263H485.052632v-53.894737h48.370526C507.877053 880.074105 485.052632 833.509053 485.052632 781.473684c0-59.418947 24.171789-113.313684 63.218526-152.360421l38.103579 38.103579A161.091368 161.091368 0 0 0 538.947368 781.473684c0 54.784 35.381895 104.043789 63.514948 134.736842h133.712842l53.490526-108.759579c15.710316-31.851789 18.755368-55.834947 18.755369-86.554947 0-80.976842-63.434105-150.096842-178.607158-195.503158-17.542737 8.138105-38.292211 13.554526-63.919158 13.554526h-80.842105c-13.958737 0-43.924211 15.979789-57.290106 40.016843l-47.104-26.165895C401.408 515.449263 448.242526 485.052632 485.052632 485.052632h80.842105c37.268211 0 57.478737-15.440842 79.090526-36.45979C625.367579 336.195368 549.753263 269.473684 485.052632 269.473684h-107.789474a21.288421 21.288421 0 0 0-5.955369 2.021053A683.762526 683.762526 0 0 0 302.187789 194.021053c-35.84-34.223158-61.763368-58.933895-94.908631-79.440842A42.442105 42.442105 0 0 0 185.478737 107.789474a22.824421 22.824421 0 0 0-17.381053 7.194947c-10.913684 11.425684-6.063158 28.240842 1.428211 39.181474 21.989053 32.121263 47.912421 56.858947 83.752421 91.109052 20.614737 19.671579 49.259789 43.169684 77.392842 63.08379C281.007158 367.400421 215.578947 484.432842 215.578947 592.842105c0 74.482526 24.791579 124.065684 51.065264 176.586106C294.534737 825.209263 323.368421 882.903579 323.368421 970.105263h-53.894737c0-74.482526-24.791579-124.065684-51.065263-176.586105C190.517895 737.738105 161.684211 680.043789 161.684211 592.842105c0-90.866526 42.226526-197.685895 93.453473-274.485894a803.759158 803.759158 0 0 1-39.046737-34.115369C177.852632 247.754105 150.231579 221.399579 125.035789 184.616421c-24.441263-35.759158-22.797474-78.686316 4.069053-106.819368 26.300632-27.567158 70.898526-31.043368 106.522947-9.000421 37.941895 23.444211 65.562947 49.798737 103.774316 86.258526 9.970526 9.512421 33.037474 32.309895 56.93979 60.550737h68.634947c-27.621053-37.780211-60.416-72.730947-88.522105-99.543579-28.833684-27.540211-54.730105-52.116211-84.533895-74.024421L326.305684 0.296421c31.232 23.228632 57.802105 48.532211 87.309474 76.719158 53.840842 51.388632 94.450526 100.594526 121.74821 146.83621 82.836211 26.650947 150.042947 116.870737 165.025685 230.750316l1.724631 13.177263-9.404631 9.404632c-3.772632 3.772632-7.706947 7.653053-11.802948 11.587368C837.227789 561.178947 862.315789 663.498105 862.315789 720.896zM309.463579 754.526316c3.934316 8.057263 7.895579 16.087579 11.991579 24.144842C348.887579 832.970105 377.263158 889.128421 377.263158 970.105263h53.894737c0-93.696-34.061474-161.226105-61.520842-215.578947h-60.173474z m597.90821 53.894737c-3.422316 9.404632-7.814737 19.806316-13.770105 31.959579L829.790316 970.105263h60.065684l52.143158-105.957052c10.778947-21.935158 17.515789-40.016842 21.90821-55.727158h-56.535579zM514.694737 390.736842c0-34.223158-13.231158-44.463158-29.642105-44.463158s-29.642105 10.24-29.642106 44.463158c0 34.250105 13.231158 44.463158 29.642106 44.463158s29.642105-10.213053 29.642105-44.463158z" fill="#231F20" ></path></symbol><symbol id="icon-rat_zi" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#85C3DE" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-431.157895 188.631579v-215.578947h269.473685v-53.894737H538.947368v-39.585684c26.543158-18.081684 94.585263-65.050947 177.852632-127.488L700.631579 215.578947H323.368421v53.894737h295.316211a4221.008842 4221.008842 0 0 1-121.640421 85.369263l-11.991579 8.003369V431.157895H242.526316v53.894737h242.526316v215.578947c0 48.343579-13.850947 53.894737-134.736843 53.894737v53.894737c105.391158 0 188.631579 0 188.631579-107.789474z" fill="#231F20" ></path></symbol><symbol id="icon-rooster_you" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#BBC4C9" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-215.578947-188.631579h-161.684211v-26.947368h161.684211V242.526316H269.473684v53.894737h161.684211v26.947368h-161.684211v485.052632h53.894737v-53.894737h377.263158v53.894737h53.894737V323.368421zM323.368421 646.736842h377.263158v53.894737H323.368421v-53.894737z m0-269.473684h107.789474c0 103.316211-72.784842 107.654737-81.084632 107.789474L350.315789 538.947368c46.592 0 134.736842-33.792 134.736843-161.68421h53.894736v107.789474c0 29.722947 24.171789 53.894737 53.894737 53.894736h107.789474v53.894737H323.368421v-215.578947z m377.263158 0v107.789474h-107.789474v-107.789474h107.789474z m-215.578947-80.842105h53.894736v26.947368h-53.894736v-26.947368z" fill="#231F20" ></path></symbol><symbol id="icon-rooster" viewBox="0 0 1024 1024"><path d="M891.688421 506.421895C877.244632 455.033263 862.315789 401.893053 862.315789 323.368421V116.224l-323.368421 195.745684V323.368421c0 78.524632 14.928842 131.664842 29.372632 183.053474 12.611368 44.894316 24.522105 87.282526 24.522105 140.314947 0 101.618526-77.931789 176.693895-168.286316 203.991579l5.416422 11.587368h215.578947c24.333474 0 43.385263-0.242526 58.556631-2.128842C811.52 846.821053 916.210526 764.550737 916.210526 646.736842c0-53.032421-11.910737-95.420632-24.522105-140.314947z" fill="#FF8787" ></path><path d="M673.684211 354.357895c-16.384 0-29.642105-10.213053-29.642106-44.463158 0-34.223158 13.231158-44.463158 29.642106-44.463158s29.642105 10.24 29.642105 44.463158c0 34.250105-13.258105 44.463158-29.642105 44.463158zM540.106105 970.105263l-50.58021-107.789474h156.05221l50.607158 107.789474h59.553684l-51.60421-109.918316C811.52 846.821053 916.210526 764.550737 916.210526 646.736842c0-53.032421-11.910737-95.420632-24.522105-140.314947C877.244632 455.033263 862.315789 401.893053 862.315789 323.368421V107.789474c0-59.445895-48.343579-107.789474-107.789473-107.789474a107.924211 107.924211 0 0 0-107.789474 106.172632 100.890947 100.890947 0 0 0-24.117895-3.314527 88.710737 88.710737 0 0 0-88.602947 88.602948c0 20.668632 5.227789 39.720421 10.671158 53.921684l-99.489684 59.688421 93.749894 14.470737V377.263158c0 14.416842-5.901474 21.692632-33.360842 49.152l-11.129263 11.129263C398.228211 326.521263 324.985263 269.473684 215.740632 269.473684 96.768 269.473684 0 366.241684 0 485.214316V646.736842h53.894737v-161.522526A162.007579 162.007579 0 0 1 215.740632 323.368421c82.081684 0 140.422737 36.244211 240.64 152.252632l-38.615579 38.615579C367.804632 461.285053 323.098947 431.157895 259.584 431.157895A151.983158 151.983158 0 0 0 107.789474 582.952421V754.526316h53.894737v-171.573895A98.007579 98.007579 0 0 1 259.584 485.052632c46.322526 0 79.629474 20.911158 137.027368 86.016l18.970948 21.530947 128.080842-128.080842C572.200421 435.981474 592.842105 415.366737 592.842105 377.263158v-97.926737l23.309474-14.120421-13.662316-23.04c-0.161684-0.242526-14.578526-24.899368-14.578526-50.688 0-19.132632 15.575579-34.708211 34.70821-34.708211 5.093053 0 26.785684 3.179789 39.558737 18.647579l26.327579 46.026106 39.774316-24.090948-20.372211-49.367579C704.754526 140.449684 700.631579 117.517474 700.631579 107.789474c0-29.722947 24.171789-53.894737 53.894737-53.894737s53.894737 24.171789 53.894737 53.894737v215.578947c0 85.935158 16.680421 145.300211 31.366736 197.632C851.887158 564.008421 862.315789 601.141895 862.315789 646.736842c0 95.285895-99.408842 161.684211-188.631578 161.684211h-209.461895l-68.419369-145.704421C375.242105 618.954105 338.108632 592.842105 296.448 592.842105A80.976842 80.976842 0 0 0 215.578947 673.711158V862.315789h53.894737v-188.604631c0-14.874947 12.099368-26.974316 26.974316-26.974316 20.533895 0 38.965895 14.147368 50.553263 38.858105L480.579368 970.105263h59.526737z" fill="#231F20" ></path></symbol><symbol id="icon-snake_si" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#FF8787" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-242.041263 180.762947l-52.116211-13.797052C657.219368 749.864421 651.425684 754.526316 619.789474 754.526316h-242.526316V485.052632h269.473684v53.894736h53.894737V215.578947H323.368421v538.947369c0 29.722947 24.171789 53.894737 53.894737 53.894737h242.526316c77.689263 0 91.189895-51.065263 108.274526-115.658106zM377.263158 269.473684h269.473684v161.684211H377.263158v-161.684211z" fill="#231F20" ></path></symbol><symbol id="icon-tiger_yin" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#7DD47F" ></path><path d="M970.105263 512c0 224.983579-163.166316 412.186947-377.263158 450.533053v-54.460632C777.135158 870.507789 916.210526 707.206737 916.210526 512c0-222.881684-181.328842-404.210526-404.210526-404.210526S107.789474 289.118316 107.789474 512s181.328842 404.210526 404.210526 404.210526c9.081263 0 18.000842-0.754526 26.947368-1.374315v53.894736c-8.973474 0.538947-17.866105 1.374316-26.947368 1.374316-252.604632 0-458.105263-205.500632-458.105263-458.105263S259.395368 53.894737 512 53.894737s458.105263 205.500632 458.105263 458.105263z m-257.42821 299.250526l-107.789474-53.894737-24.117895 48.208843 107.789474 53.894736 24.117895-48.208842z m-269.473685-5.658947l-24.117894-48.208842-107.789474 53.894737 24.117895 48.208842 107.789473-53.894737zM700.631579 431.157895h-161.684211v-53.894737h107.789474v-53.894737H377.263158v53.894737h107.789474v53.894737h-161.684211v323.368421h53.894737v-53.894737h269.473684v53.894737h53.894737V431.157895z m-161.684211 161.68421h107.789474v53.894737h-107.789474v-53.894737z m-161.68421 0h107.789474v53.894737h-107.789474v-53.894737z m161.68421-107.789473h107.789474v53.894736h-107.789474v-53.894736z m-161.68421 0h107.789474v53.894736h-107.789474v-53.894736zM754.526316 215.578947h-223.097263l-20.803369-62.410105-51.119158 17.057684L474.624 215.578947H269.473684v107.789474h53.894737v-53.894737h377.263158v53.894737h53.894737V215.578947z" fill="#231F20" ></path></symbol><symbol id="icon-snake" viewBox="0 0 1024 1024"><path d="M107.789474 790.474105c0-72.434526 67.880421-91.513263 121.451789-91.513263 74.401684 0 153.815579 34.438737 237.891369 70.925474 50.580211 21.935158 104.609684 45.325474 162.250105 63.083789-52.412632 44.786526-118.784 74.347789-195.152842 83.078737-143.171368 16.357053-326.440421 7.006316-326.440421-125.574737zM377.263158 215.578947c-15.575579 0-30.288842 3.449263-43.654737 9.377685A250.691368 250.691368 0 0 0 323.368421 296.421053c0 115.550316 76.422737 169.391158 137.83579 212.614736 8.138105 5.712842 16.141474 11.371789 23.848421 17.057685V323.368421a107.789474 107.789474 0 0 0-107.789474-107.789474z" fill="#C3D686" ></path><path d="M671.528421 788.857263c44.328421 11.964632 89.626947 19.563789 136.892632 19.56379 89.168842 0 161.684211-60.442947 161.68421-134.736842s-72.515368-134.736842-161.68421-134.736843c-19.078737 0-37.025684 1.509053-54.218106 4.015158-0.754526-101.402947-38.211368-172.355368-79.413894-219.648L673.684211 323.368421a1749.962105 1749.962105 0 0 1-79.036632-1.751579c45.702737 35.866947 108.705684 107.870316 105.984 232.367158 0 0.431158-0.080842 0.808421-0.10779 1.239579-34.923789 10.994526-66.155789 26.731789-95.097263 45.190737a163.085474 163.085474 0 0 0-15.845052-42.388211c-21.557895-39.639579-60.065684-66.775579-97.360842-93.022316C433.098105 423.343158 377.263158 384 377.263158 296.421053c0-130.290526 108.274526-188.631579 215.578947-188.631579 64.134737 0 132.715789 12.045474 214.366316 37.807158C802.330947 180.250947 780.099368 209.381053 700.631579 214.635789V161.684211h-53.894737v53.679157c-63.272421-1.024-104.528842-5.200842-104.986947-5.254736l-5.578106 53.598315C538.408421 263.949474 592.357053 269.473684 673.684211 269.473684c125.170526 0 188.631579-48.128 188.631578-143.063579V106.981053l-18.432-6.144C747.789474 68.823579 668.025263 53.894737 592.842105 53.894737c-158.666105 0-269.473684 99.732211-269.473684 242.526316 0 115.550316 76.422737 169.391158 137.83579 212.614736 33.684211 23.713684 65.509053 46.106947 81.003789 74.698106 9.539368 17.542737 13.285053 33.414737 12.341895 47.750737 21.153684 9.108211 42.118737 17.839158 62.949052 25.977263C671.151158 620.193684 729.977263 592.842105 808.421053 592.842105c59.445895 0 107.789474 36.271158 107.789473 80.842106s-48.343579 80.842105-107.789473 80.842105c-105.472 0-203.237053-42.388211-297.768421-83.429053-94.800842-41.094737-184.346947-79.952842-281.411369-79.952842C122.718316 591.171368 53.894737 644.715789 53.894737 727.578947c0 79.063579 67.098947 136.434526 159.555368 136.434527 142.174316 0 230.426947-66.883368 306.79579-129.886316 31.420632 13.419789 62.787368 26.058105 94.450526 37.133474-47.077053 49.637053-110.969263 82.566737-186.610526 91.270736l5.066105 53.625264c93.453474-7.006316 143.144421 9.350737 195.718737 26.543157 46.457263 15.225263 94.127158 30.854737 169.822316 30.854737 19.994947 0 41.957053-1.077895 66.344421-3.557052l-5.416421-53.625263c-105.283368 10.778947-158.100211-6.548211-213.935158-24.872422-22.150737-7.275789-44.624842-14.632421-70.305684-20.345263a334.848 334.848 0 0 0 96.14821-82.297263z m-458.078316 21.261474C162.573474 810.118737 107.789474 784.276211 107.789474 727.578947c0-60.847158 62.733474-82.539789 121.451789-82.539789 77.850947 0 154.731789 30.288842 235.250526 64.943158-66.263579 52.924632-139.722105 100.136421-251.041684 100.136421z" fill="#231F20" ></path></symbol><symbol id="icon-tiger" viewBox="0 0 1024 1024"><path d="M431.157895 162.250105V134.736842c0-41.552842-39.289263-80.842105-80.842106-80.842105-28.833684 0-57.128421 4.661895-58.314105 4.850526L269.473684 62.490947v83.887158C144.788211 223.824842 89.222737 346.839579 66.991158 431.157895h266.051368c240.747789 0 415.851789 107.789474 415.85179 269.473684-14.848-25.114947-43.924211-53.894737-88.68379-53.894737-67.988211 0-121.263158 71.033263-121.263158 161.684211 0 66.802526 30.477474 119.888842 60.712421 156.16 12.638316 15.171368 36.055579 37.726316 59.014737 58.88 5.066105 0.107789 9.781895 0.538947 15.009685 0.538947 219.297684 0 350.315789-191.811368 350.315789-377.263158C1024 327.545263 679.855158 172.813474 431.157895 162.250105z" fill="#F7C768" ></path><path d="M673.684211 1024c-114.768842 0-188.820211-33.333895-254.167579-62.787368-53.625263-24.144842-99.974737-45.002105-161.28-45.002106-40.448 0-83.590737 23.255579-103.639579 45.16379l-39.747369-36.432842C142.497684 894.787368 199.168 862.315789 258.236632 862.315789c68.392421 0 119.861895 21.288421 172.921263 45.056V673.684211c0-35.166316-17.542737-64.107789-30.639158-80.815158-15.198316 9.835789-32.067368 18.890105-50.741895 26.947368l-21.342316-49.475368C469.800421 509.413053 485.052632 377.317053 485.052632 323.368421V221.642105A597.827368 597.827368 0 0 0 404.210526 215.578947h-26.947368V134.736842c0-12.099368-14.848-26.947368-26.947369-26.947368-9.377684 0-18.836211 0.592842-26.947368 1.347368V269.473684h-53.894737V211.671579c-136.030316 102.912-158.450526 266.886737-161.306947 295.882105 9.135158 9.108211 38.992842 25.061053 71.976421 38.669474l38.103579-59.365053 12.449684-1.589894C321.212632 473.653895 377.263158 392.192 377.263158 323.368421h53.894737c0 88.333474-68.796632 192.242526-180.870737 213.342316l-48.397474 75.398737-20.291368-7.437474C53.894737 557.756632 53.894737 523.317895 53.894737 512c0-50.041263 37.025684-254.733474 215.578947-365.621895V62.490947l22.528-3.745684C293.187368 58.556632 321.482105 53.894737 350.315789 53.894737c41.552842 0 80.842105 39.289263 80.842106 80.842105v27.513263c248.697263 10.563368 592.842105 165.295158 592.842105 484.486737 0 185.451789-131.018105 377.263158-350.315789 377.263158z m-13.473685-323.368421c-36.513684 0-67.368421 49.367579-67.368421 107.789474 0 85.746526 68.096 145.084632 89.465263 161.549473 91.540211-2.533053 164.378947-45.487158 213.827369-107.654737H700.631579v-53.894736h230.238316c8.919579-17.273263 16.357053-35.354947 22.285473-53.894737h-239.885473l-6.467369-17.650527C706.290526 735.582316 692.439579 700.631579 660.210526 700.631579zM485.052632 931.112421c33.926737 14.066526 70.521263 26.597053 114.607157 33.468632C569.424842 928.309895 538.947368 875.223579 538.947368 808.421053c0-90.650947 53.274947-161.684211 121.263158-161.684211 44.759579 0 73.835789 28.779789 88.68379 53.894737h217.007158c2.775579-17.866105 4.203789-35.920842 4.203789-53.894737 0-38.938947-5.658947-74.752-15.925895-107.627789l-126.706526 126.679579-38.103579-38.103579L932.001684 485.052632a367.939368 367.939368 0 0 0-57.775158-81.596632l-154.543158 154.543158-38.103579-38.103579 153.573053-153.573053a537.869474 537.869474 0 0 0-82.593684-56.751158l-140.665263 140.638316-38.103579-38.103579 128.134737-128.134737A794.731789 794.731789 0 0 0 538.947368 231.046737V323.368421c0 50.149053-11.102316 156.698947-95.932631 236.328421 18.378105 23.417263 42.037895 63.407158 42.037895 113.987369v257.42821zM215.578947 431.157895v-53.894737c39.774316 0 53.894737-29.022316 53.894737-53.894737h53.894737c0 53.571368-37.025684 107.789474-107.789474 107.789474z" fill="#231F20" ></path></symbol><symbol id="icon-boar" viewBox="0 0 1024 1024"><path d="M732.079158 377.263158c-107.789474 0-186.421895 31.393684-281.869474 126.841263L180.331789 773.982316C257.724632 807.909053 348.725895 808.421053 485.052632 808.421053h96.013473c55.834947-34.411789 133.551158-53.894737 227.354948-53.894737h121.344L970.105263 680.555789V572.631579c0-94.315789-130.236632-195.368421-238.026105-195.368421z" fill="#FFBDD8" ></path><path d="M808.421053 700.631579v53.894737c-196.446316 0-323.368421 84.641684-323.368421 215.578947h-53.894737c0-163.705263 148.075789-269.473684 377.263158-269.473684z m-323.368421 107.789474v-53.894737c-158.342737 0-245.598316 0-319.649685-49.367579L158.612211 700.631579H80.842105c-21.692632 0-26.624-14.821053-26.947368-26.947368v-82.620632c84.156632-11.183158 161.684211-74.913684 161.68421-186.853053V215.578947H161.684211v161.684211H134.736842c-66.964211 0-134.736842 37.025684-134.736842 107.789474h53.894737c0-42.630737 52.870737-53.894737 80.842105-53.894737h24.629895C147.132632 504.912842 85.153684 538.947368 26.947368 538.947368H0v134.736843c0 32.498526 21.530947 80.842105 80.842105 80.842105h61.682527c32.687158 20.506947 67.125895 33.145263 105.957052 41.013895A232.879158 232.879158 0 0 0 215.578947 916.210526h53.894737c0-41.930105 14.012632-80.303158 39.424-112.505263C358.885053 808.151579 415.959579 808.421053 485.052632 808.421053z m-72.946527-342.420211L323.368421 554.738526V431.157895h-53.894737v253.682526l180.736-180.736-38.103579-38.103579zM323.368421 161.684211h-53.894737v190.032842a769.536 769.536 0 0 1 53.894737-49.098106V161.684211z m323.368421-53.894737c-72.623158 0-146.809263 23.336421-215.578947 58.637473V107.789474h-53.894737v154.138947C458.832842 205.392842 555.331368 161.684211 646.736842 161.684211c148.587789 0 269.473684 120.885895 269.473684 269.473684v235.654737L809.579789 862.315789h61.359158L970.105263 680.555789V431.157895c0-178.310737-145.057684-323.368421-323.368421-323.368421z" fill="#231F20" ></path></symbol><symbol id="icon-boar_hai" viewBox="0 0 1024 1024"><path d="M512 512m-296.421053 0a296.421053 296.421053 0 1 0 592.842106 0 296.421053 296.421053 0 1 0-592.842106 0Z" fill="#85C3DE" ></path><path d="M309.975579 804.756211l-27.136-46.592c103.073684-60.011789 183.026526-132.473263 241.475368-219.24379H350.315789l-13.473684-50.283789c58.88-33.980632 99.435789-117.571368 118.703158-165.295158H242.526316v-53.894737h538.947368v53.894737h-268.18021c-12.395789 34.088421-42.469053 106.603789-90.435369 161.68421h134.009263a680.555789 680.555789 0 0 0 46.349474-107.708631l51.092211 17.057684c-58.421895 175.265684-171.034947 309.490526-344.333474 410.381474z m192.350316-2.937264L467.806316 760.454737c88.414316-73.728 154.516211-158.773895 202.105263-259.907369l48.801684 22.959158a797.372632 797.372632 0 0 1-82.351158 137.781895c32.741053 15.009684 83.456 44.867368 137.647158 101.591579l-38.938947 37.268211c-57.236211-59.877053-109.325474-85.557895-133.766737-95.178106a850.997895 850.997895 0 0 1-98.977684 96.848842z m48.613052-536.872421l-80.842105-53.894737 29.884632-44.840421 80.842105 53.894737-29.884632 44.840421zM512 53.894737C259.395368 53.894737 53.894737 259.395368 53.894737 512s205.500632 458.105263 458.105263 458.105263c9.081263 0 17.973895-0.835368 26.947368-1.374316v-53.894736c-8.946526 0.619789-17.866105 1.374316-26.947368 1.374315-222.881684 0-404.210526-181.328842-404.210526-404.210526S289.118316 107.789474 512 107.789474s404.210526 181.328842 404.210526 404.210526c0 195.206737-139.075368 358.507789-323.368421 396.045474v54.460631c214.096842-38.346105 377.263158-225.549474 377.263158-450.533052C970.105263 259.395368 764.604632 53.894737 512 53.894737z" fill="#231F20" ></path></symbol><symbol id="icon-rat" viewBox="0 0 1024 1024"><path d="M727.659789 431.157895c-132.581053 0-220.348632 47.454316-285.803789 154.354526-19.779368 32.309895-15.845053 76.503579-9.404632 96.579368 3.260632 10.159158 7.760842 18.647579 12.422737 25.546106C464.761263 737.010526 499.927579 754.526316 538.947368 754.526316h66.829474c1.158737 17.893053-1.967158 34.762105-15.144421 53.975579-12.692211 18.539789-37.807158 40.151579-56.32 54.810947 25.249684-0.673684 52.709053-0.997053 83.240421-0.997053C877.487158 862.315789 970.105263 711.922526 970.105263 571.176421 936.421053 512 882.364632 431.157895 727.659789 431.157895z" fill="#85C3DE" ></path><path d="M210.432 1012.897684l-43.573895-31.690105c106.954105-147.051789 185.317053-171.196632 423.828211-172.705684 21.396211-31.258947 16.249263-56.266105 9.377684-89.70779-3.557053-17.138526-7.221895-34.842947-7.221895-54.433684 0-68.958316 25.330526-104.636632 63.407158-136.973474l34.896842 41.040842c-29.453474 25.061053-44.409263 46.780632-44.409263 95.932632 0 14.093474 2.937263 28.402526 6.063158 43.546947 5.901474 28.510316 12.8 62.032842-1.131789 99.462737 166.373053-10.24 264.542316-96.902737 264.542315-236.193684C916.210526 418.330947 827.580632 323.368421 684.921263 323.368421c-83.644632 0-153.303579 29.696-174.187789 39.612632a224.875789 224.875789 0 0 1-20.533895 31.339789l-41.741474-34.115368 20.884211 17.057684-20.911158-16.976842C448.781474 359.828211 485.052632 314.287158 485.052632 262.736842c0-34.816-8.946526-60.766316-26.570106-77.069474-17.515789-16.249263-44.786526-24.602947-81.219368-24.953263V323.368421h-53.894737V109.783579l24.872421-1.913263c64.700632-4.931368 114.095158 7.895579 146.863158 38.238316C524.207158 173.056 538.947368 212.291368 538.947368 262.736842c0 11.102316-1.131789 21.908211-3.072 32.202105 37.268211-12.584421 89.842526-25.465263 149.045895-25.465263C858.165895 269.473684 970.105263 387.907368 970.105263 571.176421 970.105263 711.922526 877.487158 862.315789 617.552842 862.315789c-258.667789 0-311.942737 19.698526-407.120842 150.581895z m19.105684-256.835368c-12.045474 0-24.387368-0.565895-37.025684-1.64379l-22.096842-1.859368-2.425263-22.016C167.747368 728.144842 161.684211 672.444632 161.684211 631.026526c0-103.585684 21.450105-178.903579 53.894736-259.045052V107.789474h53.894737v274.782315l-2.021052 4.904422C235.439158 465.758316 215.578947 533.800421 215.578947 631.026526c0 22.878316 2.101895 51.442526 3.826527 70.979369 99.678316 2.802526 172.813474-35.408842 222.450526-116.493474l48.020211 24.090947c-11.237053 28.133053-11.371789 51.577263-0.377264 67.853474 9.701053 14.282105 28.645053 23.174737 49.448421 23.174737v53.894737c-39.019789 0-74.186105-17.515789-94.073263-46.888421a100.244211 100.244211 0 0 1-12.422737-25.546106c-53.221053 49.178947-121.128421 73.943579-202.913684 73.970527zM379.957895 525.473684c0-34.223158-13.231158-44.463158-29.642106-44.463158s-29.642105 10.24-29.642105 44.463158c0 34.250105 13.231158 44.463158 29.642105 44.463158s29.642105-10.213053 29.642106-44.463158z" fill="#231F20" ></path></symbol><symbol id="icon-bilibili" viewBox="0 0 1129 1024"><path d="M234.909 9.656a80.468 80.468 0 0 1 68.398 0 167.374 167.374 0 0 1 41.843 30.578l160.937 140.82h115.07l160.936-140.82a168.983 168.983 0 0 1 41.843-30.578A80.468 80.468 0 0 1 930.96 76.445a80.468 80.468 0 0 1-17.703 53.914 449.818 449.818 0 0 1-35.406 32.187 232.553 232.553 0 0 1-22.531 18.508h100.585a170.593 170.593 0 0 1 118.289 53.109 171.397 171.397 0 0 1 53.914 118.288v462.693a325.897 325.897 0 0 1-4.024 70.007 178.64 178.64 0 0 1-80.468 112.656 173.007 173.007 0 0 1-92.539 25.75h-738.7a341.186 341.186 0 0 1-72.421-4.024A177.835 177.835 0 0 1 28.91 939.065a172.202 172.202 0 0 1-27.36-92.539V388.662a360.498 360.498 0 0 1 0-66.789A177.03 177.03 0 0 1 162.487 178.64h105.414c-16.899-12.07-31.383-26.555-46.672-39.43a80.468 80.468 0 0 1-25.75-65.984 80.468 80.468 0 0 1 39.43-63.57M216.4 321.873a80.468 80.468 0 0 0-63.57 57.937 108.632 108.632 0 0 0 0 30.578v380.615a80.468 80.468 0 0 0 55.523 80.469 106.218 106.218 0 0 0 34.601 5.632h654.208a80.468 80.468 0 0 0 76.444-47.476 112.656 112.656 0 0 0 8.047-53.109v-354.06a135.187 135.187 0 0 0 0-38.625 80.468 80.468 0 0 0-52.304-54.719 129.554 129.554 0 0 0-49.89-7.242H254.22a268.764 268.764 0 0 0-37.82 0z m0 0" fill="#20B0E3" ></path><path d="M348.369 447.404a80.468 80.468 0 0 1 55.523 18.507 80.468 80.468 0 0 1 28.164 59.547v80.468a80.468 80.468 0 0 1-16.094 51.5 80.468 80.468 0 0 1-131.968-9.656 104.609 104.609 0 0 1-10.46-54.719v-80.468a80.468 80.468 0 0 1 70.007-67.593z m416.02 0a80.468 80.468 0 0 1 86.102 75.64v80.468a94.148 94.148 0 0 1-12.07 53.11 80.468 80.468 0 0 1-132.773 0 95.757 95.757 0 0 1-12.875-57.133V519.02a80.468 80.468 0 0 1 70.007-70.812z m0 0" fill="#20B0E3" ></path></symbol><symbol id="icon-xingxi" viewBox="0 0 1024 1024"><path d="M536.89344 516.87424C297.6768 473.99936 33.47456 483.98336 15.02208 586.95168c-18.45248 102.94784 225.8432 204.06784 465.05472 246.9376 239.21152 42.86976 503.41376 32.89088 521.86624-70.06208 18.45248-102.9632-225.83808-204.0832-465.0496-246.95296z m444.71808 243.31264c-11.84256 66.08896-227.4304 103.73632-498.22208 55.20384-270.7968-48.53248-459.88864-158.70976-448.04096-224.79872 11.84256-66.08896 227.43552-103.7568 498.2272-55.22432 270.79168 48.53248 459.88352 158.73024 448.03584 224.8192z" fill="#6B0306" ></path><path d="M314.71104 345.87648c12.42112-19.82976 26.97216-38.7072 44.05248-56.08448 126.81728-128.9984 334.19776-130.7648 463.19616-3.94752 71.69536 70.48192 103.94624 165.84704 96.80384 258.816l19.54816 6.43072c9.10848-100.15232-25.088-203.43296-102.4-279.43936-136.83712-134.52288-356.8128-132.64896-491.33568 4.18816a348.19584 348.19584 0 0 0-49.40288 63.60064l19.53792 6.43584z" fill="#6B0204" ></path><path d="M295.53152 360.49408m-76.56448 0a76.56448 76.56448 0 1 0 153.12896 0 76.56448 76.56448 0 1 0-153.12896 0Z" fill="#FFEC43" ></path><path d="M295.53152 444.29824c-46.21312 0-83.80416-37.59616-83.80416-83.80928S249.3184 276.6848 295.53152 276.6848s83.80416 37.59616 83.80416 83.80928-37.59104 83.80416-83.80416 83.80416z m0-153.13408c-38.22592 0-69.33504 31.104-69.33504 69.3248s31.10912 69.3248 69.33504 69.3248 69.33504-31.104 69.33504-69.3248-31.10912-69.3248-69.33504-69.3248z" fill="#6B0204" ></path><path d="M317.952 294.63552c22.45632 11.40736 31.95904 38.08256 28.96896 64.65024-6.528 57.98912-75.73504 64.24576-82.67264 61.93664a69.64224 69.64224 0 0 0 31.62112 7.55712c38.35904 0 69.45792-30.82752 69.45792-68.85888-0.00512-30.37184-19.84512-56.13568-47.37536-65.28512z" fill="#FFC700" ></path><path d="M922.96704 527.70304m-37.90848 0a37.90848 37.90848 0 1 0 75.81696 0 37.90848 37.90848 0 1 0-75.81696 0Z" fill="#FFC700" ></path><path d="M922.96704 572.85632c-24.89856 0-45.14304-20.25472-45.14304-45.15328 0-24.89344 20.24448-45.14816 45.14304-45.14816 24.89856 0 45.14304 20.25472 45.14304 45.14816 0 24.89856-20.24448 45.15328-45.14304 45.15328z m0-75.82208a30.70464 30.70464 0 0 0-30.67392 30.66368 30.70976 30.70976 0 0 0 30.67392 30.67392 30.70976 30.70976 0 0 0 30.67392-30.67392 30.70464 30.70464 0 0 0-30.67392-30.66368z" fill="#6C0000" ></path><path d="M566.5024 838.17984m-49.75616 0a49.75616 49.75616 0 1 0 99.51232 0 49.75616 49.75616 0 1 0-99.51232 0Z" fill="#6C0000" ></path><path d="M769.64864 507.07456c-4.12672-11.73504-14.53056-20.1728-27.13088-22.02112l-82.85184-12.12928-35.97824-73.56928c-5.60128-11.46368-17.65376-18.85696-30.73024-18.85696-13.03552 0-25.10848 7.39328-30.73024 18.85696l-35.97824 73.56928-82.83136 12.14976c-12.6208 1.80736-23.04 10.24512-27.17184 22.02112-4.1472 11.91424-1.08032 24.88832 8.02304 33.83808l60.83072 59.86816-14.09536 82.92864c-2.1248 12.42624 3.42016 25.20576 14.13632 32.5376 10.26048 6.94272 24.6528 7.72608 35.74272 1.88928l72.09472-38.24128 72.13568 38.27712a35.00032 35.00032 0 0 0 16.26112 4.02944 34.74432 34.74432 0 0 0 19.50208-5.95968c10.65472-7.31136 16.19968-20.07552 14.07488-32.49664l-14.09536-82.92864 60.83072-59.86816c9.08288-8.96512 12.12928-21.9392 7.9616-33.8944z" fill="#FFC700" ></path><path d="M681.37472 729.46176a42.19904 42.19904 0 0 1-19.64032-4.86912l-68.75648-36.48512-68.7104 36.43904c-13.13792 6.92224-31.01184 5.94432-43.1872-2.28352-13.06624-8.94976-19.81952-24.54528-17.2288-39.7568l13.48096-79.19616-58.15296-57.22112c-11.1104-10.9312-14.85824-26.78272-9.7792-41.37472 5.03296-14.34624 17.67424-24.61184 32.98304-26.8032l79.03232-11.60192 34.29888-70.13888c6.8352-13.92128 21.44768-22.912 37.23264-22.912 15.82592 0 30.4384 8.99584 37.23264 22.91712l34.29888 70.13376 79.0784 11.57632c15.2832 2.24256 27.88864 12.50816 32.91136 26.78784 5.10464 14.62272 1.37728 30.49984-9.70752 41.4464L708.608 603.3408l13.47072 79.2064c2.60608 15.17568-4.11136 30.76096-17.11104 39.68a42.05568 42.05568 0 0 1-23.59296 7.23456z m-88.3968-57.74336l75.53024 40.07936c8.7808 4.64896 20.00896 4.06528 28.32896-1.54112 8.2944-5.69856 12.63104-15.62624 10.97216-25.26208l-14.71488-86.66624 63.5136-62.5152c7.07072-6.96832 9.45152-17.07008 6.21056-26.34752-3.23072-9.17504-11.40736-15.78496-21.34016-17.24416l-86.64064-12.68224-37.64736-76.99968c-4.39296-8.99072-13.90592-14.79168-24.22784-14.79168-10.31168 0-19.81952 5.8112-24.22784 14.80192l-37.64736 76.99456-86.62016 12.70784c-9.96864 1.42336-18.15552 8.0384-21.38624 17.24928-3.21536 9.23648-0.81408 19.31264 6.26688 26.27584l63.52384 62.52032-14.73024 86.65088c-1.64864 9.65632 2.69824 19.6096 11.08992 25.35424 7.78752 5.27872 19.77344 5.92896 28.27776 1.45408l75.4688-40.0384z" fill="#6C0000" ></path></symbol><symbol id="icon-chinese_lion" viewBox="0 0 1024 1024"><path d="M729.788632 751.050105c-0.565895 11.587368-1.482105 24.441263-2.883369 38.211369C720.518737 850.566737 632.697263 916.210526 512 916.210526c-120.670316 0-208.518737-65.643789-214.878316-126.949052a731.109053 731.109053 0 0 1-2.910316-38.238316c34.681263-4.958316 62.922105-14.551579 90.381474-24.064C422.049684 714.024421 460.8 700.631579 512 700.631579s89.950316 13.392842 127.407158 26.354526c27.459368 9.485474 55.700211 19.105684 90.381474 24.064zM862.315789 512c0 84.372211-44.355368 134.736842-118.568421 134.736842-40.232421 0-75.048421-11.371789-100.001684-22.797474a227.489684 227.489684 0 0 1-7.976421 31.717053L610.330947 646.736842l-25.438315-8.865684c0.080842-0.242526-4.634947 8.865684-72.892632 8.865684-10.590316 0-19.186526-0.269474-26.947368-0.619789v-166.319158A78.686316 78.686316 0 0 0 512 485.052632c44.570947 0 80.842105-36.271158 80.842105-80.842106s-36.271158-80.842105-80.842105-80.842105c-9.539368 0-18.485895 2.128842-26.947368 5.200842V35.651368c3.961263-5.093053 6.602105-8.138105 6.952421-8.515368L512 5.012211l19.994947 22.150736c1.158737 1.293474 27.594105 30.908632 54.703158 88.387369a689.798737 689.798737 0 0 1 71.033263 46.780631c14.389895 10.832842 29.453474 23.605895 41.633685 35.866948h-0.026948c-34.896842 25.950316-71.491368 62.895158-103.343158 101.537684 14.821053 11.937684 26.947368 26.785684 35.651369 43.870316 23.632842-28.941474 56.805053-64.970105 91.432421-87.336421l17.704421-11.452632 15.36 14.44379C807.289263 307.253895 862.315789 406.851368 862.315789 512z m-161.68421-53.894737a26.974316 26.974316 0 1 0-26.947368 26.947369c14.848 0 26.947368-12.099368 26.947368-26.947369z" fill="#FFAF6E" ></path><path d="M916.210526 619.789474c0 98.842947-82.539789 134.736842-137.997473 134.736842-59.095579 0-99.597474-14.012632-138.805895-27.540211C601.950316 714.024421 563.2 700.631579 512 700.631579s-89.950316 13.392842-127.407158 26.354526C345.384421 740.513684 304.882526 754.526316 245.786947 754.526316 190.329263 754.526316 107.789474 718.632421 107.789474 619.789474v-80.842106H53.894737v80.842106c0 97.926737 63.191579 159.690105 136.003368 180.574315C202.832842 925.291789 342.204632 1024 512 1024c169.822316 0 309.167158-98.708211 322.101895-223.636211C906.913684 779.479579 970.105263 717.716211 970.105263 619.789474v-80.842106h-53.894737v80.842106zM512 970.105263c-135.491368 0-247.619368-70.440421-266.401684-161.68421h0.161684c68.149895 0 115.038316-16.222316 156.429474-30.504421C438.487579 765.359158 469.854316 754.526316 512 754.526316s73.512421 10.832842 109.783579 23.390316C663.174737 792.198737 710.063158 808.421053 778.213053 808.421053h0.188631c-18.782316 91.243789-130.937263 161.684211-266.401684 161.68421zM997.052632 161.684211c-39.828211 0-71.033263 8.919579-93.884632 19.078736-6.063158-13.231158-13.716211-25.438316-23.902316-35.651368C854.932211 120.697263 821.113263 107.789474 781.473684 107.789474c-41.040842 0-84.506947 23.740632-123.742316 54.514526a689.798737 689.798737 0 0 0-71.033263-46.780632c-27.109053-57.478737-53.544421-87.093895-54.703158-88.387368L512 5.012211l-19.994947 22.150736c-1.158737 1.293474-27.594105 30.908632-54.703158 88.387369a688.882526 688.882526 0 0 0-71.006316 46.780631C327.033263 131.530105 283.567158 107.789474 242.526316 107.789474c-39.639579 0-73.458526 12.907789-97.792 37.322105a120.373895 120.373895 0 0 0-23.902316 35.651368C97.953684 170.603789 66.775579 161.684211 26.947368 161.684211H0v215.578947c0 71.760842 69.093053 107.789474 107.789474 107.789474h1.670737c1.347368-18.324211 3.745684-36.325053 7.518315-53.894737H107.789474c-12.988632 0-53.894737-16.222316-53.894737-53.894737V217.330526c24.090947 3.233684 42.145684 10.401684 54.568421 17.00379-0.134737 2.829474-0.673684 5.416421-0.673684 8.272842 0.080842 33.253053 14.336 66.991158 39.666526 97.17221 8.677053-18.674526 18.512842-35.866947 28.860632-52.035368-10.078316-16.680421-14.605474-32.525474-14.632421-45.298526-0.053895-24.791579 7.275789-45.298526 21.207578-59.284211C196.904421 169.121684 217.519158 161.684211 242.526316 161.684211c50.499368 0 126.221474 66.155789 185.478737 138.024421a134.656 134.656 0 0 0-35.678316 43.897263c-23.632842-28.968421-56.832-64.997053-91.432421-87.363369l-17.677474-11.452631-15.386947 14.443789C216.710737 307.253895 161.684211 406.851368 161.684211 512c0 84.372211 44.328421 134.736842 118.568421 134.736842 40.259368 0 75.075368-11.371789 100.001684-22.797474 3.152842 17.650526 7.68 30.881684 7.949473 31.717053l50.876632-17.785263C439.026526 637.628632 431.157895 614.669474 431.157895 592.842105c0-13.338947 0-53.894737 80.842105-53.894737s80.842105 40.555789 80.842105 53.894737c0 21.827368-7.868632 44.786526-7.949473 45.029053l25.438315 8.865684 25.411369 8.919579c0.296421-0.835368 4.823579-14.039579 7.976421-31.717053 24.953263 11.425684 59.769263 22.797474 100.028631 22.797474 74.24 0 118.568421-50.364632 118.568421-134.736842 0-105.148632-55.026526-204.746105-106.145684-252.766316l-15.36-14.443789-17.704421 11.452631c-34.600421 22.366316-67.799579 58.394947-91.432421 87.336421a134.467368 134.467368 0 0 0-35.651368-43.870315C655.225263 227.84 731.001263 161.684211 781.473684 161.684211c25.007158 0 45.594947 7.437474 59.634527 21.477052 13.958737 13.985684 21.261474 34.465684 21.207578 59.284211-0.053895 12.773053-4.581053 28.618105-14.632421 45.325473 10.347789 16.168421 20.183579 33.333895 28.860632 52.035369 25.303579-30.181053 39.558737-63.919158 39.666526-97.172211 0-2.856421-0.565895-5.443368-0.673684-8.245894A160.525474 160.525474 0 0 1 970.105263 217.330526V377.263158c0 37.672421-40.933053 53.894737-53.894737 53.894737h-9.189052c3.799579 17.569684 6.170947 35.570526 7.518315 53.894737H916.210526c38.696421 0 107.789474-36.028632 107.789474-107.789474V161.684211h-26.947368z m-404.210527 242.526315c0 44.570947-36.271158 80.842105-80.842105 80.842106s-80.842105-36.271158-80.842105-80.842106 36.271158-80.842105 80.842105-80.842105 80.842105 36.271158 80.842105 80.842105z m80.842106 26.947369c14.848 0 26.947368 12.099368 26.947368 26.947368s-12.099368 26.947368-26.947368 26.947369a26.974316 26.974316 0 0 1 0-53.894737z m-296.421053 26.947368c0 14.848-12.099368 26.947368-26.947369 26.947369s-26.947368-12.099368-26.947368-26.947369 12.099368-26.947368 26.947368-26.947368 26.947368 12.099368 26.947369 26.947368z m4.50021 103.909053C367.696842 571.095579 329.054316 592.842105 280.252632 592.842105 264.245895 592.842105 215.578947 592.842105 215.578947 512c0-75.371789 35.139368-151.956211 73.916632-197.416421 22.554947 18.351158 44.032 42.280421 60.658526 62.679579A80.949895 80.949895 0 0 0 269.473684 458.105263c0 44.570947 36.271158 80.842105 80.842105 80.842105a80.680421 80.680421 0 0 0 68.284632-37.995789c1.940211 1.859368 4.176842 3.395368 6.224842 5.146947-21.665684 13.096421-36.378947 31.986526-43.061895 55.91579z m352.741053-247.430737C773.281684 360.043789 808.421053 436.628211 808.421053 512c0 80.842105-48.693895 80.842105-64.673685 80.842105-48.801684 0-87.417263-21.719579-101.537684-30.800842-6.629053-23.983158-21.369263-42.873263-43.061895-55.942737 2.048-1.751579 4.284632-3.287579 6.224843-5.146947A80.707368 80.707368 0 0 0 673.684211 538.947368c44.570947 0 80.842105-36.271158 80.842105-80.842105a80.949895 80.949895 0 0 0-80.680421-80.842105c16.626526-20.399158 38.076632-44.328421 60.658526-62.679579z m-187.607579-39.962947C535.686737 271.602526 524.153263 269.473684 512 269.473684s-23.686737 2.128842-34.896842 5.146948a816.047158 816.047158 0 0 0-69.146947-76.072421 636.389053 636.389053 0 0 1 63.218526-40.259369l7.841684-4.338526 3.69179-8.138105c10.347789-23.013053 20.749474-41.283368 29.291789-54.730106 8.542316 13.473684 18.944 31.717053 29.345684 54.757053l3.69179 8.138105 7.814737 4.338526c25.6 14.174316 47.616 28.995368 63.218526 40.259369a813.217684 813.217684 0 0 0-69.173895 76.045474z" fill="#231F20" ></path></symbol></svg>',function(h){var c=(c=document.getElementsByTagName("script"))[c.length-1],l=c.getAttribute("data-injectcss"),c=c.getAttribute("data-disable-injectsvg");if(!c){var a,v,t,i,o,s=function(c,l){l.parentNode.insertBefore(c,l)};if(l&&!h.__iconfont__svg__cssinject__){h.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(c){console&&console.log(c)}}a=function(){var c,l=document.createElement("div");l.innerHTML=h._iconfont_svg_string_3890337,(l=l.getElementsByTagName("svg")[0])&&(l.setAttribute("aria-hidden","true"),l.style.position="absolute",l.style.width=0,l.style.height=0,l.style.overflow="hidden",l=l,(c=document.body).firstChild?s(l,c.firstChild):c.appendChild(l))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(a,0):(v=function(){document.removeEventListener("DOMContentLoaded",v,!1),a()},document.addEventListener("DOMContentLoaded",v,!1)):document.attachEvent&&(t=a,i=h.document,o=!1,e(),i.onreadystatechange=function(){"complete"==i.readyState&&(i.onreadystatechange=null,m())})}function m(){o||(o=!0,t())}function e(){try{i.documentElement.doScroll("left")}catch(c){return void setTimeout(e,50)}m()}}(window);]]></content>
      
    </entry>
    
    
  
</search>
