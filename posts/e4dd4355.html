<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Ansible å­¦ä¹ ç¬”è®° | è‰¾æ–¯ç‰› Blog</title><meta name="author" content="aceniu,123354319@qq.com"><meta name="copyright" content="aceniu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ansible æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç†è®¡ç®—æœºç³»ç»Ÿã€‚å®ƒä½¿ç”¨ YAML è¯­è¨€æ¥æè¿°é…ç½®ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ SSH æˆ– WinRM åè®®æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚Ansible æ˜¯ä¸€ç§è½»é‡çº§å·¥å…·ï¼Œæ˜“äºå­¦ä¹ å’Œä½¿ç”¨ï¼Œå¹¶ä¸”ä¸éœ€è¦åœ¨è¢«ç®¡ç†çš„è®¡ç®—æœºä¸Šå®‰è£…å®¢æˆ·ç«¯ã€‚å®ƒå¯ä»¥ç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼Œä¾‹å¦‚è½¯ä»¶å®‰è£…ã€ç³»ç»Ÿé…ç½®å’Œåº”ç”¨ç¨‹åºéƒ¨ç½²ã€‚"><meta property="og:type" content="article"><meta property="og:title" content="Ansible å­¦ä¹ ç¬”è®°"><meta property="og:url" content="https://blog.halfsummer.xyz/posts/e4dd4355.html"><meta property="og:site_name" content="è‰¾æ–¯ç‰› Blog"><meta property="og:description" content="Ansible æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç†è®¡ç®—æœºç³»ç»Ÿã€‚å®ƒä½¿ç”¨ YAML è¯­è¨€æ¥æè¿°é…ç½®ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ SSH æˆ– WinRM åè®®æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚Ansible æ˜¯ä¸€ç§è½»é‡çº§å·¥å…·ï¼Œæ˜“äºå­¦ä¹ å’Œä½¿ç”¨ï¼Œå¹¶ä¸”ä¸éœ€è¦åœ¨è¢«ç®¡ç†çš„è®¡ç®—æœºä¸Šå®‰è£…å®¢æˆ·ç«¯ã€‚å®ƒå¯ä»¥ç”¨äºè‡ªåŠ¨åŒ–å„ç§ä»»åŠ¡ï¼Œä¾‹å¦‚è½¯ä»¶å®‰è£…ã€ç³»ç»Ÿé…ç½®å’Œåº”ç”¨ç¨‹åºéƒ¨ç½²ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0d2f9e0.jpg"><meta property="article:published_time" content="2023-02-25T09:43:06.000Z"><meta property="article:modified_time" content="2023-03-13T17:48:00.563Z"><meta property="article:author" content="aceniu"><meta property="article:tag" content="aceniu,blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0d2f9e0.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.halfsummer.xyz/posts/e4dd4355.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Ansible å­¦ä¹ ç¬”è®°",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-13 17:48:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="è‰¾æ–¯ç‰› Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>è¿½ç•ª</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fa fa-images faa-tada"></i> <span>å›¾åºŠ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0d2f9e0.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="è‰¾æ–¯ç‰› Blog"><span class="site-name">è‰¾æ–¯ç‰› Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>è¿½ç•ª</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fa fa-images faa-tada"></i> <span>å›¾åºŠ</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ansible å­¦ä¹ ç¬”è®°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-02-25T09:43:06.000Z" title="å‘è¡¨äº 2023-02-25 09:43:06">2023-02-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-03-13T17:48:00.563Z" title="æ›´æ–°äº 2023-03-13 17:48:00">2023-03-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Program/">Program</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Program/Operations/">Operations</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Ansible å­¦ä¹ ç¬”è®°"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer"><h1 id="1ï¼‰Ansible-å®‰è£…éƒ¨ç½²">1ï¼‰Ansible å®‰è£…éƒ¨ç½²</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install epel-release ansible libselinux-python</span><br></pre></td></tr></table></figure><h1 id="2ï¼‰ä¸»æœºæ¸…å•">2ï¼‰ä¸»æœºæ¸…å•</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#vim /etc/ansible/hosts </span></span><br><span class="line"> </span><br><span class="line">[web]</span><br><span class="line">172.16.1.7 </span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line"> </span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line"> </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><p><strong>ä¸»æœºåˆ†ç»„åï¼Œæ‰§è¡Œå‘½ä»¤æµ‹è¯•ï¼Œæ‰¹é‡ç®¡ç†ä¸€ç»„æœºå™¨</strong></p><p>ç®¡ç†æ‰€æœ‰çš„æœºå™¨ï¼Œä½¿ç”¨ç‰¹æ®Šä¸»æœºç»„ï¼Œall</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è®©æ‰€æœ‰çš„ä¸»æœºï¼Œè¿œç¨‹è¿è¡Œhostnameï¼Œè¿”å›ä¸»æœºåä¿¡æ¯</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m shell -a &quot;hostname&quot;</span></span><br><span class="line"> </span><br><span class="line">ä½†æ˜¯é»˜è®¤æ²¡é…ç½®è®¤è¯æ–¹å¼ï¼Œæƒé™è¢«æ‹’ç»</span><br></pre></td></tr></table></figure><h1 id="3ï¼‰Ansible-è¿æ¥å®¢æˆ·ç«¯">3ï¼‰Ansible è¿æ¥å®¢æˆ·ç«¯</h1><h2 id="3-1-åŸºäºå…¬é’¥è®¤è¯">3.1 åŸºäºå…¬é’¥è®¤è¯</h2><p>ç”Ÿæˆå…¬é’¥çš„æ–¹æ³•ï¼šï¼ˆ~/.ssh/ï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa <span class="comment">#-t : tæ˜¯typeçš„ç¼©å†™ï¼Œå³æŒ‡å®šå¯†é’¥çš„ç±»å‹ï¼Œå¯†é’¥çš„ç±»å‹æœ‰ä¸¤ç§ï¼šRSAã€DSA</span></span><br></pre></td></tr></table></figure><p>å‘é€å…¬é’¥ç»™ç›®æ ‡æœºå™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ssh-copy-id root@172.16.1.41</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.41 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">rsync-41</span><br></pre></td></tr></table></figure><h2 id="3-2-åŸºäºå¯†ç è®¤è¯">3.2 åŸºäºå¯†ç è®¤è¯</h2><ul><li>åœ¨ä½ çš„å®¢æˆ·ç«¯æœºå™¨ï¼Œä¿®æ”¹äº†sshé»˜è®¤ç«¯å£ï¼Œä»¥åŠå¯†ç éœ€è¦ä¿®æ”¹ä¸»æœºæ¸…å•æ–‡ä»¶æ‰å¯ä»¥æ­£ç¡®è¿æ¥</li><li>æ³¨æ„ä½ å¾—é…ç½®æ–‡ä»¶å…è®¸å…å¯†ç™»å½•æ‰èƒ½è¿›è¡Œå¦‚ä¸‹æµ‹è¯•</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ansible/hosts  <span class="comment">#ä¸»æœºæ¸…å•æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œéƒ¨åˆ†èµ„æ–™é‡Œçš„ä¸»æœºé…ç½®æ–‡ä»¶è¯­æ³•ï¼Œæ—§ç‰ˆå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#Ansible 2.0 has deprecated the â€œsshâ€ from ansible_ssh_user, ansible_ssh_host, and ansible_ssh_port to become </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™æ˜¯æ—§ç‰ˆæœ¬çš„ç”¨æ³•</span></span><br><span class="line">ansible_ssh_host</span><br><span class="line">ansible_ssh_port</span><br><span class="line">ansible_ssh_user</span><br><span class="line">ansible_ssh_password</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ–°ç‰ˆå‚æ•°å»æ‰äº†ä¸­é—´çš„_ssh(å¦‚æœä½ å†™æ—§ç‰ˆæœ¬çš„è¯­æ³•ï¼Œæ–°ç‰ˆä¹Ÿä¹Ÿè®¤è¯†)</span></span><br><span class="line">ansible_user</span><br><span class="line">ansible_host</span><br><span class="line">ansible_port</span><br></pre></td></tr></table></figure><p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>å‚æ•°ç±»å‹</strong></th><th><strong>å‚æ•°è¯´æ˜</strong></th></tr></thead><tbody><tr><td>ansible_host</td><td>ä¸»æœºåœ°å€</td><td>è¿œç¨‹ä¸»æœºip</td></tr><tr><td>ansible_port</td><td>ä¸»æœºç«¯å£</td><td>è®¾ç½®SSHè¿æ¥ç«¯å£ï¼Œé»˜è®¤22</td></tr><tr><td>ansible_user</td><td>ä¸»æœºç”¨æˆ·</td><td>é»˜è®¤SSHè¿œç¨‹è¿æ¥çš„ç”¨æˆ·èº«ä»½</td></tr><tr><td>ansible_password</td><td>ç”¨æˆ·å¯†ç </td><td>æŒ‡å®šSSHè¿œç¨‹ä¸»æœºå¯†ç </td></tr></tbody></table><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>ç»™rsyncæœºå™¨ï¼Œè¿›è¡Œå…å¯†è®¤è¯</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.ç»™rsyncæœºå™¨ï¼Œæ·»åŠ å¯†ç ï¼Œç«¯å£ä¿¡æ¯</span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41 ansible_port=22 ansible_password=<span class="string">&#x27;123456&#x27;</span></span><br><span class="line"> </span><br><span class="line">2.å¦‚æœç›®æ ‡æœºå™¨çš„sshä¿¡æ¯éƒ½è¢«æ”¹äº†ï¼Œè¿™é‡Œä¹Ÿå¾—æ”¹</span><br><span class="line">172.16.1.41 ansible_port=22999 ansible_password=<span class="string">&#x27;123123&#x27;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ‰§è¡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m ping</span></span><br><span class="line">172.16.1.41 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Œæ•…éšœè§£å†³">ğŸ“Œæ•…éšœè§£å†³</h2><p>ä½ å¯èƒ½ä¼šé‡è§å¦‚ä¸‹é—®é¢˜ï¼Œå…³äºæ–°æœºå™¨çš„æŒ‡çº¹ç¡®è®¤é—®é¢˜ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible 172.16.1.9 -m ping</span></span><br><span class="line">172.16.1.9 | FAILED! =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#x27;s fingerprint to your known_hosts file to manage this host.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•1ï¼Œæ‰‹åŠ¨sshè¿æ¥ï¼Œè¿›è¡ŒæŒ‡çº¹ç¡®è®¤ï¼Œå†™å…¥åˆ°æœ¬æœºçš„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/known_hosts</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•2ï¼Œansibleé…ç½®æ–‡ä»¶ä¸­å¿½ç•¥æŒ‡çº¹ç¡®è®¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep &#x27;host_key_checking&#x27; /etc/ansible/ansible.cfg </span></span><br><span class="line">host_key_checking = False</span><br></pre></td></tr></table></figure><p>é—®é¢˜å·²ç»è§£å†³ï¼Œå¯ä»¥æ­£ç¡®æ“ä½œweb-9æœºå™¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible 172.16.1.9 -m ping</span></span><br><span class="line">172.16.1.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Œè¸©å‘è®°å½•-ansibleç¼“å­˜">ğŸ“Œè¸©å‘è®°å½•(ansibleç¼“å­˜)</h2><p>ç”±äºansibleåœ¨å¯¹è¿œç¨‹ä¸»æœºæ“ä½œä¹‹å‰ï¼Œé»˜è®¤ä¼šå…ˆé€šè¿‡setupæ¨¡å—è·å–æœºå™¨çš„factsï¼ˆé™æ€å±æ€§ï¼‰ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆç¼“å­˜ï¼Œä¾¿äºåŠ é€Ÿè¿œç¨‹ä¸»æœºçš„æ“ä½œï¼›ä½†ç¼“å­˜ä¹Ÿä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„ç°è±¡ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯çš„æœºå™¨ä¿¡æ¯æ›´æ–°äº†ï¼ŒæœåŠ¡ç«¯ä¾æ—§ä½¿ç”¨çš„æ˜¯æ—§æ•°æ®ï¼Œé‚£å°±ä¸å‡†ç¡®äº†ï¼Œå› æ­¤å¯ä»¥åˆ é™¤ç¼“å­˜ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å…³äºç¼“å­˜å¯¼è‡´bugçš„æ–‡ç« ï¼Œhttps://serverfault.com/questions/630253/ansible-stuck-on-gathering-facts</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">æ¸…ç†ansibleçš„ç¼“å­˜ç›®å½•å³å¯</span><br><span class="line">[root@master-61 ~]<span class="comment">#rm -rf ~/.ansible/cp/*</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ“ŒåŒä¸€ç»„è¿ç»­çš„ip">ğŸ“ŒåŒä¸€ç»„è¿ç»­çš„ip</h2><p>å¯ä»¥ä¿®æ”¹ä¸»æœºæ¸…å•æ–‡ä»¶å¦‚ä¸‹ï¼Œå‰ææ˜¯è¯¥äº›ä¸»æœºçš„é…ç½®ä¸€è‡´</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[web]</span><br><span class="line">172.16.1.[7:9]</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Œå…¬å…±å˜é‡">ğŸ“Œå…¬å…±å˜é‡</h2><p>å½“ä¸»æœºæ¸…å•é‡Œï¼Œå¾ˆå¤šä¸»æœºç»„ï¼Œæœ‰ç›¸åŒçš„å˜é‡å±æ€§ï¼Œå¯ä»¥å†™æˆå…¬å…±å˜é‡</p><p>è¿™éƒ¨åˆ†é…ç½®æ˜¯é’ˆå¯¹webä¸»æœºç»„ï¼ŒæŠ½è±¡çš„å˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep -vE &#x27;^#|^$&#x27; /etc/ansible/hosts </span></span><br><span class="line">[web:vars]</span><br><span class="line">ansible_ssh_port=22999</span><br><span class="line">ansible_ssh_user=root</span><br><span class="line">ansible_ssh_pass=123123</span><br><span class="line">[web]</span><br><span class="line">172.16.1.[7:9]</span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31 ansible_ssh_port=22999 </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41 ansible_ssh_port=22999 ansible_ssh_user=root ansible_ssh_pass=123123</span><br></pre></td></tr></table></figure><p><strong>æ‰€æœ‰ä¸»æœºéƒ½ç”Ÿæ•ˆçš„å˜é‡</strong></p><p>æŒ‡å®šä¸»æœºç»„åallï¼Œå³å¯é’ˆå¯¹æ‰€æœ‰ä¸»æœºåç”Ÿæ•ˆï¼Œå‰ææ˜¯ï¼Œä½ è¦ç¡®ä¿è¿™ä¸ªä¿¡æ¯æ˜¯æ‰€æœ‰ä¸»æœºé€šç”¨çš„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#grep -vE &#x27;^#|^$&#x27; /etc/ansible/hosts </span></span><br><span class="line">[all:vars]</span><br><span class="line">ansible_port=22</span><br><span class="line">ansible_password=<span class="string">&#x27;123456&#x27;</span></span><br><span class="line"> </span><br><span class="line">[web]</span><br><span class="line">172.16.1.7</span><br><span class="line">172.16.1.8</span><br><span class="line">172.16.1.9</span><br><span class="line"> </span><br><span class="line">[nfs]</span><br><span class="line">172.16.1.31</span><br><span class="line"> </span><br><span class="line">[backup]</span><br><span class="line">172.16.1.41</span><br></pre></td></tr></table></figure><h2 id="3-3-Ansibleè¿æ¥æŒ‡çº¹ç¡®è®¤çš„é—®é¢˜">3.3 Ansibleè¿æ¥æŒ‡çº¹ç¡®è®¤çš„é—®é¢˜</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1.master-61éœ€è¦ç¡®è®¤ç›®æ ‡æœºå™¨çš„æŒ‡çº¹ï¼Œè®°å½•åˆ°æœ¬åœ°knownâ€”â€”hostsæ–‡ä»¶</span><br><span class="line"><span class="built_in">ls</span> ~/.ssh/known_hostsæ–‡ä»¶ä¸­ è¿™é‡Œå°±å­˜æ”¾äº†ç›®æ ‡æœºå™¨çš„æŒ‡çº¹ä¿¡æ¯</span><br><span class="line"> </span><br><span class="line">å¯ä»¥è¿›è¡Œè®¤è¯æ–¹å¼ï¼Œå¯†ç ï¼Œè¿˜æ˜¯å…¬é’¥</span><br><span class="line"> </span><br><span class="line">2.é¦–æ¬¡è¿œç¨‹è¿æ¥ï¼Œéœ€è¦æŒ‡çº¹ç¡®è®¤ï¼Œå¯ä»¥å¿½ç•¥è¯¥æŒ‡çº¹</span><br><span class="line">sshçš„è¿æ¥å‚æ•°ï¼Œå¿½ç•¥æŒ‡çº¹çš„ç¡®è®¤</span><br><span class="line">ansibleçš„é…ç½®æ–‡ä»¶ä¸­ä¹Ÿæœ‰ä¸€ä¸ªå‚æ•°å¿½ç•¥æŒ‡çº¹çš„ç¡®è®¤</span><br><span class="line"> </span><br><span class="line">ä¸€èˆ¬ç”¨æ³•æ˜¯</span><br><span class="line">æ€»ä¹‹ansibleå°±æ˜¯ä»¥sshè¿æ¥æ ‡å‡†æ¥çš„</span><br><span class="line"> </span><br><span class="line">1.æŒ‡çº¹ç¡®è®¤ <span class="built_in">yes</span>/no</span><br><span class="line"> </span><br><span class="line">2.å¯†ç è®¤è¯/å…¬é’¥è®¤è¯</span><br><span class="line"> </span><br><span class="line">å…³äºansibleå¦‚ä½•åˆå§‹åŒ–çš„ä½¿ç”¨ï¼Œæœ‰ä¸‰ä¸ªæ–¹æ¡ˆ</span><br><span class="line"> </span><br><span class="line">æ–¹æ¡ˆä¸€</span><br><span class="line">å·²ç»åŸºäºsshå®Œæˆäº†æŒ‡çº¹ç¡®è®¤ï¼Œè®¤è¯æ–¹å¼</span><br><span class="line">ansibleç›´æ¥ç”¨å°±å¯ä»¥</span><br><span class="line">ä½ å¯ä»¥å…ˆä¸€é”®åˆ†å‘å…¬é’¥ï¼Œå®ç°æ‰¹é‡åŒ–å…å¯†ç™»å½•ï¼Œå†ansibleå…å¯†è¿œç¨‹æ‰§è¡Œå‘½ä»¤</span><br><span class="line"> </span><br><span class="line">æ–¹æ¡ˆ2</span><br><span class="line">ssh root@172.16.1.7</span><br><span class="line">æ‰‹åŠ¨ç¡®è®¤<span class="built_in">yes</span> å†™å…¥åˆ°æœ¬åœ°çš„known_hosts</span><br><span class="line">ä½ å¯ä»¥æ‰‹åŠ¨sshè¿æ¥ï¼Œç¡®è®¤æŒ‡çº¹åï¼Œå†ansibleå»è¿œç¨‹æ“ä½œï¼Œé€‰æ‹©è®¤è¯æ–¹å¼å°±è¡Œ</span><br><span class="line"> </span><br><span class="line">æ–¹æ¡ˆ3.</span><br><span class="line">ä½ å¯ä»¥ç›´æ¥å¿½ç•¥æŒ‡çº¹ç¡®è®¤ï¼Œåœ¨ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­å®šä¹‰å¥½sshè¿æ¥é…ç½®å‚æ•°</span><br><span class="line"> </span><br><span class="line">è¿™ä¸ªå°±æ˜¯æœ€ç®€å•çš„ï¼Œä¿®æ”¹ansibleé…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€å¿½ç•¥æŒ‡çº¹ç¡®è®¤çš„å‚æ•°å³å¯</span><br><span class="line"> </span><br><span class="line">ä¿®æ”¹å¦‚ä¸‹å‚æ•°å³å¯</span><br><span class="line"> 72 <span class="comment"># uncomment this to disable SSH key host checking</span></span><br><span class="line"> 73 host_key_checking = False</span><br><span class="line"> </span><br><span class="line">åç»­å°±è¿›å…¥äº†è®¤è¯æ–¹å¼é˜¶æ®µï¼Œé€‰æ‹©å¯†ç ï¼Œè¿˜æ˜¯å…¬é’¥ï¼Œ</span><br><span class="line">å¸¸è§é”™è¯¯</span><br><span class="line">- ç«¯å£é”™äº†</span><br><span class="line">- å¯†ç é”™äº†</span><br><span class="line">- ç”¨æˆ·é”™äº†</span><br><span class="line"> </span><br><span class="line">å¦‚æœå‡ºé”™</span><br><span class="line">1.æ‰¾ansibleçš„/etc/ansible/hostsä¸­è¯­æ³•æ˜¯å¦å‡ºé”™</span><br><span class="line">2.çœ‹ç›®æ ‡æœºå™¨ï¼Œåˆ°åº•æä¾›äº†ä»€ä¹ˆæ ·çš„sshè¿æ¥å½¢å¼ï¼ˆsshd_configï¼‰</span><br></pre></td></tr></table></figure><h2 id="3-4-sshæ‰¹é‡ç®¡ç†åˆ†å‘ï¼ˆå®æˆ˜ï¼‰">3.4 sshæ‰¹é‡ç®¡ç†åˆ†å‘ï¼ˆå®æˆ˜ï¼‰</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yingcai111/article/details/127404417">https://blog.csdn.net/yingcai111/article/details/127404417</a></p><hr><h1 id="3ï¼‰ad-hoc-å‘½ä»¤è¡Œæ¨¡å¼">3ï¼‰ad-hoc å‘½ä»¤è¡Œæ¨¡å¼</h1><p>Ansibleçš„ad-hocæ¨¡å¼ä¹Ÿå°±æ˜¯ansibleçš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼é€šå¸¸ç”¨æ¥ä¸´æ—¶å¤„ç†ä¸€äº›ä»»åŠ¡ã€‚ä¾‹å¦‚</p><ul><li>ä¸´æ—¶æ‰¹é‡æŸ¥çœ‹æ‰€æœ‰è¢«ç®¡æ§æœºå™¨çš„å†…å­˜ã€è´Ÿè½½ã€ç£ç›˜</li><li>ä¸´æ—¶æ‰¹é‡åˆ†å‘æŸä¸ªç‰¹å®šæ–‡ä»¶</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible ä¸»æœºå -m <span class="built_in">command</span> -a <span class="string">&quot;æ‰¹é‡æ‰§è¡Œçš„æ“ä½œ&quot;</span></span><br><span class="line"><span class="comment"># -m æŒ‡å®šæ¨¡å—çš„å‚æ•°</span></span><br><span class="line"><span class="comment"># -a æŒ‡å®šæ¨¡å—çš„æ‰§è¡ŒåŠ¨ä½œå‚æ•°</span></span><br></pre></td></tr></table></figure><h2 id="3-1-åˆ—å‡ºAnsibleæ‰€æœ‰æ”¯æŒçš„æ¨¡å—">3.1 åˆ—å‡ºAnsibleæ‰€æœ‰æ”¯æŒçš„æ¨¡å—</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å½“å‰ansibleæ”¯æŒ3387ä¸ªæ¨¡å—</span></span><br><span class="line">[root@master-61 ~]<span class="comment"># ansible-doc -l |wc -l</span></span><br><span class="line">3387</span><br></pre></td></tr></table></figure><h2 id="3-2-æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„å…·ä½“ç”¨æ³•">3.2 æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„å…·ä½“ç”¨æ³•</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible-doc -s ping</span></span><br><span class="line">- name: Try to connect to host, verify a usable python and <span class="built_in">return</span> `pong<span class="string">&#x27; on success</span></span><br><span class="line"><span class="string">  ping:</span></span><br><span class="line"><span class="string">      data:                  # Data to return for the `ping&#x27;</span> <span class="built_in">return</span> value. If this</span><br><span class="line">                               parameter is <span class="built_in">set</span> to</span><br><span class="line">                               `crash<span class="string">&#x27;, the module</span></span><br><span class="line"><span class="string">                               will cause an</span></span><br><span class="line"><span class="string">                               exception.</span></span><br><span class="line"><span class="string">[root@master-61 ~]#ansible-doc -s shell</span></span><br><span class="line"><span class="string">- name: Execute shell commands on targets</span></span><br><span class="line"><span class="string">  shell:</span></span><br><span class="line"><span class="string">      chdir:                 # Change into this directory before running the command.</span></span><br><span class="line"><span class="string">      cmd:                   # The command to run followed by optional arguments.</span></span><br><span class="line"><span class="string">      creates:               # A filename, when it already exists, this step will</span></span><br><span class="line"><span class="string">                               *not* be run.</span></span><br><span class="line"><span class="string">      executable:            # Change the shell used to execute the command. This</span></span><br><span class="line"><span class="string">                               expects an absolute</span></span><br><span class="line"><span class="string">                               path to the executable.</span></span><br><span class="line"><span class="string">      free_form:             # The shell module takes a free form command to run, as</span></span><br><span class="line"><span class="string">                               a string. There is no</span></span><br><span class="line"><span class="string">                               actual parameter named</span></span><br><span class="line"><span class="string">                               &#x27;</span>free form<span class="string">&#x27;. See the</span></span><br><span class="line"><span class="string">                               examples on how to use</span></span><br><span class="line"><span class="string">                               this module.</span></span><br><span class="line"><span class="string">      removes:               # A filename, when it does not exist, this step will</span></span><br><span class="line"><span class="string">                               *not* be run.</span></span><br><span class="line"><span class="string">      stdin:                 # Set the stdin of the command directly to the specified</span></span><br><span class="line"><span class="string">                               value.</span></span><br><span class="line"><span class="string">      stdin_add_newline:     # Whether to append a newline to stdin data.</span></span><br><span class="line"><span class="string">      warn:                  # Whether to enable task warnings.</span></span><br></pre></td></tr></table></figure><h2 id="3-3-Ansibleæ‰§è¡Œå‘½ä»¤ç»“æœï¼ˆçŠ¶æ€é¢œè‰²ï¼‰">3.3 Ansibleæ‰§è¡Œå‘½ä»¤ç»“æœï¼ˆçŠ¶æ€é¢œè‰²ï¼‰</h2><p>å¯ä»¥ä½¿ç”¨æ¨¡å—æ“ä½œï¼Œä¼šæœ‰ä¸åŒçš„é¢œè‰²ç»“æœï¼Œéƒ½æ˜¯ç”±æ„ä¹‰çš„</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">è¿ç»´è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œæœ‰2ä¸ªæ–¹å¼</span><br><span class="line">shellè„šæœ¬ï¼Œè¿œç¨‹æ‰§è¡Œ</span><br><span class="line">ansibleæ¨¡å—ï¼Œè¿œç¨‹æ‰§è¡Œ</span><br><span class="line"> </span><br><span class="line">åŒºåˆ«åœ¨äº</span><br><span class="line">shellè„šæœ¬ä¸å¤Ÿæ™ºèƒ½ï¼Œä¸ä¼šè®°å½•ä¸Šä¸€æ¬¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œä»¥åŠä¿®æ”¹çš„çŠ¶æ€ï¼Œå› æ­¤å¯¼è‡´ï¼Œå‚»ç“œå¼çš„ï¼Œé‡å¤æ€§æ‰§è¡Œï¼Œæ•ˆç‡çš„æå…¶ä½ä¸‹ï¼Œä¸åšçŠ¶æ€è®°å½•ï¼Œ</span><br><span class="line"> </span><br><span class="line">ansibleçš„æ¨¡å—ï¼Œyumæ¨¡å—ä¼šè®°å½•æ‰§è¡Œçš„çŠ¶æ€</span><br><span class="line">ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œè£…å®Œä¹‹åï¼Œçš„å´å¯¹ç›®æ ‡æœºå™¨äº§ç”Ÿäº†ä¿®æ”¹çš„çŠ¶æ€ï¼Œä¼šç»™master-61è¿”å›ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œç»“æœï¼Œæ‰§è¡ŒçŠ¶æ€ï¼Œå­˜å‚¨ä¸‹æ¥</span><br><span class="line">ansible web -m yum -a <span class="string">&quot;name=rsync  state=installed&quot;</span></span><br><span class="line"> </span><br><span class="line">ansibleä¼šæ£€æµ‹ç›®æ ‡æœºå™¨ï¼Œå¯¹æ¯”è¿™ä¸ªçŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€æ²¡å˜ï¼Œansibleå°±ä¸ä¼šå†æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå› æ­¤æ•ˆç‡å¾ˆé«˜</span><br><span class="line">ansible web -m yum -a <span class="string">&quot;name=rsync  state=installed&quot;</span></span><br></pre></td></tr></table></figure><p>ansibleçš„çŠ¶æ€ï¼Œé¢œè‰²åŒºåˆ†ï¼Œçœ‹åˆ°ä¸åŒçš„çŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»¿è‰²ï¼šå‘½ä»¤ä»¥ç”¨æˆ·æœŸæœ›çš„æ‰§è¡Œäº†ï¼Œä½†æ˜¯çŠ¶æ€æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼›</span><br><span class="line">é»„è‰²ï¼šå‘½ä»¤ä»¥ç”¨æˆ·æœŸæœ›çš„æ‰§è¡Œäº†ï¼Œå¹¶ä¸”çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼› </span><br><span class="line">ç´«è‰²ï¼šè­¦å‘Šä¿¡æ¯ï¼Œè¯´æ˜ansibleæç¤ºä½ æœ‰æ›´åˆé€‚çš„ç”¨æ³•ï¼›å‡ºç°äº†warningè­¦å‘Š</span><br><span class="line">çº¢è‰²ï¼šå‘½ä»¤é”™è¯¯ï¼Œæ‰§è¡Œå¤±è´¥ï¼›</span><br><span class="line">è“è‰²ï¼š è¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹ï¼›</span><br></pre></td></tr></table></figure><hr><h1 id="4ï¼‰Ansible-æ¨¡å—ï¼ˆæ ¸å¿ƒå†…å®¹ï¼‰">4ï¼‰Ansible æ¨¡å—ï¼ˆæ ¸å¿ƒå†…å®¹ï¼‰</h1><p>Ansibleè‡ªåŠ¨åŒ–è½¯ä»¶çš„æ ¸å¿ƒåŠŸèƒ½å°±åœ¨äºå…¶ä¼—å¤šçš„æ¨¡å—ï¼Œå¯ä»¥è¯´å­¦ä¹ Ansibleå°±æ˜¯å­¦ä¹ æ¨¡å—çš„ä½¿ç”¨ã€‚</p><p>å‰©ä½™çš„æ˜¯å¯¹Ansibleå‰§æœ¬ç¼–å†™çš„ç†Ÿç»ƒåº¦ã€‚</p><h2 id="1-ping-æµ‹è¯•è¿é€šæ€§æ¨¡å—">.1 ping æµ‹è¯•è¿é€šæ€§æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html#ansible-collections-ansible-builtin-ping-module</a></p><h3 id="ğŸ“–-æ¦‚è¦">ğŸ“– æ¦‚è¦</h3><ul><li>ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æ€»æ˜¯pongåœ¨æˆåŠŸè”ç³»æ—¶è¿”å›ã€‚å®ƒåœ¨å‰§æœ¬ä¸­æ²¡æœ‰æ„ä¹‰ï¼Œä½†å®ƒæœ‰åŠ©äº/usr/bin/ansibleéªŒè¯ç™»å½•èƒ½åŠ›ä»¥åŠé…ç½®äº†å¯ç”¨çš„ Pythonã€‚</li><li>è¿™ä¸æ˜¯ ICMP pingï¼Œè¿™åªæ˜¯ä¸€ä¸ªåœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šéœ€è¦ Python çš„ç®€å•æµ‹è¯•æ¨¡å—ã€‚</li><li>å¯¹äº Windows ç›®æ ‡ï¼Œè¯·æ”¹ç”¨win_pingæ¨¡å—ã€‚</li><li>å¯¹äºç½‘ç»œç›®æ ‡ï¼Œè¯·æ”¹ç”¨net_pingæ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameter</th><th>choices/default</th><th>comments</th></tr></thead><tbody><tr><td>data</td><td>é»˜è®¤ä¸ºâ€™pongâ€™</td><td>ä¸º<code>ping</code>è¿”å›å€¼è¿”å›çš„æ•°æ®ã€‚å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º<code>crash</code>ï¼Œæ¨¡å—å°†å¼•å‘å¼‚å¸¸ã€‚</td></tr></tbody></table><h3 id="ğŸ“Œé€šè¿‡master-61æœºå™¨ï¼ŒæŸ¥çœ‹ç›®æ ‡æœºå™¨æ˜¯å¦è¿è¡Œ">ğŸ“Œé€šè¿‡master-61æœºå™¨ï¼ŒæŸ¥çœ‹ç›®æ ‡æœºå™¨æ˜¯å¦è¿è¡Œ</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m ping</span></span><br><span class="line">172.16.1.8 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.7 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.31 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.9 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">172.16.1.41 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-command-ç®€å•å‘½ä»¤æ¨¡å—">.2 command ç®€å•å‘½ä»¤æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v2">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html#ansible-collections-ansible-builtin-command-module</a></p><h3 id="ğŸ“–-æ¦‚è¦-v2">ğŸ“– æ¦‚è¦</h3><ul><li>è¯¥commandæ¨¡å—ä»¥å‘½ä»¤åç§°ä¸ºå•ä½ï¼Œç„¶åæ˜¯ç©ºé—´é™åˆ¶çš„å‚æ•°åˆ—è¡¨ã€‚</li><li>ç»™å®šå‘½ä»¤å°†åœ¨æ‰€æœ‰é€‰å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</li><li>å‘½ä»¤å°†ä¸ä¼šé€šè¿‡å¤–å£³å¤„ç†ï¼Œå› æ­¤å˜é‡å’Œ$HOMEæ“ä½œï¼Œä¾‹å¦‚ï¼Œâ€œ&lt;â€œå’Œä¸èµ·ä½œç”¨ã€‚å¦‚æœéœ€è¦è¿™äº›åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Shellæ¨¡å—â€&gt;â€<code>&quot;|&quot;</code>â€œ;â€``â€œ&amp;â€</li><li>è¦åˆ›å»ºcommandæ¯”ä½¿ç”¨ç©ºæ ¼åˆ é™¤å‚æ•°çš„ä»»åŠ¡æ›´å®¹æ˜“è¯»å–çš„ä»»åŠ¡ï¼Œè¯·ä½¿ç”¨args ä»»åŠ¡å…³é”®å­—æˆ–ä½¿ç”¨å‚æ•°ä¼ é€’cmdå‚æ•°ã€‚</li><li>éœ€è¦å…è´¹çš„è¡¨å•å‘½ä»¤æˆ–cmdå‚æ•°ï¼Œè¯·å‚è§ç¤ºä¾‹ã€‚</li><li>å¯¹äºWindowsç›®æ ‡ï¼Œè¯·æ”¹ç”¨Win_Commandæ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v2">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameterï¼ˆå‚æ•°ï¼‰</th><th>choices/defaultsï¼ˆé€‰é¡¹ï¼‰</th><th>commentsï¼ˆæ³¨è§£ï¼‰</th></tr></thead><tbody><tr><td>argv</td><td></td><td>å°†å‘½ä»¤ä½œä¸ºåˆ—è¡¨è€Œä¸æ˜¯å­—ç¬¦ä¸²ä¼ é€’ã€‚ä½¿ç”¨<code>argv</code>æ¥é¿å…å¼•ç”¨å¯èƒ½è¢«é”™è¯¯è§£é‡Šçš„å€¼(ä¾‹å¦‚â€œuser nameâ€)ã€‚åªèƒ½æä¾›å­—ç¬¦ä¸²æˆ–åˆ—è¡¨å½¢å¼ï¼Œä¸èƒ½åŒæ—¶æä¾›ä¸¤è€…ã€‚å¿…é¡»æä¾›å…¶ä¸­ä¸€ç§ã€‚</td></tr><tr><td>chdir</td><td></td><td>åœ¨è¿è¡Œè¯¥å‘½ä»¤ä¹‹å‰ï¼Œåˆ‡æ¢åˆ°è¯¥ç›®å½•</td></tr><tr><td>cmd</td><td></td><td>è¦è¿è¡Œçš„å‘½ä»¤ã€‚</td></tr><tr><td>creates</td><td></td><td>æ–‡ä»¶åæˆ–(ä»2.0å¼€å§‹)globæ¨¡å¼ã€‚å¦‚æœå®ƒå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿è¡Œæ­¤æ­¥éª¤ã€‚</td></tr><tr><td>free_form</td><td></td><td>å‘½ä»¤æ¨¡å—ä»¥è‡ªç”±å½¢å¼è¿è¡Œã€‚æ²¡æœ‰åä¸ºâ€œfree formâ€çš„å®é™…å‚æ•°ã€‚</td></tr><tr><td>removes</td><td></td><td>æ–‡ä»¶åæˆ–(ä»2.0å¼€å§‹)globæ¨¡å¼ã€‚å¦‚æœå®ƒå·²ç»å­˜åœ¨ï¼Œåˆ™å°†è¿è¡Œæ­¤æ­¥éª¤ã€‚</td></tr><tr><td>stdin</td><td></td><td>å°†å‘½ä»¤çš„stdinç›´æ¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼</td></tr><tr><td>stdin_add_newline</td><td>yes or noï¼Œé»˜è®¤yes</td><td>å¦‚æœè®¾ç½®ä¸º<code>yes</code>ï¼Œåˆ™å‘<code>stdin</code>æ•°æ®è¿½åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚</td></tr><tr><td>strip_empty_ends</td><td>yes or noï¼Œé»˜è®¤yes</td><td>ä»ç»“æœçš„stdout/stderrç»“å°¾å‰¥ç¦»ç©ºè¡Œã€‚</td></tr><tr><td>warn</td><td>yes or noï¼Œé»˜è®¤yes</td><td>å¯ç”¨æˆ–ç¦ç”¨ä»»åŠ¡è­¦å‘Šã€‚</td></tr></tbody></table><h3 id="ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå">ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ä¸¤ä¸ªæ–¹æ³•</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ç®€å†™ï¼Œ<span class="built_in">command</span>æ˜¯ansibleçš„åŸºç¡€æ¨¡å—ï¼Œé»˜è®¤å°±æ˜¯ -m <span class="built_in">command</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;hostname&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå†…å­˜">ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå†…å­˜</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;free -m&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821         100        1579           9         141        1561</span><br><span class="line">Swap:             0           0           0</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821         100        1579           9         141        1560</span><br><span class="line">Swap:             0           0           0</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1821          98        1581           9         141        1562</span><br><span class="line">Swap:             0           0           0</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶">ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;touch /opt/666.log&quot;</span></span><br><span class="line">[WARNING]: Consider using the file module with state=<span class="built_in">touch</span> rather than running</span><br><span class="line"><span class="string">&#x27;touch&#x27;</span>.  If you need to use <span class="built_in">command</span> because file is insufficient you can add <span class="string">&#x27;warn:</span></span><br><span class="line"><span class="string">false&#x27;</span> to this <span class="built_in">command</span> task or <span class="built_in">set</span> <span class="string">&#x27;command_warnings=False&#x27;</span> <span class="keyword">in</span> ansible.cfg to get rid</span><br><span class="line">of this message.</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">é‡Œé¢æ²¡æœ‰ä¸œè¥¿ï¼Œ</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;cat /opt/666.log&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹è·å–æœºå™¨è´Ÿè½½">ğŸ“Œè¿œç¨‹è·å–æœºå™¨è´Ÿè½½</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;uptime&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.00, 0.02, 0.05</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.00, 0.01, 0.05</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> 20:09:39 up  3:27,  2 <span class="built_in">users</span>,  load average: 0.01, 0.03, 0.05</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œå…³é—­å‘Šè­¦ä¿¡æ¯">ğŸ“Œå…³é—­å‘Šè­¦ä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;touch /opt/666.log  warn=false &quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œåœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œåˆ›å»ºwenjie01ç”¨æˆ·">ğŸ“Œåœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œåˆ›å»ºwenjie01ç”¨æˆ·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m command -a &quot;useradd wenjie01&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤">ğŸ“Œä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤</h3><p>è¿™äº›å‘½ä»¤ç”¨äºç¼–å†™ansible-playbookï¼Œå®ŒæˆæœåŠ¡å™¨éƒ¨ç½²çš„å„ç§å¤æ‚æ¡ä»¶é™å®š</p><p><strong>chdir</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;touch /opt/wenjie666&quot;</span></span><br><span class="line"><span class="comment">#ç­‰åŒäº</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;touch wenjie666 chdir=/opt&quot;</span></span><br></pre></td></tr></table></figure><p><strong>removes</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ¤æ–­å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œå¤‡ä»½</span></span><br><span class="line"><span class="comment">#ç›®æ ‡æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä¼šå¯¹ç›®æ ‡æœºå™¨äº§ç”Ÿä»»ä½•ä¿®æ”¹ï¼Œå› æ­¤ç»¿è‰²ç»“æœ</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;tar -zcf /backup_config/etc.tgz  etc chdir=/  removes=/backup_config&quot;</span></span><br></pre></td></tr></table></figure><p><strong>creates</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m command -a &quot;mkdir /opt creates=/opt&quot;</span></span><br><span class="line">172.16.1.41 | SUCCESS | rc=0 &gt;&gt;</span><br><span class="line">skipped, since /opt exists</span><br></pre></td></tr></table></figure><h2 id="3-shell-ä¸‡èƒ½æ¨¡å—">.3 shell ä¸‡èƒ½æ¨¡å—</h2><h3 id="ğŸ“–-æ¦‚è¦-v3">ğŸ“– æ¦‚è¦</h3><ul><li>è¯¥<code>shell</code>æ¨¡å—é‡‡ç”¨å‘½ä»¤åç§°ï¼Œåè·Ÿä»¥ç©ºæ ¼åˆ†éš”çš„å‚æ•°åˆ—è¡¨ã€‚</li><li>éœ€è¦è‡ªç”±æ ¼å¼çš„å‘½ä»¤æˆ–<code>cmd</code>å‚æ•°ï¼Œè¯·å‚è§ç¤ºä¾‹ã€‚</li><li>å®ƒå‡ ä¹ä¸å‘½ä»¤<code>/bin/sh</code>æ¨¡å—å®Œå…¨ç›¸åŒï¼Œä½†é€šè¿‡è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„shell ( ) è¿è¡Œå‘½ä»¤ã€‚</li><li>å¯¹äº Windows ç›®æ ‡ï¼Œè¯·æ”¹ç”¨win_shellæ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v3">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameter</th><th>choices/defaultsï¼ˆé€‰é¡¹ï¼‰</th><th>commentsï¼ˆæ³¨è§£ï¼‰</th></tr></thead><tbody><tr><td>chdir</td><td></td><td>åœ¨è¿è¡Œè¯¥å‘½ä»¤ä¹‹å‰ï¼Œåˆ‡æ¢åˆ°è¯¥ç›®å½•ã€‚</td></tr><tr><td>cmd</td><td></td><td>è¿è¡Œçš„å‘½ä»¤åè·Ÿå¯é€‰å‚æ•°</td></tr><tr><td>creates</td><td></td><td>å½“æ–‡ä»¶åå·²ç»å­˜åœ¨æ—¶ï¼Œæ­¤æ­¥éª¤å°†ä¸è¿è¡Œ</td></tr><tr><td>executable</td><td></td><td>æ›´æ”¹ç”¨äºæ‰§è¡Œè¯¥å‘½ä»¤çš„shellã€‚è¿™éœ€è¦å¯æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚</td></tr><tr><td>free_form</td><td></td><td>shellæ¨¡å—æ¥å—ä¸€ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼è¿è¡Œçš„è‡ªç”±å½¢å¼å‘½ä»¤ã€‚æ²¡æœ‰åä¸ºâ€œfree formâ€çš„å®é™…å‚æ•°ã€‚</td></tr><tr><td>removes</td><td></td><td>å½“æ–‡ä»¶åä¸å­˜åœ¨æ—¶ï¼Œæ­¤æ­¥éª¤å°†ä¸è¿è¡Œã€‚</td></tr><tr><td>stdin</td><td></td><td>å°†å‘½ä»¤çš„stdinç›´æ¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚</td></tr><tr><td>stdin_add_newline</td><td>yes or noï¼Œé»˜è®¤yes</td><td>æ˜¯å¦å‘stdinæ•°æ®è¿½åŠ æ¢è¡Œç¬¦ã€‚</td></tr><tr><td>warn</td><td>yes or noï¼Œé»˜è®¤yes</td><td>æ˜¯å¦å¯ç”¨ä»»åŠ¡è­¦å‘Šã€‚</td></tr></tbody></table><h3 id="ğŸ“Œè¿œç¨‹è¿‡æ»¤sshè¿›ç¨‹ä¿¡æ¯">ğŸ“Œè¿œç¨‹è¿‡æ»¤sshè¿›ç¨‹ä¿¡æ¯</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible all -m shell -a &quot;ps -ef | grep ssh&quot;</span></span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">root        977      1  0 16:42 ?        00:00:00 /usr/sbin/sshd -D</span><br><span class="line">root       1496    977  0 16:57 ?        00:00:00 sshd: root@pts/0</span><br><span class="line">root       4614    977  4 20:45 ?        00:00:00 sshd: root@pts/1</span><br><span class="line">root       4672   4671  0 20:45 pts/1    00:00:00 /bin/sh -c ps -ef | grep ssh</span><br><span class="line">root       4674   4672  0 20:45 pts/1    00:00:00 grep ssh</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œä½¿ç”¨é‡å®šå‘ç¬¦å·ï¼Œåˆ›å»ºæ–‡ä»¶">ğŸ“Œä½¿ç”¨é‡å®šå‘ç¬¦å·ï¼Œåˆ›å»ºæ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">è¿œç¨‹è·å–æ—¶é—´ä¿¡æ¯ï¼Œä¸”å†™å…¥åˆ°æ–‡ä»¶ä¸­</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">command</span>ä¸è®¤è¯†é‡å®šå‘</span><br><span class="line"><span class="comment"># ansible web -m command -a &quot;date &gt; /tmp/date.log&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &quot;date &#x27;+%F %T&#x27; &gt; /tmp/date.log&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &#x27;cat /tmp/date.log&#x27;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">2022-05-06 20:48:25</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹æ‰§è¡Œå¤æ‚linuxå‘½ä»¤">ğŸ“Œè¿œç¨‹æ‰§è¡Œå¤æ‚linuxå‘½ä»¤</h3><p>è¿™ä¸ªå‘½ä»¤å°±æ— æ³•åœ¨commandä¸­æ‰§è¡Œ</p><p>é€šè¿‡ä¸€æ¡å‘½ä»¤ï¼Œåšå¦‚ä¸‹äº‹æƒ…</p><ul><li>åˆ›å»ºæ–‡ä»¶å¤¹</li><li>ç”Ÿæˆshè„šæœ¬æ–‡ä»¶ï¼ˆæŸ¥çœ‹ä¸»æœºåï¼‰</li><li>èµ‹äºˆè„šæœ¬å¯æ‰§è¡Œæƒé™</li><li>æ‰§è¡Œè„šæœ¬</li><li>å¿½ç•¥warningä¿¡æ¯</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m shell -a &quot;mkdir /0224/;echo &#x27;hostname&#x27; &gt; /0224/hostname.sh;chmod +x /0224/hostname.sh;/0224/hostname.sh;  warn=false&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-8mkdir: cannot create directory â€˜/0224/â€™: File exists</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-7mkdir: cannot create directory â€˜/0224/â€™: File exists</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">web-9mkdir: cannot create directory â€˜/0224/â€™: File exists</span><br></pre></td></tr></table></figure><h2 id="4-copy-æ‹·è´æ–‡ä»¶æ¨¡å—">.4 copy æ‹·è´æ–‡ä»¶æ¨¡å—</h2><h3 id="ğŸ“–-æ¦‚è¦-v4">ğŸ“– æ¦‚è¦</h3><ul><li>è¯¥<code>copy</code>æ¨¡å—å°†æ–‡ä»¶ä»æœ¬åœ°æˆ–è¿œç¨‹æœºå™¨å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨ä¸Šçš„æŸä¸ªä½ç½®ã€‚</li><li>ä½¿ç”¨<code>fetch</code>æ¨¡å—å°†æ–‡ä»¶ä»è¿œç¨‹ä½ç½®å¤åˆ¶åˆ°æœ¬åœ°æ¡†ã€‚</li><li>å¦‚æœæ‚¨éœ€è¦åœ¨å¤åˆ¶çš„æ–‡ä»¶ä¸­è¿›è¡Œå˜é‡æ’å€¼ï¼Œè¯·ä½¿ç”¨<code>æ¨¡æ¿æ¨¡å—</code>ã€‚åœ¨å­—æ®µä¸­ä½¿ç”¨å˜é‡<code>content</code>å°†å¯¼è‡´ä¸å¯é¢„æµ‹çš„è¾“å‡ºã€‚</li><li>å¯¹äº Windows ç›®æ ‡ï¼Œè¯·æ”¹ç”¨<code>win_copy</code>æ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v4">ğŸ“– å‚æ•°</h3><table><thead><tr><th>Parameterï¼ˆå‚æ•°ï¼‰</th><th>choicesï¼ˆé€‰é¡¹ï¼‰/default</th><th>commentsï¼ˆæ³¨è§£5ï¼‰</th></tr></thead><tbody><tr><td>attributes</td><td></td><td>ç”Ÿæˆçš„æ–‡ä»¶æˆ–ç›®å½•åº”è¯¥å…·æœ‰çš„å±æ€§ã€‚ è¦è·å¾—æ”¯æŒçš„æ ‡å¿—ï¼Œè¯·æŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿä¸Šchatrçš„æ‰‹å†Œé¡µã€‚ è¿™ä¸ªå­—ç¬¦ä¸²åº”è¯¥åŒ…å«ä¸lsattræ˜¾ç¤ºçš„ç›¸åŒé¡ºåºçš„å±æ€§ã€‚<br>=æ“ä½œç¬¦è¢«å‡å®šä¸ºé»˜è®¤å€¼ï¼Œå¦åˆ™éœ€è¦åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å«+æˆ–-æ“ä½œç¬¦</td></tr><tr><td>backup</td><td>yes or noï¼Œé»˜è®¤no</td><td>åˆ›å»ºä¸€ä¸ªåŒ…å«æ—¶é—´æˆ³ä¿¡æ¯çš„å¤‡ä»½æ–‡ä»¶ï¼Œè¿™æ ·ï¼Œå¦‚æœæ‚¨ä»¥æŸç§æ–¹å¼é”™è¯¯åœ°ä¿®æ”¹äº†å®ƒï¼Œå°±å¯ä»¥é‡æ–°è·å¾—åŸå§‹æ–‡ä»¶ã€‚</td></tr><tr><td>checksum</td><td></td><td>æ­£åœ¨ä¼ è¾“çš„æ–‡ä»¶çš„SHA1æ ¡éªŒå’Œç”¨äºéªŒè¯æ–‡ä»¶çš„å¤åˆ¶æ˜¯å¦æˆåŠŸã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œansibleå°†ä½¿ç”¨srcæ–‡ä»¶çš„æœ¬åœ°è®¡ç®—çš„æ ¡éªŒå’Œã€‚</td></tr><tr><td>content</td><td></td><td>å½“ä»£æ›¿srcä½¿ç”¨æ—¶ï¼Œå°†æ–‡ä»¶çš„å†…å®¹ç›´æ¥è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚åªæœ‰å½“destæ˜¯ä¸€ä¸ªæ–‡ä»¶æ—¶æ‰æœ‰æ•ˆã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºè¯¥æ–‡ä»¶ã€‚å¯¹äºé«˜çº§æ ¼å¼åŒ–æˆ–å†…å®¹åŒ…å«å˜é‡ï¼Œè¯·ä½¿ç”¨templateæ¨¡å—ã€‚</td></tr><tr><td>decrypt</td><td>yes or noï¼Œé»˜è®¤no</td><td>æ­¤é€‰é¡¹æ§åˆ¶ä½¿ç”¨ä¿é™©åº“å¯¹æºæ–‡ä»¶è¿›è¡Œè‡ªåŠ¨è§£å¯†ã€‚</td></tr><tr><td>dest</td><td></td><td>æ–‡ä»¶åº”è¯¥å¤åˆ¶åˆ°çš„è¿œç¨‹ç»å¯¹è·¯å¾„ã€‚1ã€å¦‚æœ<code>src</code>æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªç›®å½•ã€‚2ã€å¦‚æœ<code>dest</code>æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼Œå¹¶ä¸”<code>dest</code>ä»¥"/"ç»“å°¾æˆ–è€…<code>src</code>æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™åˆ›å»º<code>dest</code>ã€‚3ã€å¦‚æœ<code>dest</code>æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™å¯åŠ¨ç›®å½•ç”±è¿œç¨‹ä¸»æœºå†³å®šã€‚4ã€å¦‚æœ<code>src</code>å’Œ<code>dest</code>æ˜¯æ–‡ä»¶ï¼Œåˆ™ä¸ä¼šåˆ›å»º<code>dest</code>çš„çˆ¶ç›®å½•ï¼Œå¦‚æœçˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä»»åŠ¡å¤±è´¥ã€‚</td></tr><tr><td>directory_mode</td><td></td><td>åœ¨è¿›è¡Œé€’å½’å¤åˆ¶æ—¶ï¼Œè®¾ç½®ç›®å½•çš„æ¨¡å¼ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤å€¼ã€‚è¯¥æ¨¡å¼åªå¯¹æ–°åˆ›å»ºçš„ç›®å½•è¿›è¡Œè®¾ç½®ï¼Œå¯¹å·²ç»å­˜åœ¨çš„ç›®å½•ä¸äº§ç”Ÿå½±å“ã€‚</td></tr><tr><td>follow</td><td>yes or noï¼Œé»˜è®¤no</td><td>è¿™ä¸ªæ ‡å¿—æŒ‡ç¤ºç›®æ ‡ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé“¾æ¥(å¦‚æœå­˜åœ¨çš„è¯)åº”è¯¥è¢«è·Ÿéšã€‚</td></tr><tr><td>force</td><td>yes or noï¼Œé»˜è®¤yes</td><td>æ˜¯å¦è¦æ›¿æ¢è¿œç¨‹æ–‡ä»¶ã€‚å¦‚æœæ˜¯ï¼Œå½“è¿œç¨‹æ–‡ä»¶çš„å†…å®¹ä¸æºæ–‡ä»¶ä¸ä¸€è‡´æ—¶ï¼Œè¿œç¨‹æ–‡ä»¶å°†è¢«æ›¿æ¢ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åªæœ‰åœ¨ç›®æ ‡ä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰ä¼šä¼ è¾“æ–‡ä»¶ã€‚</td></tr><tr><td>group</td><td></td><td>åº”è¯¥æ‹¥æœ‰è¯¥æ–‡ä»¶/ç›®å½•çš„ç»„çš„åç§°ï¼Œè¿™å°†æä¾›ç»™chownã€‚</td></tr><tr><td>local_follow</td><td>yes or noï¼Œé»˜è®¤yes</td><td>è¿™ä¸ªæ ‡å¿—æŒ‡ç¤ºæºæ ‘ä¸­çš„æ–‡ä»¶ç³»ç»Ÿé“¾æ¥(å¦‚æœå­˜åœ¨çš„è¯)åº”è¯¥è¢«è·Ÿéšã€‚</td></tr><tr><td>mode</td><td></td><td>ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚å¯¹äºé‚£äº›ä¹ æƒ¯ä½¿ç”¨/usr/bin/chmodçš„äººï¼Œè¯·è®°ä½æ¨¡å¼å®é™…ä¸Šæ˜¯å…«è¿›åˆ¶æ•°å­—ã€‚ä½ å¿…é¡»æ·»åŠ ä¸€ä¸ªå‰å¯¼é›¶ï¼Œä»¥ä¾¿Ansibleçš„YAMLè§£æå™¨çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°å­—(å¦‚0644æˆ–01777)æˆ–å¼•ç”¨å®ƒ(å¦‚â€™644â€™æˆ–â€™1777â€™)ï¼Œä»¥ä¾¿Ansibleæ¥æ”¶åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å¯ä»¥è¿›è¡Œè‡ªå·±çš„è½¬æ¢ï¼Œä»å­—ç¬¦ä¸²åˆ°æ•°å­—ã€‚ç»™Ansibleä¸€ä¸ªå·ç ,éµå¾ªè¿™äº›è§„åˆ™ä¸­çš„ä¸€ä¸ªå°†ä¼šå¾—åˆ°ä¸€ä¸ªå°æ•°ï¼Œè¿™å°†ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚åœ¨Ansible 1.8ä¸­ï¼Œæ¨¡å¼å¯ä»¥è¢«æŒ‡å®šä¸ºç¬¦å·æ¨¡å¼(ä¾‹å¦‚ï¼Œu+rwxæˆ–u=rw,g=r,o=r)ã€‚åœ¨Ansible 2.3ä¸­ï¼Œæ¨¡å¼ä¹Ÿå¯ä»¥æ˜¯ç‰¹æ®Šçš„å­—ç¬¦ä¸²ä¿å­˜ã€‚<code>preserver</code>æ„å‘³ç€æ–‡ä»¶å°†è¢«èµ‹äºˆä¸æºæ–‡ä»¶ç›¸åŒçš„æƒé™ã€‚</td></tr><tr><td>owner</td><td></td><td>åº”è¯¥æ‹¥æœ‰æ–‡ä»¶/ç›®å½•çš„ç”¨æˆ·åï¼Œè¿™å°†è¢«æä¾›ç»™chownã€‚</td></tr><tr><td>remote_src</td><td>yes or noï¼Œé»˜è®¤no</td><td>å½±å“<code>src</code>æ˜¯å¦éœ€è¦è½¬ç§»æˆ–å·²ç»è¿œç¨‹å­˜åœ¨ã€‚å¦‚æœ<code>no</code>ï¼Œå®ƒå°†åœ¨åŸå§‹/ä¸»æœºä¸Šæœç´¢<code>src</code>ã€‚å¦‚æœ<code>yes</code>ï¼Œå®ƒå°†è½¬åˆ°<code>src</code>çš„è¿œç¨‹/ç›®æ ‡è®¡ç®—æœºã€‚ä»2.8ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>Remote_src</code>æ”¯æŒé€’å½’å¤åˆ¶ã€‚<code>Remote_src</code>åªé€‚ç”¨äº<code>mode=preserve</code>ç‰ˆæœ¬2.6ã€‚</td></tr><tr><td>selevel</td><td>é»˜è®¤0</td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„çº§åˆ«éƒ¨åˆ†ã€‚è¿™å°±æ˜¯MLS/MCSå±æ€§ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º<code>range</code>ã€‚å½“è®¾ç½®ä¸ºdefaultæ—¶ï¼Œå¦‚æœå¯ç”¨ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>level</code>éƒ¨åˆ†ã€‚</td></tr><tr><td>serole</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„è§’è‰²éƒ¨åˆ†ã€‚å½“è®¾ç½®ä¸º_defaultæ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>role</code>éƒ¨åˆ†(å¦‚æœå¯ç”¨çš„è¯)ã€‚</td></tr><tr><td>setype</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„<code>type</code>éƒ¨åˆ†ã€‚å½“è®¾ç½®ä¸º_defaultæ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„ç±»å‹éƒ¨åˆ†(å¦‚æœå¯ç”¨çš„è¯)ã€‚</td></tr><tr><td>seuser</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„ç”¨æˆ·éƒ¨åˆ†ã€‚<code>default</code>æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ç³»ç»Ÿç­–ç•¥ã€‚å½“è®¾ç½®ä¸º_defaultæ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„ç”¨æˆ·éƒ¨åˆ†(å¦‚æœå¯ç”¨)ã€‚</td></tr><tr><td>src</td><td></td><td>è¦å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶çš„æœ¬åœ°è·¯å¾„ã€‚è¿™å¯ä»¥æ˜¯ç»å¯¹çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹çš„ã€‚å¦‚æœpathæ˜¯ç›®å½•ï¼Œåˆ™é€’å½’å¤åˆ¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœpathä»¥â€œ/â€ç»“å°¾ï¼Œåˆ™åªå°†è¯¥ç›®å½•ä¸­çš„å†…å®¹å¤åˆ¶åˆ°ç›®çš„åœ°ã€‚å¦åˆ™ï¼Œå¦‚æœå®ƒä¸æ˜¯ä»¥â€œ/â€ç»“å°¾ï¼Œåˆ™å¤åˆ¶åŒ…å«æ‰€æœ‰å†…å®¹çš„ç›®å½•æœ¬èº«ã€‚è¿™ç§è¡Œä¸ºç±»ä¼¼äºrsyncå‘½ä»¤è¡Œå·¥å…·ã€‚</td></tr><tr><td>unsafe_writes</td><td>yes or noï¼Œé»˜è®¤no</td><td>å½±å“ä½•æ—¶ä½¿ç”¨åŸå­æ“ä½œæ¥é˜²æ­¢æ•°æ®æŸåæˆ–ä»ç›®æ ‡æ–‡ä»¶è¿›è¡Œä¸ä¸€è‡´çš„è¯»å–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—ä½¿ç”¨åŸå­æ“ä½œæ¥é˜²æ­¢æ•°æ®æŸåæˆ–ä¸ä¸€è‡´åœ°è¯»å–ç›®æ ‡æ–‡ä»¶ï¼Œä½†æœ‰æ—¶ç³»ç»Ÿé…ç½®æˆ–ç ´åçš„æ–¹å¼ä¼šé˜²æ­¢è¿™ç§æƒ…å†µã€‚ä¸€ä¸ªä¾‹å­æ˜¯dockeræŒ‚è½½çš„æ–‡ä»¶ï¼Œå®ƒä¸èƒ½ä»å®¹å™¨å†…éƒ¨åŸå­åœ°æ›´æ–°ï¼Œåªèƒ½ä»¥ä¸å®‰å…¨çš„æ–¹å¼å†™å…¥ã€‚å½“ä»»åŠ¡æ“ä½œå¤±è´¥æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹å…è®¸Ansibleé€€å›åˆ°ä¸å®‰å…¨çš„æ–¹æ³•æ¥æ›´æ–°æ–‡ä»¶(ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå¼ºè¿«Ansibleæ‰§è¡Œä¸å®‰å…¨çš„å†™æ“ä½œ)ã€‚<br>é‡è¦!ä¸å®‰å…¨çš„å†™æ“ä½œä¼šå—åˆ°ç«äº‰æ¡ä»¶çš„å½±å“ï¼Œå¹¶å¯èƒ½å¯¼è‡´æ•°æ®æŸåã€‚</td></tr><tr><td>validate</td><td></td><td>å¤åˆ¶åˆ°é€‚å½“ä½ç½®ä¹‹å‰è¦è¿è¡Œçš„éªŒè¯å‘½ä»¤ã€‚è¦éªŒè¯çš„æ–‡ä»¶è·¯å¾„æ˜¯é€šè¿‡â€™%sâ€™ä¼ å…¥çš„ï¼Œå®ƒå¿…é¡»å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚è¯¥å‘½ä»¤æ˜¯å®‰å…¨ä¼ é€’çš„ï¼Œå› æ­¤åƒæ‰©å±•å’Œç®¡é“è¿™æ ·çš„shellåŠŸèƒ½å°†ä¸èµ·ä½œç”¨</td></tr></tbody></table><p><strong>å¤åˆ¶æ–‡ä»¶æ—¶å€™åº”è¯¥æ³¨æ„<code>/</code></strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿œç¨‹æ‹·è´/opt/ä¸‹çš„æ‰€æœ‰å†…å®¹åˆ°ç›®æ ‡æœºå™¨</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m copy -a &quot;src=/opt/ dest=/tmp/&quot;</span></span><br><span class="line"><span class="comment">#è¿œç¨‹æ‹·è´/opt  æ•´ä¸ªç›®å½•åˆ°ç›®æ ‡æœºå™¨</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m copy -a &quot;src=/opt  dest=/tmp/&quot;</span></span><br></pre></td></tr></table></figure><h2 id="5-file-æ–‡ä»¶æ“ä½œæ¨¡å—">.5 file æ–‡ä»¶æ“ä½œæ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v3">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module">https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module</a></p><h3 id="ğŸ“–æ¦‚è¦">ğŸ“–æ¦‚è¦</h3><ul><li>è®¾ç½®æ–‡ä»¶ã€ç¬¦å·é“¾æ¥æˆ–ç›®å½•çš„å±æ€§ã€‚</li><li>æˆ–è€…ï¼Œåˆ é™¤æ–‡ä»¶ã€ç¬¦å·é“¾æ¥æˆ–ç›®å½•ã€‚</li><li>è®¸å¤šå…¶ä»–æ¨¡å—æ”¯æŒä¸è¯¥æ¨¡å—ç›¸åŒçš„é€‰é¡¹<code>file</code>- åŒ…æ‹¬å¤åˆ¶ã€æ¨¡æ¿å’Œç»„è£…ã€‚</li><li>å¯¹äº Windows ç›®æ ‡ï¼Œè¯·æ”¹ç”¨win_fileæ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–å‚æ•°">ğŸ“–å‚æ•°</h3><table><thead><tr><th>parametersï¼ˆå‚æ•°ï¼‰</th><th>choices/defaultsï¼ˆé€‰é¡¹ï¼‰</th><th>commentsï¼ˆæ³¨é‡Šï¼‰</th></tr></thead><tbody><tr><td>access_time</td><td></td><td>è¯¥å‚æ•°è¡¨ç¤ºåº”è¯¥è®¾ç½®æ–‡ä»¶è®¿é—®æ—¶é—´çš„æ—¶é—´ã€‚åº”è¯¥åœ¨ä¸éœ€è¦ä¿®æ”¹æ—¶ä¿ç•™ï¼Œ<code>YYYYMMDDHHMM.SS</code>æ—¶ä½¿ç”¨é»˜è®¤çš„æ—¶é—´æ ¼å¼ï¼Œæˆ–<code>now</code>ã€‚é»˜è®¤ä¸º<code>None</code>ï¼Œè¿™æ„å‘³ç€ä¿å­˜æ˜¯<code>state=[file,directory,link,hard]</code>çš„é»˜è®¤å€¼ï¼Œç°åœ¨æ˜¯<code>state=touch</code>çš„é»˜è®¤å€¼ã€‚</td></tr><tr><td>access_time_format</td><td>é»˜è®¤ <code>"%Y%m%d%H%M.%S"</code></td><td>å½“ä¸<code>access_time</code>ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºå¿…é¡»ä½¿ç”¨çš„æ—¶é—´æ ¼å¼ã€‚</td></tr><tr><td>attributes</td><td></td><td>ç”Ÿæˆçš„æ–‡ä»¶æˆ–ç›®å½•åº”è¯¥å…·æœ‰çš„å±æ€§ã€‚è¦è·å¾—æ”¯æŒçš„æ ‡å¿—ï¼Œè¯·æŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿä¸Šchatrçš„æ‰‹å†Œé¡µã€‚è¿™ä¸ªå­—ç¬¦ä¸²åº”è¯¥åŒ…å«ä¸lsattræ˜¾ç¤ºçš„ç›¸åŒé¡ºåºçš„å±æ€§ã€‚<code>=</code>æ“ä½œç¬¦è¢«å‡å®šä¸ºé»˜è®¤å€¼ï¼Œå¦åˆ™éœ€è¦åœ¨å­—ç¬¦ä¸²ä¸­åŒ…å«<code>+</code>æˆ–<code>-</code>æ“ä½œç¬¦ã€‚</td></tr><tr><td>follow</td><td>yes or noï¼Œé»˜è®¤yes</td><td>è¿™ä¸ªæ ‡å¿—æŒ‡ç¤ºæ–‡ä»¶ç³»ç»Ÿé“¾æ¥(å¦‚æœå­˜åœ¨çš„è¯)åº”è¯¥è¢«è·Ÿéšã€‚</td></tr><tr><td>force</td><td>yes or noï¼Œé»˜è®¤no</td><td>å¼ºåˆ¶åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹åˆ›å»ºç¬¦å·é“¾æ¥:æºæ–‡ä»¶ä¸å­˜åœ¨(ä½†ç¨åä¼šå‡ºç°);ç›®çš„åœ°å·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶(å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å–æ¶ˆ<code>path</code>æ–‡ä»¶çš„é“¾æ¥ï¼Œå¹¶åˆ›å»ºåˆ°<code>src</code>æ–‡ä»¶çš„ç¬¦å·é“¾æ¥æ¥ä»£æ›¿å®ƒ)ã€‚</td></tr><tr><td>group</td><td></td><td>åº”è¯¥æ‹¥æœ‰è¯¥æ–‡ä»¶/ç›®å½•çš„ç»„çš„åç§°ï¼Œè¿™å°†æä¾›ç»™chownã€‚</td></tr><tr><td>mode</td><td></td><td>ç”Ÿæˆçš„æ–‡ä»¶æˆ–ç›®å½•åº”æœ‰çš„æƒé™ã€‚å¯¹äºé‚£äº›ä¹ æƒ¯ä½¿ç”¨/usr/bin/chmodçš„äººï¼Œè¯·è®°ä½æ¨¡å¼å®é™…ä¸Šæ˜¯å…«è¿›åˆ¶æ•°å­—ã€‚ä½ å¿…é¡»æ·»åŠ ä¸€ä¸ªå‰å¯¼é›¶ï¼Œä»¥ä¾¿Ansibleçš„YAMLè§£æå™¨çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªå…«è¿›åˆ¶æ•°å­—(å¦‚0644æˆ–01777)æˆ–å¼•ç”¨å®ƒ(å¦‚â€™644â€™æˆ–â€™1777â€™)ï¼Œä»¥ä¾¿Ansibleæ¥æ”¶åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å¯ä»¥è¿›è¡Œè‡ªå·±çš„è½¬æ¢ï¼Œä»å­—ç¬¦ä¸²åˆ°æ•°å­—ã€‚ç»™Ansibleä¸€ä¸ªæ•°å­—ï¼Œè€Œä¸éµå¾ªè¿™äº›è§„åˆ™ä¹‹ä¸€ï¼Œå°†ç»“æŸä¸ä¸€ä¸ªåè¿›åˆ¶æ•°å­—ï¼Œè¿™å°†æœ‰æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚åœ¨Ansible 1.8ä¸­ï¼Œæ¨¡å¼å¯ä»¥è¢«æŒ‡å®šä¸ºç¬¦å·æ¨¡å¼(ä¾‹å¦‚ï¼Œu+rwxæˆ–u=rw,g=r,o=r)ã€‚</td></tr><tr><td>modification_time</td><td></td><td>è¯¥å‚æ•°è¡¨ç¤ºè®¾ç½®æ–‡ä»¶ä¿®æ”¹æ—¶é—´çš„æ—¶é—´ã€‚åº”è¯¥åœ¨ä¸éœ€è¦ä¿®æ”¹æ—¶ä¿ç•™ï¼Œ<code>YYYYMMDDHHMM.SS</code>æ—¶ä½¿ç”¨é»˜è®¤çš„æ—¶é—´æ ¼å¼ï¼Œæˆ–<code>now</code>ã€‚é»˜è®¤ä¸º<code>None</code>ï¼Œè¿™æ„å‘³ç€ä¿å­˜æ˜¯<code>state=[file,directory,link,hard]</code>çš„é»˜è®¤å€¼ï¼Œç°åœ¨æ˜¯<code>state=touch</code>çš„é»˜è®¤å€¼ã€‚</td></tr><tr><td>modification_time_format</td><td>é»˜è®¤ <code>"%Y%m%d%H%M.%S"</code></td><td>ä¸â€œmodification_timeâ€ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¡¨ç¤ºå¿…é¡»ä½¿ç”¨çš„æ—¶é—´æ ¼å¼ã€‚</td></tr><tr><td>owner</td><td></td><td>åº”è¯¥æ‹¥æœ‰æ–‡ä»¶/ç›®å½•çš„ç”¨æˆ·åï¼Œè¿™å°†è¢«æä¾›ç»™chownã€‚</td></tr><tr><td>path</td><td></td><td>è¢«ç®¡ç†æ–‡ä»¶çš„è·¯å¾„ã€‚</td></tr><tr><td>resource</td><td>yes or noï¼Œé»˜è®¤no</td><td>é€’å½’åœ°å¯¹ç›®å½•å†…å®¹è®¾ç½®æŒ‡å®šçš„æ–‡ä»¶å±æ€§ã€‚è¿™åªé€‚ç”¨äºå°†<code>state</code>è®¾ç½®ä¸º<code>directory</code>çš„æƒ…å†µã€‚</td></tr><tr><td>selevel</td><td>é»˜è®¤â€œs0â€</td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„çº§åˆ«éƒ¨åˆ†ã€‚è¿™å°±æ˜¯MLS/MCSå±æ€§ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºèŒƒå›´ã€‚å½“è®¾ç½®ä¸º<code>_default</code>æ—¶ï¼Œå¦‚æœå¯ç”¨ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>level</code>éƒ¨åˆ†ã€‚</td></tr><tr><td>serole</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„è§’è‰²éƒ¨åˆ†ã€‚å½“è®¾ç½®ä¸º<code>_default</code>æ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>role</code>éƒ¨åˆ†(å¦‚æœå¯ç”¨çš„è¯)ã€‚</td></tr><tr><td>setype</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„ç±»å‹éƒ¨åˆ†ã€‚å½“è®¾ç½®ä¸º<code>_default</code>æ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>type</code>éƒ¨åˆ†(å¦‚æœå¯ç”¨çš„è¯)ã€‚</td></tr><tr><td>seuser</td><td></td><td>SELinuxæ–‡ä»¶ä¸Šä¸‹æ–‡çš„ç”¨æˆ·éƒ¨åˆ†ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹å®ƒä½¿ç”¨ç³»ç»Ÿç­–ç•¥ï¼Œå½“è®¾ç½®ä¸º<code>_default</code>æ—¶ï¼Œå®ƒå°†ä½¿ç”¨ç­–ç•¥çš„<code>user</code>éƒ¨åˆ†(å¦‚æœå¯ç”¨)ã€‚</td></tr><tr><td>src</td><td></td><td>è¦é“¾æ¥çš„æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™åªé€‚ç”¨äº<code>state=link</code>å’Œ<code>state=hard</code>ã€‚å¯¹äº<code>state=link</code>ï¼Œè¿™ä¹Ÿå°†æ¥å—ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºæ­£åœ¨åˆ›å»ºçš„æ–‡ä»¶(path)çš„ï¼Œè¿™æ˜¯Unixå‘½ä»¤<code>ln -s SRC DEST</code>å¤„ç†ç›¸å¯¹è·¯å¾„çš„æ–¹å¼ã€‚</td></tr><tr><td>state</td><td>absent or directory or file or hard or link or touch</td><td>1ã€å¦‚æœ<code>absent</code>ï¼Œç›®å½•å°†è¢«é€’å½’åˆ é™¤ï¼Œæ–‡ä»¶æˆ–ç¬¦å·é“¾æ¥å°†è¢«è§£é™¤é“¾æ¥ã€‚å¯¹äºç›®å½•ï¼Œå¦‚æœå£°æ˜äº†<code>diff</code>ï¼Œæ‚¨å°†çœ‹åˆ°åˆ—å‡ºåœ¨<code>path_contents</code>ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¢«åˆ é™¤ã€‚æ³¨æ„ï¼Œå¦‚æœ<code>path</code>ä¸å­˜åœ¨ï¼Œç¼ºå¸­ä¸ä¼šå¯¼è‡´æ–‡ä»¶å¤±è´¥ï¼Œå› ä¸ºçŠ¶æ€æ²¡æœ‰æ”¹å˜ã€‚2ã€å¦‚æœä¸­é—´<code>directory</code>ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ‰€æœ‰ä¸­é—´å­ç›®å½•ã€‚å› ä¸ºAnsible 1.7ï¼Œä»–ä»¬å°†è¢«åˆ›å»ºä¸æä¾›çš„æƒé™ã€‚3ã€å¦‚æœ<code>file</code>ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–é€‰é¡¹ï¼Œè¿™ä¸»è¦ä½œä¸ºä¸€ä¸ªâ€œç»Ÿè®¡â€ï¼Œå¹¶å°†è¿”å›è·¯å¾„çš„å½“å‰çŠ¶æ€ã€‚å³ä½¿æœ‰å…¶ä»–é€‰é¡¹(å³æ¨¡å¼)ï¼Œæ–‡ä»¶å°†è¢«ä¿®æ”¹ï¼Œä½†ä¸ä¼šåˆ›å»ºå¦‚æœå®ƒä¸å­˜åœ¨;å¦‚æœä½ æƒ³è¦é‚£ä¸ªè¡Œä¸ºï¼Œå¯ä»¥æŸ¥çœ‹è§¦æ‘¸å€¼æˆ–å¤åˆ¶æˆ–æ¨¡æ¿æ¨¡å—ã€‚4ã€å¦‚æœæ˜¯<code>hard</code>ï¼Œåˆ™ä¼šåˆ›å»ºæˆ–æ›´æ”¹ç¡¬é“¾æ¥ã€‚5ã€å¦‚æœ<code>link</code>ï¼Œç¬¦å·é“¾æ¥å°†è¢«åˆ›å»ºæˆ–æ›´æ”¹ã€‚6ã€å¦‚æœ<code>touch</code>(1.4ä¸­çš„æ–°åŠŸèƒ½)ï¼Œå¦‚æœ<code>path</code>ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œè€Œç°æœ‰çš„æ–‡ä»¶æˆ–ç›®å½•å°†æ¥æ”¶æ›´æ–°çš„æ–‡ä»¶è®¿é—®å’Œä¿®æ”¹æ—¶é—´(ç±»ä¼¼äº<code>touch</code>ä»å‘½ä»¤è¡Œå·¥ä½œçš„æ–¹å¼)ã€‚</td></tr><tr><td>unsafe_writes</td><td>yes or noï¼Œé»˜è®¤no</td><td>å½±å“ä½•æ—¶ä½¿ç”¨åŸå­æ“ä½œæ¥é˜²æ­¢æ•°æ®æŸåæˆ–ä»ç›®æ ‡æ–‡ä»¶è¿›è¡Œä¸ä¸€è‡´çš„è¯»å–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—ä½¿ç”¨åŸå­æ“ä½œæ¥é˜²æ­¢æ•°æ®æŸåæˆ–ä¸ä¸€è‡´åœ°è¯»å–ç›®æ ‡æ–‡ä»¶ï¼Œä½†æœ‰æ—¶ç³»ç»Ÿé…ç½®æˆ–ç ´åçš„æ–¹å¼ä¼šé˜²æ­¢è¿™ç§æƒ…å†µã€‚ä¸€ä¸ªä¾‹å­æ˜¯dockeræŒ‚è½½çš„æ–‡ä»¶ï¼Œå®ƒä¸èƒ½ä»å®¹å™¨å†…éƒ¨åŸå­åœ°æ›´æ–°ï¼Œåªèƒ½ä»¥ä¸å®‰å…¨çš„æ–¹å¼å†™å…¥ã€‚å½“åŸå­æ“ä½œå¤±è´¥æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹å…è®¸Ansibleé€€å›åˆ°ä¸å®‰å…¨çš„æ–¹æ³•æ¥æ›´æ–°æ–‡ä»¶(ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå¼ºè¿«Ansibleæ‰§è¡Œä¸å®‰å…¨çš„å†™æ“ä½œ)ã€‚é‡è¦!ä¸å®‰å…¨çš„å†™æ“ä½œä¼šå—åˆ°ç«äº‰æ¡ä»¶çš„å½±å“ï¼Œå¹¶å¯èƒ½å¯¼è‡´æ•°æ®æŸå</td></tr></tbody></table><p>ä¸copyåŒºåˆ«å¼€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">copy src(ç®¡ç†æœºå™¨ä¸Š)  dest(ç›®æ ‡æœºå™¨ä¸Š)</span><br><span class="line"><span class="comment">#fileä¸“é—¨ç”¨äºåœ¨è¿œç¨‹æœºå™¨ä¸Šï¼Œå…³äºæ–‡ä»¶çš„æ“ä½œ</span></span><br><span class="line">file src(ç›®æ ‡æœºå™¨ä¸Šçš„æ–‡ä»¶)  dest(ç›®æ ‡æœºå™¨ä¸Šçš„æ–‡ä»¶)</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶">ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶</h3><p>stateå‚æ•°ï¼Œpathå‚æ•°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿œç¨‹åœ¨webæœåŠ¡å™¨ç»„ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡æœ¬ï¼Œ  hello_ansible.log</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello_ansible.log state=touch&quot;</span></span><br><span class="line"><span class="comment">#åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello_ansible state=directory&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œåˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™">ğŸ“Œåˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello-linux.log state=touch owner=www group=www&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§">ğŸ“Œè¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/hello-linux.log owner=www group=www mode=666&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œåˆ›è½¯è¿æ¥æ–‡ä»¶">ğŸ“Œåˆ›è½¯è¿æ¥æ–‡ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;src=/etc/hosts dest=/opt/hosts state=link&quot;</span></span><br><span class="line"><span class="comment">#å¼ºåˆ¶æ€§åˆ›å»ºæ–‡ä»¶ï¼ˆè½¯è¿æ¥ï¼‰</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;src=/etc/hostsss  dest=/opt/hosts state=link  force=yes &quot;</span></span><br></pre></td></tr></table></figure><h2 id="6-scriptè„šæœ¬æ¨¡å—">.6 scriptè„šæœ¬æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v4">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/script_module.html#ansible-collections-ansible-builtin-script-module</a></p><h3 id="ğŸ“–-æ¦‚è¦-v5">ğŸ“– æ¦‚è¦</h3><ul><li>è¯¥scriptæ¨¡å—é‡‡ç”¨è„šæœ¬åç§°ï¼Œåè·Ÿä»¥ç©ºæ ¼åˆ†éš”çš„å‚æ•°åˆ—è¡¨ã€‚</li><li>éœ€è¦è‡ªç”±æ ¼å¼çš„å‘½ä»¤æˆ–cmdå‚æ•°ï¼Œè¯·å‚è§ç¤ºä¾‹ã€‚</li><li>path çš„æœ¬åœ°è„šæœ¬å°†è¢«ä¼ è¾“åˆ°è¿œç¨‹èŠ‚ç‚¹ç„¶åæ‰§è¡Œã€‚</li><li>ç»™å®šçš„è„šæœ¬å°†é€šè¿‡è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„ shell ç¯å¢ƒè¿›è¡Œå¤„ç†ã€‚</li><li>è¿™ä¸ªæ¨¡å—åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šä¸éœ€è¦ pythonï¼Œå¾ˆåƒrawæ¨¡å—ã€‚</li><li>Windows ç›®æ ‡ä¹Ÿæ”¯æŒæ­¤æ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v5">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameterï¼ˆå‚æ•°ï¼‰</th><th>choices/defualtsï¼ˆé€‰é¡¹ï¼‰</th><th>commentsï¼ˆæ³¨è§£ï¼‰</th></tr></thead><tbody><tr><td>chdir</td><td></td><td>åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰ï¼Œåœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šåˆ‡æ¢åˆ°è¿™ä¸ªç›®å½•ã€‚</td></tr><tr><td>cmd</td><td></td><td>è¦è¿è¡Œçš„æœ¬åœ°è„šæœ¬çš„è·¯å¾„ï¼Œåè·Ÿå¯é€‰å‚æ•°ã€‚</td></tr><tr><td>creates</td><td></td><td>è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶åï¼Œå¦‚æœå®ƒå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿è¡Œæ­¤æ­¥éª¤ã€‚</td></tr><tr><td>decrypt</td><td>yes or noï¼Œé»˜è®¤yes</td><td>æ­¤é€‰é¡¹æ§åˆ¶ä½¿ç”¨ä¿é™©åº“å¯¹æºæ–‡ä»¶è¿›è¡Œè‡ªåŠ¨è§£å¯†ã€‚</td></tr><tr><td>executable</td><td></td><td>ç”¨äºè°ƒç”¨è„šæœ¬çš„å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°æˆ–è·¯å¾„ã€‚</td></tr><tr><td>free_form</td><td></td><td>æœ¬åœ°è„šæœ¬æ–‡ä»¶çš„è·¯å¾„ï¼Œåè·Ÿå¯é€‰å‚æ•°ã€‚</td></tr><tr><td>removes</td><td></td><td>è¿œç¨‹èŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶åï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šè¿è¡Œæ­¤æ­¥éª¤ã€‚</td></tr></tbody></table><h3 id="ğŸ“Œè¿œç¨‹æ‰§è¡Œè„šæœ¬">ğŸ“Œè¿œç¨‹æ‰§è¡Œè„šæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.ç®¡ç†æœºåˆ›å»ºæµ‹è¯•è„šæœ¬</span><br><span class="line"> </span><br><span class="line">master-61åˆ›å»ºè¯¥è„šæœ¬</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat echo_server_info.sh </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(hostname -I)</span>&quot;</span> &gt;&gt; /tmp/server_info.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(uptime)</span>&quot;</span> &gt;&gt; /tmp/server_info.log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(free -m)</span>&quot;</span> &gt;&gt; /tmp/server_info.sh</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">2.æ·»åŠ æ‰§è¡Œæƒé™</span><br><span class="line">[root@master-61 ~]<span class="comment">#chmod +x echo_server_info.sh </span></span><br><span class="line"> </span><br><span class="line">3.è¿œç¨‹æ‰§è¡Œ</span><br><span class="line">å‘é€nfsæœºå™¨å»æ‰§è¡Œ</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/echo_server_info.sh&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;rc&quot;</span>: 0, </span><br><span class="line">    <span class="string">&quot;stderr&quot;</span>: <span class="string">&quot;Shared connection to 172.16.1.31 closed.\r\n&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stderr_lines&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;Shared connection to 172.16.1.31 closed.&quot;</span></span><br><span class="line">    ], </span><br><span class="line">    <span class="string">&quot;stdout&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;stdout_lines&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">4.æ£€æŸ¥ç»“æœ</span><br><span class="line">[root@nfs-31 ~]<span class="comment">#cat /tmp/server_info.log</span></span><br><span class="line">10.0.0.31 172.16.1.31 </span><br><span class="line"> 22:40:45 up  5:58,  2 <span class="built_in">users</span>,  load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œè¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬">ğŸ“Œè¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">è¿œç¨‹å®‰è£…nginxè„šæœ¬</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat install_nginx.sh </span></span><br><span class="line">yum install nginx -y</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/install_nginx.sh&quot;</span></span><br><span class="line"> </span><br><span class="line">å¸è½½nginx</span><br><span class="line">[root@master-61 ~]<span class="comment">#cat install_nginx.sh </span></span><br><span class="line"><span class="comment">#yum install nginx -y</span></span><br><span class="line">yum remove nginx -y</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m script -a &quot;/root/install_nginx.sh&quot;</span></span><br></pre></td></tr></table></figure><h2 id="7-cronå®šæ—¶ä»»åŠ¡æ¨¡å—">.7 cronå®šæ—¶ä»»åŠ¡æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v5">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module">https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module</a></p><h3 id="ğŸ“–æ¦‚è¦-v2">ğŸ“–æ¦‚è¦</h3><ul><li>ä½¿ç”¨æ­¤æ¨¡å—æ¥ç®¡ç† crontab å’Œç¯å¢ƒå˜é‡æ¡ç›®ã€‚æ­¤æ¨¡å—å…è®¸æ‚¨åˆ›å»ºç¯å¢ƒå˜é‡å’Œå‘½åçš„ crontab æ¡ç›®ã€æ›´æ–°æˆ–åˆ é™¤å®ƒä»¬ã€‚</li><li>ç®¡ç† crontab ä½œä¸šæ—¶ï¼šæ¨¡å—åŒ…å«ä¸€è¡Œï¼Œå…¶ä¸­åŒ…å«ä¸ä¼ é€’ç»™æ¨¡å—çš„â€œåç§°â€ç›¸å¯¹åº”çš„ crontab æ¡ç›®çš„æè¿°ï¼Œä¾›å°†æ¥çš„ ansible/module è°ƒç”¨ç”¨äºæŸ¥æ‰¾/æ£€æŸ¥çŠ¶æ€ã€‚â€œnameâ€å‚æ•°åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œæ›´æ”¹â€œnameâ€å€¼å°†å¯¼è‡´åˆ›å»ºä¸€ä¸ªæ–°çš„ cron ä»»åŠ¡ï¼ˆæˆ–åˆ é™¤ä¸€ä¸ªä¸åŒçš„ä»»åŠ¡ï¼‰ã€‚&quot;#Ansible: &quot;</li><li>ç®¡ç†ç¯å¢ƒå˜é‡æ—¶ï¼Œä¸æ·»åŠ æ³¨é‡Šè¡Œï¼Œä½†æ˜¯ï¼Œå½“æ¨¡å—éœ€è¦æŸ¥æ‰¾/æ£€æŸ¥çŠ¶æ€æ—¶ï¼Œå®ƒä½¿ç”¨â€œnameâ€å‚æ•°æŸ¥æ‰¾ç¯å¢ƒå˜é‡å®šä¹‰è¡Œã€‚</li><li>ä½¿ç”¨ % ç­‰ç¬¦å·æ—¶ï¼Œå¿…é¡»æ­£ç¡®è½¬ä¹‰å®ƒä»¬ã€‚</li></ul><h3 id="ğŸ“–å‚æ•°-v2">ğŸ“–å‚æ•°</h3><table><thead><tr><th>parameter(å‚æ•°)</th><th>choices/default(é€‰é¡¹)</th><th>comments(æ³¨é‡Š)</th></tr></thead><tbody><tr><td>backup</td><td>yes or noï¼Œé»˜è®¤no</td><td>å¦‚æœè®¾ç½®äº†ï¼Œè¯·åœ¨ä¿®æ”¹crontabä¹‹å‰åˆ›å»ºå¤‡ä»½ã€‚è¯¥æ¨¡å—åœ¨<code>backup_file</code>å˜é‡ä¸­è¿”å›å¤‡ä»½çš„ä½ç½®ã€‚</td></tr><tr><td>cron_file</td><td></td><td>å¦‚æœæŒ‡å®šäº†è¯¥æ–‡ä»¶ï¼Œå°†ä½¿ç”¨è¯¥æ–‡ä»¶è€Œä¸æ˜¯å•ä¸ªç”¨æˆ·çš„crontabã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†æ ¹æ®/etc/cron.dè¿›è¡Œè§£é‡Š,å¦‚æœå®ƒæ˜¯ç»å¯¹çš„ï¼Œå®ƒé€šå¸¸ä¼šæ˜¯/etc/crontabã€‚è¦ä½¿ç”¨<code>cron_file</code>å‚æ•°ï¼Œè¿˜å¿…é¡»æŒ‡å®š<code>use</code>ã€‚</td></tr><tr><td>day</td><td>é»˜è®¤"*"</td><td>ä½œä¸šåº”è¯¥è¿è¡Œçš„æœˆä»½(1-31ã€<em>ã€</em>/2ç­‰)</td></tr><tr><td>disabled</td><td>yes or noï¼Œé»˜è®¤no</td><td>æ˜¯å¦åº”è¯¥åœ¨crontabä¸­ç¦ç”¨è¯¥ä½œä¸š(æ³¨é‡Šæ‰)ã€‚åªæœ‰state=presentæ—¶æ‰æœ‰æ•ˆã€‚</td></tr><tr><td>env</td><td>yes or noï¼Œé»˜è®¤no</td><td>å¦‚æœè®¾ç½®äº†ï¼Œåˆ™ç®¡ç†crontabçš„ç¯å¢ƒå˜é‡ã€‚åœ¨crontabä¸Šæ·»åŠ äº†æ–°çš„å˜é‡ã€‚<code>Name</code>å’Œ<code>value</code>å‚æ•°æ˜¯ç¯å¢ƒå˜é‡çš„åç§°å’Œå€¼ã€‚</td></tr><tr><td>hour</td><td>é»˜è®¤"*"</td><td>ä½œä¸šåº”è¯¥è¿è¡Œçš„æ—¶é—´(0-23ã€<em>ã€</em>/2ç­‰)</td></tr><tr><td>insertafter</td><td></td><td>ä¸state=presentå’Œenvä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœæŒ‡å®šäº†ï¼Œç¯å¢ƒå˜é‡å°†è¢«æ’å…¥åˆ°æŒ‡å®šç¯å¢ƒå˜é‡çš„å£°æ˜ä¹‹åã€‚</td></tr><tr><td>insertbefore</td><td></td><td>ä¸state=presentå’Œenvä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœæŒ‡å®šäº†ï¼Œç¯å¢ƒå˜é‡å°†è¢«æ’å…¥åˆ°æŒ‡å®šç¯å¢ƒå˜é‡çš„å£°æ˜ä¹‹å‰ã€‚</td></tr><tr><td>job</td><td></td><td>æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœè®¾ç½®äº†envï¼Œåˆ™ä¸ºç¯å¢ƒå˜é‡çš„å€¼ã€‚å‘½ä»¤ä¸åº”è¯¥åŒ…å«æ¢è¡Œç¬¦ã€‚å¦‚æœéœ€è¦<code>state=present</code>ã€‚</td></tr><tr><td>minute</td><td>é»˜è®¤"*"</td><td>ä½œä¸šåº”è¯¥è¿è¡Œçš„æ—¶é—´(0-59ã€<em>ã€</em>/2ç­‰)</td></tr><tr><td>month</td><td>é»˜è®¤"*"</td><td>ä½œä¸šåº”è¯¥è¿è¡Œçš„æœˆä»½(1-12ï¼Œ<em>ï¼Œ</em>/2ï¼Œç­‰ç­‰)</td></tr><tr><td>name</td><td></td><td>crontabè¡¨é¡¹çš„æè¿°ï¼Œå¦‚æœè®¾ç½®äº†envï¼Œåˆ™æ˜¯ç¯å¢ƒå˜é‡çš„åç§°ã€‚å¦‚æœéœ€è¦<code>state=absent</code>ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®<code>name</code>å¹¶ä¸”<code>state=present</code>ï¼Œé‚£ä¹ˆæ— è®ºç°æœ‰çš„crontabæ¡ç›®æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„crontabæ¡ç›®ã€‚</td></tr><tr><td>reboot</td><td>yes or noï¼Œé»˜è®¤no</td><td>æ˜¯å¦åº”è¯¥åœ¨é‡æ–°å¯åŠ¨æ—¶è¿è¡Œä½œä¸šã€‚ä¸èµæˆä½¿ç”¨è¯¥é€‰é¡¹ã€‚ç”¨æˆ·åº”è¯¥ä½¿ç”¨<code>special_time</code>ã€‚</td></tr><tr><td>special_time</td><td>annually or daily or hourly or monthly or reboot or weekly or yearly</td><td>ç‰¹æ®Šæ—¶é—´è§„èŒƒæ˜µç§°ã€‚</td></tr><tr><td>state</td><td>absent or presentï¼Œé»˜è®¤present</td><td>æ˜¯å¦ç¡®ä¿ä½œä¸šæˆ–ç¯å¢ƒå˜é‡å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚</td></tr><tr><td>user</td><td></td><td>éœ€è¦ä¿®æ”¹crontabçš„ç”¨æˆ·ã€‚å¦‚æœä¸è®¾ç½®ï¼Œè¯¥å‚æ•°é»˜è®¤ä½¿ç”¨rootã€‚</td></tr><tr><td>weekday</td><td>é»˜è®¤"*"</td><td>ä½œä¸šåº”è¯¥è¿è¡Œçš„æ˜ŸæœŸå‡ (0-6è¡¨ç¤ºå‘¨æ—¥-å‘¨å…­ï¼Œ*ç­‰)</td></tr></tbody></table><h3 id="ğŸ“Œæ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡">ğŸ“Œæ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cronæ¨¡å—åˆ›å»ºå®šæ—¶ä»»åŠ¡</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;ntp aliyun&#x27; minute=*/5 job=&#x27;ntpdate -u ntp.aliyun.com&#x27;&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;ntp aliyun&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">æŸ¥çœ‹è¿œç¨‹æœºå™¨çš„crontabè®°å½•</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">* * * * * /usr/sbin/ntpdate time1.aliyun.com &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"> </span><br><span class="line"><span class="comment">#Ansible: ntp aliyun</span></span><br><span class="line">*/5 * * * * ntpdate -u ntp.aliyun.com</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œåˆ é™¤å®šæ—¶ä»»åŠ¡">ğŸ“Œåˆ é™¤å®šæ—¶ä»»åŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…ˆæ£€æŸ¥è¿œç¨‹çš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">* * * * * /usr/sbin/ntpdate time1.aliyun.com &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"> </span><br><span class="line"><span class="comment">#Ansible: ntp aliyun</span></span><br><span class="line">*/5 * * * * ntpdate -u ntp.aliyun.com</span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ­£ç»Ÿç”¨æ³•</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;ntp aliyun&#x27;  state=absent&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#æ­ªé—¨é‚ªé“</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -r&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡">ğŸ“Œä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m cron -a &quot;name=&#x27;12345&#x27; minute=30 hour=23 job=&#x27;echo  å¤§é¹ &gt;&gt;/tmp/hello.log&#x27;&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;envs&quot;</span>: [], </span><br><span class="line">    <span class="string">&quot;jobs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;12345&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;crontab -l&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"><span class="comment">#Ansible: 12345</span></span><br><span class="line">30 23 * * * <span class="built_in">echo</span> å¤§é¹ &gt;&gt;/tmp/hello.log</span><br></pre></td></tr></table></figure><h2 id="8-group-æ¨¡å—">.8 group æ¨¡å—</h2><p>ğŸ““<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/group_module.html#group-module">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/group_module.html#group-module</a></p><h3 id="ğŸ“Œåˆ›å»ºwenjie-opsç»„ï¼Œgid-1234">ğŸ“Œåˆ›å»ºwenjie_opsç»„ï¼Œgid=1234</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=wenjie_ops  gid=1234&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;gid&quot;</span>: 1234, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;wenjie_ops&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œåˆ é™¤ç»„">ğŸ“Œåˆ é™¤ç»„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=wenjie_ops gid=1234 state=absent&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;wenjie_ops&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;absent&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-user-ç”¨æˆ·æ¨¡å—">.9 user ç”¨æˆ·æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v6">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/user_module.html">https://docs.ansible.com/ansible/latest/modules/user_module.html</a></p><h3 id="ğŸ“–-å‚æ•°-v6">ğŸ“– å‚æ•°</h3><table><thead><tr><th>æ¨¡å—å‚æ•°</th><th>å‚æ•°æè¿°</th></tr></thead><tbody><tr><td>create_home</td><td>åˆ›å»ºå®¶ç›®å½•ï¼Œè®¾ç½®noåˆ™ä¸åˆ›å»ºå®¶ç›®å½•</td></tr><tr><td>group</td><td>åˆ›å»ºç”¨æˆ·ç»„</td></tr><tr><td>name</td><td>åˆ›å»ºç”¨æˆ·çš„åå­—</td></tr><tr><td>password</td><td>åˆ›å»ºç”¨æˆ·çš„å¯†ç </td></tr><tr><td>uid</td><td>åˆ›å»ºç”¨æˆ·çš„UID</td></tr><tr><td>shell</td><td>ç”¨æˆ·ç™»å½•è§£é‡Šå™¨</td></tr><tr><td>state</td><td>Absentï¼ˆåˆ é™¤ç”¨æˆ·ï¼‰presentï¼ˆé»˜è®¤å‚æ•°ï¼Œåˆ›å»ºï¼‰</td></tr><tr><td>expires</td><td>è´¦æˆ·è¿‡æœŸæ—¶é—´</td></tr></tbody></table><h3 id="ğŸ“Œåˆ›å»ºç”¨æˆ·">ğŸ“Œåˆ›å»ºç”¨æˆ·</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„è¯¥ç”¨æˆ·ç»„æ˜¯å¦å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">groupï¼Œnameï¼Œgid</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=cc01 gid=1777&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">åˆ›å»ºç”¨æˆ·ï¼Œè®¾ç½®æƒé™</span><br><span class="line">user  naem  uid  group  create_home  shell</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m group -a &quot;name=cc01 gid=1777&quot;</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m user -a &quot;name=cc01 uid=1777 group=1777 create_home=no shell=/sbin/nologin &quot;</span></span><br><span class="line">172.16.1.31 | CHANGED =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">    <span class="string">&quot;comment&quot;</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;create_home&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;group&quot;</span>: 1777, </span><br><span class="line">    <span class="string">&quot;home&quot;</span>: <span class="string">&quot;/home/cc01&quot;</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;cc01&quot;</span>, </span><br><span class="line">    <span class="string">&quot;shell&quot;</span>: <span class="string">&quot;/sbin/nologin&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;present&quot;</span>, </span><br><span class="line">    <span class="string">&quot;system&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;uid&quot;</span>: 1777</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">æ£€æŸ¥ç”¨æˆ·</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible nfs -m shell -a &quot;id cc01&quot;</span></span><br><span class="line">172.16.1.31 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">uid=1777(cc01) gid=1777(cc01) <span class="built_in">groups</span>=1777(cc01)</span><br></pre></td></tr></table></figure><h2 id="10-yum-å®‰è£…è½¯ä»¶">.10 yum å®‰è£…è½¯ä»¶</h2><h3 id="ğŸ““æ–‡æ¡£-v7">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html</a></p><h3 id="ğŸ“–-æ¦‚è¦-v6">ğŸ“– æ¦‚è¦</h3><ul><li>ä½¿ç”¨yumåŒ…ç®¡ç†å™¨å®‰è£…ã€å‡çº§ã€é™çº§ã€åˆ é™¤å’Œåˆ—å‡ºåŒ…å’Œç»„ã€‚</li><li>yumæ¨¡å—ä»…é€‚ç”¨äºpython2ï¼Œè‹¥ä½¿ç”¨python3åˆ™ç”¨dnfæ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v7">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameterï¼ˆå‚æ•°ï¼‰</th><th align="left">choices/<em>default</em></th><th>commentsï¼ˆæ³¨è§£ï¼‰</th></tr></thead><tbody><tr><td>allow_downgrade</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>æŒ‡å®šæŒ‡å®šçš„åŒ…å’Œç‰ˆæœ¬æ˜¯å¦å…è®¸é™çº§è¯¥åŒ…å¯èƒ½å·²ç»å®‰è£…çš„æ›´é«˜ç‰ˆæœ¬ã€‚æ³¨æ„ï¼Œè®¾ç½®allow_é™çº§=Trueä¼šä½¿æ­¤æ¨¡å—ä»¥éå¹‚ç­‰æ–¹å¼è¿è¡Œã€‚è¯¥ä»»åŠ¡æœ€ç»ˆå¯èƒ½ä¼šå¾—åˆ°ä¸€ç»„ä¸è¦å®‰è£…çš„æŒ‡å®šåŒ…çš„å®Œæ•´åˆ—è¡¨ä¸åŒ¹é…çš„åŒ…(å› ä¸ºé™çº§çš„åŒ…ä¸å…¶ä»–åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šå¯¼è‡´å¯¹å…ˆå‰äº‹åŠ¡ä¸­çš„åŒ…çš„æ›´æ”¹)ã€‚</td></tr><tr><td>autoremove</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>å¦‚æœ<code>yes</code>ï¼Œåˆ™ä»ç³»ç»Ÿä¸­åˆ é™¤æ‰€æœ‰â€œleafâ€åŒ…ï¼Œè¿™äº›åŒ…æœ€åˆæ˜¯ä½œä¸ºç”¨æˆ·å®‰è£…åŒ…çš„ä¾èµ–é¡¹å®‰è£…çš„ï¼Œä½†ä»»ä½•æ­¤ç±»åŒ…ä¸å†éœ€è¦å®ƒä»¬ã€‚åº”è¯¥å•ç‹¬ä½¿ç”¨è¿˜æ˜¯åœ¨æ²¡æœ‰çŠ¶æ€æ—¶ä½¿ç”¨<br>æ³¨æ„:è¯¥ç‰¹æ€§éœ€è¦yum &gt;= 3.4.3 (RHEL/CentOS 7+)</td></tr><tr><td>bugfix</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>å¦‚æœè®¾ç½®ä¸ºyesï¼Œå¹¶ä¸”state=latestï¼Œåˆ™åªå®‰è£…æ ‡è®°ä¸ºä¸bugä¿®å¤ç›¸å…³çš„æ›´æ–°ã€‚</td></tr><tr><td>conf_file</td><td align="left"></td><td>ç”¨äºäº‹åŠ¡çš„è¿œç¨‹yumé…ç½®æ–‡ä»¶ã€‚</td></tr><tr><td>disable_excludes</td><td align="left"></td><td>ç¦ç”¨YUMé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„æ’é™¤ã€‚<br>å¦‚æœè®¾ç½®ä¸ºallï¼Œåˆ™ç¦ç”¨æ‰€æœ‰æ’é™¤ã€‚<br>å¦‚æœè®¾ç½®ä¸ºmainï¼Œç¦ç”¨yum.confä¸­[main]ä¸­å®šä¹‰çš„æ’é™¤ã€‚<br>å¦‚æœè®¾ç½®ä¸ºrepoidï¼Œç¦ç”¨ä¸ºç»™å®šçš„repoidå®šä¹‰çš„æ’é™¤ã€‚</td></tr><tr><td>disable_gpg_check</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>æ˜¯å¦å¯¹æ­£åœ¨å®‰è£…çš„åŒ…è¿›è¡ŒGPGç­¾åæ£€æŸ¥ã€‚ä»…å½“stateä¸ºpresentæˆ–latestæ—¶æ‰ç”Ÿæ•ˆã€‚</td></tr><tr><td>disable_plugin</td><td align="left"></td><td>å®‰è£…/æ›´æ–°æ“ä½œä¸­ç¦ç”¨çš„æ’ä»¶åç§°ã€‚è¢«ç¦ç”¨çš„æ’ä»¶å°†ä¸ä¼šåœ¨äº‹åŠ¡ä¹‹å¤–æŒä¹…å­˜åœ¨ã€‚</td></tr><tr><td>disablerepo</td><td align="left"></td><td>Repoidå­˜å‚¨åº“ä»¥ç¦ç”¨å®‰è£…/æ›´æ–°æ“ä½œã€‚è¿™äº›å›è´­ä¸ä¼šåœ¨äº¤æ˜“ç»“æŸåç»§ç»­å­˜åœ¨ã€‚å½“æŒ‡å®šå¤šä¸ªå›è´­æ—¶ï¼Œç”¨â€œï¼Œâ€éš”å¼€ã€‚<br>åœ¨Ansible 2.7ä¸­ï¼Œè¿™ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œä¸æ˜¯â€œï¼Œâ€åˆ†éš”å­—ç¬¦ä¸²</td></tr><tr><td>download_dir</td><td align="left"></td><td>æŒ‡å®šå­˜å‚¨åŒ…çš„å¤‡ç”¨ç›®å½•ã€‚<br>åªæœ‰åœ¨æŒ‡å®šdownload_onlyæ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</td></tr><tr><td>download_only</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>åªä¸‹è½½ï¼Œä¸å®‰è£…ã€‚</td></tr><tr><td>enable_plugin</td><td align="left"></td><td>ç”¨äºå®‰è£…/æ›´æ–°æ“ä½œçš„æ’ä»¶åç§°ã€‚å¯ç”¨çš„æ’ä»¶å°†ä¸ä¼šåœ¨äº‹åŠ¡ä¹‹åæŒä¹…å­˜åœ¨ã€‚</td></tr><tr><td>enablerepo</td><td align="left"></td><td>Repoidå­˜å‚¨åº“ä»¥å¯ç”¨å®‰è£…/æ›´æ–°æ“ä½œã€‚è¿™äº›å›è´­ä¸ä¼šåœ¨äº¤æ˜“ç»“æŸåç»§ç»­å­˜åœ¨ã€‚å½“æŒ‡å®šå¤šä¸ªå›è´­æ—¶ï¼Œç”¨â€œï¼Œâ€éš”å¼€ã€‚<br>åœ¨Ansible 2.7ä¸­ï¼Œè¿™ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œä¸æ˜¯â€œï¼Œâ€åˆ†éš”å­—ç¬¦ä¸²</td></tr><tr><td>exclude</td><td align="left"></td><td>å½“state=presentæˆ–latestæ—¶è¦æ’é™¤çš„åŒ…å</td></tr><tr><td>install_weak_deps</td><td align="left">yes or noï¼Œé»˜è®¤yes</td><td>ä¹Ÿå°†å®‰è£…ç”±å¼±ä¾èµ–å…³ç³»é“¾æ¥çš„æ‰€æœ‰åŒ…ã€‚<br>æ³¨æ„:è¯¥ç‰¹æ€§éœ€è¦yum &gt;= 4 (RHEL/CentOS 8+)</td></tr><tr><td>installroot</td><td align="left">é»˜è®¤"/"</td><td>æŒ‡å®šä¸€ä¸ªæ›¿ä»£çš„installrootï¼Œæ‰€æœ‰çš„åŒ…éƒ½å°†ç›¸å¯¹äºå®ƒå®‰è£…ã€‚</td></tr><tr><td>list</td><td align="left"></td><td>è¦è¿è¡Œç­‰ä»·äºyum listâ€”â€”show-duplicate &lt; Package &gt;çš„åŒ…åã€‚é™¤äº†åˆ—å‡ºè½¯ä»¶åŒ…ï¼Œuseè¿˜å¯ä»¥åˆ—å‡ºä»¥ä¸‹:å·²å®‰è£…ã€æ›´æ–°ã€å¯ç”¨å’Œå›è´­ã€‚<br>ä¸nameäº’æ–¥ã€‚</td></tr><tr><td>lock_timeout</td><td align="left">é»˜è®¤30s</td><td>ç­‰å¾…yumé”å®šæ–‡ä»¶é‡Šæ”¾çš„æ—¶é—´ã€‚</td></tr><tr><td>name</td><td align="left"></td><td>å¸¦æœ‰ç‰ˆæœ¬çš„åŒ…åæˆ–åŒ…è¯´æ˜ç¬¦ï¼Œå¦‚name-1.0ã€‚ å¦‚æœæŒ‡å®šäº†ä»¥å‰çš„ç‰ˆæœ¬ï¼Œä»»åŠ¡è¿˜éœ€è¦æ‰“å¼€allow_é™çº§ã€‚æœ‰å…³é™çº§åŒ…çš„æ³¨æ„äº‹é¡¹ï¼Œè¯·å‚é˜…allow_é™çº§æ–‡æ¡£ã€‚<br>å½“ä½¿ç”¨state=latestæ—¶ï¼Œå¯ä»¥æ˜¯â€™*'ï¼Œè¿™æ„å‘³ç€è¿è¡Œyum -y updateã€‚ æ‚¨è¿˜å¯ä»¥ä¼ é€’ä¸€ä¸ªurlæˆ–ä¸€ä¸ªæœ¬åœ°è·¯å¾„åˆ°rpmæ–‡ä»¶(ä½¿ç”¨state=present)ã€‚è¦æ“ä½œå¤šä¸ªåŒ…ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”çš„åŒ…å­—ç¬¦ä¸²æˆ–(ä»2.0å¼€å§‹)åŒ…åˆ—è¡¨ã€‚</td></tr><tr><td>releasever</td><td align="left"></td><td>æŒ‡å®šå°†ä»å…¶ä¸­å®‰è£…æ‰€æœ‰åŒ…çš„æ›¿ä»£ç‰ˆæœ¬ã€‚</td></tr><tr><td>security</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>å¦‚æœè®¾ç½®ä¸ºyesï¼Œå¹¶ä¸”state=latestï¼Œåˆ™åªå®‰è£…æ ‡è®°ä¸ºå®‰å…¨ç›¸å…³çš„æ›´æ–°ã€‚</td></tr><tr><td>skip_broken</td><td align="left">yes pr noï¼Œé»˜è®¤no</td><td>è·³è¿‡ä¾èµ–å…³ç³»æŸåçš„åŒ…(devsolve)å¹¶å¯¼è‡´é—®é¢˜ã€‚</td></tr><tr><td>state</td><td align="left">absent<br>installed<br>latest<br>present<br>removed</td><td>æ˜¯å¦å®‰è£…(<code>present</code>æˆ–<code>intsalled</code>ï¼Œ<code>latest</code>)ï¼Œæˆ–åˆ é™¤(<code>absent</code>æˆ–<code>removed</code>)è½¯ä»¶åŒ…ã€‚<br><code>present</code>å’Œ<code>installed</code>å°†ç¡®ä¿å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚<br><code>latest</code>å°†æ›´æ–°æŒ‡å®šçš„åŒ…ï¼Œå¦‚æœå®ƒä¸æ˜¯æœ€æ–°çš„å¯ç”¨ç‰ˆæœ¬ã€‚<br><code>absent</code>å’Œ<code>removed</code>å°†åˆ é™¤æŒ‡å®šçš„åŒ…ã€‚<br>é»˜è®¤ä¸º<code>None</code>ï¼Œä½†æ˜¯å®é™…ä¸Šé»˜è®¤æ“ä½œæ˜¯å­˜åœ¨çš„ï¼Œé™¤éè¯¥æ¨¡å—å¯ç”¨äº†è‡ªåŠ¨åˆ é™¤é€‰é¡¹ï¼Œç„¶åæ¨æ–­ç¼ºå¸­ã€‚</td></tr><tr><td>update_cache</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>å¼ºåˆ¶yumæ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡æ–°ä¸‹è½½ã€‚ä»…å½“stateä¸ºpresentæˆ–latestæ—¶æ‰ç”Ÿæ•ˆã€‚</td></tr><tr><td>update_only</td><td align="left">yes or noï¼Œé»˜è®¤no</td><td>ä½¿ç”¨latestæ—¶ï¼Œåªæ›´æ–°å·²å®‰è£…çš„è½¯ä»¶åŒ…ã€‚è¯·å‹¿å®‰è£…è½¯ä»¶åŒ…ã€‚<br>ä½œä¸ºæ•ˆæœåªæœ‰å½“<em>state</em>æ˜¯<em>latest</em></td></tr><tr><td>use_backend</td><td align="left">auto(é»˜è®¤)<br>yum<br>yum4<br>dnf</td><td>è¿™ä¸ªæ¨¡å—æ”¯æŒyum(ä¸€å¦‚æ—¢å¾€)ï¼Œè¢«ä¸Šæ¸¸yumå¼€å‘è€…ç§°ä¸ºyum3/ yum3/ yum-deprecatedã€‚åœ¨Ansible 2.7+ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªæ¨¡å—ä¹Ÿæ”¯æŒYUM4ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œæ–°yumâ€ï¼Œå®ƒæœ‰ä¸€ä¸ªdnfåç«¯ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¨¡å—å°†åŸºäºansible_pkg_mgräº‹å®é€‰æ‹©åç«¯ã€‚</td></tr><tr><td>validate_certs</td><td align="left">yes or noï¼Œé»˜è®¤yes</td><td>è¿™åªé€‚ç”¨äºä½¿ç”¨https urlä½œä¸ºrpmçš„æºã€‚ä¾‹å¦‚localinstallã€‚å¦‚æœè®¾ç½®ä¸ºnoï¼Œå°†ä¸éªŒè¯SSLè¯ä¹¦ã€‚ åœ¨ä½¿ç”¨è‡ªç­¾åè¯ä¹¦çš„ä¸ªäººæ§åˆ¶ç½‘ç«™ä¸Šï¼Œè¿™åªåº”è¯¥è®¾ç½®ä¸ºnoï¼Œå› ä¸ºå®ƒé¿å…äº†éªŒè¯æºç½‘ç«™ã€‚<br>åœ¨2.1ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™æ®µä»£ç çš„å·¥ä½œæ–¹å¼å°±å¥½åƒè®¾ç½®ä¸ºyesä¸€æ ·ã€‚</td></tr></tbody></table><h3 id="ğŸ“Œå®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬">ğŸ“Œå®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m yum -a &quot;name=net-tools state=latest&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œå¸è½½net-roolsè½¯ä»¶">ğŸ“Œå¸è½½net-roolsè½¯ä»¶</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible backup -m yum -a &quot;name=net-tools state=absent&quot;</span></span><br></pre></td></tr></table></figure><h2 id="11-service-systemdæ¨¡å—">.11 service/systemdæ¨¡å—</h2><p>è¯¥æ¨¡å—ä½œç”¨æ˜¯é’ˆå¯¹yumåŒ…ç®¡ç†</p><p>serviceé€‚ç”¨äºcentos6å‰çš„ç³»ç»Ÿ</p><p>systemdå‘½ä»¤é€‚ç”¨äºcentos7ç³»ç»Ÿ</p><p><strong>è¦æ³¨æ„çš„æ˜¯serviceæ¨¡å—ä¾æ—§å¯¹centos7æœ‰æ•ˆï¼Œä½†æ˜¯å»ºè®®å¤§å®¶ä½¿ç”¨systemdæ¨¡å—</strong></p><h3 id="ğŸ“Œå®‰è£…ï¼Œå¯åŠ¨nginxæœåŠ¡">ğŸ“Œå®‰è£…ï¼Œå¯åŠ¨nginxæœåŠ¡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1.å®‰è£…nginxæœåŠ¡</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m yum -a &quot;name=nginx state=installed&quot;</span></span><br><span class="line"> </span><br><span class="line">2.å¯åŠ¨æœåŠ¡</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=started&quot;</span></span><br><span class="line"> </span><br><span class="line">3.æŸ¥è¯¢çŠ¶æ€ï¼Œè¿™é‡Œansibleä¸ºç›´æ¥æä¾›statuså‚æ•°ï¼Œå¯ä»¥å€ŸåŠ©<span class="built_in">command</span>æ¨¡å—å³å¯</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl status nginx&quot;</span></span><br><span class="line"> </span><br><span class="line">4.åœæ­¢nginxæœåŠ¡</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=stopped&quot;</span></span><br><span class="line"> </span><br><span class="line">5.è®¾ç½®nginxå¼€æœºè‡ªå¯</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=started enabled=yes&quot;</span></span><br><span class="line"> </span><br><span class="line">6.æ£€æŸ¥nginxçŠ¶æ€</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl is-enabled nginx&quot;</span></span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">enabled</span><br><span class="line"> </span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;systemctl status nginx&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">7.å…³é—­å¼€æœºè‡ªå¯ï¼Œä¸”åœæ­¢æœåŠ¡</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m systemd -a &quot;name=nginx state=stopped enabled=no&quot;</span></span><br><span class="line"> </span><br><span class="line">8.å†æ¬¡æ£€æŸ¥çŠ¶æ€</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web  -m shell -a &quot;systemctl is-enabled nginx;systemctl status nginx&quot;</span></span><br></pre></td></tr></table></figure><h2 id="12-mount-æŒ‚è½½æ¨¡å—">.12 mount æŒ‚è½½æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v8">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/ansible/posix/mount_module.html">https://docs.ansible.com/ansible/latest/collections/ansible/posix/mount_module.html</a></p><h3 id="ğŸ“–-å‚æ•°-v8">ğŸ“– å‚æ•°</h3><table><thead><tr><th>å‚æ•°</th><th>é€‰é¡¹/é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>backup</strong><br><em>boolean</em></td><td><strong>Â·</strong> no â¬…ï¸<br><strong>Â·</strong> yes</td><td>åˆ›å»ºä¸€ä¸ªåŒ…å«æ—¶é—´æˆ³ä¿¡æ¯çš„å¤‡ä»½æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨æ‚¨ä»¥æŸç§æ–¹å¼é”™è¯¯åœ°æŠ“å–åŸå§‹æ–‡ä»¶æ—¶å–å›åŸå§‹æ–‡ä»¶ã€‚</td></tr><tr><td><strong>boot</strong><br><em>boolean</em></td><td><strong>Â·</strong> yes â¬…ï¸<br><strong>Â·</strong> no</td><td>ç¡®å®šæ–‡ä»¶ç³»ç»Ÿæ˜¯å¦åº”è¯¥æŒ‚è½½åœ¨å¼•å¯¼ä¸Šã€‚<br>ä»…é€‚ç”¨äºSolarisç³»ç»Ÿã€‚</td></tr><tr><td><strong>dump</strong><br><em>string</em></td><td>Default: 0</td><td>Dumpï¼ˆè§fstabï¼ˆ5ï¼‰ï¼‰ã€‚<br>è¯·æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸º nullï¼Œstateè®¾ç½®ä¸ºpresentï¼Œå®ƒå°†åœæ­¢å·¥ä½œï¼Œå¹¶å°†åœ¨åç»­è¿è¡Œä¸­é‡å¤æ¡ç›®ã€‚<br>å¯¹Solarisç³»ç»Ÿæ²¡æœ‰å½±å“ã€‚</td></tr><tr><td><strong>fstab</strong><br><em>string</em></td><td></td><td>æ–‡ä»¶ä»£æ›¿/etc/fstabã€‚<br>é™¤éä½ çœŸçš„çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™ä½ ä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚<br>å¦‚æœæ‚¨éœ€è¦åœ¨chrootç¯å¢ƒä¸­é…ç½®æŒ‚è½½ç‚¹ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚<br>OpenBSDä¸å…è®¸æŒ‡å®šå¸¦æœ‰æŒ‚è½½çš„å¤‡ç”¨fstabæ–‡ä»¶ï¼Œå› æ­¤ä¸è¦åœ¨OpenBSDä¸Šä»¥ä»»ä½•åœ¨å®æ—¶æ–‡ä»¶ç³»ç»Ÿä¸Šè¿è¡Œçš„çŠ¶æ€ä½¿ç”¨å®ƒã€‚<br>åœ¨Solarisä¸Šï¼Œæ­¤å‚æ•°é»˜è®¤ä¸º/etc/fstabæˆ–/etc/vfstabã€‚</td></tr><tr><td><strong>fstype</strong><br><em>string</em></td><td></td><td>æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚<br>å½“stateæ˜¯ present æˆ– mountedæ—¶éœ€è¦ã€‚</td></tr><tr><td><strong>opts</strong><br><em>string</em></td><td></td><td>mounté€‰é¡¹ï¼ˆè¯·å‚é˜…solarisä¸Šçš„fstabï¼ˆ5ï¼‰æˆ–vfstabï¼ˆ4ï¼‰ï¼‰</td></tr><tr><td><strong>passno</strong><br><em>string</em></td><td>Default: 0</td><td>Passnoï¼ˆè§fstabï¼ˆ5ï¼‰ï¼‰ã€‚<br>è¯·æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸ºnull å’Œstateè®¾ç½®ä¸ºpresentï¼Œå®ƒå°†åœæ­¢å·¥ä½œï¼Œå¹¶å°†åœ¨åç»­è¿è¡Œä¸­é‡å¤æ¡ç›®ã€‚<br>Solarisç³»ç»Ÿä¸å»ºè®®ä½¿ç”¨ã€‚</td></tr><tr><td><strong>path</strong><br><em>path</em><br><mark>required</mark></td><td></td><td>æŒ‚è½½ç‚¹çš„è·¯å¾„ï¼ˆä¾‹å¦‚/mnt/filesï¼‰ã€‚<br>åœ¨Ansible 2.3ä¹‹å‰ï¼Œæ­¤é€‰é¡¹åªèƒ½ç”¨ä½œdestã€destfileå’Œåç§°ã€‚</td></tr><tr><td><strong>src</strong><br><em>path</em></td><td></td><td>è¦è¢«æŒ‚è½½è®¾å¤‡çš„è·¯å¾„ã€‚å½“stateè®¾ç½®ä¸ºpresentæˆ–mountedæ—¶æ˜¯å¿…éœ€çš„ã€‚</td></tr><tr><td><strong>state</strong><br><em>string</em><br><mark>required</mark></td><td><strong>Â·</strong> absent<br><strong>Â·</strong> mounted<br><strong>Â·</strong> present<br><strong>Â·</strong> unmounted<br><strong>Â·</strong> remounted</td><td>å¦‚æœ mountedï¼Œè®¾å¤‡å°†è¢«ä¸»åŠ¨å®‰è£…ï¼Œå¹¶åœ¨fstabä¸­é€‚å½“é…ç½®ã€‚å¦‚æœæŒ‚è½½ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™å°†åˆ›å»ºæŒ‚è½½ç‚¹ã€‚<br>å¦‚æœ unmountedï¼Œè®¾å¤‡å°†å¸è½½è€Œä¸æ›´æ”¹fstabã€‚<br>present ä»…æŒ‡å®šè®¾å¤‡å°†åœ¨fstabä¸­é…ç½®ï¼Œä¸ä¼šè§¦å‘æˆ–è¦æ±‚æŒ‚è½½ã€‚<br>absent è¡¨ç¤ºè®¾å¤‡æ”¯æ¶çš„æ¡ç›®å°†ä»fstabä¸­åˆ é™¤ï¼Œè¿˜å°†å¸è½½è®¾å¤‡å¹¶åˆ é™¤æŒ‚è½½ç‚¹ã€‚<br>remounted æŒ‡å®šå½“æ‚¨æƒ³å¼ºåˆ¶åˆ·æ–°æŒ‚è½½æœ¬èº«æ—¶ï¼Œè®¾å¤‡å°†è¢«é‡æ–°å®‰è£…ï¼ˆåœ¨2.9ä¸­æ·»åŠ ï¼‰ã€‚è¿™æ€»æ˜¯ä¼šè¿”å› changed=true</td></tr></tbody></table><h3 id="ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆåªå†™å…¥-etc-fstabè€Œä¸æŒ‚è½½ï¼‰">ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆåªå†™å…¥/etc/fstabè€Œä¸æŒ‚è½½ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=present&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆç«‹å³æŒ‚è½½ä¸”å†™å…¥-etc-fstabï¼‰">ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆç«‹å³æŒ‚è½½ä¸”å†™å…¥/etc/fstabï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=mounted&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œå–æ¶ˆæŒ‚è½½ï¼Œä»¥åŠåˆ é™¤fstabè®°å½•">ğŸ“Œå–æ¶ˆæŒ‚è½½ï¼Œä»¥åŠåˆ é™¤fstabè®°å½•</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=absent&quot;</span></span><br><span class="line"><span class="comment">#å–æ¶ˆæŒ‚è½½ï¼Œä¸åˆ é™¤fstabè®°å½•</span></span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m mount -a &quot;src=&#x27;172.16.1.31:/nfs-nginx-data&#x27; path=/usr/share/nginx/html fstype=nfs state=umounted&quot;</span></span><br></pre></td></tr></table></figure><h2 id="13-archiveå‹ç¼©æ¨¡å—">.13 archiveå‹ç¼©æ¨¡å—</h2><h3 id="ğŸ““æ–‡æ¡£-v9">ğŸ““æ–‡æ¡£</h3><p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html">https://docs.ansible.com/ansible/latest/collections/community/general/archive_module.html</a></p><h3 id="ğŸ“Œå‹ç¼©-etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„">ğŸ“Œå‹ç¼©/etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m archive -a &quot;path=/etc dest=/opt/etc.tgz&quot;</span></span><br><span class="line"> </span><br><span class="line">æŸ¥çœ‹</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;ls /opt -l&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">total 10092</span><br><span class="line">-rw-rw-rw- 1 www  www        0 May  6 20:11 666.<span class="built_in">log</span></span><br><span class="line">-rw-r--r-- 1 root root 9679353 May  7 20:36 etc.tgz</span><br><span class="line">drwxr-xr-x 2 www  www        6 May  6 22:13 hello_ansible</span><br><span class="line">-rw-r--r-- 1 root root       0 May  6 22:10 hello_ansible.log</span><br><span class="line">-rw-rw-rw- 1 www  www        0 May  6 22:20 hello-linux.log</span><br><span class="line">lrwxrwxrwx 1 root root      10 May  6 22:22 hosts -&gt; /etc/hosts</span><br><span class="line">-rw-r--r-- 1 root root  640923 May  6 20:17 log.tgz</span><br><span class="line">-rw------- 1 www  www       20 May  6 21:40 web-cf.log</span><br><span class="line">-rw------- 1 www  www        9 May  6 21:26 web-cf.log.6269.2022-05-06@21:35:30~</span><br><span class="line">-rw-r--r-- 1 root root       0 May  6 20:19 wenjie666</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">total 10392</span><br><span class="line"> </span><br><span class="line">æŸ¥çœ‹æ–‡ä»¶ç±»å‹</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;file /opt/etc.tgz&quot;</span></span><br><span class="line">172.16.1.7 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">/opt/etc.tgz: gzip compressed data, was <span class="string">&quot;/opt/etc.tgz&quot;</span>, last modified: Sat May  7 20:36:34 2022, max compression</span><br><span class="line">172.16.1.9 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">/opt/etc.tgz: gzip compressed data, was <span class="string">&quot;/opt/etc.tgz&quot;</span>, last modified: Sat May  7 20:36:34 2022, max compression</span><br><span class="line">172.16.1.8 | CHANGED | rc=0 &gt;&gt;</span><br></pre></td></tr></table></figure><h2 id="14-unarchiveè§£å‹ç¼©æ¨¡å—">.14 unarchiveè§£å‹ç¼©æ¨¡å—</h2><h3 id="ğŸ“Œè§£å‹ç¼©etc-tgzåˆ°æŒ‡å®šç›®å½•ï¼ˆè¿œç¨‹è§£å‹ï¼‰">ğŸ“Œè§£å‹ç¼©etc.tgzåˆ°æŒ‡å®šç›®å½•ï¼ˆè¿œç¨‹è§£å‹ï¼‰</h3><p>remote_srcè¿œç¨‹æ•°æ®æº</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æŒ‡å®šç›®å½•å¿…é¡»å­˜åœ¨</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m file -a &quot;path=/opt/etc_file state=directory&quot;</span></span><br><span class="line"> </span><br><span class="line">è§£å‹ç¼©</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -m unarchive -a &quot;src=/opt/etc.tgz dest=/opt/etc_file remote_src=yes&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">æŸ¥çœ‹</span><br><span class="line">[root@master-61 ~]<span class="comment">#ansible web -a &quot;ls /opt/etc_file/etc/&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œå°†ç®¡ç†æœºçš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š">ğŸ“Œå°†ç®¡ç†æœºçš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š</h3><p>å°†master-61çš„å‹ç¼©æ–‡ä»¶ï¼Œå‹ç¼©åˆ°webç»„æœºå™¨ä¸Š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.ç”Ÿæˆetc.tgzæ•°æ®</span><br><span class="line">[root@master-61 ~]<span class="comment">#cd / &amp;&amp; tar -zcf /opt/etc.tgz etc</span></span><br><span class="line"> </span><br><span class="line">[root@master-61 /]<span class="comment">#ls /opt/</span></span><br><span class="line">etc.tgz</span><br><span class="line"> </span><br><span class="line">2.è¿œç¨‹è§£å‹åˆ°webç»„æœºå™¨ä¸Š</span><br><span class="line">[root@master-61 /]<span class="comment">#ansible web -m unarchive -a &quot;src=/opt/etc.tgz dest=/tmp/&quot;</span></span><br><span class="line"> </span><br><span class="line">3.æ£€æŸ¥</span><br><span class="line">[root@master-61 /]<span class="comment">#ansible web -a &quot;ls /tmp/etc/&quot;</span></span><br></pre></td></tr></table></figure><h2 id="15-fetch-ä»å®¢æˆ·ç«¯æœåŠ¡æ–‡ä»¶æ¨¡å—">15. fetch ä»å®¢æˆ·ç«¯æœåŠ¡æ–‡ä»¶æ¨¡å—</h2><h3 id="ğŸ“–-æ¦‚è¦-v7">ğŸ“– æ¦‚è¦</h3><ul><li>è¯¥æ¨¡å—çš„å·¥ä½œæ–¹å¼ä¸copyç±»ä¼¼ï¼Œä½†ç›¸åã€‚</li><li>å®ƒç”¨äºä»è¿œç¨‹æœºå™¨è·å–æ–‡ä»¶å¹¶å°†å®ƒä»¬æœ¬åœ°å­˜å‚¨åœ¨æŒ‰ä¸»æœºåç»„ç»‡çš„æ–‡ä»¶æ ‘ä¸­ã€‚</li><li><em>å¦‚æœdest</em>ä¸­å·²ç»å­˜åœ¨çš„æ–‡ä»¶ä¸<em>src</em>ä¸åŒï¼Œå®ƒä»¬å°†è¢«è¦†ç›–ã€‚</li><li>Windows ç›®æ ‡ä¹Ÿæ”¯æŒæ­¤æ¨¡å—ã€‚</li></ul><h3 id="ğŸ“–-å‚æ•°-v9">ğŸ“– å‚æ•°</h3><table><thead><tr><th>parameter</th><th>choices/defaults</th><th>comments</th></tr></thead><tbody><tr><td>dest</td><td></td><td>ä¿å­˜æ–‡ä»¶çš„ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœdestç›®å½•æ˜¯/backupï¼Œåˆ™ä¸»æœºhost.example.comä¸Šåä¸º/etc/profileçš„srcæ–‡ä»¶å°†è¢«ä¿å­˜åˆ°/backup/host.example.com/etc/profileã€‚ä¸»æœºåä»¥åº“å­˜åç§°ä¸ºå‡†</td></tr><tr><td>fail_on_missing</td><td>yes or noï¼Œé»˜è®¤ä¸ºyes</td><td>å½“è®¾ç½®ä¸ºyesæ—¶ï¼Œå¦‚æœç”±äºä»»ä½•åŸå› æ— æ³•è¯»å–è¿œç¨‹æ–‡ä»¶ï¼Œåˆ™ä»»åŠ¡å°†å¤±è´¥ã€‚</td></tr><tr><td>flat</td><td>yes or noï¼Œé»˜è®¤no</td><td>å…è®¸æ‚¨è¦†ç›–å°†ä¸»æœºå/path/to/æ–‡ä»¶è¿½åŠ åˆ°ç›®æ ‡çš„é»˜è®¤è¡Œä¸ºã€‚å¦‚æœdestä»¥â€™/'ç»“å°¾ï¼Œå®ƒå°†ä½¿ç”¨æºæ–‡ä»¶çš„åŸºåï¼Œç±»ä¼¼äºcopyæ¨¡å—ã€‚å¦‚æœä½¿ç”¨å•ä¸ªä¸»æœºï¼Œæˆ–è€…æ£€ç´¢æ¯ä¸ªä¸»æœºå”¯ä¸€å‘½åçš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚å¦‚æœä½¿ç”¨å¤šä¸ªå…·æœ‰ç›¸åŒæ–‡ä»¶åçš„ä¸»æœºï¼Œåˆ™æ¯ä¸ªä¸»æœºçš„æ–‡ä»¶å°†è¢«è¦†ç›–ã€‚</td></tr><tr><td>src</td><td></td><td>è¦åœ¨è¿œç¨‹ç³»ç»Ÿä¸Šè·å–çš„æ–‡ä»¶ã€‚è¿™å¿…é¡»æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›®å½•ã€‚åœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šæ”¯æŒé€’å½’æŠ“å–ã€‚</td></tr><tr><td>validate_checksum</td><td>yes or noï¼Œé»˜è®¤yes</td><td>åœ¨è·å–æ–‡ä»¶ä¹‹åï¼ŒéªŒè¯æºå’Œç›®æ ‡æ ¡éªŒå’Œæ˜¯å¦åŒ¹é…ã€‚</td></tr></tbody></table><h1 id="5ï¼‰ansible-playbook-å‰§æœ¬æ¨¡å¼">5ï¼‰ansible-playbook å‰§æœ¬æ¨¡å¼</h1><p>Ansibleçš„playbookæ¨¡å¼å°±æ˜¯é’ˆå¯¹ç‰¹å®šçš„å…·ä½“è¾ƒå¤§çš„ä»»åŠ¡ï¼Œäº‹å…ˆå†™å¥½æ‰§è¡Œå‰§æœ¬ï¼Œç„¶ååœ¨å…¶ä»–æœºå™¨ä¸Šæ‰¹é‡æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œå±äºå®šåˆ¶åŒ–çš„æ‰¹é‡æ‰§è¡Œä»»åŠ¡ã€‚</p><h3 id="playbookå‰§æœ¬çš„ç»„æˆè§„èŒƒ">playbookå‰§æœ¬çš„ç»„æˆè§„èŒƒ</h3><blockquote><p>å‰§æœ¬å¾ˆé‡è¦çš„å°±æ˜¯ï¼Œå®šä¹‰æ¼”å‘˜çš„ä¿¡æ¯(å…¶å®å°±æ˜¯å®šä¹‰ä¸»æœºçš„ä¿¡æ¯)ï¼Œæ¼”å‘˜çš„å…·ä½“ä»»åŠ¡(ä»¥åŠä¸»æœºè¦æ‰§è¡Œçš„æ¨¡å—ï¼ŒåŠ¨ä½œ)ã€‚<br>Ansibleçš„å‰§æœ¬ä¹Ÿæ˜¯ç”±ä¸¤ä¸ªæœ€åŸºæœ¬çš„éƒ¨åˆ†ç»„æˆã€‚</p><ul><li>hostså®šä¹‰çš„è¢«ç®¡ç†çš„ä¸»æœºåˆ—è¡¨ä¿¡æ¯(æ¼”å‘˜æœ‰å“ªäº›)</li><li>taskså…³é”®è¯å®šä¹‰çš„è¢«ç®¡ç†ä¸»æœºéœ€è¦æ‰§è¡Œçš„åŠ¨ä½œ(æ¼”å‘˜è¦åšä»€ä¹ˆäº‹)</li></ul></blockquote><h3 id="å‰§æœ¬ä¹‹hostséƒ¨åˆ†">å‰§æœ¬ä¹‹hostséƒ¨åˆ†</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼Œå®šä¹‰è¢«ç®¡ç†ä¸»æœºçš„ipåœ°å€</span></span><br><span class="line">- hosts: 192. 168.178.138</span><br><span class="line">  tasks:</span><br><span class="line"> 	- name: è¿™æ˜¯æˆ‘ç¬¬ä¸€ä¸ªä»»åŠ¡</span><br><span class="line">	  yum: name=nginx state=installed</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼Œå®šä¹‰è¢«ç®¡ç†ä¸»æœºçš„åå­—ï¼Œæ³¨æ„è¯¥ä¸»æœºåå¿…é¡»èƒ½å¤Ÿè§£æ</span></span><br><span class="line">- hosts: backup01</span><br><span class="line">  tasks:</span><br><span class="line">    - name:éœ€è¦æ‰§è¡Œçš„åŠ¨ä½œ</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹å¼ä¸‰ï¼Œå®šä¹‰å¤šä¸ªä¸»æœºä¿¡æ¯</span></span><br><span class="line">- hosts: 192.168.178.138,192.168.178.139,backup01</span><br><span class="line">  tasks:</span><br><span class="line">	- name: æ‰§è¡Œçš„åŠ¨ä½œ...</span><br><span class="line">	</span><br><span class="line"><span class="comment">#æ–¹å¼å››ï¼Œå¡«å†™æ‰€æœ‰çš„ä¸»æœº</span></span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰è¢«ç®¡ç†çš„ä¸»æœºï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„å‰æï¼Œå°±æ˜¯è¢«ç®¡ç†çš„ä¸»æœºå¿…é¡»åœ¨ansibleç®¡ç†çš„hostsæ–‡ä»¶ä¸­æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œå¦åˆ™è¯†åˆ«ä¸äº†/etc/ansible/hosts</p></blockquote><h3 id="å‰§æœ¬ä¹‹tasksè®²è§£">å‰§æœ¬ä¹‹tasksè®²è§£</h3><blockquote><ul><li>å˜é‡å½¢å¼å®šä¹‰taskä»»åŠ¡ï¼Œname=&quot;shenfuâ€ age=18</li><li>è¿˜å¯ä»¥ä½¿ç”¨å­—å…¸å½¢å¼å®šä¹‰ï¼Œç‰¹ç‚¹æ˜¯<code>key:value</code>ï¼Œç›¸å…³çš„è¯è¯­ï¼Œè‡ªå‘ï¼Œè‡ªè±ªï¼Œè‡ªå¾‹ï¼Œè‡ªåŠ›æ›´ç”Ÿ<ul><li>name:â€œshenfuâ€</li><li>age:18</li><li>addr: â€œåŒ—äº¬æ²™æ²³â€</li></ul></li></ul></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰taskæ–¹å¼ä¸€ï¼šé‡‡ç”¨å˜é‡å½¢å¼è®¾ç½®ä»»åŠ¡</span></span><br><span class="line">tasks:</span><br><span class="line">  -	name: make sure apache is runing</span><br><span class="line">    service: name=httpd state=running </span><br><span class="line"></span><br><span class="line">  - name: copy file. .</span><br><span class="line">	copy: src=/etc/ansible/hosts dest=/etc/ansible/hosts</span><br><span class="line">		  owner=root group=root mode=0644</span><br><span class="line">		  </span><br><span class="line"><span class="comment"># å½“ä¼ å…¥çš„å‚æ•°åˆ—è¡¨è¿‡é•¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶åˆ†å‰²</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼Œé‡‡ç”¨å­—å…¸å½¢å¼è®¾ç½®å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">tasks:</span><br><span class="line">  - name:copy file to client...</span><br><span class="line">	copy:</span><br><span class="line">	  src: /etc/ansible/hosts </span><br><span class="line">	  dest: /etc/ansible/hosts</span><br><span class="line">	  owner: root</span><br><span class="line">	  group: root</span><br><span class="line">      mode: 0644</span><br></pre></td></tr></table></figure><h3 id="yamlè¯­æ³•è§„èŒƒ">yamlè¯­æ³•è§„èŒƒ</h3><blockquote><p>åœ¨å­¦ä¹ ansibleçš„æ—¶å€™ï¼Œç¼–å†™palybookæ˜¯æœ€é‡è¦çš„ç¯èŠ‚ï¼Œé‚£ä¹ˆpalybookæ˜¯éµå¾ªyamlè¯­æ³•ï¼Œå› æ­¤éœ€è¦æŒæ¡yamlè¯­æ³•çš„æ•°æ®æ ¼å¼ã€‚</p></blockquote><blockquote><p>ç›®å‰ä¸»æµä½¿ç”¨çš„æ•°æ®æ ¼å¼ï¼Œæœ‰jsonã€xmlã€yamlï¼Œéƒ½å±äºæ•°æ®åºåˆ—åŒ–æ ¼å¼ã€‚</p><p>yamlæ›´å®¹æ˜“è¢«è§£æï¼Œå·²è¯»ï¼Œå› æ­¤æ›´å¤šçš„ä½¿ç”¨åœ¨äº†é…ç½®æ–‡ä»¶å½“ä¸­ï¼Œansibleã€saltstackã€k8séƒ½ç”¨yamlã€‚</p></blockquote><blockquote><p>yamlåŸºæœ¬è¯­æ³•</p><p>å¤§å°å†™æ•æ„Ÿä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§çš„å…³ç³»(åŒæ ·çš„ç©ºæ ¼æ•°é‡)<br>åœ¨é…ç½®ç¼©è¿›å…³ç³»çš„æ—¶å€™ï¼Œç¦æ­¢ç”¨tabé”®ï¼Œè¯·ä¸€ä¸ªä¸€ä¸ªç”¨ç©ºæ ¼é”®è¡¨ç¤ºç›¸åŒå…ƒç´ çš„å·¦ä¾§ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªéœ€è¦å¯¹å…¶å³å¯<br>yaml è¯­æ³•æ”¯æŒçš„æ•°æ®ç»“æ„</p><p>å¯¹è±¡ï¼ŒæŒ‡çš„å°±æ˜¯å­—å…¸çš„æ¦‚å¿µï¼Œkey: valueï¼Œæ³¨æ„key: åé¢æœ‰ä¸€ä¸ªç©ºæ ¼æ•°ç»„ï¼ŒæŒ‡çš„å°±æ˜¯åˆ—è¡¨çš„æ¦‚å¿µ</p></blockquote><h3 id="playbookç¼–å†™çš„è§„èŒƒ">playbookç¼–å†™çš„è§„èŒƒ</h3><p>å‰§æœ¬çš„ç¼©è¿›å…³ç³»ï¼Œä¸€èˆ¬æ˜¯ä¸¤ä¸ªç©ºæ ¼ä½œä¸ºä¸€ä¸ªç¼©è¿›ï¼Œä¸”ç©ºæ ¼æ•°ç›®æ— æ‰€è°“ï¼Œå·¦ä¾§å¯¹é½å³å¯ã€‚</p><h3 id="playbookå®é™…ç¼–å†™ä¸æ‰§è¡Œ">playbookå®é™…ç¼–å†™ä¸æ‰§è¡Œ</h3><blockquote><p>å‰§æœ¬ç¼–å†™å®Œæˆä¹‹åï¼Œè¿˜å¾—æ‰§è¡Œæ‰èƒ½å·¥ä½œã€‚åœ¨ansibleç¨‹åºä¸­ï¼ŒåŠ è½½æ¨¡å—çš„åŠŸèƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ansible adhocå‘½ä»¤è¡Œå½¢æ‰§è¡ŒåŠ è½½å‰§æœ¬ä¸­çš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ansible- playbookå‘½ä»¤å»æ‰§è¡Œè„šæœ¬ã€‚</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºæœ¬æ‰§è¡Œè¯­æ³•</span></span><br><span class="line">ansible-playbook nginx.yaml   <span class="comment"># å¯ä»¥ä½¿ç”¨ç»å¯¹ç›¸å¯¹è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‰§æœ¬å‘½ä»¤çš„å¸®ç›¸ä¿¡æ¯</span></span><br><span class="line">ansible-playbook -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‰§æœ¬çš„æ‰§è¡Œè¯¦ç»†è¾“å‡º</span></span><br><span class="line">ansible-playbook nginx.yaml --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‰§æœ¬å½±å“çš„ä¸»æœºåˆ—è¡¨ä¿¡æ¯</span></span><br><span class="line">ansible-playbook nginx.yaml --list-hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå‰§æœ¬åŠ è½½æŒ‡å®šçš„ä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œé»˜è®¤å‰§æœ¬ä½¿ç”¨çš„æ˜¯/etc/ansible/hosts</span></span><br><span class="line">ansible-playbook nginx.yaml -i /etc/my_ansible/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå‰§æœ¬å¹¶ä¸”æ£€æŸ¥è¯­æ³•</span></span><br><span class="line">ansible-playbook nginx.yaml --syntax-check</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒè¯•å‰§æœ¬ï¼Œåªæ˜¯è°ƒè¯•ï¼Œä½†æ˜¯ä¸ä¼šå¯¹è¢«ç®¡ç†èŠ‚ç‚¹å‘ç”Ÿæ”¹å˜</span></span><br><span class="line">ansible-playbook nginx.yaml -C <span class="comment"># æ¨¡æ‹Ÿæ‰§è¡Œï¼Œä¸å½±å“å®¢æˆ·ç«¯æœºå™¨</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œä½¿ç”¨å‰§æœ¬æ‰¹é‡å®‰è£…nginxæœåŠ¡">ğŸ“Œä½¿ç”¨å‰§æœ¬æ‰¹é‡å®‰è£…nginxæœåŠ¡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">     <span class="number">1</span>	<span class="comment"># install nginx yaml,by shenfu</span></span><br><span class="line">     <span class="number">2</span>	<span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">     <span class="number">3</span>	  <span class="attr">tasks:</span></span><br><span class="line">     <span class="number">4</span>	      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">     <span class="number">5</span>	 		<span class="attr">yum:</span> <span class="string">name=nginx</span> <span class="string">state=present</span></span><br><span class="line">     <span class="number">6</span>	      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">Nignx.conf</span> <span class="string">to</span> <span class="string">every_server</span></span><br><span class="line">     <span class="number">7</span>			<span class="attr">copy:</span> <span class="string">src=./nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.è¡¨ç¤ºæ³¨é‡Šä¿¡æ¯ï¼Œå¯ä»¥ç”¨#å·ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‰ä¸ªçŸ­æ¨ªçº¿å½“åšæ³¨é‡Š</span></span><br><span class="line"><span class="comment"># 2.è¡¨ç¤ºå®šä¹‰playbookç®¡ç†çš„ç›®æ ‡æœºå™¨ï¼Œå¯ä»¥å†™allç®¡ç†æ‰€æœ‰ï¼Œä¹Ÿå¯ä»¥å•ç‹¬çš„å¡«å†™ip,ä¹Ÿå¯ä»¥å¡«å†™ä¸»æœºå</span></span><br><span class="line"><span class="comment"># 3.å®šä¹‰playbookéœ€è¦å®Œæˆçš„ä»»åŠ¡çš„é›†åˆï¼Œæ¯”å¦‚ä½ è¦å®šä¹‰2ï¼Œç¬¬ä¸€ä¸ªæ˜¯å®‰è£…nginxé€šè¿‡yumæ¨¡å—ï¼Œç¬¬äºŒä¸ªæ˜¯é€šè¿‡copyæ¨¡å—ï¼Œå‘é€ç®¡ç†èŠ‚ç‚¹ä¸Šçš„é…ç½®æ–‡ä»¶ï¼Œå‘é€ç»™è¢«ç®¡ç†çš„å®¢æˆ·ç«¯æœºå™¨</span></span><br><span class="line"><span class="comment"># 4.å®šä¹‰ä»»åŠ¡çš„åå­—ï¼Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># 5.å®šä¹‰ä»»åŠ¡çš„å…·ä½“æ“ä½œï¼ŒæŒ‡å®šç”¨å“ªäº›æ¨¡å—ï¼Œä¸å‚æ•°</span></span><br><span class="line"><span class="comment"># 6~7è¡Œä½œç”¨æ˜¯å’Œ4~5è¡Œæ˜¯ä¸€æ ·äº†</span></span><br></pre></td></tr></table></figure><h3 id="ğŸ“Œä½¿ç”¨å‰§æœ¬éƒ¨ç½²rsyncæœåŠ¡">ğŸ“Œä½¿ç”¨å‰§æœ¬éƒ¨ç½²rsyncæœåŠ¡</h3><blockquote><p>è¿›è¡Œæ€è€ƒï¼Œå‰§æœ¬å¦‚ä½•è®¾è®¡ï¼Œå’Œå®‰æ’</p><p>å…ˆè€ƒè™‘å¥½éƒ¨ç½²rsyncçš„æ•´ä¸ªè¿‡ç¨‹</p><p>éƒ¨ç½²çš„æ€è·¯è¿‡ç¨‹å¦‚ä¸‹ï¼Œç„¶åè½¬åŒ–æˆplaybookå‰§æœ¬çš„è¿‡ç¨‹å°±å¯ä»¥</p><p>å®‰è£…rysncæœåŠ¡ï¼Œä½¿ç”¨yum<br>ç¼–å†™rsyncé…ç½®æ–‡ä»¶ï¼Œ(å¸¸ç”¨çš„æ“ä½œæ˜¯ï¼Œåœ¨Ansible-01ç®¡ç†æœºå™¨ä¸Šç¼–å†™å¥½é…ç½®æ–‡ä»¶ï¼Œåˆ†å‘ç»™å®¢æˆ·ç«¯æœºå™¨å³å¯) copyæ¨¡å—åˆ›å»ºrsyncç”¨æˆ·ï¼Œä½¿ç”¨ansibleçš„useræ¨¡å—åˆ›å»ºç”¨äºrsyncéªŒè¯çš„æ–‡ä»¶ï¼Œè¿˜æ˜¯é€‰æ‹©åœ¨Ansible-01ä¸Šå†™å¥½ååˆ†å‘ï¼Œcopyæ¨¡å—ï¼Œæ³¨æ„æ–‡ä»¶æƒé™è®¾ç½®åˆ›å»ºæ•°æ®å¤‡ä»½çš„æ–‡ä»¶å¤¹ï¼ŒrsyncæŒ‡å®š äº†bakcupæ¨¡å—ï¼Œå¤‡ä»½ç›®å½•æ˜¯<br>/data_ backup/ï¼Œè°ƒç”¨fileæ¨¡å—åˆ›å»ºæ–‡ä»¶å¤¹å¯åŠ¨rsyncæœåŠ¡ç«¯ï¼Œä¸”æ˜¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œshellæ¨¡å—ï¼Œsystemdæ¨¡å—</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@m01</span> <span class="string">myyaml</span>]<span class="comment"># cat install_rsync.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="number">192.168</span><span class="number">.178</span><span class="number">.115</span></span><br><span class="line"> <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step01,install</span> <span class="string">rsync</span> <span class="string">service</span></span><br><span class="line">	 <span class="attr">yum:</span> <span class="string">name=rsync</span> <span class="string">state=installed</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step02,edit</span> <span class="string">rsync</span> <span class="string">conf</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">copy:</span> <span class="string">src=/etc/ansible/rsync_conf/rsyncd.conf</span></span><br><span class="line"><span class="string">dest=/etc/rsync/conf/</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step03,create</span> <span class="string">user</span> <span class="string">rsync</span></span><br><span class="line">     <span class="attr">user:</span> <span class="string">name=rsync</span> <span class="string">state=present</span> <span class="string">createhome=no</span></span><br><span class="line"><span class="string">shell=/sbin/nolgoin</span></span><br><span class="line"></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step04,create</span> <span class="string">user</span> <span class="string">auth</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">copy:</span> <span class="string">src=/etc/ansible/rsync_conf/rsync.password</span></span><br><span class="line"><span class="string">dest=/etc/rsync/conf/</span> <span class="string">mode=0600</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step05,create</span> <span class="string">backup</span> <span class="string">dir</span></span><br><span class="line">     <span class="attr">file:</span> <span class="string">dest=/data_backup/</span> <span class="string">state=directory</span> <span class="string">owner=rsync</span></span><br><span class="line"><span class="string">group=rsync</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">step06,run</span> <span class="string">rsync</span> <span class="string">server</span></span><br><span class="line">     <span class="attr">shell:</span> <span class="string">rsync</span> <span class="string">--daemon</span> <span class="string">creates=/var/run/rsync.pid</span></span><br></pre></td></tr></table></figure><h1 id="6ï¼‰Ansible-å˜é‡">6ï¼‰Ansible å˜é‡</h1><p>Ansibleæ”¯æŒåˆ©ç”¨å˜é‡æ¥å­˜å‚¨å€¼ï¼Œå¹¶åœ¨Ansibleé¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶ä¸­é‡å¤ä½¿ç”¨è¿™äº›å€¼ã€‚è¿™å¯ä»¥ç®€åŒ–é¡¹ç›®çš„åˆ›å»ºå’Œç»´æŠ¤ï¼Œå¹¶å‡å°‘é”™è¯¯çš„æ•°é‡ã€‚</p><p>é€šè¿‡å˜é‡ï¼Œå¯ä»¥è½»æ¾åœ°åœ¨Ansibleé¡¹ç›®ä¸­ç®¡ç†ç»™å®šç¯å¢ƒçš„åŠ¨æ€å€¼ã€‚ä¾‹å¦‚ï¼Œå˜é‡å¯èƒ½åŒ…å«ä¸‹é¢è¿™äº›å€¼ï¼š</p><ul><li>è¦åˆ›å»ºçš„ç”¨æˆ·</li><li>è¦å®‰è£…çš„è½¯ä»¶åŒ…</li><li>è¦é‡æ–°å¯åŠ¨çš„æœåŠ¡</li><li>è¦åˆ é™¤çš„æ–‡ä»¶</li><li>è¦ä»äº’è”ç½‘æ£€ç´¢çš„å­˜æ¡£</li></ul><h2 id="1-å‘½åå˜é‡">.1 å‘½åå˜é‡</h2><p>å˜é‡çš„åç§°å¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œå¹¶ä¸”åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚</p><table><thead><tr><th>æ— æ•ˆçš„å˜é‡åç§°</th><th>æœ‰æ•ˆçš„å˜é‡åç§°</th></tr></thead><tbody><tr><td>web server</td><td>web_server</td></tr><tr><td>remote.file</td><td>remote_file</td></tr><tr><td>1st file</td><td>file_1 file1</td></tr><tr><td>remoteserver$1</td><td>remote_server_1 remote_server1</td></tr></tbody></table><h2 id="2-å®šä¹‰å˜é‡">.2 å®šä¹‰å˜é‡</h2><p>å¯ä»¥åœ¨Ansibleé¡¹ç›®ä¸­çš„å¤šä¸ªä½ç½®å®šä¹‰å˜é‡ã€‚ä¸è¿‡ï¼Œè¿™äº›å˜é‡å¤§è‡´å¯ç®€åŒ–ä¸ºä¸‰ä¸ªèŒƒå›´çº§åˆ«ï¼š</p><ul><li>å…¨å±€èŒƒå›´ï¼šä»å‘½ä»¤è¡Œæˆ–Ansibleé…ç½®è®¾ç½®çš„å˜é‡</li><li>PlayèŒƒå›´ï¼šåœ¨playå’Œç›¸å…³ç»“æ„ä¸­è®¾ç½®çš„å˜é‡</li><li>ä¸»æœºèŒƒå›´ï¼šç”±æ¸…å•ã€äº‹å®æ”¶é›†æˆ–æ³¨å†Œçš„ä»»åŠ¡ï¼Œåœ¨ä¸»æœºç»„å’Œä¸ªåˆ«ä¸»æœºä¸Šè®¾ç½®çš„å˜é‡</li></ul><p>å¦‚æœåœ¨å¤šä¸ªxeklå®šä¹‰äº†ç›¸åŒåç§°çš„å˜é‡ï¼Œåˆ™é‡‡ç”¨ä¼˜å…ˆçº§åˆ«æœ€é«˜çš„å˜é‡ã€‚çª„èŒƒå›´ä¼˜å…ˆäºæ›´å¹¿æ³›çš„èŒƒå›´ï¼šç”±æ¸…å•å®šä¹‰çš„å˜é‡å°†è¢«playbookå®šä¹‰çš„å˜é‡è¦†ç›–ï¼Œåè€…å°†è¢«å‘½ä»¤è¡Œä¸­å®šä¹‰çš„å˜é‡è¦†ç›–ã€‚</p><h3 id="2-1-åœ¨playbookæ–‡ä»¶ä¸­è¿›è¡Œå˜é‡å®šä¹‰">.2.1 åœ¨playbookæ–‡ä»¶ä¸­è¿›è¡Œå˜é‡å®šä¹‰</h3><p>Playbookå˜é‡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®šä¹‰ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ–¹å¼ä¸€ï¼šåœ¨æ¨¡å—ä¸‹å®šä¹‰å˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat nfs_yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: install tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">      vars:</span><br><span class="line">        packages:</span><br><span class="line">        - tree</span><br><span class="line">    - name: remove tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">        state: absent</span><br><span class="line">      vars:</span><br><span class="line">        packages:</span><br><span class="line">        - tree</span><br><span class="line"><span class="comment">#é—®é¢˜ï¼š</span></span><br><span class="line">	1.å¦‚æœå°†å˜é‡è®¾ç½®åˆ°æ¨¡å—ä¸‹ï¼Œé‚£ä¹ˆå…¶ä»–çš„nameæ˜¯ä¸è¯†åˆ«çš„</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ–¹å¼äºŒï¼šåœ¨hostsä¸‹å®šä¹‰å˜é‡</span></span><br><span class="line">[root@m01 ~] <span class="comment"># vim yum.yml</span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    packages:</span><br><span class="line">      - tree</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span>  </span><br><span class="line">    - name: remove tree server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span></span><br><span class="line">        state: absent</span><br><span class="line"><span class="comment">#é—®é¢˜ï¼š</span></span><br><span class="line">	1.åˆ›å»ºç›®å½•æ—¶å¯èƒ½ä¼šå‡ºç°æ ¼å¼è½¬æ¢é—®é¢˜</span><br><span class="line">	2.å¦‚æœå°†å˜é‡è®¾ç½®åˆ°hostsä¸‹ï¼Œé‚£ä¹ˆå…¶ä»–çš„hostsæ˜¯ä¸è¯†åˆ«çš„</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 3. æ–¹å¼ä¸‰ï¼šåœ¨hostsä¸‹é¢å®šä¹‰å¤šä¸ªå˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat nfs_yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    packages:</span><br><span class="line">      - tree</span><br><span class="line">    db: </span><br><span class="line">      - httpd</span><br><span class="line">      - httpd-tools</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; packages &#125;&#125;&quot;</span>  </span><br><span class="line">    - name: install httpd server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; db &#125;&#125;&quot;</span></span><br><span class="line">    - name: Mkdir Dir</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; packages &#125;&#125;</span><br><span class="line">        state: directory</span><br></pre></td></tr></table></figure><h3 id="2-2-é€šè¿‡vars-fileå®šä¹‰å˜é‡">.2.2 é€šè¿‡vars_fileå®šä¹‰å˜é‡</h3><p>åˆšæ‰æˆ‘ä»¬å­¦åˆ°åœ¨playbookä¸­ä½¿ç”¨varså®šä¹‰å˜é‡ï¼Œæœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯å…¶ä»–çš„playbookæ— æ³•ä½¿ç”¨è¯¥å˜é‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡å–ç¬¬äºŒç§å®šä¹‰å˜é‡çš„æ–¹å¼ï¼Œåœ¨vars_fileä¸­å®šä¹‰å˜é‡ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å‡†å¤‡å˜é‡æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim vars.yml </span></span><br><span class="line">web: </span><br><span class="line">  - httpd</span><br><span class="line">  - httpd-tools</span><br><span class="line">db: tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è°ƒç”¨å˜é‡æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim yum.yml </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars_files: /root/vars.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Installed http Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; web &#125;&#125;&quot;</span></span><br><span class="line">    - name: Installed tree Server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; db &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå½“å˜é‡ç”¨ä½œå¼€å§‹ä¸€ä¸ªå€¼çš„ç¬¬ä¸€å…ƒç´ æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å¼•å·ã€‚è¿™å¯ä»¥é˜²æ­¢Ansibleå°†å˜é‡å¼•ç”¨è§†ä¸ºYAMLå­—å…¸çš„å¼€å¤´ã€‚</p><h3 id="2-3-é€šè¿‡Inventoryä¸»æœºæ¸…å•ä¸­è¿›è¡Œå˜é‡å®šä¹‰">.2.3 é€šè¿‡Inventoryä¸»æœºæ¸…å•ä¸­è¿›è¡Œå˜é‡å®šä¹‰</h3><p>è¿™æ˜¯è¾ƒæ—§çš„åšæ³•ï¼Œä¸å»ºè®®é‡‡ç”¨ï¼Œä½†ä½ å¯èƒ½ä¼šåœ¨æœªæ¥çš„å·¥ä½œå½“ä¸­é‡åˆ°ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é…ç½®ä¸»æœºæ¸…å•</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts </span></span><br><span class="line">... ...</span><br><span class="line">[db_server]</span><br><span class="line">db01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[db_server:vars]</span><br><span class="line">web=httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è°ƒç”¨å˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim yum.yml </span></span><br><span class="line">- hosts: db_server</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; web &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼š</span></span><br><span class="line">	1.ä¸»æœºæ¸…å•ä¸­å®šä¹‰å˜é‡ï¼Œåªè¦hostsé…ç½®çš„æ˜¯ä¸»æœºæ¸…å•ä¸­è®¾ç½®å˜é‡çš„ç»„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡</span><br><span class="line">	2.å¦‚æœhostsé…ç½®çš„ä¸æ˜¯ä¸»æœºæ¸…å•ä¸­è®¾ç½®å˜é‡çš„ç»„ï¼Œå˜é‡ä¸å¯è¯†åˆ«</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 3.ä¸»æœºæ¸…å•å®šä¹‰å˜é‡æ³¨æ„</span></span><br><span class="line">1.è®¾ç½®ä¸»æœºæ¸…å•çš„å˜é‡</span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/ansible/hosts</span></span><br><span class="line">[lb_group]</span><br><span class="line">lb01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">lb02 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[web_group]</span><br><span class="line">web01 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">web02 ansible_ssh_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">[nginx:children]</span><br><span class="line">web_group</span><br><span class="line">lb_group</span><br><span class="line"></span><br><span class="line">[nginx:vars]</span><br><span class="line">web=nginx_group</span><br><span class="line"></span><br><span class="line">[web_group:vars]  </span><br><span class="line">web=nginx_host</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.ä¸»æœºç»„å®šä¹‰çš„å˜é‡ä¼˜å…ˆçº§é«˜äºæ•´åˆç»„å®šä¹‰çš„å˜é‡ </span></span><br><span class="line"><span class="comment"># 2.ä¸»æœºå®šä¹‰çš„å˜é‡ä¼˜å…ˆçº§é«˜äºä¸»æœºç»„å®šä¹‰çš„å˜é‡</span></span><br></pre></td></tr></table></figure><h3 id="2-4-é€šè¿‡hosts-varså’Œgroup-varså®šä¹‰å˜é‡">2.4 é€šè¿‡hosts_varså’Œgroup_varså®šä¹‰å˜é‡</h3><p>ä¹‹å‰çš„å‡ ç§å˜é‡å®šä¹‰éƒ½ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæ¯”è¾ƒå¥½ç”¨çš„æ˜¯åœ¨Ansibleé¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªå˜é‡ç›®å½• <code>host_vars</code>ã€ <code>group_vars</code> åˆ‡è®°ï¼Œç›®å½•åå­—ä¸€å®šè¦ä¸€è‡´ï¼Œä¸èƒ½åšä»»ä½•ä¿®æ”¹ã€‚</p><p>1ï¸âƒ£ä¸»æœºç»„å®šä¹‰å˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.åˆ›å»ºä¸»æœºç»„å˜é‡çš„ç›®å½•ï¼Œä¸èƒ½æ”¹åå­—</span></span><br><span class="line">[root@m01 ~]<span class="comment"># mkdir group_vars</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ç›®å½•ä¸‹åˆ›å»ºå˜é‡æ–‡ä»¶ï¼Œæ–‡ä»¶çš„åå­—è¦è·Ÿä¸»æœºæ¸…å•ä¸­ä¸»æœºç»„åå­—ä¸€è‡´</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cd group_vars/</span></span><br><span class="line">[root@m01 group_vars]<span class="comment"># vim web_group</span></span><br><span class="line">file: group_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è°ƒç”¨å˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#4.æ³¨æ„ï¼š</span></span><br><span class="line">	1.åªè¦å‰§æœ¬ä¸­çš„hostsä¸è®¾ç½®å˜é‡çš„ä¸»æœºç»„åå­—ç›¸åŒï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ä¸»æœºå®šä¹‰å˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.åˆ›å»ºä¸»æœºå˜é‡çš„ç›®å½•ï¼Œä¸èƒ½æ”¹åå­—</span></span><br><span class="line">[root@m01 ~]<span class="comment"># mkdir host_vars</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ç›®å½•ä¸‹åˆ›å»ºå˜é‡æ–‡ä»¶ï¼Œæ–‡ä»¶çš„åå­—è¦è·Ÿä¸»æœºæ¸…å•ä¸­ä¸»æœºåå­—ä¸€è‡´</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim host_vars/web01</span></span><br><span class="line">file: host_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.è°ƒç”¨å˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4.æ‰§è¡Œ</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.æŸ¥çœ‹æ‰§è¡Œç»“æœ</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 22 17:35 host_vars</span><br><span class="line">[root@web02 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec 22 17:35 group_vars</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.æ³¨æ„ï¼š</span></span><br><span class="line">	1ï¼‰ä¸»æœºç»„å®šä¹‰çš„å˜é‡ä¼˜å…ˆçº§é«˜äºæ•´åˆç»„å®šä¹‰çš„å˜é‡</span><br><span class="line">	2ï¼‰ä¸»æœºå®šä¹‰çš„å˜é‡ä¼˜å…ˆçº§é«˜äºä¸»æœºç»„å®šä¹‰çš„å˜é‡</span><br></pre></td></tr></table></figure><h3 id="2-5-å‘½ä»¤è¡Œå®šä¹‰å˜é‡ï¼ˆå‘½ä»¤è¡Œ-e-è®¾ç½®å˜é‡ï¼‰">2.5 å‘½ä»¤è¡Œå®šä¹‰å˜é‡ï¼ˆå‘½ä»¤è¡Œ -e è®¾ç½®å˜é‡ï¼‰</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1ã€æŸ¥çœ‹å‰§æœ¬æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡æ‰§è¡Œ</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml -e &quot;file=minglinghang&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€æŸ¥çœ‹è¿œç«¯æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--. 1 root root 0 Dec 22 17:41 minglinghang</span><br><span class="line"></span><br><span class="line">[root@web02 ~]<span class="comment"># ll /tmp/</span></span><br><span class="line">total 0</span><br><span class="line">-rw-r--r-- 1 root root 0 Dec 22 17:41 minglinghang</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€ä¿®æ”¹å‰§æœ¬</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file &#125;&#125;</span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /tmp/&#123;&#123; file2 &#125;&#125; </span><br><span class="line">        state: <span class="built_in">touch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5ã€å‘½ä»¤è¡ŒæŒ‡å®šå¤šä¸ªå˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml -e &quot;file=command&quot; -e &quot;file2=command2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-6-ç›´æ¥ä½¿ç”¨å†…ç½®å˜é‡">2.6 ç›´æ¥ä½¿ç”¨å†…ç½®å˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å†…ç½®å˜é‡ </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible &#x27;web_group&#x27; -m setup</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†…éƒ¨å˜é‡çš„ä¸»æœºå</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible &#x27;web_group&#x27; -m setup -a &#x27;filter=ansible_fqdn&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å†…ç½®å˜é‡åˆ›å»ºç›®å½•ï¼Œç›®å½•æ ¼å¼ä¸º ä¸»æœºå_IP_æ—¶é—´</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml   </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /backup/&#123;&#123; ansible_fqdn &#125;&#125;_&#123;&#123; ansible_eth1.ipv4.address &#125;&#125;_&#123;&#123; ansible_date_time.date &#125;&#125;</span><br><span class="line">        state: directory</span><br><span class="line">        </span><br><span class="line">[root@nfs ~]<span class="comment"># ll    #ç›¸å½“äºåœ¨nfsæœºå™¨ä¸Šåˆ›å»ºæ—¶é—´å¤‡ä»½ç›®å½•</span></span><br><span class="line">drwxr-xr-x 2 root root  6 May  6 22:37 nfs_172.16.1.131_2021-05-06</span><br></pre></td></tr></table></figure><h3 id="2-7-å†…ç½®å˜é‡è®¾ç½®å˜é‡">2.7 å†…ç½®å˜é‡è®¾ç½®å˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim test.yml   </span></span><br><span class="line">- hosts: nfs_group</span><br><span class="line">  vars:</span><br><span class="line">    - host: <span class="string">&quot;&#123;&#123;ansible_fqdn &#125;&#125;&quot;</span></span><br><span class="line">    - remoe_ip: <span class="string">&quot;&#123;&#123; ansible_eth1.ipv4.address &#125;&#125;&quot;</span></span><br><span class="line">    - <span class="built_in">date</span>: <span class="string">&quot;&#123;&#123; ansible_date_time.date &#125;&#125;&quot;</span></span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      file:</span><br><span class="line">        path: /backup/&#123;&#123; remote_ip &#125;&#125;_&#123;&#123; host &#125;&#125;_&#123;&#123; <span class="built_in">date</span> &#125;&#125;</span><br><span class="line">        state: directory</span><br></pre></td></tr></table></figure><h3 id="2-8-å†…ç½®å˜é‡å¸¸ç”¨æ–¹å¼">2.8 å†…ç½®å˜é‡å¸¸ç”¨æ–¹å¼</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç¼–å†™é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> &#123;&#123; ansible_eth1.ipv4.address &#125;&#125;</span><br><span class="line"><span class="comment"># 2.é…ç½®playbook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># cat redis.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: install redis server</span><br><span class="line">      yum:</span><br><span class="line">        name: redis</span><br><span class="line"></span><br><span class="line">    - name: config redis </span><br><span class="line">      template:</span><br><span class="line">        src: /root/mm/redis.conf</span><br><span class="line">        dest: /etc</span><br><span class="line"><span class="comment"># 3.æ‰§è¡Œ</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook redis.yml</span></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹ç»“æœ</span></span><br><span class="line">[root@web01 ~]<span class="comment"># grep &#x27;^bind&#x27; /etc/redis.conf </span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.107</span><br><span class="line">[root@web02 ~]<span class="comment"># grep &#x27;^bind&#x27; /etc/redis.conf </span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.108</span><br></pre></td></tr></table></figure><h3 id="2-9-å±‚çº§å˜é‡">2.9 å±‚çº§å˜é‡</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç¼–è¾‘å˜é‡æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim vars_file.yml</span></span><br><span class="line">lamp:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: httpd</span><br><span class="line">    db_package: mariadb-server</span><br><span class="line">    php_package: php</span><br><span class="line"></span><br><span class="line">lnmp:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: nginx</span><br><span class="line">    db_package: mysql</span><br><span class="line">    php_package: php</span><br><span class="line"></span><br><span class="line">lnmt:</span><br><span class="line">  framework:</span><br><span class="line">    web_package: nginx</span><br><span class="line">    db_package: mysql</span><br><span class="line">    java_package: tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç¼–è¾‘playbookæ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  vars_files: ./vars_file.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install LAMP httpd</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.web_package &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP mariadb-server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.db_package &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP php</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp.framework.php_package &#125;&#125;&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 3.å®˜æ–¹æ¨èå†™æ³•</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  vars_files: ./vars_file.yml</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install LAMP httpd</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;web_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP mariadb-server</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;db_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    - name: Install LAMP php</span><br><span class="line">      yum:</span><br><span class="line">        name: <span class="string">&quot;&#123;&#123; lamp[&#x27;framework&#x27;][&#x27;php_package&#x27;] &#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æ‰§è¡Œplaybook</span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook test.yml</span></span><br></pre></td></tr></table></figure><h2 id="3-å˜é‡æ³¨å†Œ">.3 å˜é‡æ³¨å†Œ</h2><p>å½“Absibleçš„æ¨¡å—è¿è¡Œä»¥åï¼Œå…¶å®éƒ½ä¼šè¿”å›ä¸€äº›ç»“æœï¼ˆresultï¼‰ï¼Œå°±åƒæ˜¯æ‰§è¡Œè„šæœ¬ï¼Œæˆ‘ä»¬æœ‰çš„æ—¶å€™éœ€è¦è„šæœ¬ç»™æˆ‘ä»¬ä¸€äº›è¿”å›å€¼ï¼ˆreturnï¼‰ï¼Œè¿™æ—¶æˆ‘ä»¬æ‰çŸ¥é“ï¼Œä¸Šä¸€æ­¥æ˜¯å¦å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼›ä½†æ˜¯â€¦é»˜è®¤æƒ…å†µä¸‹ï¼ŒAnsibleçš„ç»“æœï¼ˆresultï¼‰å¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¿”å›å€¼â€™å­˜å‚¨â€™åˆ°å˜é‡ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡â€™è°ƒç”¨â€™å¯¹åº”çš„å˜é‡åï¼Œä»è€Œè·å–åˆ°è¿™äº›ç»“æœï¼ˆresultï¼‰ï¼Œè¿™ç§å°†æ¨¡å—çš„è¿”å›å€¼ï¼Œå†™å…¥åˆ°å˜é‡ä¸­çš„æ–¹æ³•è¢«ç§°ä¸ºå˜é‡æ³¨å†Œã€‚</p><p><strong>ä½¿ç”¨ad-hocæ¨¡å¼ä¼šå¾—åˆ°è¿”å›ç»“æœ</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># ansible web01 -m shell -a &#x27;df -h&#x27;</span></span><br><span class="line">web01 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 475M     0  475M   0% /dev</span><br><span class="line">tmpfs                    487M     0  487M   0% /dev/shm</span><br><span class="line">tmpfs                    487M  7.6M  479M   2% /run</span><br><span class="line">tmpfs                    487M     0  487M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root   17G  2.3G   15G  13% /</span><br><span class="line">/dev/sda1               1014M  163M  852M  17% /boot</span><br><span class="line">tmpfs                     98M     0   98M   0% /run/user/0</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨playbookæ‰§è¡ŒåŒæ ·çš„å‘½ä»¤å¾—ä¸åˆ°ç»“æœ</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># cat test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: list File</span><br><span class="line">      shell: <span class="string">&quot;df -h &quot;</span></span><br><span class="line">      </span><br><span class="line">[root@m01 ~]<span class="comment"># vim a.yml </span></span><br><span class="line">[root@m01 ~]<span class="comment"># ansible-playbook a.yml </span></span><br><span class="line"></span><br><span class="line">PLAY [web01] ******************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] ********************************************************************</span><br><span class="line">ok: [web01]</span><br><span class="line"></span><br><span class="line">TASK [list <span class="built_in">dir</span>] ***************************************************************************</span><br><span class="line">changed: [web01]</span><br><span class="line"></span><br><span class="line">PLAY RECAP ********************************************************************************</span><br><span class="line">web01                      : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ³¨å†Œå˜é‡çš„æ–¹å¼</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1ã€æ³¨å†Œä¸€ä¸ªå˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€è°ƒç”¨å¹¶è¾“å‡ºå˜é‡</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line">    - name: Get Register</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; get_dir_list &#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 3ã€åªè¾“å‡ºæƒ³è¦çš„éƒ¨åˆ†</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim test.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Touch File</span><br><span class="line">      shell: <span class="string">&quot;df -h&quot;</span></span><br><span class="line">      register: get_dir_list</span><br><span class="line"></span><br><span class="line">    - name: Get Register</span><br><span class="line">      debug:</span><br><span class="line">        msg: <span class="string">&quot;&#123;&#123; get_dir_list[&#x27;stdout_lines&#x27;] &#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><p><strong>å˜é‡æ³¨å†Œä¸€èˆ¬ä½¿ç”¨åœºæ™¯</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 lnmp]<span class="comment"># cat lnmp2.yml </span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Tar php Package</span><br><span class="line">      unarchive:</span><br><span class="line">        src: /root/package/php.tar.gz</span><br><span class="line">        dest: /tmp/</span><br><span class="line"></span><br><span class="line">    - name: Check php Install Status</span><br><span class="line">      shell: <span class="string">&quot;rpm -qa | grep php | wc -l&quot;</span></span><br><span class="line">      register: get_php_instll_status</span><br><span class="line"></span><br><span class="line">    - name: Install php Server </span><br><span class="line">      shell: <span class="string">&quot;yum localinstall -y /tmp/*.rpm&quot;</span></span><br><span class="line">      when: get_php_instll_status.stdout_lines == 0</span><br><span class="line"></span><br><span class="line">    - name: Config php Server</span><br><span class="line">      copy:</span><br><span class="line">        src:/root/mm/php.ini</span><br><span class="line">        dest: /etc/ </span><br><span class="line"></span><br><span class="line">    - name: Config php Server</span><br><span class="line">      copy:</span><br><span class="line">        src: /root/mm/www.conf</span><br><span class="line">        dest: /etc/php-fpm.d/</span><br><span class="line"></span><br><span class="line">    - name: Start php Server</span><br><span class="line">      systemd:</span><br><span class="line">        name: php-fpm</span><br><span class="line">        state: started</span><br></pre></td></tr></table></figure><h2 id="4-factsç¼“å­˜">.4 factsç¼“å­˜</h2><p>Ansible factsæ˜¯åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šé€šè¿‡Ansibleè‡ªåŠ¨é‡‡é›†å‘ç°çš„å˜é‡ã€‚factsåŒ…å«æ¯å°ç‰¹å®šçš„ä¸»æœºä¿¡æ¯ã€‚æ¯”å¦‚ï¼šè¢«æ§ç«¯çš„ä¸»æœºåã€IPåœ°å€ã€ç³»ç»Ÿç‰ˆæœ¬ã€CPUæ•°é‡ã€å†…å­˜çŠ¶æ€ã€ç£ç›˜çŠ¶æ€ç­‰ç­‰ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li><p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥CPUï¼Œæ¥ç”Ÿæˆå¯¹åº”çš„nginxé…ç½®æ–‡ä»¶</p></li><li><p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥ä¸»æœºåï¼Œç”Ÿæˆä¸åŒçš„redisé…ç½®æ–‡ä»¶</p></li><li><p>é€šè¿‡factsç¼“å­˜æ£€ç´¢ç‰©ç†æœºçš„å†…å­˜å¤§å°æ¥ç”Ÿæˆä¸é€šçš„mysqlé…ç½®æ–‡ä»¶</p></li></ol><p><strong>æŸ¥çœ‹æ‰€æœ‰å†…ç½®å˜é‡</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i hosts web -m setup &gt; facts.json</span><br></pre></td></tr></table></figure><p>å†…å®¹è¾ƒå¤šä¿å­˜çš„jsonæ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚</p><p><strong>å…³é—­factsç¼“å­˜</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 ~]<span class="comment"># vim facts.yml</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  gather_facts: no   <span class="comment">#å…³é—­ä¿¡æ¯é‡‡é›†</span></span><br><span class="line">  tasks:</span><br><span class="line">  </span><br><span class="line"><span class="comment">#å¦‚æœä¸ä½¿ç”¨å†…ç½®å˜é‡ï¼Œå¯ä»¥å…³é—­ä¼šæé«˜å‰§æœ¬çš„æ‰§è¡Œé€Ÿåº¦ï¼Œå¦‚æœä½¿ç”¨å†…ç½®å˜é‡ï¼Œé‚£ä¹ˆä¸èƒ½å…³é—­factsç¼“å­˜</span></span><br></pre></td></tr></table></figure><p><strong>ä¸€èˆ¬ä½¿ç”¨</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.é…ç½®redisé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> &#123;&#123; ansible_eth1.ipv4.address &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.ç¼–å†™å‰§æœ¬</span></span><br><span class="line">- hosts: web_group</span><br><span class="line">  tasks:</span><br><span class="line">    - name: Install Redis Server</span><br><span class="line">      yum:</span><br><span class="line">        name: redis</span><br><span class="line">        state: present</span><br><span class="line"></span><br><span class="line">    - name: Config Redis Server</span><br><span class="line">      template:</span><br><span class="line">        src: /root/mm/redis.conf</span><br><span class="line">        dest: /etc/</span><br><span class="line">        </span><br><span class="line"><span class="comment">#3.æŸ¥çœ‹å—æ§ç«¯é…ç½®</span></span><br><span class="line">[root@web01 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.107</span><br><span class="line">[root@web02 ~]<span class="comment"># vim /etc/redis.conf</span></span><br><span class="line"><span class="built_in">bind</span> 172.16.1.108</span><br></pre></td></tr></table></figure><h2 id="5-handlers-è§¦å‘å™¨">.5 handlers è§¦å‘å™¨</h2><h2 id="6-when-æ¡ä»¶">.6 when æ¡ä»¶</h2><h2 id="7-with-itemå¾ªç¯">.7 with itemå¾ªç¯</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz">aceniu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz/posts/e4dd4355.html">https://blog.halfsummer.xyz/posts/e4dd4355.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.halfsummer.xyz" target="_blank">è‰¾æ–¯ç‰› Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0d2f9e0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/6c0b0bfc.html" title="Debianå®‰è£…Docker"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0bf3a11.jpeg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Debianå®‰è£…Docker</div></div></a></div><div class="next-post pull-right"><a href="/posts/cd0249f6.html" title="bitwarden"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fe0d0bb321f.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">bitwarden</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">aceniu</div><div class="author-info__description">Love 33 & Yilia</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/aceniu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/aceniu" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_github-circle"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=123354319@qq.com" target="_blank" title="Email"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-Rss"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/289493392" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=123354319&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_qq-circle"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%EF%BC%89Ansible-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-text">1ï¼‰Ansible å®‰è£…éƒ¨ç½²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%EF%BC%89%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95"><span class="toc-text">2ï¼‰ä¸»æœºæ¸…å•</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%89Ansible-%E8%BF%9E%E6%8E%A5%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">3ï¼‰Ansible è¿æ¥å®¢æˆ·ç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%9F%BA%E4%BA%8E%E5%85%AC%E9%92%A5%E8%AE%A4%E8%AF%81"><span class="toc-text">3.1 åŸºäºå…¬é’¥è®¤è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%9F%BA%E4%BA%8E%E5%AF%86%E7%A0%81%E8%AE%A4%E8%AF%81"><span class="toc-text">3.2 åŸºäºå¯†ç è®¤è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C%E6%95%85%E9%9A%9C%E8%A7%A3%E5%86%B3"><span class="toc-text">ğŸ“Œæ•…éšœè§£å†³</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95-ansible%E7%BC%93%E5%AD%98"><span class="toc-text">ğŸ“Œè¸©å‘è®°å½•(ansibleç¼“å­˜)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C%E5%90%8C%E4%B8%80%E7%BB%84%E8%BF%9E%E7%BB%AD%E7%9A%84ip"><span class="toc-text">ğŸ“ŒåŒä¸€ç»„è¿ç»­çš„ip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%93%8C%E5%85%AC%E5%85%B1%E5%8F%98%E9%87%8F"><span class="toc-text">ğŸ“Œå…¬å…±å˜é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Ansible%E8%BF%9E%E6%8E%A5%E6%8C%87%E7%BA%B9%E7%A1%AE%E8%AE%A4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">3.3 Ansibleè¿æ¥æŒ‡çº¹ç¡®è®¤çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-ssh%E6%89%B9%E9%87%8F%E7%AE%A1%E7%90%86%E5%88%86%E5%8F%91%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">3.4 sshæ‰¹é‡ç®¡ç†åˆ†å‘ï¼ˆå®æˆ˜ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%89ad-hoc-%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="toc-text">3ï¼‰ad-hoc å‘½ä»¤è¡Œæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%88%97%E5%87%BAAnsible%E6%89%80%E6%9C%89%E6%94%AF%E6%8C%81%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-text">3.1 åˆ—å‡ºAnsibleæ‰€æœ‰æ”¯æŒçš„æ¨¡å—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E5%85%B7%E4%BD%93%E7%94%A8%E6%B3%95"><span class="toc-text">3.2 æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„å…·ä½“ç”¨æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Ansible%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%BB%93%E6%9E%9C%EF%BC%88%E7%8A%B6%E6%80%81%E9%A2%9C%E8%89%B2%EF%BC%89"><span class="toc-text">3.3 Ansibleæ‰§è¡Œå‘½ä»¤ç»“æœï¼ˆçŠ¶æ€é¢œè‰²ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%EF%BC%89Ansible-%E6%A8%A1%E5%9D%97%EF%BC%88%E6%A0%B8%E5%BF%83%E5%86%85%E5%AE%B9%EF%BC%89"><span class="toc-text">4ï¼‰Ansible æ¨¡å—ï¼ˆæ ¸å¿ƒå†…å®¹ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-ping-%E6%B5%8B%E8%AF%95%E8%BF%9E%E9%80%9A%E6%80%A7%E6%A8%A1%E5%9D%97"><span class="toc-text">.1 ping æµ‹è¯•è¿é€šæ€§æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E9%80%9A%E8%BF%87master-61%E6%9C%BA%E5%99%A8%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8%E6%98%AF%E5%90%A6%E8%BF%90%E8%A1%8C"><span class="toc-text">ğŸ“Œé€šè¿‡master-61æœºå™¨ï¼ŒæŸ¥çœ‹ç›®æ ‡æœºå™¨æ˜¯å¦è¿è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-command-%E7%AE%80%E5%8D%95%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%9D%97"><span class="toc-text">.2 command ç®€å•å‘½ä»¤æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v2"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v2"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v2"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-text">ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E6%9F%A5%E7%9C%8B%E4%B8%BB%E6%9C%BA%E5%86%85%E5%AD%98"><span class="toc-text">ğŸ“Œè¿œç¨‹æŸ¥çœ‹ä¸»æœºå†…å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6"><span class="toc-text">ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E8%8E%B7%E5%8F%96%E6%9C%BA%E5%99%A8%E8%B4%9F%E8%BD%BD"><span class="toc-text">ğŸ“Œè¿œç¨‹è·å–æœºå™¨è´Ÿè½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%85%B3%E9%97%AD%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF"><span class="toc-text">ğŸ“Œå…³é—­å‘Šè­¦ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%9C%A8%E6%89%80%E6%9C%89%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%8C%E5%88%9B%E5%BB%BAwenjie01%E7%94%A8%E6%88%B7"><span class="toc-text">ğŸ“Œåœ¨æ‰€æœ‰æœºå™¨ä¸Šï¼Œåˆ›å»ºwenjie01ç”¨æˆ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E4%BD%BF%E7%94%A8command%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%93%E6%9C%89%E5%91%BD%E4%BB%A4"><span class="toc-text">ğŸ“Œä½¿ç”¨commandæä¾›çš„ä¸“æœ‰å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-shell-%E4%B8%87%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-text">.3 shell ä¸‡èƒ½æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v3"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v3"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E8%BF%87%E6%BB%A4ssh%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-text">ğŸ“Œè¿œç¨‹è¿‡æ»¤sshè¿›ç¨‹ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E4%BD%BF%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E7%AC%A6%E5%8F%B7%EF%BC%8C%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6"><span class="toc-text">ğŸ“Œä½¿ç”¨é‡å®šå‘ç¬¦å·ï¼Œåˆ›å»ºæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%A4%8D%E6%9D%82linux%E5%91%BD%E4%BB%A4"><span class="toc-text">ğŸ“Œè¿œç¨‹æ‰§è¡Œå¤æ‚linuxå‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-copy-%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97"><span class="toc-text">.4 copy æ‹·è´æ–‡ä»¶æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v4"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v4"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-file-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="toc-text">.5 file æ–‡ä»¶æ“ä½œæ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v3"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96%E6%A6%82%E8%A6%81"><span class="toc-text">ğŸ“–æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96%E5%8F%82%E6%95%B0"><span class="toc-text">ğŸ“–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6"><span class="toc-text">ğŸ“Œè¿œç¨‹åˆ›å»ºæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E4%B8%94%E8%AE%BE%E5%AE%9A%E6%9D%83%E9%99%90"><span class="toc-text">ğŸ“Œåˆ›å»ºæ–‡ä»¶ä¸”è®¾å®šæƒé™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7"><span class="toc-text">ğŸ“Œè¿œç¨‹ä¿®æ”¹æ–‡ä»¶å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%9B%E8%BD%AF%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6"><span class="toc-text">ğŸ“Œåˆ›è½¯è¿æ¥æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-script%E8%84%9A%E6%9C%AC%E6%A8%A1%E5%9D%97"><span class="toc-text">.6 scriptè„šæœ¬æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v4"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v5"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v5"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-text">ğŸ“Œè¿œç¨‹æ‰§è¡Œè„šæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%BF%9C%E7%A8%8B%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="toc-text">ğŸ“Œè¿œç¨‹åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œè„šæœ¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-cron%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="toc-text">.7 cronå®šæ—¶ä»»åŠ¡æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v5"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96%E6%A6%82%E8%A6%81-v2"><span class="toc-text">ğŸ“–æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96%E5%8F%82%E6%95%B0-v2"><span class="toc-text">ğŸ“–å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E6%B7%BB%E5%8A%A0ntpdate%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-text">ğŸ“Œæ·»åŠ ntpdateå®šæ—¶ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%A0%E9%99%A4%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-text">ğŸ“Œåˆ é™¤å®šæ—¶ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E4%BF%AE%E6%94%B9%E6%8C%87%E5%AE%9A%E5%90%8D%E7%A7%B0%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-text">ğŸ“Œä¿®æ”¹æŒ‡å®šåç§°çš„å®šæ—¶ä»»åŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-group-%E6%A8%A1%E5%9D%97"><span class="toc-text">.8 group æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%9B%E5%BB%BAwenjie-ops%E7%BB%84%EF%BC%8Cgid-1234"><span class="toc-text">ğŸ“Œåˆ›å»ºwenjie_opsç»„ï¼Œgid&#x3D;1234</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%A0%E9%99%A4%E7%BB%84"><span class="toc-text">ğŸ“Œåˆ é™¤ç»„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-user-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97"><span class="toc-text">.9 user ç”¨æˆ·æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v6"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v6"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-text">ğŸ“Œåˆ›å»ºç”¨æˆ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-yum-%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6"><span class="toc-text">.10 yum å®‰è£…è½¯ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v7"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v6"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v7"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%AE%89%E8%A3%85net-tools%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC"><span class="toc-text">ğŸ“Œå®‰è£…net-toolsæœ€æ–°ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%8D%B8%E8%BD%BDnet-rools%E8%BD%AF%E4%BB%B6"><span class="toc-text">ğŸ“Œå¸è½½net-roolsè½¯ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-service-systemd%E6%A8%A1%E5%9D%97"><span class="toc-text">.11 service&#x2F;systemdæ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%AE%89%E8%A3%85%EF%BC%8C%E5%90%AF%E5%8A%A8nginx%E6%9C%8D%E5%8A%A1"><span class="toc-text">ğŸ“Œå®‰è£…ï¼Œå¯åŠ¨nginxæœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-mount-%E6%8C%82%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="toc-text">.12 mount æŒ‚è½½æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v8"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v8"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E7%BB%99web%E6%9C%BA%E5%99%A8%E7%BB%84%E6%8C%82%E8%BD%BDnfs%E7%9B%AE%E5%BD%95%EF%BC%88%E5%8F%AA%E5%86%99%E5%85%A5-etc-fstab%E8%80%8C%E4%B8%8D%E6%8C%82%E8%BD%BD%EF%BC%89"><span class="toc-text">ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆåªå†™å…¥&#x2F;etc&#x2F;fstabè€Œä¸æŒ‚è½½ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E7%BB%99web%E6%9C%BA%E5%99%A8%E7%BB%84%E6%8C%82%E8%BD%BDnfs%E7%9B%AE%E5%BD%95%EF%BC%88%E7%AB%8B%E5%8D%B3%E6%8C%82%E8%BD%BD%E4%B8%94%E5%86%99%E5%85%A5-etc-fstab%EF%BC%89"><span class="toc-text">ğŸ“Œç»™webæœºå™¨ç»„æŒ‚è½½nfsç›®å½•ï¼ˆç«‹å³æŒ‚è½½ä¸”å†™å…¥&#x2F;etc&#x2F;fstabï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%8F%96%E6%B6%88%E6%8C%82%E8%BD%BD%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%88%A0%E9%99%A4fstab%E8%AE%B0%E5%BD%95"><span class="toc-text">ğŸ“Œå–æ¶ˆæŒ‚è½½ï¼Œä»¥åŠåˆ é™¤fstabè®°å½•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-archive%E5%8E%8B%E7%BC%A9%E6%A8%A1%E5%9D%97"><span class="toc-text">.13 archiveå‹ç¼©æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%93%E6%96%87%E6%A1%A3-v9"><span class="toc-text">ğŸ““æ–‡æ¡£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%8E%8B%E7%BC%A9-etc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%B0%E6%8C%87%E5%AE%9A%E8%B7%AF%E5%BE%84"><span class="toc-text">ğŸ“Œå‹ç¼©&#x2F;etcé…ç½®æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-unarchive%E8%A7%A3%E5%8E%8B%E7%BC%A9%E6%A8%A1%E5%9D%97"><span class="toc-text">.14 unarchiveè§£å‹ç¼©æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E8%A7%A3%E5%8E%8B%E7%BC%A9etc-tgz%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%EF%BC%88%E8%BF%9C%E7%A8%8B%E8%A7%A3%E5%8E%8B%EF%BC%89"><span class="toc-text">ğŸ“Œè§£å‹ç¼©etc.tgzåˆ°æŒ‡å®šç›®å½•ï¼ˆè¿œç¨‹è§£å‹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E5%B0%86%E7%AE%A1%E7%90%86%E6%9C%BA%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85%EF%BC%8C%E8%A7%A3%E5%8E%8B%E5%88%B0%E8%BF%9C%E7%A8%8B%E6%9C%BA%E5%99%A8%E4%B8%8A"><span class="toc-text">ğŸ“Œå°†ç®¡ç†æœºçš„å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°è¿œç¨‹æœºå™¨ä¸Š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-fetch-%E4%BB%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97"><span class="toc-text">15. fetch ä»å®¢æˆ·ç«¯æœåŠ¡æ–‡ä»¶æ¨¡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E6%A6%82%E8%A6%81-v7"><span class="toc-text">ğŸ“– æ¦‚è¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%96-%E5%8F%82%E6%95%B0-v9"><span class="toc-text">ğŸ“– å‚æ•°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%EF%BC%89ansible-playbook-%E5%89%A7%E6%9C%AC%E6%A8%A1%E5%BC%8F"><span class="toc-text">5ï¼‰ansible-playbook å‰§æœ¬æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#playbook%E5%89%A7%E6%9C%AC%E7%9A%84%E7%BB%84%E6%88%90%E8%A7%84%E8%8C%83"><span class="toc-text">playbookå‰§æœ¬çš„ç»„æˆè§„èŒƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%E4%B9%8Bhosts%E9%83%A8%E5%88%86"><span class="toc-text">å‰§æœ¬ä¹‹hostséƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%E4%B9%8Btasks%E8%AE%B2%E8%A7%A3"><span class="toc-text">å‰§æœ¬ä¹‹tasksè®²è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yaml%E8%AF%AD%E6%B3%95%E8%A7%84%E8%8C%83"><span class="toc-text">yamlè¯­æ³•è§„èŒƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#playbook%E7%BC%96%E5%86%99%E7%9A%84%E8%A7%84%E8%8C%83"><span class="toc-text">playbookç¼–å†™çš„è§„èŒƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#playbook%E5%AE%9E%E9%99%85%E7%BC%96%E5%86%99%E4%B8%8E%E6%89%A7%E8%A1%8C"><span class="toc-text">playbookå®é™…ç¼–å†™ä¸æ‰§è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E4%BD%BF%E7%94%A8%E5%89%A7%E6%9C%AC%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85nginx%E6%9C%8D%E5%8A%A1"><span class="toc-text">ğŸ“Œä½¿ç”¨å‰§æœ¬æ‰¹é‡å®‰è£…nginxæœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C%E4%BD%BF%E7%94%A8%E5%89%A7%E6%9C%AC%E9%83%A8%E7%BD%B2rsync%E6%9C%8D%E5%8A%A1"><span class="toc-text">ğŸ“Œä½¿ç”¨å‰§æœ¬éƒ¨ç½²rsyncæœåŠ¡</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#6%EF%BC%89Ansible-%E5%8F%98%E9%87%8F"><span class="toc-text">6ï¼‰Ansible å˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%91%BD%E5%90%8D%E5%8F%98%E9%87%8F"><span class="toc-text">.1 å‘½åå˜é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-text">.2 å®šä¹‰å˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9C%A8playbook%E6%96%87%E4%BB%B6%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89"><span class="toc-text">.2.1 åœ¨playbookæ–‡ä»¶ä¸­è¿›è¡Œå˜é‡å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%80%9A%E8%BF%87vars-file%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-text">.2.2 é€šè¿‡vars_fileå®šä¹‰å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%80%9A%E8%BF%87Inventory%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89"><span class="toc-text">.2.3 é€šè¿‡Inventoryä¸»æœºæ¸…å•ä¸­è¿›è¡Œå˜é‡å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%80%9A%E8%BF%87hosts-vars%E5%92%8Cgroup-vars%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-text">2.4 é€šè¿‡hosts_varså’Œgroup_varså®šä¹‰å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%EF%BC%88%E5%91%BD%E4%BB%A4%E8%A1%8C-e-%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F%EF%BC%89"><span class="toc-text">2.5 å‘½ä»¤è¡Œå®šä¹‰å˜é‡ï¼ˆå‘½ä»¤è¡Œ -e è®¾ç½®å˜é‡ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text">2.6 ç›´æ¥ä½¿ç”¨å†…ç½®å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text">2.7 å†…ç½®å˜é‡è®¾ç½®å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E5%B8%B8%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">2.8 å†…ç½®å˜é‡å¸¸ç”¨æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E5%B1%82%E7%BA%A7%E5%8F%98%E9%87%8F"><span class="toc-text">2.9 å±‚çº§å˜é‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%98%E9%87%8F%E6%B3%A8%E5%86%8C"><span class="toc-text">.3 å˜é‡æ³¨å†Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-facts%E7%BC%93%E5%AD%98"><span class="toc-text">.4 factsç¼“å­˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-handlers-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">.5 handlers è§¦å‘å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-when-%E6%9D%A1%E4%BB%B6"><span class="toc-text">.6 when æ¡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-with-item%E5%BE%AA%E7%8E%AF"><span class="toc-text">.7 with itemå¾ªç¯</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/317ae1f5.html" title="Gitåˆ é™¤æš‚å­˜åŒºæˆ–ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶">Gitåˆ é™¤æš‚å­˜åŒºæˆ–ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶</a><time datetime="2023-03-14T01:17:28.000Z" title="å‘è¡¨äº 2023-03-14 01:17:28">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/70fb250c.html" title="Gitå¦‚ä½•å›æ»šä»£ç ?">Gitå¦‚ä½•å›æ»šä»£ç ?</a><time datetime="2023-03-14T01:13:35.000Z" title="å‘è¡¨äº 2023-03-14 01:13:35">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1c5e0d7.html" title="Tomcat å­¦ä¹ ç¬”è®°">Tomcat å­¦ä¹ ç¬”è®°</a><time datetime="2023-03-13T23:19:24.000Z" title="å‘è¡¨äº 2023-03-13 23:19:24">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1020521.html" title="Nginx å­¦ä¹ ç¬”è®°">Nginx å­¦ä¹ ç¬”è®°</a><time datetime="2023-03-13T23:16:34.000Z" title="å‘è¡¨äº 2023-03-13 23:16:34">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/fa17c65a.html" title="Redis å­¦ä¹ ç¬”è®°">Redis å­¦ä¹ ç¬”è®°</a><time datetime="2023-03-13T23:16:24.000Z" title="å‘è¡¨äº 2023-03-13 23:16:24">2023-03-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By aceniu</div><div class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>âœ¨ æœ‰æ–°æ–‡ç« å•¦ï¼ ğŸ‘‰</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">ğŸ—ç‚¹å‡»é£Ÿç”¨ğŸ”</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: 'âœ¨ æœ‰æ–°æ–‡ç« å•¦ï¼ ğŸ‘‰',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: 'ğŸ—ç‚¹å‡»é£Ÿç”¨ğŸ”',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>