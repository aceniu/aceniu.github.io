<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Docker 学习笔记 | 艾斯牛 Blog</title><meta name="author" content="aceniu,123354319@qq.com"><meta name="copyright" content="aceniu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1）简介 Docker：https:&#x2F;&#x2F;www.docker.com  Docker Hub：https:&#x2F;&#x2F;hub.docker.com  1.1 Docker 为什么横空出世 传统开发中，软件编码开发&#x2F;测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，开发需要清楚的告诉"><meta property="og:type" content="article"><meta property="og:title" content="Docker 学习笔记"><meta property="og:url" content="https://blog.halfsummer.xyz/posts/920e92d1.html"><meta property="og:site_name" content="艾斯牛 Blog"><meta property="og:description" content="1）简介 Docker：https:&#x2F;&#x2F;www.docker.com  Docker Hub：https:&#x2F;&#x2F;hub.docker.com  1.1 Docker 为什么横空出世 传统开发中，软件编码开发&#x2F;测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，开发需要清楚的告诉"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg"><meta property="article:published_time" content="2023-03-13T23:04:59.000Z"><meta property="article:modified_time" content="2023-03-13T17:48:54.679Z"><meta property="article:author" content="aceniu"><meta property="article:tag" content="aceniu,blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.halfsummer.xyz/posts/920e92d1.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Docker 学习笔记",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-13 17:48:54"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="艾斯牛 Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/images/"><i class="fa-fw fa fa-images faa-tada"></i> <span>图床</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="艾斯牛 Blog"><span class="site-name">艾斯牛 Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/images/"><i class="fa-fw fa fa-images faa-tada"></i> <span>图床</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker 学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-13T23:04:59.000Z" title="发表于 2023-03-13 23:04:59">2023-03-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-13T17:48:54.679Z" title="更新于 2023-03-13 17:48:54">2023-03-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Docker 学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer"><h1 id="1）简介">1）简介</h1><div class="tip home"><p>Docker：<a target="_blank" rel="noopener" href="https://www.docker.com">https://www.docker.com</a></p></div><div class="tip home"><p>Docker Hub：<a target="_blank" rel="noopener" href="https://hub.docker.com">https://hub.docker.com</a></p></div><h2 id="1-1-Docker-为什么横空出世">1.1 Docker 为什么横空出世</h2><p>传统开发中，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，<b style="color:#01b4bc">开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况</b>。<b style="color:#fa5457">Docker的出现使得Docker得以打破过去「程序即应用」的观念。透过镜像(images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作</b>。</p><h2 id="1-2-概述">1.2 概述</h2><p><b style="color:#fa5457">Docker是基于Go语言实现的云开源项目</b>。</p><p>Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的 APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“<b style="color:#fa5457">一次镜像，处处运行</b>”。</p><p><b style="color:#01b4bc">Linux容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的</b>。将应用打成镜像，通过镜像成为运行在Docker容器上面的实例，而 Docker容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。<b style="color:#fa5457">只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作</b>。</p><h2 id="1-3-容器与虚拟机的比较">1.3 容器与虚拟机的比较</h2><p>📌 <strong>纯物理部署、虚拟机的部署的缺点</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13d7da4.png" alt="image-20230106105948208"></p><p>📌 <strong>虚拟化发展史</strong></p><ul><li><p>个人虚拟化 vmware workstation，主要用于个人电脑。</p></li><li><p>企业版虚拟化 vmware esxi 虚拟化工具，用于高性能服务器</p></li><li><p>Linux下虚拟机工作，kvm 工具</p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230106111151052.png" alt="image-20230106111151052" style="zoom:50%"></li><li><p>容器-LXC &amp; docker</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c1311949.png" alt="image-20230106111707293"></p></li></ul><p>📌 <strong>开发中的问题</strong></p><ul><li>分布式系统中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。</li><li>在数百上千台服务中重复部署，环境不一定一致，开发、测试、生产环境有差异，会遇到各种问题</li></ul><p>📌 <strong>Docker 解决依赖兼容问题</strong></p><ul><li>将应用的Libs（函数库）、Deps（依赖）、配置与应用一起打包</li><li>将每个应用放到一个隔离<strong>容器</strong>去运行，避免互相干扰</li></ul><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c14030d7.png" alt="在这里插入图片描述" style="zoom:33%"><p>📌 <strong>Docker 解决操作系统环境差异</strong></p><p>应用程序在计算机中交互的流程如下：</p><p>1）应用调用操作系统应用（函数库），实现各种功能</p><p>2）系统函数库是对内核指令集的封装，会调用内核指令</p><p>3）内核指令操作计算机硬件</p><p>📌 <strong>Docker如何解决不同系统环境的问题？</strong></p><ul><li><b style="color:#01b4bc">Docker将用户程序与所需要调用的系统(比如Ubuntu)函数库一起打包</b>，不管实际的运行系统是Centos还是Ubuntu都可以正常运行，因为应用程序调用的是捆绑在一起的系统的函数，系统函数再调用linux内核的函数。</li><li>Docker运行到不同操作系统时，直接基于打包的函数库，<b style="color:#01b4bc">只借助于操作系统的Linux内核来运行，不在乎实际运行的系统版本是什么</b>。</li></ul><blockquote><p>Docker是一个快速交付应用、运行应用的技术，具备下列优势：</p><ul><li>可以<b style="color:#01b4bc">将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</b></li><li>运行时<b style="color:#01b4bc">利用沙箱机制形成隔离容器</b>，各个应用<b style="color:#01b4bc">互不干扰</b></li><li>启动、移除都可以通过一行命令完成，方便快捷</li></ul></blockquote><blockquote><p>Docker和虚拟机的差异：</p><ul><li>docker是一个系统进程；虚拟机是在操作系统中的操作系统</li><li>docker体积小、启动速度快、性能好；虚拟机体积大、启动速度慢、性能一般</li></ul></blockquote><h2 id="1-4-Docker-架构">1.4 Docker 架构</h2><p>Docker是一个CS架构的程序，由两部分组成：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13edfdc.png" alt="在这里插入图片描述"></p><ul><li>服务端(server)：Docker守护进程，负责处理Docker指令，管理镜像、容器等</li><li>客户端(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。</li></ul><h2 id="1-5-Docker-引擎">1.5 Docker 引擎</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c13c4845.png" alt="image-20230106114851591"></p><h2 id="1-6-Docker-平台组成">1.6 Docker 平台组成</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c10526cd.png" alt="image-20230106115104206"></p><h2 id="1-7-镜像-容器">1.7 镜像&amp;容器</h2><p><strong>镜像（Image）</strong>：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。</p><p><strong>容器（Container）</strong>：镜像中的应用程序运行后形成的进程就是<strong>容器</strong>，只是Docker会给容器进程做隔离，对外不可见。</p><blockquote><p><strong>镜像</strong>就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。</p><p><strong>容器</strong>就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。</p></blockquote><h2 id="1-8-Docker-生命周期">1.8 Docker 生命周期</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c10de085.png" alt="image-20230106201947897"></p><h2 id="1-9-Docker-镜像原理理解">1.9 Docker 镜像原理理解</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cos.halfsummer.xyz/pictures/niubb/2023/20230313-640f3c1088a88.png" alt="image-20230106214026388"></p><h1 id="2）Docker-安装">2）Docker 安装</h1><h2 id="2-1-Docker-版本说明">2.1 Docker 版本说明</h2><ul><li><a target="_blank" rel="noopener" href="https://hub.docker.com/">DockerHub</a>：DockerHub是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。</li><li>国内也有类似于DockerHub 的公开服务，比如 网易云镜像服务、阿里云镜像库等。</li></ul><p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p><p>Docker CE 分为 <code>stable</code> <code>test</code> 和 <code>nightly</code> 三个更新频道。</p><blockquote><p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询内核版本</span></span><br><span class="line">cat /etc/redhat-release</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询操作系统的发型版号</span></span><br><span class="line">uname -r</span><br></pre></td></tr></table></figure><h2 id="2-2-卸载">2.2 卸载</h2><p>如果之前安装过旧版本的Docker，可以使用下面命令卸载：(<code>'\'</code>表示本行命令未结束，下一行继续，<code>'\'</code>前记得有一个空格)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br></pre></td></tr></table></figure><h2 id="2-3-安装">2.3 安装</h2><p>📌 <strong>基础环境配置</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/Centos-base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>开启linux内核的流量转发：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/docker.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.conf.default.rp_filter = 0</span><br><span class="line">net.ipv4.conf.all.rp_filter = 0</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>重新加载修改内核参数的配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br></pre></td></tr></table></figure><blockquote><p>🔴 如果报错：</p><blockquote><p>No such file or directory<br>sysctl: cannot stat /proc/sys/net/bridge/bridge-nf-call-ip6tables: No such file or directory<br>sysctl: cannot stat /proc/sys/net/bridge/beidge-nf-call-iptables: No such file or directory<br>net.ipv4.conf.default.rp_filter = 0<br>net.ipv4.conf.all.rp_filter = 0<br>net.ipv4.ip_forward = 1</p></blockquote><p>就执行如下命令：（向内核中加载模块）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br></pre></td></tr></table></figure><p>然后再重新执行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.d/docker.conf</span><br></pre></td></tr></table></figure></blockquote><p>📌 <strong>yum安装</strong></p><ul><li><p><strong>方法1</strong>：</p><p>首先需要将虚拟机联网，安装yum工具、存储驱动、逻辑卷管理：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure><p>更新本地镜像源：(<code>yum-config-manager</code> 命令的本质是对 <code>/etc/yum.repos.d/</code>(库数据的储存位置)文件夹下文件的增删查改。)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure></li><li><p><strong>方法2</strong>：</p><p>查看源中可用版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker-ce --showduplicates | sort -r</span><br></pre></td></tr></table></figure><p>如果没有匹配项，则下载阿里源repo文件 第一个是阿里云自带仓库 第二个是阿里云提供的docker专属repo仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-7.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line">curl -o /etc/yum.repos.d/docker-ce.repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p>更新yum缓存:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure><p>安装与卸载:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce-xxx </span><br><span class="line"></span><br><span class="line">yum remove -y docker-xxx</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-4-配置镜像加速器">2.4 配置镜像加速器</h2><p>Docker的镜像默认是从Docker hub下载，网速很慢，国内有很多云服务商都提供了加速器服务（阿里云加速器，Daocloud加速器，灵雀云加速器等）</p><p>注意：此处docker版本不同daemon文件的后缀不同，新版后缀为.conf，旧版的可能为.json。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-9-centos ~]# mkdir -p /etc/docker</span><br><span class="line">[root@VM-4-9-centos ~]#</span><br><span class="line">[root@VM-4-9-centos ~]# touch /etc/docker/daemon.conf</span><br><span class="line">[root@VM-4-9-centos ~]#</span><br><span class="line">[root@VM-4-9-centos ~]# vim /etc/docker/daemon.conf</span><br><span class="line">[root@VM-4-9-centos ~]# cat /etc/docker/daemon.conf</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">　　&quot;registry-mirrors&quot;:[</span><br><span class="line">　　　　&quot;https://8xpk5wnt.mirror.aliyun.com&quot;</span><br><span class="line">　　]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者：</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://hub.daocloud.io&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-启动">2.5 启动</h2><p>关闭防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止开机启动防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重载配置文件</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加开机启动</span></span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新启动服务</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="2-6-测试">2.6 测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">&#x27;hello-world:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">2db29710123e: Pull complete </span><br><span class="line">Digest: sha256:6e8b6f026e0b9c419ea0fd02d3905dd0952ad1feea67543f525c73a0a790fefb</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line">...省略部分数据...</span><br></pre></td></tr></table></figure><hr><h1 id="3）镜像管理命令">3）镜像管理命令</h1><p>使用镜像的流程：</p><ol><li>获取该软件的docker镜像。</li><li>运行该镜像，就启动了一个容器。</li><li>停止容器，删除该镜像。</li></ol><h2 id="8-1-搜索镜像是否存在于镜像库">8.1 搜索镜像是否存在于镜像库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search 镜像名:tag	# tag就是具体的标签版本</span><br></pre></td></tr></table></figure><h2 id="8-2-查看镜像">8.2 查看镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前所有镜像</span></span><br><span class="line">[root@localhost ~]# docker images</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker image ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个镜像详细信息</span></span><br><span class="line">[root@localhost ~]# docker images 镜像名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只显示镜像<span class="built_in">id</span> --quiet</span></span><br><span class="line">[root@localhost ~]# docker images -q</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化显示镜像只提取出需要的信息</span></span><br><span class="line">[root@localhost ~]# docker images --format &quot;&#123;&#123;.ID&#125;&#125;--&#123;&#123;.Repository&#125;&#125;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化成表格 显示镜像只提取出需要的信息</span></span><br><span class="line">[root@localhost ~]# docker images --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;&quot;</span><br></pre></td></tr></table></figure><h2 id="8-2-镜像拉取">8.2 镜像拉取</h2><p>获取镜像，镜像托管仓库，好比yum源一样。（docker默认仓库是dockerhub）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker pull 镜像名:tag	# tag | latest</span><br></pre></td></tr></table></figure><h2 id="8-3-查看-Docker-的服务信息">8.3 查看 Docker 的服务信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker info</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker info | grep Root</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br></pre></td></tr></table></figure><p>镜像存放在：<code>ll /var/lib/docker/image/overlay2/imagedb/content/sha256/</code></p><p>镜像文件其实是一个json数据类型的文件，记录 镜像和容器的配置关系</p><h2 id="8-4-删除镜像">8.4 删除镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker rmi 镜像名(或 ID 或 ID前三位)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量删除</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker images -aq是列出所有的镜像 用反引号‘`’框柱表示取出命令的结果</span></span><br><span class="line">[root@localhost ~]# docker rmi `docker images -aq`</span><br></pre></td></tr></table></figure><h2 id="8-5-导出镜像">8.5 导出镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker image save 镜像名[:tag] &gt; /重定向的位置/镜像名.tgz</span><br></pre></td></tr></table></figure><h2 id="8-6-导入镜像">8.6 导入镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker image load -i /位置/镜像名.tgz</span><br></pre></td></tr></table></figure><h2 id="8-7-查看-Docker-镜像信息">8.7 查看 Docker 镜像信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image inspect 镜像id</span><br></pre></td></tr></table></figure><hr><h1 id="4）容器管理命令">4）容器管理命令</h1><h2 id="9-1-运行、创建容器">9.1 运行、创建容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果镜像不存在本地，则回去下载该镜像</span></span><br><span class="line">docker run 镜像名</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">丰富docker运行的参数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">rm</span> 容器挂掉后被删除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name niubb 给容器命名niubb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ping 是后面容器执行的指令</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# docker run -d --rm --name niubb centos:7.6.1810 ping baidu.com</span><br><span class="line">5579d43af5173d37d575cbb497573ec5b7db6e0daeed70730115e0eb6db34ad7</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND            CREATED          STATUS          PORTS     NAMES</span><br><span class="line">5579d43af517   centos:7.6.1810   &quot;ping baidu.com&quot;   12 seconds ago   Up 11 seconds             niubb</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用--<span class="built_in">rm</span>后，容器挂掉后删除了状态记录</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">52e5ccb0d743   centos         &quot;/bin/bash&quot;              11 minutes ago   Exited (0) 11 minutes ago             heuristic_rosalind</span><br><span class="line">6684befd9bfa   f1cb7c7d58b7   &quot;bash&quot;                   2 hours ago      Exited (130) 2 hours ago              agitated_bartik</span><br><span class="line">3bbc199beb84   f1cb7c7d58b7   &quot;bash&quot;                   3 hours ago      Exited (127) 2 hours ago              tender_shtern</span><br><span class="line">2f2c4da21e01   5d0da3dc9764   &quot;bash&quot;                   3 hours ago      Exited (0) 3 hours ago                agitated_buck</span><br><span class="line">e2c3e6042ba3   nginx          &quot;/docker-entrypoint.…&quot;   4 hours ago      Exited (0) 10 minutes ago             busy_lewin</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 宿主机路径:容器内路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:rw 为可读写可省略</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">:ro 在容器内只读，如果写入会报错</span></span><br><span class="line">[root@localhost ~]# docker run -d -v /opt:/tep/centos7.6 centos:7.6.1810</span><br><span class="line">[root@localhost ~]# docker run -d -v /opt:/tep/centos7.6:rw centos:7.6.1810</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认情况下，仓库被创建在/var/lib/registry目录下</span></span><br></pre></td></tr></table></figure><p><span style="color:red;background:#ff0">※注意：</span></p><ol><li><p><span style="color:red">容器内的程序必须处于前台运行状态，否则容器就会直接退出。</span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run centos</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS       PORTS                NAMES</span><br></pre></td></tr></table></figure></li><li><p>如果容器内，什么事情也不做，容器也会挂掉。容器内必须有一个进程在前台运行。</p></li></ol><h2 id="9-2-启动、停止、重启容器">9.2 启动、停止、重启容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id/名字</span><br><span class="line">docker stop 容器id/名字</span><br><span class="line">docker restart 容器id/名字</span><br></pre></td></tr></table></figure><h2 id="9-3-查看容器、容器日志、容器的详细信息">9.3 查看容器、容器日志、容器的详细信息</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器</span></span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有容器状态</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器日志</span></span><br><span class="line">[root@localhost ~]# docker logs 容器id</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时刷新容器日志</span></span><br><span class="line">[root@localhost ~]# docker logs -f 容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器的详细信息</span></span><br><span class="line">[root@localhost ~]# docker container inspect 容器id</span><br></pre></td></tr></table></figure><h2 id="9-4-删除容器">9.4 删除容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 删除指定容器</span></span><br><span class="line">[root@localhost ~]# docker rm -f &lt;containerid&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 删除未启动成功的容器</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -a|grep Created|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -qf status=created)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 删除退出状态的容器</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -a|grep Exited|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者</span></span><br><span class="line">[root@localhost ~]# docker rm $(docker ps -qf status=exited)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@docker_test ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS                           PORTS                               NAMES</span><br><span class="line">d13ef6c6cb8e   nginx     &quot;/docker-entrypoint.…&quot;   6 minutes ago       Up 6 minutes                     0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx1</span><br><span class="line">e30bfa566607   docker    &quot;docker-entrypoint.s…&quot;   51 minutes ago      Exited (125) 13 minutes ago                                          peaceful_black</span><br><span class="line">886aa44c834e   docker    &quot;docker-entrypoint.s…&quot;   57 minutes ago      Exited (0) 55 minutes ago                                            festive_wing</span><br><span class="line">4d8d27bc3d78   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (0) 58 minutes ago                                            reverent_engelbart</span><br><span class="line">74026fa35fbe   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (0) About an hour ago                                         jovial_galois</span><br><span class="line">64d0278cd793   nginx     &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (127) About an hour ago                                       practical_archimedes</span><br><span class="line">[root@docker_test ~]# docker rm $(docker ps -a|grep Exited|awk &#x27;&#123;print $1&#125;&#x27;)</span><br><span class="line">e30bfa566607</span><br><span class="line">886aa44c834e</span><br><span class="line">4d8d27bc3d78</span><br><span class="line">74026fa35fbe</span><br><span class="line">64d0278cd793</span><br><span class="line">[root@docker_test ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">d13ef6c6cb8e   nginx     &quot;/docker-entrypoint.…&quot;   28 minutes ago   Up 28 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx1</span><br></pre></td></tr></table></figure><h2 id="9-5-进入容器内">9.5 进入容器内</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it 交互操作</span></span><br><span class="line">[root@localhost ~]# docker exec -it 容器id bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">aa7cb64f6428   nginx     &quot;/docker-entrypoint.…&quot;   6 seconds ago   Up 5 seconds   80/tcp    sleepy_faraday</span><br><span class="line">[root@localhost ~]# docker exec -it aa7cb64f6428 bash</span><br><span class="line">root@aa7cb64f6428:/# </span><br></pre></td></tr></table></figure><h2 id="9-6-容器的端口映射">9.6 容器的端口映射</h2><p>宿主机的端口范围：0~65535</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 端口映射：宿主机端口:容器端口</span></span><br><span class="line">[root@localhost ~]# docker run -d -p 端口号:端口号 镜像名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-P 随机端口映射</span></span><br><span class="line">[root@localhost ~]# docker run -d -P 镜像名</span><br></pre></td></tr></table></figure><h2 id="9-7-查看容器的端口映射">9.7 查看容器的端口映射</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker port 容器id</span><br></pre></td></tr></table></figure><h2 id="9-8-更新容器参数">9.8 更新容器参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker update [选项] 容器id</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>--blkio-weight</code></td><td style="text-align:left">阻塞IO (相对权重)，介于10到1000之间，0表示禁用（默认禁止）</td></tr><tr><td style="text-align:left"><code>--cpu-period</code></td><td style="text-align:left">限制CPU CFS（完全公平的调度程序）期限</td></tr><tr><td style="text-align:left"><code>--cpu-quota</code></td><td style="text-align:left">限制CPU CFS（完全公平的调度程序）配额</td></tr><tr><td style="text-align:left"><code>--cpu-rt-period</code></td><td style="text-align:left"><code>API 1.25+</code>，将CPU实时时间限制为微秒</td></tr><tr><td style="text-align:left"><code>--cpu-rt-runtime</code></td><td style="text-align:left"><code>API 1.25+</code>，将CPU实时运行时间限制为微秒</td></tr><tr><td style="text-align:left"><code>--cpu-shares</code>, <code>-c</code></td><td style="text-align:left">CPU份额（相对权重）</td></tr><tr><td style="text-align:left"><code>--cpus</code></td><td style="text-align:left"><code>API 1.29+</code>，CPU数量</td></tr><tr><td style="text-align:left"><code>--cpuset-cpus</code></td><td style="text-align:left">允许执行的CPU（0-3，0,1）</td></tr><tr><td style="text-align:left"><code>--cpuset-mem</code></td><td style="text-align:left">允许执行的MEM（0-3，0,1）</td></tr><tr><td style="text-align:left"><code>--kernel-memory</code></td><td style="text-align:left">内核内存限制</td></tr><tr><td style="text-align:left"><code>--memory-swap</code></td><td style="text-align:left">交换限制等于内存加交换，“-1”以启用无限交换</td></tr><tr><td style="text-align:left"><code>--memory-reservatio</code></td><td style="text-align:left">内存软限制</td></tr><tr><td style="text-align:left"><code>--memory</code>, <code>-m</code></td><td style="text-align:left">内存限制</td></tr><tr><td style="text-align:left"><code>--pids-limit</code></td><td style="text-align:left"><code>API 1.40+</code>，调节容器pids限制（-1表示无限制）</td></tr><tr><td style="text-align:left"><code>--restart</code></td><td style="text-align:left">容器退出时重新启动策略以应用</td></tr></tbody></table><h2 id="9-9-容器的文件拷贝">9.9 容器的文件拷贝</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器内拷贝文件到linux主机上</span></span><br><span class="line">[root@localhost ~]# docker cp 容器id:容器内路径 目标主机路径</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从宿主机拷贝文件到容器内</span> </span><br><span class="line">[root@localhost ~]# docker cp 文件路径 容器id:容器内路径</span><br></pre></td></tr></table></figure><h2 id="9-8-容器的提交">9.8 容器的提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker commit 容器id 重命名镜像</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS                            PORTS     NAMES</span><br><span class="line">a04a590adf6c   centos:7.6.1810   &quot;bash&quot;                   59 seconds ago   Exited (0) 7 seconds ago                    awesome_lamarr</span><br><span class="line">[root@localhost ~]# docker commit a04a590adf6c niubb/centos-vim-7.6.1810</span><br><span class="line">sha256:f6f3648f6cccdd589e6849d0075d96bd53c3727062b168fac6775b904850fef9</span><br><span class="line">[root@localhost ~]# docker images</span><br><span class="line">REPOSITORY                  TAG        IMAGE ID       CREATED         SIZE</span><br><span class="line">niubb/centos-vim-7.6.1810   latest     f6f3648f6ccc   9 seconds ago   449MB</span><br><span class="line">centos                      7.6.1810   f1cb7c7d58b7   3 years ago     202MB</span><br></pre></td></tr></table></figure><h2 id="9-9-容器的导出和导入">9.9 容器的导出和导入</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> -o 文件名.tar CONTAINER	<span class="comment"># 导出容器的内容留作为一个tar归档文件</span></span><br><span class="line">docker import [OPTIONS] 文件名.tar 命名CONTAINER	<span class="comment"># 从tar包中得内容创建一个新的文件系统再导入为镜像</span></span><br></pre></td></tr></table></figure><h2 id="9-9-查看容器详细信息">9.9 查看容器详细信息</h2><p><strong>方法一：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect 容器名称/容器id</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect nginx1</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;d13ef6c6cb8e10be379cd796956f3e334aa44ceef15da80db3f4fddf14b09479&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-01-21T12:11:57.22722614Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 84812,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2023-01-21T12:11:57.504385223Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:a99a39d070bfd1cb60fe65c45dea3a33764dc00a9546bf8dc46cb5a11b1b50e9&quot;,</span><br><span class="line">...省略数据...</span><br></pre></td></tr></table></figure><p><strong>方法二：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询容器创建语句</span></span><br><span class="line">[root@localhost ~]# runlike -p 容器名</span><br></pre></td></tr></table></figure><ul><li><p>安装runlike</p><p>需要安装pip工具包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install python-pip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果不成功，尝试下列命令</span></span><br><span class="line">[root@localhost ~]# yum -y install python36</span><br><span class="line">[root@localhost ~]# pip install --upgrade pip</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可以尝试更换国内源</span></span><br><span class="line">[root@localhost ~]# touch /etc/pip.conf</span><br><span class="line">[root@docker_test ~]# cat &gt;&gt; /etc/pip.conf &lt;&lt; EOF</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">[global]</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">EOF</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# pip3 install runlike</span><br></pre></td></tr></table></figure></li></ul><hr><h1 id="5）Docker-镜像">5）Docker 镜像</h1><p>是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。</p><p>只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p><p>部署一个用于你需要的容器环境。</p><ul><li>定制docker镜像有两种方式：<ol><li>手动修改容器内容，导出新的镜像</li><li>基于Dockerfile 自行编写指令，基于指令流程创建镜像。</li></ol></li></ul><h2 id="10-1-dockerfile-指令">10.1 dockerfile 指令</h2><h3 id="10-1-1-FROM-指定基础镜像">10.1.1 FROM 指定基础镜像</h3><h3 id="10-1-2-MAINTAINER-指定维护者信息">10.1.2 MAINTAINER 指定维护者信息</h3><p>（可以没有维护者）</p><h3 id="10-1-3-RUN-执行命令">10.1.3 RUN 执行命令</h3><h3 id="10-1-4-ADD-拷贝文件，会自动解压">10.1.4 ADD 拷贝文件，会自动解压</h3><ol><li>添加宿主机的文件到容器内，如果是gzip、bzip2、xz、tar ADD能自动解压到当前路径下。</li><li>原文件如果是URL，此时docker引擎会下载该链接，放入目标路径，且自动设置为600权限。如果URL源文件是压缩包，则不自动解压。</li></ol><h3 id="10-1-5-COPY-复制文件">10.1.5 COPY 复制文件</h3><p>添加宿主机的文件到容器内，COPY仅复制</p><h3 id="10-1-6-WORKDIR-设置当前工作目录">10.1.6 WORKDIR 设置当前工作目录</h3><p>（相当于cd）</p><h3 id="10-1-7-VOLUME-设置卷，挂载到主机目录">10.1.7 VOLUME 设置卷，挂载到主机目录</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;/data1&quot;</span>,<span class="string">&quot;/data2&quot;</span>]</span></span><br><span class="line"><span class="comment"># 支持列表的形式挂载多个文件夹</span></span><br></pre></td></tr></table></figure><h3 id="10-1-8-EXPOSE-指定对外的端口">10.1.8 EXPOSE 指定对外的端口</h3><h3 id="10-1-9-CMD-指定容器启动后要干的事情">10.1.9 CMD 指定容器启动后要干的事情</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure><p>相当于</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;cat&quot;</span>，<span class="string">&quot;/etc/os-release&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul><li><p>Docker挂载主机目录访问如果出现cannot open directory.：Permission denied</p><p>解决办法：在挂载目录后多加一个–privileged=true参数即可（扩大容器权限，使容器内的root拥有真正的root权限）</p></li></ul><h3 id="10-1-10-ENTRYPOINT-容器启动后执行的命令">10.1.10 ENTRYPOINT 容器启动后执行的命令</h3><p>当指定了ENTRYPOINT之后，CMD的指令语义就有了变化。CMD的内容当做参数传递给ENTRYPOINT指令。</p><h3 id="10-1-11-ENV-环境变量">10.1.11 ENV 环境变量</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> MYSQL_VERSION=<span class="number">5.6</span></span><br></pre></td></tr></table></figure><p>ARG和ENV的区别在于，ENV无论实在镜像构建时，还是容器运行时，该变量都可以使用。ARG只存在于构建镜像时。</p><p>10.1.12 USER 用户切换</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">USER</span> niubb</span><br></pre></td></tr></table></figure><h3 id="10-1-12-restart-重启机制">10.1.12 restart 重启机制</h3><p>docker容器的重启策略有下面四种:</p><ul><li><code>no</code><br>是默认的重启策略,docker容器如启动失败或意外停止后Docker Daemon不会尝试进行重启，除非手动启动容器，否则一直是stop的状态。</li><li><code>always</code><br>表示永远重启，它的先决条件是如果你使用<code>docker stop</code>命令停止了容器则docker不会自行启动该容器，但如果执行<code>docker stop</code>命令后重启了Docker Daemon则该容器会触发<code>always</code>重启策略，进而启动容器。</li><li><code>on-failure</code><br>重启策略的触发标准是当<code>Docker Daemon</code>检测到容器非正常停止后则会执行该重启策略。<code>on-failure</code>要求传入一个整型参数表示重启次数，当重启次数<code>&gt;=</code>该整数值则不会予以重启。</li><li><code>unless-stopped</code><br>重启策略与<code>always</code>很相似，唯一不同处在于<code>unless-stopped</code>会在<code>Docker Daemon</code>启动时会检测docker容器列表内的容器在上次停止时的状态，如果上一次容器停止时就是stop状态则不会启动该容器，否则启动该容器。</li></ul><h2 id="10-2-构建镜像">10.2 构建镜像</h2><p>cd切换到写好的dockerfile文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker bulid .</span><br><span class="line">docker bulid -t &#x27;取一个镜像名&#x27; .</span><br></pre></td></tr></table></figure><h1 id="11）容器数据卷">11）容器数据卷</h1><h2 id="1-命令">.1 命令</h2><ol><li><p>初始化运行容器时：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录 镜像名</span><br></pre></td></tr></table></figure></li><li><p>dockerfile:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;宿主机绝对路径&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>值得注意的是通过 VOLUME 指令创建的挂载点，无法指定主机上对应的目录，而是自动生成的。</p><p>在dockerfile中VOLUME可以指定多个挂在目录，即<code>[&quot;宿主机绝对路径1&quot;,&quot;宿主机绝对路径2&quot;]</code>代表这两个目录都会挂在到宿主机的自动生成的目录。</p></li></ol><h2 id="2-概述">.2 概述</h2><ul><li><p>容器在运行时，应该保证在存储层不写入任何数据，运行在容器内产生的数据，我们推荐是挂载写入到宿主机上，进行维护。卷的设计目的就是<span style="color:red">数据的持久化</span>，完全独立于容器的生存周期，因此Docker不会在容器删除是删除器挂载的数据卷。</p></li><li><p>特点：</p><ol><li>数据卷可在容器之间共享或重用数据</li><li>卷中的更改可以直接实时生效</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ol></li><li><p>注意：</p><p>Docker挂载主机目录访问如果出现<code>cannot open directory .: Permission denied</code></p><p>解决办法：在挂载目录后多加一个–privileged=true参数即可。</p><p>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，在SELinux里面挂载目录被禁止掉了额，如果要开启，我们一般使用–privileged=true命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p></li></ul><h2 id="3-读写规则">.3 读写规则</h2><p><code>:rw</code> 默认规则为可读写。</p><p><code>:ro</code> 容器实例内部被限制，只能读取不能写(= read only)，此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:rw 镜像名</span><br><span class="line">docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</span><br></pre></td></tr></table></figure><h2 id="4-卷的继承和共享">.4 卷的继承和共享</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it  --privileged=true --volumes-from 父类容器id  --name u2 镜像名</span><br></pre></td></tr></table></figure><p>此时u2只是继承了父类容器的规则，父类容器如果挂掉并不会对u2的挂载产生影响。</p><h1 id="团队协作">团队协作</h1><h2 id="1-阿里云">.1 阿里云</h2><h2 id="2-dockerhub">.2 dockerhub</h2><h2 id="3-私有仓库">.3 私有仓库</h2><h3 id="3-1-创建私有仓库">.3.1 创建私有仓库</h3><ul><li><p>下载镜像Docker Registry</p><p>相当于本地有个私有Docker hub。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v $&#123;PWD&#125;/registry:/var/lib/registry --restart always --privileged=true --name registry registry</span><br></pre></td></tr></table></figure></li><li><p>修改配置文件 daedom.json 使之支持http：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daedom.json</span><br></pre></td></tr></table></figure><p>在 daedom.json 添加：（！！！千万别漏掉后面的逗号！！！）</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;你的ip地址:5000&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>重启 Docker：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-2-查看私有库镜像">.3.2 查看私有库镜像</h3><ul><li><p>浏览器访问 <code>http://你的ip地址:5000/v2/_catalog</code></p></li><li><p>或者 curl 查询</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET http://你的ip地址:5000/v2/_catalog</span><br></pre></td></tr></table></figure></li></ul><h3 id="3-3-推送和拉取">.3.3 推送和拉取</h3><p>以下以nginx举例说明</p><ul><li><p>给镜像打上标签（使其符合私库规范）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag nginx:1.18.0 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li><li><p>把本地的镜像推到服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull 你的ip地址:5000/nginx:1.18.0</span><br></pre></td></tr></table></figure></li></ul><h1 id="Docker-APP常规安装">Docker APP常规安装</h1><h2 id="1-tomcat">.1 tomcat</h2><ul><li><p>创建临时容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8080:8080 --rm --name temp_tomcat -d tomcat</span><br></pre></td></tr></table></figure><ul><li><p>8080如果不能访问，进入交互</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker_test ~]# docker exec -it temp_tomcat /bin/bash</span><br><span class="line">root@d69eb116a23c:/usr/local/tomcat# cd webapps</span><br><span class="line">root@d69eb116a23c:/usr/local/tomcat/webapps# cp -r webapps.dist/. webapps</span><br></pre></td></tr></table></figure></li></ul></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 --privileged=true  --restart=always \</span><br><span class="line">-v /mydata/tomcat/webapps:/usr/local/tomcat/webapps \</span><br><span class="line">-v /mydata/tomcat/logs:/usr/local/tomcat/logs \</span><br><span class="line">-v /mydata/tomcat/conf:/usr/local/tomcat/conf \</span><br><span class="line">--name tomcat \</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure></li></ul><h2 id="2-MySQL">.2 MySQL</h2><ul><li><p>检查宿主机上是否有Mysql，以及3306端口占用情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nb /]# ps -ef | grep mysql</span><br><span class="line">root      4688  1287  0 01:35 pts/0    00:00:00 grep --color=auto mysql</span><br><span class="line">[root@nb /]# netstat -anp | grep 3306</span><br><span class="line">[root@nb /]# </span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=true --restart=always \</span><br><span class="line">-v /mydata/mysql/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>修改配置</p><p>此时应该修改配置文件，否则默认不支持utf-8</p><p>修改配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /mydata/mysql/conf/my.cnf</span><br><span class="line">vim /mydata/mysql/conf/my.cnf</span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server = utf8_general_ci</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure><p>重启容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql</span><br></pre></td></tr></table></figure><p>再次进入容器后再进入MySQL，查看当前字符集：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql bash</span><br><span class="line">mysql -u root -p 123456</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &#x27;character%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><h2 id="3-redis">.3 redis</h2><ul><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --restart=always \</span><br><span class="line">--privileged=true \</span><br><span class="line">-v /mydata/redis/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-v /mydata/redis/data:/data \</span><br><span class="line">redis-server /etc/redis/redis.conf \</span><br><span class="line">--log-opt max-size=100m --log-opt max-file=2 \</span><br><span class="line">--appendonly yes \</span><br><span class="line">--requirepass 000588 \</span><br><span class="line">--name redis \</span><br><span class="line">-d redis</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>--privileged=true</code> 开启容器卷</li><li><code>--restart=always</code> 总是开机启动</li><li><code>-log</code>是日志方面的</li><li><code>-p 6379:6379</code> 将6379端口挂载出去</li><li><code>--name</code> 给这个容器取一个名字</li><li><code>-v</code> 数据卷挂载<ul><li><code>/mydata/redis/redis.conf:/etc/redis/redis.conf</code> 这里是将 liunx 路径下的myredis.conf 和redis下的redis.conf 挂载在一起。</li><li><code>/mydata/redis/data:/data</code> 这个同上</li></ul></li><li><code>-d redis</code> 表示后台启动redis</li><li><code>redis-server /etc/redis/redis.conf</code> 以配置文件启动 redis，加载容器内的 conf 文件，最终找到的是挂载的目录 <code>/etc/redis/redis.conf</code> 也就是 liunx 下的<code>/home/redis/myredis/myredis.conf</code></li><li><code>--appendonly yes</code> 开启redis 持久化</li><li><code>--requirepass 000588</code> 设置密码</li></ol></blockquote><ul><li><p>修改redis.conf</p><p>打开配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /mydata/redis/redis.conf</span><br></pre></td></tr></table></figure><p>修改 redis.conf ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.开启redis验证</span><br><span class="line">requirepass 000588</span><br><span class="line"></span><br><span class="line"># 2.允许redis外地连接</span><br><span class="line"># 注释掉 </span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># 3.将daemonize yes注释起来或者 daemonize no设置，因为该配置和docker run中-d参数冲突，会导致容器一直启动失败</span><br><span class="line">daemonize no</span><br></pre></td></tr></table></figure><p>myredis.conf <a target="_blank" rel="noopener" href="https://blog.csdn.net/FangHX25/article/details/109134203">原版conf翻译</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"># bind 192.168.1.100 10.0.0.1</span><br><span class="line"># bind 127.0.0.1 ::1</span><br><span class="line"># bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line">requirepass 000588</span><br><span class="line"></span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line">databases 30</span><br><span class="line"></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line"></span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line">replica-priority 100</span><br><span class="line"></span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"></span><br><span class="line">list-compress-depth 0</span><br><span class="line"></span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"></span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line">rdb-save-incremental-fsync yes</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="4-nginx">.4 nginx</h2><ul><li><p>创建临时容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --rm --name temp-nginx -d nginx</span><br></pre></td></tr></table></figure><blockquote><ol><li><code>--rm</code> 退出容器时会自动将其删除</li></ol></blockquote></li><li><p>创建宿主机目录并拷贝需要创建的容器卷</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/nginx/conf</span><br><span class="line">mkdir -p /data/nginx/html</span><br><span class="line">mkdir -p /data/nginx/logs</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker cp temp-nginx:/etc/nginx/nginx.conf /data/nginx/conf/nginx.conf</span><br><span class="line">docker cp temp-nginx:/etc/nginx/conf.d /data/nginx/conf/conf.d</span><br><span class="line">docker cp temp-nginx:/usr/share/nginx/html /data/nginx</span><br><span class="line">chmod 777 /data/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>停止容器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop temp-nginx</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></li><li><p>创建容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 -p 443:443 --privileged=true --restart=always \</span><br><span class="line">-v /mydata/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /mydata/nginx/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /mydata/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-v /mydata/nginx/logs:/var/log/nginx \</span><br><span class="line">--name nginx \</span><br><span class="line">-d nginx</span><br></pre></td></tr></table></figure></li></ul><h1 id="Docker-APP复杂安装">Docker APP复杂安装</h1><h2 id="1-MySQL主从复制">1. MySQL主从复制</h2><ol><li><p>启动主库镜像</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> --restart=always \</span><br><span class="line">-v /mydata/mysql-master/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql-master \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>进入主库配置文件<code>/mydata/mysql-master/conf</code>下新建 <code>my.cnf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=101</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line"><span class="comment">## 开启二进制日志功能</span></span><br><span class="line">log-bin=mall-mysql-bin</span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M</span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7</span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure><p>重新启动主库容器<code>docker restart mysql-master</code>。</p></li><li><p>主库操作</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker 连接容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql-master /bin/bash -c <span class="string">&#x27;mysql -uroot -p000588&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改mysql身份验证插件为mysql_native_password;</span></span><br><span class="line"><span class="comment"># 因为mysql 8.0+起;其默认的身份验证插件为caching_sha2_password;</span></span><br><span class="line"><span class="comment"># 如果不改会导致登录验证失败;</span></span><br><span class="line"><span class="comment"># ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;000588&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建从库数据同步用户slave;</span></span><br><span class="line">CREATE USER slave IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;000588&#x27;</span>;</span><br><span class="line"><span class="comment">#  授权</span></span><br><span class="line">GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="comment"># 查看主库状态（记录数据1,待用）</span></span><br><span class="line">show master status;</span><br></pre></td></tr></table></figure></li><li><p>启动从服务器镜像</p><p>如果同宿主服务器修改:</p><p>端口<code>-p 3307:3306</code></p><p>容器名<code>--name mysql-slave</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 --privileged=<span class="literal">true</span> --restart=always \</span><br><span class="line">-v /mydata/mysql-slave/logs:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql/conf.d \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=000588 \</span><br><span class="line">--name mysql-slave \</span><br><span class="line">mysql:5.7</span><br></pre></td></tr></table></figure></li><li><p>进入主库配置文件<code>/mydata/mysql-slave/conf</code>下新建 <code>my.cnf</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span><br><span class="line">server_id=102</span><br><span class="line"><span class="comment">## 指定不需要同步的数据库名称</span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span><br><span class="line"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span><br><span class="line">slave_skip_errors=1062  </span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line">log_slave_updates=1  </span><br><span class="line"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure><p>重新启动从库容器<code>docker restart mysql-slave</code>。</p></li><li><p>从库操作(记录数据1)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql-slave /bin/bash -c <span class="string">&#x27;mysql -uroot -p000588&#x27;</span></span><br><span class="line"><span class="comment"># 如果主从在一台服务器,则需要通过[ docker inspect --format=&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; mysql] 查询主库容器IP</span></span><br><span class="line"><span class="comment"># 如果不在一台服务器,则直接使用外网ip即可 主库中两个结果添加进来</span></span><br><span class="line"></span><br><span class="line">change master to master_host=<span class="string">&#x27;192.168.206.105&#x27;</span>, master_user=<span class="string">&#x27;slave&#x27;</span>, master_password=<span class="string">&#x27;000588&#x27;</span>, master_port=3306, master_log_file=<span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos=154, master_connect_retry=30;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主数据库的IP地址；</span></span><br><span class="line">master_host：<span class="string">&#x27;192.168.206.105&#x27;</span>,</span><br><span class="line"><span class="comment"># 主数据库的运行端口；</span></span><br><span class="line">master_port：3306,</span><br><span class="line"><span class="comment"># 在主数据库创建的用于同步数据的用户账号；</span></span><br><span class="line">master_user：<span class="string">&#x27;slave&#x27;</span>,</span><br><span class="line"><span class="comment"># 在主数据库创建的用于同步数据的用户密码；</span></span><br><span class="line">master_password：<span class="string">&#x27;000588&#x27;</span>,</span><br><span class="line"><span class="comment"># 指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</span></span><br><span class="line">master_log_file：<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line"><span class="comment"># 指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</span></span><br><span class="line">master_log_pos：154,</span><br><span class="line"><span class="comment"># 连接失败重试的时间间隔，单位为秒。</span></span><br><span class="line">master_connect_retry：30;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启主从同步</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"><span class="comment"># 查看主从同步状况</span></span><br><span class="line">mysql&gt; show slave status\G;</span><br></pre></td></tr></table></figure><p><code>Slave_IO_Running</code>及<code>Slave_SQL_Running</code>为YES时;从库启动+主从复制成功。</p></li></ol><ul><li><p>停止主从复制</p><p>在从库中执行<code>stop slave；</code></p></li><li><p>读写分离</p><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/jkjkjkll/article/details/125102188">https://blog.csdn.net/jkjkjkll/article/details/125102188</a></p></li></ul><p>Docker 网络</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz">aceniu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz/posts/920e92d1.html">https://blog.halfsummer.xyz/posts/920e92d1.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.halfsummer.xyz" target="_blank">艾斯牛 Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/edc1b716.html" title="Shell编程 学习笔记"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Shell编程 学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/posts/6c6bf881.html" title="Gitee + PicGO 搭建图床"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Gitee + PicGO 搭建图床</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">aceniu</div><div class="author-info__description">Love 33 & Yilia</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/aceniu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/aceniu" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_github-circle"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=123354319@qq.com" target="_blank" title="Email"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-Rss"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/289493392" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=123354319&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_qq-circle"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%EF%BC%89%E7%AE%80%E4%BB%8B"><span class="toc-text">1）简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Docker-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%A8%AA%E7%A9%BA%E5%87%BA%E4%B8%96"><span class="toc-text">1.1 Docker 为什么横空出世</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%A6%82%E8%BF%B0"><span class="toc-text">1.2 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-text">1.3 容器与虚拟机的比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Docker-%E6%9E%B6%E6%9E%84"><span class="toc-text">1.4 Docker 架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-Docker-%E5%BC%95%E6%93%8E"><span class="toc-text">1.5 Docker 引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-Docker-%E5%B9%B3%E5%8F%B0%E7%BB%84%E6%88%90"><span class="toc-text">1.6 Docker 平台组成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-%E9%95%9C%E5%83%8F-%E5%AE%B9%E5%99%A8"><span class="toc-text">1.7 镜像&amp;容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-Docker-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">1.8 Docker 生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-9-Docker-%E9%95%9C%E5%83%8F%E5%8E%9F%E7%90%86%E7%90%86%E8%A7%A3"><span class="toc-text">1.9 Docker 镜像原理理解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%EF%BC%89Docker-%E5%AE%89%E8%A3%85"><span class="toc-text">2）Docker 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Docker-%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="toc-text">2.1 Docker 版本说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%8D%B8%E8%BD%BD"><span class="toc-text">2.2 卸载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%AE%89%E8%A3%85"><span class="toc-text">2.3 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8"><span class="toc-text">2.4 配置镜像加速器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%90%AF%E5%8A%A8"><span class="toc-text">2.5 启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.6 测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%EF%BC%89%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-text">3）镜像管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E6%90%9C%E7%B4%A2%E9%95%9C%E5%83%8F%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BA%8E%E9%95%9C%E5%83%8F%E5%BA%93"><span class="toc-text">8.1 搜索镜像是否存在于镜像库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F"><span class="toc-text">8.2 查看镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96"><span class="toc-text">8.2 镜像拉取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E6%9F%A5%E7%9C%8B-Docker-%E7%9A%84%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-text">8.3 查看 Docker 的服务信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F"><span class="toc-text">8.4 删除镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E5%AF%BC%E5%87%BA%E9%95%9C%E5%83%8F"><span class="toc-text">8.5 导出镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-text">8.6 导入镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-7-%E6%9F%A5%E7%9C%8B-Docker-%E9%95%9C%E5%83%8F%E4%BF%A1%E6%81%AF"><span class="toc-text">8.7 查看 Docker 镜像信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%EF%BC%89%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-text">4）容器管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E8%BF%90%E8%A1%8C%E3%80%81%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-text">9.1 运行、创建容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF%E5%AE%B9%E5%99%A8"><span class="toc-text">9.2 启动、停止、重启容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E3%80%81%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E3%80%81%E5%AE%B9%E5%99%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">9.3 查看容器、容器日志、容器的详细信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-text">9.4 删除容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8%E5%86%85"><span class="toc-text">9.5 进入容器内</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-text">9.6 容器的端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-7-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E7%9A%84%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-text">9.7 查看容器的端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-8-%E6%9B%B4%E6%96%B0%E5%AE%B9%E5%99%A8%E5%8F%82%E6%95%B0"><span class="toc-text">9.8 更新容器参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-9-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D"><span class="toc-text">9.9 容器的文件拷贝</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-8-%E5%AE%B9%E5%99%A8%E7%9A%84%E6%8F%90%E4%BA%A4"><span class="toc-text">9.8 容器的提交</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-9-%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AF%BC%E5%87%BA%E5%92%8C%E5%AF%BC%E5%85%A5"><span class="toc-text">9.9 容器的导出和导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-9-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">9.9 查看容器详细信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%EF%BC%89Docker-%E9%95%9C%E5%83%8F"><span class="toc-text">5）Docker 镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-dockerfile-%E6%8C%87%E4%BB%A4"><span class="toc-text">10.1 dockerfile 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-FROM-%E6%8C%87%E5%AE%9A%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F"><span class="toc-text">10.1.1 FROM 指定基础镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-2-MAINTAINER-%E6%8C%87%E5%AE%9A%E7%BB%B4%E6%8A%A4%E8%80%85%E4%BF%A1%E6%81%AF"><span class="toc-text">10.1.2 MAINTAINER 指定维护者信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-3-RUN-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-text">10.1.3 RUN 执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-4-ADD-%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%8E%8B"><span class="toc-text">10.1.4 ADD 拷贝文件，会自动解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-5-COPY-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-text">10.1.5 COPY 复制文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-6-WORKDIR-%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="toc-text">10.1.6 WORKDIR 设置当前工作目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-7-VOLUME-%E8%AE%BE%E7%BD%AE%E5%8D%B7%EF%BC%8C%E6%8C%82%E8%BD%BD%E5%88%B0%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95"><span class="toc-text">10.1.7 VOLUME 设置卷，挂载到主机目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-8-EXPOSE-%E6%8C%87%E5%AE%9A%E5%AF%B9%E5%A4%96%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-text">10.1.8 EXPOSE 指定对外的端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-9-CMD-%E6%8C%87%E5%AE%9A%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%90%8E%E8%A6%81%E5%B9%B2%E7%9A%84%E4%BA%8B%E6%83%85"><span class="toc-text">10.1.9 CMD 指定容器启动后要干的事情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-10-ENTRYPOINT-%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%90%8E%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-text">10.1.10 ENTRYPOINT 容器启动后执行的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-11-ENV-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">10.1.11 ENV 环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-12-restart-%E9%87%8D%E5%90%AF%E6%9C%BA%E5%88%B6"><span class="toc-text">10.1.12 restart 重启机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-text">10.2 构建镜像</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11%EF%BC%89%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-text">11）容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%91%BD%E4%BB%A4"><span class="toc-text">.1 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A6%82%E8%BF%B0"><span class="toc-text">.2 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AF%BB%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-text">.3 读写规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8D%B7%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%85%B1%E4%BA%AB"><span class="toc-text">.4 卷的继承和共享</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C"><span class="toc-text">团队协作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-text">.1 阿里云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-dockerhub"><span class="toc-text">.2 dockerhub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-text">.3 私有仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-text">.3.1 创建私有仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E7%A7%81%E6%9C%89%E5%BA%93%E9%95%9C%E5%83%8F"><span class="toc-text">.3.2 查看私有库镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%8E%A8%E9%80%81%E5%92%8C%E6%8B%89%E5%8F%96"><span class="toc-text">.3.3 推送和拉取</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-APP%E5%B8%B8%E8%A7%84%E5%AE%89%E8%A3%85"><span class="toc-text">Docker APP常规安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-tomcat"><span class="toc-text">.1 tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MySQL"><span class="toc-text">.2 MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-redis"><span class="toc-text">.3 redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-nginx"><span class="toc-text">.4 nginx</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-APP%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85"><span class="toc-text">Docker APP复杂安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">1. MySQL主从复制</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/317ae1f5.html" title="Git删除暂存区或版本库中的文件">Git删除暂存区或版本库中的文件</a><time datetime="2023-03-14T01:17:28.000Z" title="发表于 2023-03-14 01:17:28">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/70fb250c.html" title="Git如何回滚代码?">Git如何回滚代码?</a><time datetime="2023-03-14T01:13:35.000Z" title="发表于 2023-03-14 01:13:35">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1c5e0d7.html" title="Tomcat 学习笔记">Tomcat 学习笔记</a><time datetime="2023-03-13T23:19:24.000Z" title="发表于 2023-03-13 23:19:24">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1020521.html" title="Nginx 学习笔记">Nginx 学习笔记</a><time datetime="2023-03-13T23:16:34.000Z" title="发表于 2023-03-13 23:16:34">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/fa17c65a.html" title="Redis 学习笔记">Redis 学习笔记</a><time datetime="2023-03-13T23:16:24.000Z" title="发表于 2023-03-13 23:16:24">2023-03-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By aceniu</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>