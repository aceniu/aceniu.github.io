<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>MySQL 学习笔记 | 艾斯牛 Blog</title><meta name="author" content="aceniu,123354319@qq.com"><meta name="copyright" content="aceniu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;blog.51cto.com&#x2F;liuyj&#x2F;5536362 MySQL 1）数据库知识点  2）数据库相关概念    名称 全程 简称     数据库 存储数据的仓库，数据是有组织的进行存储 DataBase（BD）   数据库管理系统 操纵和管理数据库的大型软件 DataBase Management System（DBMS）   SQL 操作关系型数据库的编程语言，定义了一套操"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 学习笔记"><meta property="og:url" content="https://blog.halfsummer.xyz/posts/520fef84.html"><meta property="og:site_name" content="艾斯牛 Blog"><meta property="og:description" content="https:&#x2F;&#x2F;blog.51cto.com&#x2F;liuyj&#x2F;5536362 MySQL 1）数据库知识点  2）数据库相关概念    名称 全程 简称     数据库 存储数据的仓库，数据是有组织的进行存储 DataBase（BD）   数据库管理系统 操纵和管理数据库的大型软件 DataBase Management System（DBMS）   SQL 操作关系型数据库的编程语言，定义了一套操"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg"><meta property="article:published_time" content="2023-03-13T23:15:45.000Z"><meta property="article:modified_time" content="2023-03-13T17:48:54.683Z"><meta property="article:author" content="aceniu"><meta property="article:tag" content="aceniu,blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.halfsummer.xyz/posts/520fef84.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#3b70fc"><link rel="apple-touch-icon" sizes="180x180" href="/img/siteicon/128.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/siteicon/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/siteicon/16.png"><link rel="mask-icon" href="/img/siteicon/128.png" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MySQL 学习笔记",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-13 17:48:54"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="艾斯牛 Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/images/"><i class="fa-fw fa fa-images faa-tada"></i> <span>图床</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="艾斯牛 Blog"><span class="site-name">艾斯牛 Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw fas fa-envelope faa-tada"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/bangumis/index.html"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili"></use></svg> <span>追番</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-list hide"></i> <span>List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/images/"><i class="fa-fw fa fa-images faa-tada"></i> <span>图床</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-13T23:15:45.000Z" title="发表于 2023-03-13 23:15:45">2023-03-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-13T17:48:54.683Z" title="更新于 2023-03-13 17:48:54">2023-03-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="MySQL 学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer"><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/liuyj/5536362">https://blog.51cto.com/liuyj/5536362</a></p><h1 id="MySQL">MySQL</h1><h2 id="1）数据库知识点">1）数据库知识点</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-20_11-13-21.png" alt="Snipaste_2022-12-20_11-13-21"></p><h2 id="2）数据库相关概念">2）数据库相关概念</h2><table><thead><tr><th>名称</th><th>全程</th><th>简称</th></tr></thead><tbody><tr><td>数据库</td><td>存储数据的仓库，数据是有组织的进行存储</td><td>DataBase（BD）</td></tr><tr><td>数据库管理系统</td><td>操纵和管理数据库的大型软件</td><td>DataBase Management System（DBMS）</td></tr><tr><td>SQL</td><td>操作关系型数据库的编程语言，定义了一套操作关系型数据库统一标准</td><td>Structured Query Language（SQL）</td></tr></tbody></table><h2 id="3）MySQL数据库版本">3）MySQL数据库版本</h2><ul><li>社区版（MySQL Community Server）</li><li>商业版（MySQL Enterprise Edition）</li></ul><h2 id="4）概述">4）概述</h2><ul><li><p><strong>关系型数据库（RDBMS）</strong></p><p>概念：建立在关系模型基础上，由多张互相连接的二维表组成的数据库。</p><p>特点：</p><ol><li>使用表存储数据，格式统一，便于维护。</li><li>使用SQL语言操作，标准统一，使用方便。</li></ol></li><li><p>数据模型</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-20_20-52-27.png" alt="Snipaste_2022-12-20_20-52-27"></p></li></ul><h2 id="5）MySQL-下载、安装与卸载">5）MySQL 下载、安装与卸载</h2><h3 id="5-1-Linux">5.1 Linux</h3><ul><li><p>基于CentOS 7.6</p><ol><li><p>安装前检查（注意：此步骤至关重要！！）</p><p>（1）更新 yum</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y upgrade</span><br></pre></td></tr></table></figure><p>（2）需要删除mariadb,会与MySQL冲突</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要删除mariadb,会与MySQL冲突</span></span><br><span class="line"><span class="comment"># 查询版本</span></span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">rpm -e mariadb-libs... --nodeps</span><br></pre></td></tr></table></figure><p>（3）检查MySQL残留，有则删除</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep -i mysql</span><br><span class="line"><span class="comment"># 如果有，则执行</span></span><br><span class="line">yum remove mysql-....</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没有则继续</span></span><br><span class="line">find / -name mysql</span><br><span class="line"><span class="comment"># 或 </span></span><br><span class="line">whereis mysql</span><br><span class="line"><span class="built_in">rm</span> -rf ...删除上面查找到的文件和文件夹</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/my.cnf</span><br><span class="line"><span class="built_in">rm</span> -rf /var/log/mysql*</span><br></pre></td></tr></table></figure><p>（4）检查服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br><span class="line"><span class="comment"># 如果是激活状态</span></span><br><span class="line">systemctl stop mysqld</span><br></pre></td></tr></table></figure></li><li><p>安装 MySQL</p><p>方法一：yum 安装</p><p>（1）配置Mysql 8.0安装源</p><p>查询最新版本的的方法 <a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/">https://dev.mysql.com/downloads/repo/yum/</a></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-27_11-30-44.png" alt="Snipaste_2022-12-27_11-30-44"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 红框处修改命令中相应版本</span></span><br><span class="line">rpm -Uvh https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br></pre></td></tr></table></figure><p>（2）yum安装MySQL</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-server --nogpgcheck</span><br><span class="line"><span class="comment"># --nogpgcheck 是跳过公钥检查安装</span></span><br></pre></td></tr></table></figure><p>（3）启动服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><p>（4）查看临时密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;A temporary password&quot;</span> /var/log/mysqld.log</span><br></pre></td></tr></table></figure><p>方法二：编译安装（未整理）</p></li><li><p>卸载</p><p>一、yum 卸载</p><p>（1）卸载所有查询到的安装</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa |grep -i mysql</span><br></pre></td></tr></table></figure><p>（2）删除所有查找到的目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name mysql</span><br></pre></td></tr></table></figure><p>（3）删除日志</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /var/log/mysqld.log</span><br></pre></td></tr></table></figure></li><li><p>其他问题</p><p>（1）问题1：安装MySQL时提示：mysql-community-client-5.7.39-1.el7.x86_64.rpm 的<code>公钥</code>尚未安装。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2023130556677825144.png" alt="2023130556677825144"></p><p>解决方案：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><br></pre></td></tr></table></figure><p>（2）问题2：查看内存不足或者缓存空间为0时可能启动不了服务。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看错误信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解决方案：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找到mysql的配置都在my.cnf</span></span><br><span class="line">$ whereis my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑my.cnf</span></span><br><span class="line">$ vim /etc/my.cnf</span><br><span class="line"><span class="comment"># 添加或修改</span></span><br><span class="line">innodb_buffer_pool_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果不能启用服务请检查swap分区是否为0</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分配 1G空间给swap</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=1024</span><br><span class="line">mkswap /swapfile</span><br><span class="line">swapon /swapfile</span><br><span class="line"><span class="comment"># 添加这行 /swapfile swap swap defaults 0 0 到 /etc/fstab</span></span><br></pre></td></tr></table></figure></li></ol></li></ul><h3 id="5-2-MacOS（未整理）">5.2 MacOS（未整理）</h3><h3 id="5-3-Windows（未整理）">5.3 Windows（未整理）</h3><h3 id="5-4-Docker">5.4 Docker</h3><h2 id="基础">基础</h2><h3 id="1）SQL">1）SQL</h3><ul><li><p>SQL通用语法</p><ol><li>SQL语句可以单行或多行书写，以分号结尾。</li><li>SQL语句可以使用空格/缩进来增强语句的可读性。</li><li>MySQL数据库的SQL语句不区分大小写，关键字建议使用大写。</li><li>注释：<ol><li>单行注释： <code>--</code>注释内容 或 <code>#</code> 注释内容（MySQL特有）</li><li>多行注释：<code>/* 注释内容*/</code></li></ol></li></ol></li><li><p><strong>SQL分类</strong></p><table><thead><tr><th>分类</th><th>全称</th><th>说明</th></tr></thead><tbody><tr><td>DDL</td><td>Data Definition Language</td><td>数据定义语言，用来定义数据库对象（数据库、表、字段）</td></tr><tr><td>DML</td><td>Data Manipulation Language</td><td>数据库操作语言，用来对数据库表中的数据进行增、删、改</td></tr><tr><td>DQL</td><td>Data Query Language</td><td>数据查询语言，用来查询数据库中标的记录</td></tr><tr><td>DCL</td><td>Data Control Language</td><td>数据控制语言，用来创建数据库用户、控制数据库的访问权限</td></tr></tbody></table></li></ul><h3 id="2）DDL数据定义语言">2）DDL数据定义语言</h3><h4 id="2-1-数据库操作">2.1 数据库操作</h4><ul><li><p>查询数据库</p><p>查询所有数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW DATABASES;</span><br></pre></td></tr></table></figure><p>查询当前使用的数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELSECT DATABASE();</span><br></pre></td></tr></table></figure></li><li><p>创建数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE [IF NOT EXISTS] 数据库名 [DEFAULT CHARSET 字符集] [COLLATE 排序规则];</span><br></pre></td></tr></table></figure><blockquote><p>[DEFAULT CHARSET 字符集]： <code>DEFAULT CHARSET utf8mb4</code></p></blockquote></li><li><p>删除数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP DATABASE [IF EXISTS] 数据库名;</span><br></pre></td></tr></table></figure></li><li><p>使用数据库（切换至）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-2-表操作">2.2 表操作</h4><ul><li><p>查询表</p><p>查询当前数据库内所有表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW TABLES;</span><br></pre></td></tr></table></figure><p>查询表结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DESC 表名;</span><br><span class="line"># 或者</span><br><span class="line">DESCRIBE 表名;</span><br></pre></td></tr></table></figure><p>查询指定表的建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW CREATE TABLE 表名;</span><br></pre></td></tr></table></figure></li><li><p>创建表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE 表名(</span><br><span class="line">	字段1 字段1类型[COMMENT &#x27;字段1注释&#x27;],</span><br><span class="line">	字段2 字段2类型[COMMENT &#x27;字段2注释&#x27;],</span><br><span class="line">	...</span><br><span class="line">	字段n 字段n类型[COMMENT &#x27;字段n注释&#x27;],</span><br><span class="line">)[COMMENT &#x27;表注释&#x27;];</span><br></pre></td></tr></table></figure><blockquote><p><strong>数据类型:</strong></p><ol><li><p>数值类型</p><table><thead><tr><th>类型</th><th>大小</th><th>范围（有符号）</th><th>范围（无符号）</th><th>用途</th></tr></thead><tbody><tr><td>TINYINT</td><td>1 Bytes</td><td>(-128，127)</td><td>(0，255)</td><td>小整数值</td></tr><tr><td>SMALLINT</td><td>2 Bytes</td><td>(-32 768，32 767)</td><td>(0，65 535)</td><td>大整数值</td></tr><tr><td>MEDIUMINT</td><td>3 Bytes</td><td>(-8 388 608，8 388 607)</td><td>(0，16 777 215)</td><td>大整数值</td></tr><tr><td>INT或INTEGER</td><td>4 Bytes</td><td>(-2 147 483 648，2 147 483 647)</td><td>(0，4 294 967 295)</td><td>大整数值</td></tr><tr><td>BIGINT</td><td>8 Bytes</td><td>(-9,223,372,036,854,775,808，9 223 372 036 854 775 807)</td><td>(0，18 446 744 073 709 551 615)</td><td>极大整数值</td></tr><tr><td>FLOAT</td><td>4 Bytes</td><td>(-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38)</td><td>0，(1.175 494 351 E-38，3.402 823 466 E+38)</td><td>单精度浮点数值</td></tr><tr><td>DOUBLE</td><td>8 Bytes</td><td>(-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td>0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308)</td><td>双精度浮点数值</td></tr><tr><td>DECIMAL</td><td>对DECIMAL(M,D) ，如果M&gt;D，为M+2否则为D+2</td><td>依赖于M和D的值</td><td>依赖于M和D的值</td><td>小数值</td></tr></tbody></table><p>注意：</p><ol><li><p>如果是无符号的范围可以加上 <code>UNSIGNED</code> （例：<code>age TINYINY UNSIGNED</code>）</p></li><li><p>浮点数共四个字节，小数为1位 （例：<code>score DOUBLE(4,1)</code>）</p></li></ol></li><li><p>日期和时间类型</p><table><thead><tr><th>类型</th><th>大小( bytes)</th><th>范围</th><th>格式</th><th>用途</th></tr></thead><tbody><tr><td>DATE</td><td>3</td><td>1000-01-01/9999-12-31</td><td>YYYY-MM-DD</td><td>日期值</td></tr><tr><td>TIME</td><td>3</td><td>‘-838:59:59’/‘838:59:59’</td><td>HH:MM:SS</td><td>时间值或持续时间</td></tr><tr><td>YEAR</td><td>1</td><td>1901/2155</td><td>YYYY</td><td>年份值</td></tr><tr><td>DATETIME</td><td>8</td><td>‘1000-01-01 00:00:00’ 到 ‘9999-12-31 23:59:59’</td><td>YYYY-MM-DD hh:mm:ss</td><td>混合日期和时间值</td></tr><tr><td>TIMESTAMP</td><td>4</td><td>‘1970-01-01 00:00:01’ UTC 到 ‘2038-01-19 03:14:07’ UTC<br>结束时间是第 2147483647 秒，北京时间 2038-1-19 11:14:07，格林尼治时间 2038年1月19日 凌晨 03:14:07</td><td>YYYY-MM-DD hh:mm:ss</td><td>混合日期和时间值，时间戳</td></tr></tbody></table></li><li><p>字符串类型</p><table><thead><tr><th>类型</th><th>大小</th><th>用途</th></tr></thead><tbody><tr><td>CHAR</td><td>0-255 bytes</td><td>定长字符串</td></tr><tr><td>VARCHAR</td><td>0-65535 bytes</td><td>变长字符串</td></tr><tr><td>TINYBLOB</td><td>0-255 bytes</td><td>不超过 255 个字符的二进制字符串</td></tr><tr><td>TINYTEXT</td><td>0-255 bytes</td><td>短文本字符串</td></tr><tr><td>BLOB</td><td>0-65 535 bytes</td><td>二进制形式的长文本数据</td></tr><tr><td>TEXT</td><td>0-65 535 bytes</td><td>长文本数据</td></tr><tr><td>MEDIUMBLOB</td><td>0-16 777 215 bytes</td><td>二进制形式的中等长度文本数据</td></tr><tr><td>MEDIUMTEXT</td><td>0-16 777 215 bytes</td><td>中等长度文本数据</td></tr><tr><td>LONGBLOB</td><td>0-4 294 967 295 bytes</td><td>二进制形式的极大文本数据</td></tr><tr><td>LONGTEXT</td><td>0-4 294 967 295 bytes</td><td>极大文本数据</td></tr></tbody></table><p>'变长’字符串会根据使用量来计算使用的空间，'定长’字符串会用空格来替代未使用的空间。但是两种方式当写入的数据超过指定的空间时都会报错。</p></li></ol></blockquote></li><li><p>修改表名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 RENAME TO 新表名;</span><br></pre></td></tr></table></figure></li><li><p>删除表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE [IF EXISTS] 表名;</span><br></pre></td></tr></table></figure><p>删除指定表，并重新创建该表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE TABLE 表名;</span><br></pre></td></tr></table></figure></li></ul><h4 id="2-3-字段操作">2.3 字段操作</h4><ul><li><p>添加字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 ADD 字段名 类型(长度) [COMMENT &#x27;注释&#x27;] [约束];</span><br></pre></td></tr></table></figure></li><li><p>修改</p><p>修改数据类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 MODIFY 字段名 新数据类型(长度);</span><br></pre></td></tr></table></figure><p>修改字段名和字段类型</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 CHANGE 旧字段名 新字段名 类型(长度) [COMMENT &#x27;注释&#x27;] [约束];</span><br></pre></td></tr></table></figure></li><li><p>删除字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE 表名 DROP 字段名;</span><br></pre></td></tr></table></figure></li></ul><h3 id="3）DML数据操纵语言">3）DML数据操纵语言</h3><ul><li><p>添加数据</p><p>给指定字段添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 (字段名1, 字段名2,....) VALUES (值1, 值2,...);</span><br></pre></td></tr></table></figure><p>给全部字段添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 VALUES (值1, 值2,...);</span><br></pre></td></tr></table></figure><p>批量添加数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO 表名 (字段名1, 字段名2,....) VALUES (值1, 值2,...), (值1, 值2,...), ...;</span><br><span class="line">INSERT INTO 表名 VALUES (值1, 值2,...), (值1, 值2,...), ...;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li>插入数据时，指定的字段顺序需要与值的顺序是一一对应的。</li><li>字符串和日期数据应该包含在引号中。</li><li>插入的数据大小，应该在字段规定的范围内。</li></ol></blockquote></li><li><p>修改数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE 表名 SET 字段名1 = 值1,字段名2 = 值2,... [WHERE 条件];</span><br></pre></td></tr></table></figure></li><li><p>删除数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM 表名 [WHERE 条件];</span><br></pre></td></tr></table></figure></li></ul><h3 id="4）DQL数据查询语言">4）DQL数据查询语言</h3><p>1.编写与执行（#）顺序</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表			# 4</span><br><span class="line">FROM 表名列表			# 1</span><br><span class="line">WHERE 条件列表			# 2</span><br><span class="line">GROUP BY 分组字段列表		# 3</span><br><span class="line">HAVING 分组后条件列表</span><br><span class="line">ORDER BY 排序字段列表		# 5</span><br><span class="line">LIMIT 分页参数			# 6</span><br></pre></td></tr></table></figure><p>2.查询方式</p><ul><li><p>基础查询</p><p>查询多个字段</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段1, 字段2,... FROM 表名;</span><br><span class="line">SELECT * FROM 表名;    # 开发中尽量不使用*</span><br></pre></td></tr></table></figure><p>设置别名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段1 [AS &#x27;别名1&#x27;], 字段2 [AS &#x27;别名2&#x27;],... FROM 表名;</span><br><span class="line">SELECT 字段1 [&#x27;别名1&#x27;], 字段2 [&#x27;别名2&#x27;],... FROM 表名;    # 同上</span><br></pre></td></tr></table></figure><p>去除重复记录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT 字段列表 FROM 表名;</span><br></pre></td></tr></table></figure></li><li><p>条件查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 WHERE 条件列表;</span><br></pre></td></tr></table></figure><blockquote><p><strong>运算符:</strong></p><ol><li><p>比较运算符</p><table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td>&gt;</td><td>大于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt; 或 !=</td><td>不等于</td></tr><tr><td>BETWEEN…AND…</td><td>在某个范围之内（含最小、最大值）</td></tr><tr><td>IN(…,…,…)</td><td>在in之后的列表中的值，多选一</td></tr><tr><td>LIKE 占位符</td><td>模糊匹配（_匹配单个字符，%匹配任意个字符）</td></tr><tr><td>IS NULL</td><td>是NULL</td></tr></tbody></table></li><li><p>逻辑运算符</p><table><thead><tr><th>逻辑运算符</th><th>功能</th></tr></thead><tbody><tr><td>AND 或 &amp;&amp;</td><td>并且（多个条件同时成立）</td></tr><tr><td>OR 或</td><td></td></tr><tr><td>NOT 或 !</td><td>非，不是</td></tr></tbody></table></li></ol><hr><p>==条件查询中需要注意的例子==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># BETWEEN 最小值 AND 最大值 （最小、最大值的顺序固定不能变）</span><br><span class="line">SELECT * FROM table1 Where age BETWEEN 14 AND 20;</span><br><span class="line"></span><br><span class="line"># 查询年龄为 15，,20，,30的人</span><br><span class="line">SELECT * FROM table1 Where age IN(15, 20, 30);</span><br><span class="line"></span><br><span class="line"># 查询名字为两个字的人</span><br><span class="line">SELECT * FROM table1 Where name LIKE &#x27;__&#x27;;</span><br><span class="line"></span><br><span class="line"># 查询身份证号最后一位为X的人</span><br><span class="line">SELECT * FROM table1 Where idcard LIKE &#x27;%X&#x27;;</span><br></pre></td></tr></table></figure></blockquote></li><li><p>分组查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 [WHERE 条件] GROUP BY 分组字段名 [HAVING 分组后过滤条件];</span><br></pre></td></tr></table></figure><blockquote><p>WHERE与HAVING区别:</p><ul><li>执行时机不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。</li><li>判断条件不同：where不能对聚合函数进行判断，而having可以。</li></ul><hr><p>==eg.==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 根据性别分组，统计男性员工和女性员工数量</span><br><span class="line">SELECT gender, COUNT(*) GROUP BY gender;</span><br><span class="line"></span><br><span class="line"># 根据性别分组，统计男性员工和女性员工的平均年龄</span><br><span class="line">SELECT gender, AVG(age) GROUP BY gender;</span><br><span class="line"></span><br><span class="line"># 查询年龄小于45的员工，并根据工作地址分组，获取员工数量大于等于3的工作地址</span><br><span class="line">SELECT workaddress, COUNT(*) WHERE age &lt;= 45 GROUP BY workaddress HAVING COUNT(*) &gt;= 3;</span><br></pre></td></tr></table></figure><p>注意：</p><p>执行顺序：where &gt; 聚合函数 &gt; having</p><p>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义。</p></blockquote></li><li><p>排序查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 ORDER BY 字段1 排序方式1,字段1 排序方式2,...;</span><br></pre></td></tr></table></figure><blockquote><p>排序方式</p><ul><li><code>ASC</code> 升序（默认）</li><li><code>DESC</code> 降序</li></ul></blockquote></li><li><p>分页查询</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表名 LIMIT 起始索引,查询记录数;</span><br></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li><strong>起始索引从0开始</strong>，起始索引等于（查询页码-1）*每页显示记录数。</li><li>分页查询是数据库的方言，<strong>不同的数据库有不同的实现</strong>，MySQL中是LIMIT。</li><li>如果查询的是第一页数据，起始索引可以省略，直接简写为<code>LIMIT 10</code>。</li></ol></blockquote></li></ul><p>3.聚合函数</p><p>将一列数据作为一个整体，进行纵向计算。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 聚合函数(字段列表) FROM 表名;</span><br></pre></td></tr></table></figure><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>count</td><td>统计数量</td></tr><tr><td>max</td><td>最大值</td></tr><tr><td>min</td><td>最小值</td></tr><tr><td>avg</td><td>平均值</td></tr><tr><td>sum</td><td>求和</td></tr></tbody></table><blockquote><p>注意：null 不参与聚合函数的运算</p></blockquote><h3 id="5）DCL数据控制语言">5）DCL数据控制语言</h3><h4 id="5-1-管理用户">5.1 管理用户</h4><ul><li><p>查询用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line">SELECT * FROM user;</span><br><span class="line"># 或者</span><br><span class="line">SELECT User FROM mysql.user;</span><br></pre></td></tr></table></figure></li><li><p>创建用户</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED BY &#x27;密码&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>修改用户密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;用户名&#x27;@&#x27;主机名&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;新密码&#x27;</span><br></pre></td></tr></table></figure></li><li><p>删除用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意：</p><ul><li>主机名可以使用通配符<code>%</code>。</li><li>这类命令一般都是 DBA (Database Administrator 数据管理员) 使用。</li></ul></blockquote><h4 id="5-2-权限控制">5.2 权限控制</h4><ul><li><p>查询权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>授予权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> 权限列表 <span class="keyword">ON</span> 数据库.表名 <span class="keyword">TO</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># eg.</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">ON</span> database01.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user01&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>撤销权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> 权限列表 <span class="keyword">ON</span> 数据库.表名 <span class="keyword">FROM</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>注意：</p><ul><li>多个权限之间，使用逗号分隔。</li><li>授权时，数据库名和表名可以使用<code>*</code>进行通配，代表所有。</li></ul><hr><p>常用权限：</p><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>ALL,ALL PRIVILEGES</td><td>所有权限</td></tr><tr><td>SELECT</td><td>查询数据</td></tr><tr><td>INSERT</td><td>插入数据</td></tr><tr><td>UPDATE</td><td>修改数据</td></tr><tr><td>DELETE</td><td>删除数据</td></tr><tr><td>ALTER</td><td>修改表</td></tr><tr><td>DROP</td><td>删除数据库/表/视图</td></tr><tr><td>CREATE</td><td>创建数据库/表</td></tr></tbody></table></blockquote><h3 id="6）函数">6）函数</h3><p><strong>函数</strong>是指一段可以直接被另一端程序调用的程序或代码。（尽量不使用SQL去操作，提升性能。）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 函数;</span><br></pre></td></tr></table></figure><h4 id="6-1-字符串函数">6.1 字符串函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CONCAT(S1,S2,…,Sn)</td><td>字符串拼接</td></tr><tr><td>LOWER(str)</td><td>将字符串str全部转为小写</td></tr><tr><td>UPPER(str)</td><td>将字符串str全部转为大写</td></tr><tr><td>LPAD(str,n,pad)</td><td>左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td></tr><tr><td>RPAD(str,n,pad)</td><td>右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td></tr><tr><td>TRIM(str)</td><td>去掉字符串头部和尾部的空格</td></tr><tr><td>SUBSTRING(str,strart,len)</td><td>返回从字符串str从start位置起的len个长度的字符串</td></tr></tbody></table><ul><li><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将id补充至5位（注意id需为varchar类型否则不能在前面添加0）</span><br><span class="line">UPDATE table1 SET id = LPAD(id,5,&#x27;0&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-2-数值函数">6.2 数值函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>向上取整</td></tr><tr><td>FLOOR(x)</td><td>向下取整</td></tr><tr><td>MOD(x,y)</td><td>返回x/y的模</td></tr><tr><td>RAND()</td><td>返回0~1内的随机数</td></tr><tr><td>ROUND(x,y)</td><td>求参数x的四舍五入值，保留y位小数</td></tr></tbody></table><ul><li><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 生成6位随机验证码 随机数有可能生成小于6位的数字，所以用lapd左边补0</span><br><span class="line">select lpad(round(rand(),6) * 1000000,6,&#x27;0&#x27;);</span><br></pre></td></tr></table></figure></li></ul><h4 id="6-3-日期函数">6.3 日期函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>CURDATE()</td><td>返回当前日期</td></tr><tr><td>CURTIME()</td><td>返回当前时间</td></tr><tr><td>NOW()</td><td>返回当前日期和时间</td></tr><tr><td>YEAR(date)</td><td>获取指定date的年份</td></tr><tr><td>MONTH(date)</td><td>获取指定date的月份</td></tr><tr><td>DAY(date)</td><td>获取指定date的日份</td></tr><tr><td>DATE_ADD(date,INTERVAL expr type)</td><td>返回一个日期/时间值加上一个事件间隔expr后的时间值</td></tr><tr><td>DATEDIFF(date1,date2)</td><td>返回起始时间 date1 和 结束时间 date2 之间的天数</td></tr></tbody></table><h4 id="6-4-流程函数">6.4 流程函数</h4><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>IF(vaule, t, f)</td><td>如果value为true，则返回t，否则返回f</td></tr><tr><td>IFNULL(vaule1, vaule2)</td><td>如果value1不为空，则返回value1，否则返回value2</td></tr><tr><td>CASE WHEN [val1] THEN [res1] … ELSE [default] END</td><td>如果val1为true，返回res1，否则返回default默认值</td></tr><tr><td>CASE [expr] WHEN [val1] THEN [res1] … ELSE [default] END</td><td>如果expr等于val1，返回res1，否则返回default默认值</td></tr></tbody></table><h3 id="7）约束">7）约束</h3><p>约束是作用于表中字段上的规则，用于限制储存在表中的数据。</p><p>目的：保证数据库中数据的正确、有效性和完整性。</p><p>约束分类：</p><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段的数据不能为null</td><td>NOT NULL</td></tr><tr><td>唯一约束</td><td>保证该字段的所有数据都是唯一、不重复的</td><td>UNIQUE</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯一</td><td>PRIMARY KEY</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段的值，则采用默认值</td><td>DEFAULT</td></tr><tr><td>检查约束(8.0.16版本之后)</td><td>保证字段值满足某一个条件</td><td>CHECK</td></tr><tr><td>自增约束</td><td>会在新记录插入表中时，生成一个唯一的数字</td><td>AUTO_INCREMENT</td></tr><tr><td><font style="color:red">外键约束</font></td><td><font style="color:red">用来让两张表的数据之间建立连接，保证数据的一致性和完整性</font></td><td><font style="color:red">FOREIGN KEY</font></td></tr></tbody></table><p>eg.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># id唯一且自增 </span><br><span class="line">CREATE TABLE user(id int PRIMARY KEY AUTO_INCREMENT);</span><br><span class="line"># name不为空且不重复</span><br><span class="line">ALTER TABLE user ADD name VARCHAR(10) NOT NULL UNIQUE;</span><br></pre></td></tr></table></figure><ul><li><p><strong>外键约束</strong>（大厂一般不使用外键约束）</p><p>概念：</p><p>外键的主要作用是保证数据的一致性和完整性，并且减少数据冗余。主要体现在以下两个方面：</p><p>1.阻止执行</p><p>◆ 从表插入新行，其外键值不是主表的主键值便阻止插入。<br>◆ 从表修改外键值，新值不是主表的主键值便阻止修改。<br>◆ 主表删除行，其主键值在从表里存在便阻止删除(要想删除，必须先删除从表的相关行)。<br>◆ 主表修改主键值，旧值在从表里存在便阻止修改(要想修改，必须先删除从表的相关行)。<br>2.级联执行</p><p>◆ 主表删除行，连带从表的相关行一起删除。<br>◆ 主表修改主键值，连带从表相关行的外键值一起修改。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_20-24-38.png" alt="Snipaste_2022-12-23_20-24-38"></p><p>注意：目前上述的两张表，在数据库层面，并未建立外键关联，所以是无法保证数据的一致性和完整性的。</p><ul><li><p>添加外键</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span><br><span class="line">	字段名 数据类型,</span><br><span class="line">	...</span><br><span class="line">	[<span class="keyword">CONSTRAINT</span>] [外键名称] <span class="keyword">FOREIGN</span> KEY(外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名);</span><br></pre></td></tr></table></figure></li><li><p>删除外键</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键名称;</span><br></pre></td></tr></table></figure></li><li><p>删除/更新行为</p><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td>NO ACTION</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。（与RESTRICT一致）。</td></tr><tr><td>RESTRICT</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。（与NO ACTION一致）。</td></tr><tr><td>CASCADE</td><td>当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除/更新外键在子表中的记录。</td></tr><tr><td>SET NULL</td><td>当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null（这就要求外键允许取null）。</td></tr><tr><td>SET DEFAULT</td><td>父表有变更时，子表将外键列设置成一个默认的值（innodb不支持）</td></tr></tbody></table><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> 外键名称 <span class="keyword">FOREIGN</span> KEY (外键字段名) <span class="keyword">REFERENCES</span> 主表(主表列名) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>eg.</p><p>1.创建两张表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE student</span><br><span class="line">(</span><br><span class="line">	id int (11) primary key auto_increment,</span><br><span class="line">	name char(255),</span><br><span class="line">    sex char(255),</span><br><span class="line">	age int(11)</span><br><span class="line">)charset utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE student_score</span><br><span class="line">(</span><br><span class="line">	id int (11) primary key auto_increment,</span><br><span class="line">	class char(255),</span><br><span class="line">    score char(255),</span><br><span class="line">	student_id int(11)</span><br><span class="line">)charset utf8;</span><br></pre></td></tr></table></figure><p>2.创建外键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE student_score </span><br><span class="line">ADD CONSTRAINT s_id FOREIGN KEY (student_id) REFERENCES student (id);</span><br></pre></td></tr></table></figure><p>3.验证外键的作用</p><p>（1）先向主表中添加数据，再向从表中添加数据（从表中的外键已在主表中存在），正常运行。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#向 student 表中添加数据</span><br><span class="line">INSERT INTO student(NAME, sex, age) VALUES(&#x27;小明&#x27;, &#x27;男&#x27;, &#x27;20&#x27;);</span><br><span class="line"></span><br><span class="line">#向 student_score 表中添加数据</span><br><span class="line">INSERT INTO student_score (class, score, student_id) VALUES(&#x27;语文&#x27;, &#x27;100&#x27;, 1),(&#x27;数学&#x27;, &#x27;99&#x27;, 1),(&#x27;英语&#x27;, &#x27;98&#x27;, 1);</span><br></pre></td></tr></table></figure><p>数据插入正常，无报错、警告信息。</p><p>（2）触发限制使用默认值 <code>RESTRICT</code> 的情况下</p><p>&lt;&lt;&lt;&lt;1&gt;从表插入新行，外键值不在主表中，被阻止</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO student_score (class, score, student_id) VALUES(&#x27;语文&#x27;, &#x27;100&#x27;, 2);</span><br><span class="line">#[23000][1452] Cannot add or update a child row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>&lt;&lt;&lt;&lt;2&gt;从表修改外键值，新值不是主表的主键值，阻止修改</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE student_score</span><br><span class="line">SET student_id = 2 WHERE student_id = 1;</span><br><span class="line">#[23000][1452] Cannot add or update a child row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>（3）主表删除行，其主键值在从表里存在便阻止删除(要想删除，必须先删除从表的相关行)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM student WHERE id = 1;</span><br><span class="line">#[23000][1451] Cannot delete or update a parent row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure><p>（4）主表修改主键值，旧值在从表里存在便阻止修改(要想修改，必须先删除从表的相关行)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE student SET id = 2 WHERE id = 1;</span><br><span class="line">#[23000][1451] Cannot delete or update a parent row: a foreign key constraint fails (`test1`.`student_score`, CONSTRAINT `s_id` FOREIGN KEY (`student_id`) REFERENCES `student` (`id`))</span><br></pre></td></tr></table></figure></li></ul><h3 id="8）多表查询">8）多表查询</h3><h4 id="8-1-多表关系">8.1 多表关系</h4><p>项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：</p><p>1<strong>一对多(多对一)</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-39-11.png" alt="Snipaste_2022-12-23_23-39-11"></p><p>2.<strong>多对多</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-41-15.png" alt="Snipaste_2022-12-23_23-41-15"></p><p>SQL脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">create table student</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name varchar(10) comment &#x27;姓名&#x27;,</span><br><span class="line">    no   varchar(10) comment &#x27;学号&#x27;</span><br><span class="line">) comment &#x27;学生表&#x27;;</span><br><span class="line">insert into student</span><br><span class="line">values (null, &#x27;黛绮丝&#x27;, &#x27;2000100101&#x27;),</span><br><span class="line">       (null, &#x27;谢逊&#x27;, &#x27;2000100102&#x27;),</span><br><span class="line">       (null, &#x27;殷天正&#x27;, &#x27;2000100103&#x27;),</span><br><span class="line">       (null, &#x27;韦一笑&#x27;, &#x27;2000100104&#x27;);</span><br><span class="line">  </span><br><span class="line">create table course</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name varchar(10) comment &#x27;课程名称&#x27;</span><br><span class="line">) comment &#x27;课程表&#x27;;</span><br><span class="line">insert into course</span><br><span class="line">values (null, &#x27;Java&#x27;),</span><br><span class="line">       (null, &#x27;PHP&#x27;),</span><br><span class="line">       (null, &#x27;MySQL&#x27;),</span><br><span class="line">       (null, &#x27;Hadoop&#x27;);</span><br><span class="line"> </span><br><span class="line">create table student_course</span><br><span class="line">(</span><br><span class="line">    id        int auto_increment comment &#x27;主键&#x27; primary key,</span><br><span class="line">    studentid int not null comment &#x27;学生ID&#x27;,</span><br><span class="line">    courseid  int not null comment &#x27;课程ID&#x27;,</span><br><span class="line">    constraint fk_courseid foreign key (courseid) references course (id),</span><br><span class="line">    constraint fk_studentid foreign key (studentid) references student (id)</span><br><span class="line">) comment &#x27;学生课程中间表&#x27;;</span><br><span class="line">insert into student_course</span><br><span class="line">values (null, 1, 1),</span><br><span class="line">       (null, 1, 2),</span><br><span class="line">       (null, 1, 3),</span><br><span class="line">       (null, 2, 2),</span><br><span class="line">       (null, 2, 3),</span><br><span class="line">       (null, 3, 4);</span><br></pre></td></tr></table></figure><p>3.<strong>一对一</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-44-24.png" alt="Snipaste_2022-12-23_23-44-24"></p><p>SQL脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">create table tb_user</span><br><span class="line">(</span><br><span class="line">    id     int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    name   varchar(10) comment &#x27;姓名&#x27;,</span><br><span class="line">    age    int comment &#x27;年龄&#x27;,</span><br><span class="line">    gender char(1) comment &#x27;1: 男 , 2: 女&#x27;,</span><br><span class="line">    phone  char(11) comment &#x27;手机号&#x27;</span><br><span class="line">) comment &#x27;用户基本信息表&#x27;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">create table tb_user_edu</span><br><span class="line">(</span><br><span class="line">    id            int auto_increment primary key comment &#x27;主键ID&#x27;,</span><br><span class="line">    degree        varchar(20) comment &#x27;学历&#x27;,</span><br><span class="line">    major         varchar(50) comment &#x27;专业&#x27;,</span><br><span class="line">    primaryschool varchar(50) comment &#x27;小学&#x27;,</span><br><span class="line">    middleschool  varchar(50) comment &#x27;中学&#x27;,</span><br><span class="line">    university    varchar(50) comment &#x27;大学&#x27;,</span><br><span class="line">    userid        int unique comment &#x27;用户ID&#x27;,</span><br><span class="line">    constraint fk_userid foreign key (userid) references tb_user (id)</span><br><span class="line">) comment &#x27;用户教育信息表&#x27;;</span><br><span class="line"> </span><br><span class="line">insert into tb_user(id, name, age, gender, phone)</span><br><span class="line">values (null, &#x27;黄渤&#x27;, 45, &#x27;1&#x27;, &#x27;18800001111&#x27;),</span><br><span class="line">       (null, &#x27;冰冰&#x27;, 35, &#x27;2&#x27;, &#x27;18800002222&#x27;),</span><br><span class="line">       (null, &#x27;码云&#x27;, 55, &#x27;1&#x27;, &#x27;18800008888&#x27;),</span><br><span class="line">       (null, &#x27;李彦宏&#x27;, 50, &#x27;1&#x27;, &#x27;18800009999&#x27;);</span><br><span class="line">insert into tb_user_edu(id, degree, major, primaryschool, middleschool, university, userid)</span><br><span class="line">values (null, &#x27;本科&#x27;, &#x27;舞蹈&#x27;, &#x27;静安区第一小学&#x27;, &#x27;静安区第一中学&#x27;, &#x27;北京舞蹈学院&#x27;, 1),</span><br><span class="line">       (null, &#x27;硕士&#x27;, &#x27;表演&#x27;, &#x27;朝阳区第一小学&#x27;, &#x27;朝阳区第一中学&#x27;, &#x27;北京电影学院&#x27;, 2),</span><br><span class="line">       (null, &#x27;本科&#x27;, &#x27;英语&#x27;, &#x27;杭州市第一小学&#x27;, &#x27;杭州市第一中学&#x27;, &#x27;杭州师范大学&#x27;, 3),</span><br><span class="line">       (null, &#x27;本科&#x27;, &#x27;应用数学&#x27;, &#x27;阳泉第一小学&#x27;, &#x27;阳泉区第一中学&#x27;, &#x27;清华大学&#x27;, 4);</span><br></pre></td></tr></table></figure><h4 id="8-2-多表查询">8.2 多表查询</h4><p>1.数据准备</p><p>创建emp表与dept表并插入测试数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">-- 创建dept表，并插入数据</span><br><span class="line">create table dept</span><br><span class="line">(</span><br><span class="line">    id   int auto_increment comment &#x27;ID&#x27; primary key,</span><br><span class="line">    name varchar(50) not null comment &#x27;部门名称&#x27;</span><br><span class="line">) comment &#x27;部门表&#x27; charset utf8;</span><br><span class="line">INSERT INTO dept (id, name)</span><br><span class="line">VALUES (1, &#x27;研发部&#x27;),</span><br><span class="line">       (2, &#x27;市场部&#x27;),</span><br><span class="line">       (3, &#x27;财务部&#x27;),</span><br><span class="line">       (4, &#x27;销售部&#x27;),</span><br><span class="line">       (5, &#x27;总经办&#x27;),</span><br><span class="line">       (6, &#x27;人事部&#x27;);</span><br><span class="line"></span><br><span class="line">-- 创建emp表，并插入数据</span><br><span class="line">create table emp</span><br><span class="line">(</span><br><span class="line">    id        int auto_increment comment &#x27;ID&#x27; primary key,</span><br><span class="line">    name      varchar(50) not null comment &#x27;姓名&#x27;,</span><br><span class="line">    age       int comment &#x27;年龄&#x27;,</span><br><span class="line">    job       varchar(20) comment &#x27;职位&#x27;,</span><br><span class="line">    salary    int comment &#x27;薪资&#x27;,</span><br><span class="line">    entrydate date comment &#x27;入职时间&#x27;,</span><br><span class="line">    managerid int comment &#x27;直属领导ID&#x27;,</span><br><span class="line">    dept_id   int comment &#x27;部门ID&#x27;</span><br><span class="line">) comment &#x27;员工表&#x27; charset utf8;</span><br><span class="line"> </span><br><span class="line">-- 添加外键</span><br><span class="line">alter table emp</span><br><span class="line">    add constraint fk_emp_dept_id foreign key (dept_id) references dept (id);</span><br><span class="line">INSERT INTO emp (id, name, age, job, salary, entrydate, managerid, dept_id)</span><br><span class="line">VALUES (1, &#x27;金庸&#x27;, 66, &#x27;总裁&#x27;, 20000, &#x27;2000-01-01&#x27;, null, 5),</span><br><span class="line">       (2, &#x27;张无忌&#x27;, 20, &#x27;项目经理&#x27;, 12500, &#x27;2005-12-05&#x27;, 1, 1),</span><br><span class="line">       (3, &#x27;杨逍&#x27;, 33, &#x27;开发&#x27;, 8400, &#x27;2000-11-03&#x27;, 2, 1),</span><br><span class="line">       (4, &#x27;韦一笑&#x27;, 48, &#x27;开发&#x27;, 11000, &#x27;2002-02-05&#x27;, 2, 1),</span><br><span class="line">       (5, &#x27;常遇春&#x27;, 43, &#x27;开发&#x27;, 10500, &#x27;2004-09-07&#x27;, 3, 1),</span><br><span class="line">       (6, &#x27;小昭&#x27;, 19, &#x27;程序员鼓励师&#x27;, 6600, &#x27;2004-10-12&#x27;, 2, 1),</span><br><span class="line">       (7, &#x27;灭绝&#x27;, 60, &#x27;财务总监&#x27;, 8500, &#x27;2002-09-12&#x27;, 1, 3),</span><br><span class="line">       (8, &#x27;周芷若&#x27;, 19, &#x27;会计&#x27;, 48000, &#x27;2006-06-02&#x27;, 7, 3),</span><br><span class="line">       (9, &#x27;丁敏君&#x27;, 23, &#x27;出纳&#x27;, 5250, &#x27;2009-05-13&#x27;, 7, 3),</span><br><span class="line">       (10, &#x27;赵敏&#x27;, 20, &#x27;市场部总监&#x27;, 12500, &#x27;2004-10-12&#x27;, 1, 2),</span><br><span class="line">       (11, &#x27;鹿杖客&#x27;, 56, &#x27;职员&#x27;, 3750, &#x27;2006-10-03&#x27;, 10, 2),</span><br><span class="line">       (12, &#x27;鹤笔翁&#x27;, 19, &#x27;职员&#x27;, 3750, &#x27;2007-05-09&#x27;, 10, 2),</span><br><span class="line">       (13, &#x27;方东白&#x27;, 19, &#x27;职员&#x27;, 5500, &#x27;2009-02-12&#x27;, 10, 2),</span><br><span class="line">       (14, &#x27;张三丰&#x27;, 88, &#x27;销售总监&#x27;, 14000, &#x27;2004-10-12&#x27;, 1, 4),</span><br><span class="line">       (15, &#x27;俞莲舟&#x27;, 38, &#x27;销售&#x27;, 4600, &#x27;2004-10-12&#x27;, 14, 4),</span><br><span class="line">       (16, &#x27;宋远桥&#x27;, 40, &#x27;销售&#x27;, 4600, &#x27;2004-10-12&#x27;, 14, 4),</span><br><span class="line">       (17, &#x27;陈友谅&#x27;, 42, null, 2000, &#x27;2011-10-12&#x27;, 1, null);</span><br></pre></td></tr></table></figure><p>2.概述</p><p>多表查询就是指从多张表中查询数据。原来查询单表数据，执行的SQL形式为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp;</span><br></pre></td></tr></table></figure><p>要执行多表查询，就只需要使用逗号分隔多张表即可:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp, dept; </span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130212342006.png" alt="image-20230130212342006"></p><p>（忽略一些数据）此时,我们看到查询结果中包含了大量的结果集，总共102条记录，而这其实就是员工表emp所有的记录 (17) 与 部门表dept所有记录(6) 的所有组合情况，这种现象称之为笛卡尔积。</p><blockquote><p>《笛卡尔乘积》</p><p>笛卡尔乘积是指在数学中，两个集合A集合 和 B集合的所有组合情况。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-23_23-50-12.png" alt="Snipaste_2022-12-23_23-50-12"></p><p>在多表查询中，我们是需要消除无效的笛卡尔积的，只保留两张表关联部分的数据。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/ffed86c8ebe3447686f5bccebbd44155.png" alt="img"></p><p>在SQL语句中，如何来去除无效的笛卡尔积呢？ 我们可以给多表查询加上连接查询的条件即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp , dept where emp.dept_id = dept.id;</span><br></pre></td></tr></table></figure><p>结果如下：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130212830125.png" alt="image-20230130212830125"></p><p>而由于id为17的员工，没有dept_id字段值，所以在多表查询时，根据连接查询的条件并没有查询到。</p></blockquote><h5 id="8-2-1-连接查询">8.2.1 连接查询</h5><ol><li><p>内连接：相当于查询A、B交集部分数据</p></li><li><p>外连接：</p><p>左外连接：查询左表所有数据，以及两张表交集部分数据</p><p>右外连接：查询右表所有数据，以及两张表交集部分数据</p></li><li><p>自连接：当前表与自身的连接查询，自连接必须使用表别名</p></li></ol><h6 id="1-内连接">1. 内连接</h6><p>相当于查询A、B交集部分数据</p><p>① 隐式内连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span>, 表<span class="number">2</span> <span class="keyword">WHERE</span> 条件...;</span><br></pre></td></tr></table></figure><p>② 显式内连接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> [<span class="keyword">INNER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><ul><li><p>eg.</p><ol><li><p>查询每一个员工的姓名 , 及关联的部门的名称 (隐式内连接实现)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#表结构: emp , dept</span><br><span class="line">#连接条件: emp.dept_id = dept.id</span><br><span class="line"></span><br><span class="line">select emp.name, dept.name</span><br><span class="line">from emp,</span><br><span class="line">     dept</span><br><span class="line">where emp.dept_id = dept.id;</span><br><span class="line"># 为每一张表起别名,简化SQL编写</span><br><span class="line">select e.name,d.name from emp e , dept d where e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130213622166.png" alt="image-20230130213622166"></p></li><li><p>查询每一个员工的姓名 , 及关联的部门的名称 (显式内连接实现)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select e.name, d.name</span><br><span class="line">from emp e</span><br><span class="line">         inner join dept d on e.dept_id = d.id;</span><br><span class="line"># 为每一张表起别名,简化SQL编写</span><br><span class="line">select e.name, d.name</span><br><span class="line">from emp e</span><br><span class="line">         join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><blockquote><p>注意事项：</p><p>一旦为表起了别名，就不能再使用表名来指定对应的字段了，此时只能够使用别名来指定字段。</p></blockquote></li></ol></li></ul><h6 id="2-外连接">2. 外连接</h6><p>① 左外连接：查询左表所有数据，以及两张表交集部分数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 相当于查询表<span class="number">1</span>（左表）的所有数据 包含表<span class="number">1</span>和表<span class="number">2</span>交集部分的数据</span><br><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">LEFT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><p>② 右外连接：查询右表所有数据，以及两张表交集部分数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表 <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">RIGHT</span> [<span class="keyword">OUTER</span>] <span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="keyword">ON</span> 连接条件...;</span><br></pre></td></tr></table></figure><ul><li><p>eg.</p><ol><li><p><strong>查询emp表的所有数据, 和对应的部门信息</strong></p><p>由于需求中提到，要查询emp的所有数据，所以是不能内连接查询的，需要考虑使用外连接查询。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.*, d.name from emp e left outer join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130214721226.png" alt="image-20230130214721226"></p></li><li><p><strong>查询dept表的所有数据, 和对应的员工信息(右外连接)</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select d.*, e.* from emp e right outer join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130214854779.png" alt="image-20230130214854779"></p></li></ol><blockquote><p>注意事项：</p><p>左外连接和右外连接是可以相互替换的，只需要调整在连接查询时SQL中，表结构的先后顺序就可以了。而我们在日常开发使用时，更偏向于左外连接。</p></blockquote></li></ul><h6 id="3-自连接">3. 自连接</h6><p>当前表与自身的链接查询，自链接必须使用表别名</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表A 别名A JOIN 表B 别名B ON 条件...;</span><br></pre></td></tr></table></figure><blockquote><p>对于自连接查询，可以是内连接查询，也可以是外连接查询</p><p>注意事项:</p><p>在自连接查询中，必须要为表起别名，要不然我们不清楚所指定的条件、返回的字段，到底是哪一张表的字段。</p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询员工及其所属领导的名字</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.name, b.name from emp a, emp b where a.managerid = b.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130220003537.png" alt="image-20230130220003537"></p></li><li><p><strong>查询所有员工 emp 及其领导的名字 emp , 如果员工没有领导, 也需要查询出来</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.name &#x27;员工&#x27;, b.name &#x27;领导&#x27; from emp a left join emp b on a.managerid = b.id;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130220032095.png" alt="image-20230130220032095"></p></li></ol></li></ul><h5 id="8-2-2-联合查询">8.2.2 联合查询</h5><p>对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT 字段列表 FROM 表A ... </span><br><span class="line">UNION [ALL] </span><br><span class="line">SELECT 字段列表 FROM 表B ....;</span><br></pre></td></tr></table></figure><p>1.对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致。</p><p>2.union all 会将全部的数据直接合并在一起，union 会对合并之后的数据去重。</p><ul><li><p>eg.</p><ol><li><p>将薪资低于 5000 的员工和年龄大于 50 岁的员工全部查询出来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE salary &lt; 5000</span><br><span class="line">UNION ALL</span><br><span class="line">SELECT * FROM emp WHERE age &gt; 50;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130230029057.png" alt="image-20230130230029057"></p><blockquote><p>union all查询出来的结果，仅仅进行简单的合并，并未去重。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE salary &lt; 5000</span><br><span class="line">UNION</span><br><span class="line">SELECT * FROM emp WHERE age &gt; 50;</span><br></pre></td></tr></table></figure><p>结果如下图：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/image-20230130230141485.png" alt="image-20230130230141485"></p><blockquote><p>union 联合查询，会对查询出来的结果进行去重处理。</p></blockquote></li></ol></li></ul><h5 id="8-2-3-子查询">8.2.3 子查询</h5><p>SQL语句中嵌套SELECT语句，称为嵌套查询，又称子查询。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM t1 WHERE column = (SELECT column1 FROM t2);</span><br></pre></td></tr></table></figure><p>子查询外部的语句可以是INSERT / UPDATE / DELETE / SELECT 的任何一个。</p><ul><li><p>根据子查询结果不同，分为：</p><ul><li><p><strong>标量子查询</strong>（子查询结果为单个值）</p><blockquote><p>子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种查询称为标量子查询。</p><p>常用的操作符： <code>=</code> <code>&gt;</code> <code>≥</code> <code>&lt;</code> <code>≤</code> <code>&lt;&gt;</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询 “销售部” 的所有员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 先查询 “销售部” 部门ID</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from dept where name = &#x27;销售部&#x27;;</span><br></pre></td></tr></table></figure><p>② 根据 “销售部” 部门ID, 查询员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where dept_id = (select id from dept where name = &#x27;销售部&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询在 “方东白” 入职之后的员工信息</strong></p><p>① 完成这个需求时，我们也可以将需求分解为两步：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select entrydate from emp where name = &#x27;方东白&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询指定入职日期之后入职的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where entrydate &gt; (select entrydate from emp where name = &#x27;方东白&#x27;);</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>列子查询</strong>（子查询结果为一列）</p><blockquote><p>子查询返回的是一列（可以是多行的），这种查询称为列子查询。</p><p>常用操作符：<code>IN</code> <code>NOT IN</code> <code>ANY</code> <code>SOME</code> <code>ALL</code></p></blockquote><table><thead><tr><th>操作符</th><th>描述</th></tr></thead><tbody><tr><td>IN</td><td>在指定的集合范围之内，多选一</td></tr><tr><td>NOT IN</td><td>不在指定的集合范围之内</td></tr><tr><td>ANY</td><td>子查询返回列表中，有任意一个满足即可</td></tr><tr><td>SOME</td><td>与ANY等同，使用SOME的地方都可以使用ANY</td></tr><tr><td>ALL</td><td>子查询返回列表的所有值都必须满足</td></tr></tbody></table><ul><li><p>eg.</p><ol><li><p><strong>查询 “销售部” 和 “市场部” 的所有员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 查询 “销售部” 和 “市场部” 的部门ID</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM dept WHERE name = &#x27;销售部&#x27; or name = &#x27;市场部&#x27;;</span><br></pre></td></tr></table></figure><p>② 根据部门ID, 查询员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM emp WHERE dept_id in (SELECT id FROM dept WHERE name = &#x27;销售部&#x27; or name = &#x27;市场部&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询比 财务部 所有人工资都高的员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为三步：</p><p>① 查询财务部的id</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id FROM dept WHERE name = &#x27;财务部&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询财务部所有人员的工资</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select salary</span><br><span class="line">from emp</span><br><span class="line">where dept_id = (select id from dept where name = &#x27;财务部&#x27;);</span><br></pre></td></tr></table></figure><p>③ 比财务部所有人工资都高的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where salary &gt; all (select salary from emp where dept_id = (select id from dept where name = &#x27;财务部&#x27;));</span><br></pre></td></tr></table></figure></li><li><p><strong>查询比研发部其中任意一人工资高的员工信息</strong></p><p>完成这个需求时，我们可以将需求分解为两步：</p><p>① 查询研发部所有人工资</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select salary</span><br><span class="line">from emp</span><br><span class="line">where dept_id = (select id from dept where name = &#x27;研发部&#x27;);</span><br></pre></td></tr></table></figure><p>② 比研发部其中任意一人工资高的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where salary &gt; any (select salary from emp where dept_id = (select id from dept where name = &#x27;研发部&#x27;));</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>行子查询</strong>（子查询结果为一行）</p><blockquote><p>子查询返回的结果是一行（可以是多列），这种查询称为行子查询。</p><p>常用的操作符： <code>=</code> <code>&lt;&gt;</code> <code>IN</code> <code>NOT IN</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询与 “张无忌” 的薪资及直属领导相同的员工信息</strong></p><p>① 查询 “张无忌” 的薪资及直属领导</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select salary, managerid from emp where name = &#x27;张无忌&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询与 “张无忌” 的薪资及直属领导相同的员工信息 ;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where (salary, managerid) = (select salary, managerid from emp where name = &#x27;张无忌&#x27;);</span><br></pre></td></tr></table></figure></li></ol></li></ul></li><li><p><strong>表子查询</strong>（子查询结果为多行多列）</p><blockquote><p>子查询返回的结果是多行多列，这种查询称为表子查询。</p><p>常用的操作符： <code>IN</code></p></blockquote><ul><li><p>eg.</p><ol><li><p><strong>查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息</strong></p><p>① <strong>查询 “鹿杖客” , “宋远桥” 的职位和薪资</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select job, salary</span><br><span class="line">from emp</span><br><span class="line">where name = &#x27;鹿杖客&#x27;</span><br><span class="line">   or name = &#x27;宋远桥&#x27;;</span><br></pre></td></tr></table></figure><p>② <strong>查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from emp</span><br><span class="line">where (job, salary) in (select job, salary from emp where name = &#x27;鹿杖客&#x27; or name = &#x27;宋远桥&#x27;);</span><br></pre></td></tr></table></figure></li><li><p><strong>查询入职日期是 “2006-01-01” 之后的员工信息 , 及其部门信息</strong></p><p>① 入职日期是 “2006-01-01” 之后的员工信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where entrydate &gt; &#x27;2006-01-01&#x27;;</span><br></pre></td></tr></table></figure><p>② 查询这部分员工, 对应的部门信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select e.*, d.*</span><br><span class="line">from (select * from emp where entrydate &gt; &#x27;2006-01-01&#x27;) e</span><br><span class="line">         left join dept d on e.dept_id = d.id;</span><br></pre></td></tr></table></figure></li></ol></li></ul></li></ul></li><li><p>根据子查询位置，分为:</p><ul><li>WHERE之后</li><li>FROM之后</li><li>SELECT之后</li></ul></li></ul><h3 id="9）事务">9）事务</h3><p>事务是一组操作的集合，它是一个不可分割的工作单位，事物会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p><p>默认MySQL的事务是自动提交的，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。</p><h4 id="9-1-事务的四大特性ACID">9.1 事务的四大特性ACID</h4><ul><li><p>原子性 (Atomicity):事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</p></li><li><p>一致性 (Consistency):事务完成时，必须使所有的数据都保持一致状态。</p></li><li><p>隔离性 (Isolation):数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</p></li><li><p>持久性 (Durability):事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</p><p><strong>注意：只有当前三条性质都满足了，才能保证事务的一致性</strong></p></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2f0798cbce574f478c9f03ac813fff55.png" alt="在这里插入图片描述"></p><blockquote><p><strong>刷脏</strong>：Mysql为了保证存储效率，于是每次将要读写的文件是先存储在缓存池中，对于数据的操作是在缓存池中，而mysql将会定期的刷新到磁盘中。</p></blockquote><blockquote><p>1、如何保证原子性：</p><p>首先：对于A和B两操作要操作成功就一定需要更改到表的信息，如果如图所示A语句操作成功，而B语句操作时出现断电等其他情况终止了操作，所以此时两个事务没有操作成功，在没有提交事务之前，mysql会先记录跟新前的数据到undo log日志里面，当最终的因为操作不成功而发生事务回滚时，会从undo log日志里面先前存好的数据，重新对数据库的数据进行数据的回退。</p><p>undo log日志：（撤销回退的日志）主要存储数据库更新之前的数据，用于作备份</p><p>2、如何保证事务的持久性：</p><p>通过重做日志：redo log日志，对于用户将对发生了修改而为提交的数据存入了redo log日志中，当此时发生断电等其他异常时，可以根据redo log日志重新对数据做一个提交，做一个恢复。<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/e9263317bc3a4554b839a4efefbcf60d.png" alt="img"></p><p>3、隔离性：</p><blockquote><p>(1)事务的并发问题：</p><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另外一个事务还没有提交的数据。</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了‘’幻影‘’。</td></tr></tbody></table><ol><li><p>脏读（读未提交）</p><p>事务A读取到了事务已经修改但未提交的数据，这种数据就叫脏数据，是不正确的</p></li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/0e5ac64c906c4d13b6dbdecda01b5910.png" alt="在这里插入图片描述"></p><ol start="2"><li><p>读已提交：（不可重复读）</p><p>不可重复读：对于事务A多次读取同一个数据时，由于其他是事务也在访问这个数据，进行修改且提交，对于事务A，读取同一个数据时，有可能导致数据不一致，叫不可重复读</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2b755a18343a4122a434c5d955804492.png" alt="在这里插入图片描述"></p></li><li><p>可重复读：（幻读）</p><p>幻读：原因：因为mysql数据库读取数据时，是将数据放入缓存中，当事务B对数据库进行操作：例如删除所有数据且提交时，事务A同样能访问到数据，这就产生了幻读。问题：解决了可重复读，但是会产生一种问题，错误的读取数据，对于其他事务添加的数据也将访问不到</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/86be832bbeb348ea8b736e6331ec58c0.png" alt="在这里插入图片描述"></p></li><li><p>串行化</p><p>串行化：事务A和事务B同时访问时，在事务A修改了数据，而没有提交数据时，此时事务B想增加或修改数据时，只能等待事务A的提交，事务B才能够执行。</p><p>问题：用户的体验十分的差，因为每次访问时都要等待其他事务的提交才能操作</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/03fed1e189d940fb912068ca894f4f6e.png" alt="在这里插入图片描述"></p></li></ol></blockquote><blockquote><p>(2)事务的隔离等级:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看事务的隔离级别</span><br><span class="line">SELECT @@TRANSACTION_ISOLATION;</span><br><span class="line"># 或者</span><br><span class="line">select @@global.tx_isolation,@@tx_isolation;</span><br><span class="line"></span><br><span class="line"># 设置事物隔离级别 （SESSION 为当前窗口）</span><br><span class="line">SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL &#123;READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>隔离级别</th><th>中文</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td><code>Read uncommitted</code></td><td>读未提交</td><td>√</td><td>√</td><td>√</td></tr><tr><td><code>Read committed</code></td><td>读已提交</td><td>×</td><td>√</td><td>√</td></tr><tr><td><code>Repeatable Read</code></td><td>可重复读(默认)</td><td>×</td><td>×</td><td>√</td></tr><tr><td><code>Serializable</code></td><td>串行化</td><td>×</td><td>×</td><td>×</td></tr></tbody></table><ol><li><p>读未提交：事物A和事物B，事物A未提交的数据，事物B可以读取到。 这种隔离级别最低，这种级别一般是在理论上存在，数据库隔离级别一般都高于该级别。 <strong>三种并发问题都没解决。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure></li><li><p>读已提交：事务A只能读取到事务B提交的数据，这种级别可以避免“脏数据” ，这种隔离级别会导致“不可重复读取” ，<strong>Oracle默认隔离级别</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level read committed;</span><br></pre></td></tr></table></figure></li><li><p>可重复读：- 事务A和事务B，事务A提交之后的数据，事务B读取不到 - 事务B是可重复读取数据 - 这种隔离级别高于读已提交 - 换句话说，对方提交之后的数据，我还是读取不到 - 这种隔离级别可以避免“不可重复读取”，达到可重复读取 - 比如1点和2点读到数据是同一个 - MySQL默认级别 - 虽然可以达到可重复读取，但是会导致“幻像读”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level repeatable read;</span><br></pre></td></tr></table></figure></li><li><p>串行化：事务A和事务B，事务A在操作数据库时，事务B只能排队等待 这种隔离级别很少使用，吞吐量太低，用户体验差 这种级别可以避免“幻像读”，每一次读取的都是数据库中真实存在数据，事务A与事务B串行， 而不并发</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global transaction isolation level serializable;</span><br></pre></td></tr></table></figure></li></ol></blockquote><blockquote><p>(3)隔离级别的一致性的关系：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/fe8bf94eb677468da203a783d44ade6a.png" alt="在这里插入图片描述"></p></blockquote></blockquote><h4 id="9-2-事务操作">9.2 事务操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前事务是否自动</span><br><span class="line">SELECT @@autocommit;</span><br><span class="line"></span><br><span class="line"># 方法1</span><br><span class="line"># 查看/设置事务提交方式 1为自动提交 0为手动提交</span><br><span class="line">SET @@autocommit = 0;</span><br><span class="line"># 方法2</span><br><span class="line"># 开启事务</span><br><span class="line">START TRANSACTION 或 BEGIN;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line">COMMIT;</span><br><span class="line"></span><br><span class="line"># 回滚事务</span><br><span class="line">ROLLBACK;</span><br></pre></td></tr></table></figure><h2 id="进阶">进阶</h2><h3 id="1）存储引擎">1）存储引擎</h3><ol><li><p>MySQL体系结构</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200604182023796.png" alt="20200604182023796"></p><blockquote><ul><li><p>连接层</p><p>最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关的完全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p></li><li><p>服务层</p><p>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。</p></li><li><p>引擎层</p><p>存储引擎真正的负责了MySQL中数据的储存和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取核实的存储引擎。</p></li><li><p>存储层</p><p>主要是将数据存储在文件系统之上，并完成与储存引擎的交互。</p></li></ul></blockquote></li><li><p>存储引擎介绍</p><p>存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查询建表语句</span><br><span class="line">SHOW CREATE TABLE 表名;</span><br><span class="line"># ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line"></span><br><span class="line"># 创建表时，指定存储引擎</span><br><span class="line">CREATE TABLE 表名(</span><br><span class="line">	字段1 字段1类型,</span><br><span class="line">	....</span><br><span class="line">)ENGINE = 存储引擎 [COMMENT 表注释];</span><br><span class="line"></span><br><span class="line"># 查看当前数据库支持的存储引擎</span><br><span class="line">SHOW ENGINES;</span><br></pre></td></tr></table></figure></li><li><p>存储引擎特性</p><p>1.采用的是插拔式的插件方式；<br>2.存储引擎是指定在表之上的，即一个库中的每一个表都可以指定选择存储引擎；<br>3.不管表采用什么样的存储引擎，都会在数据区，产生对应的一个.frm文件（表结构定义描述文件，下文有介绍。好像是在MySQL 8.0中，.frm 文件已经不存在了，此处以MySQL5.7介绍）<br><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/Snipaste_2022-12-25_13-35-18.png" alt="Snipaste_2022-12-25_13-35-18"></p></li></ol><blockquote><p><strong>Tips：以下所有内容，基于 MySQL 5.7.28 版本介绍（CSV、Archive、Memory、InnoDB、MyISAM。其它引擎就不过多介绍）</strong></p></blockquote><h4 id="10-1-InnoDB存储引擎-5-5后默认-重要">10.1 InnoDB存储引擎(5.5后默认)(重要)</h4><p>10.1.1 InnoDB介绍</p><p>InnoDB特点总结：</p><p>​ DML操作遵循ACID模型，支持事务；</p><p>​ 行级锁，提高并发访问性能；</p><p>​ 支持外键FOREIGN KEY约束，保证数据的完整性和正确性。</p><blockquote><p>在 MySQL 5.5 及以后版本后，MySQL 选择使用 InnoDB为默认存储引擎。在创建数据库表时，不指定存储引擎时，使用的就是 InnoDB。如需使用其他存储引擎，可以手动来指定。</p><p>特点：</p><ol><li>InnoDB 支持事务操作；（每一条SQL都默认封装成事务，自动提交，会影响速度）</li><li>InnoDB 支持外键；</li><li>InnoDB 是聚集索引（聚簇索引）；</li><li>InnoDB 不保存表的总条数；</li><li>InnoDB 5.7版本之前不支持全文检索；</li><li>InnoDB 支持表级锁、行级锁，默认为行级锁；</li><li>InnoDB 表必须有主键（如果我们没有明确去指定创建主键索引。它会帮我们隐藏的生成一个 6 byte 的 int 型的索引作为主键索引）；</li><li>InnoDB 文件存储方式为.frm文件存储表结构，ibd文件存储数据内容。</li></ol><blockquote><p>名词解释：</p><p>什么是聚集(簇)索引？</p><p>聚簇索引的特点是叶子节点包含了完整的记录行，而非聚簇索引的叶子节点只有所以字段和主键ID。</p><p>MySQL 索引采用 B+Tree（不熟悉？来跳转链接了解：MySQL 索引底层为什么选择B+Tree）。InnoDB 和 MyISAM 作为 MySQL 中 B+Tree 索引的两种重要体现形式。</p><p>InnoDB 推荐以主键作为索引来组织数据进行存储，它认为主键是一个非常重要的属性。InnoDB 表数据文件本身就是按B+Tree组织的一个索引结构，聚簇索引就是按照每张表的主键来构造一个B+树，叶子节点中存放的就是整张表的数据。</p><p>一般建表会用一个自增主键做聚簇索引，没有的话MySQL会默认创建，但是这个主键如果更改代价较高，故建表时要考虑自增ID不能频繁 update 这一点。</p><p>（估计你还看不懂，哈哈。那就看看这里你就懂了----&gt;MySQL一张表，比如有id(主键)，name，age等字段。我们可以建很多个索引，MySQL除了主键索引外，都是非聚簇索引。即只有我们创建的主键id索引，我们可以叫他id索引，它别名又叫做聚簇索引，（因为只有id索引，叶子节点包含了完整的记录行）理解成一个别名的即可。如果我们再创建一个name索引，它就叫做非聚簇索引，或者辅助索引。）【也可参考：MyISAM 和 InnoDB 的区别 文中介绍的聚簇索引】</p><p>我们日常工作中，根据实际情况自行添加的索引都是辅助索引，辅助索引就是一个为了需找主键索引的二级索引，现在找到主键索引再通过主键索引找数据；</p></blockquote></blockquote><p>InnoDB 支持的一些特性，我们在此无法验证，你只需要记住就好了。现在我们有一个<strong>db_store库</strong>，库中我们创建一个 employee 表，我们来看一下它在硬盘中的存储情况。</p><p>10.1.2 使用InnoDB存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `employee` (</span><br><span class="line">  `employeeID` int(11) NOT NULL,</span><br><span class="line">  `userName` varchar(16) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `phoneNum` varchar(32) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `createTime` datetime DEFAULT NULL,</span><br><span class="line">  `lastUpdate` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`employeeID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin;</span><br></pre></td></tr></table></figure><p>10.1.3 了解 InnoDB 硬盘存储方式</p><p>进入<code>/usr/local/mysql/data</code> 目录，再进入到 db_store 目录下，我们便能够很真实的看到数据库中的数据在硬盘中存储，它其实就是以两个文件（employee.frm、employee.ibd）的方式体现。(此处可以看到有employee 和 store 两个，说明 db_store 库下有两个表)</p><blockquote><p><strong>.frm 和 .ibd 格式文件介绍</strong></p><p><strong>.frm文件</strong>：保存的是表结构定义描述文件<br><strong>.ibd文件</strong>：保存的是employee表中的数据内容</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200605164659478.png" alt="在这里插入图片描述"></p></blockquote><h4 id="10-2-MyISAM存储引擎-早期默认">10.2 MyISAM存储引擎(早期默认)</h4><p>10.2.1 MyISAM介绍</p><p>MyISAM特点总结：</p><p>​ 不支持事务，不支持外键；</p><p>​ 支持表锁，不支持行锁；</p><p>​ 访问速度快。</p><blockquote><p>MyISAM 作为 MySQL 中 B+Tree 索引的另一种重要体现形式。</p><p>特点：</p><ol><li><p>MyISAM 是非聚集索引；</p></li><li><p>MyISAM 有一个变量专门来保存整个表的行数，查询count很快(注意不能加任何 where 条件)</p></li><li><p>MyISAM 支持全文索引；</p></li><li><p>MyISAM 可以被压缩后进行查询操作，节省空间容量；</p></li><li><p>MyISAM 支持表级锁，不支持行级锁；</p></li><li><p>MyISAM 中主键不是必须的；</p></li><li><p>MyISAM 文件存储方式为.frm文件存储表结构，.MYD文件存储数据内容，.MYI文件存储索引文件。</p></li></ol></blockquote><p>现在我们在<code>**db_store库**</code>，库中我们创建一个 employee_myisam 表，来看一下它在硬盘中的存储情况。</p><p>10.2.2 使用MyISAM存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `employee_myisam` (</span><br><span class="line">  `employeeID` int(11) NOT NULL,</span><br><span class="line">  `userName` varchar(16) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `phoneNum` varchar(32) COLLATE utf8_bin DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `createTime` datetime DEFAULT NULL,</span><br><span class="line">  `lastUpdate` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`employeeID`)</span><br><span class="line">) ENGINE=MyISAM CHARSET=utf8 COLLATE=utf8_bin;</span><br></pre></td></tr></table></figure><p>10.2.3 了解 MyIsam 硬盘存储方式</p><p>进入<code>/usr/local/mysql/data</code> 目录，再进入到 db_store 目录下，我们便能够很真实的看到数据库中的数据在硬盘中存储，它其实就是以**三个文件（xxx.frm、xxx.MYD、xxx.MYI）**的方式体现。</p><blockquote><p><strong>.frm | .MYD | .MYI 格式文件介绍</strong></p><p><strong>.frm文件</strong>：保存的是表结构定义描述文件<br><strong>.MYD文件</strong>：保存的是数据内容<br><strong>.MYI文件</strong>：保存的是索引内容</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/20200605171922206.png" alt="在这里插入图片描述"></p></blockquote><h4 id="10-MyISAM-和-InnoDB-的区别">10.- <a target="_blank" rel="noopener" href="https://blog.csdn.net/lzb348110175/article/details/106575270">MyISAM 和 InnoDB 的区别</a></h4><h4 id="10-3-Memory存储引擎">10.3 Memory存储引擎</h4><p>表数据暂时存储在内存中，由于受硬件问题、断电的影响，只能将这些表作为临时表或缓存使用。</p><p>10.3.1 Memory介绍</p><p>特点：</p><p>​ 内存存放;</p><p>​ hash索引（默认）。</p><blockquote><p>Memory存储引擎（在以往的版本中，又叫 Heap 存储引擎）。数据存储在内存中，在实际的应用场景中用到的很少，但是它与优化器查询有很大的关系，对临时表很有用。（不了解优化器查询？？请点击链接：不会MySQL调优？来来瞅瞅SQL的执行计划吧了解）</p><p>Memory中基于Hash索引，底层是 Hash 表，对于精确查询非常高效。即：在’='、'in’条件下高效，无法通过索引做区间查询。只能扫描全表。（范围查询、排序、组合索引效率不高）</p><p>特点：</p><ol><li>数据都是存储在内存中，IO效率比其他引擎高很多；（优点：效率高）</li><li>服务重启后数据会丢失，内存数据表默认只有16M（缺点：保证不了持久性）</li><li>支持 Hash索引，B Tree索引，默认为 Hash索引</li><li>不支持大数据存储类型，如 blog，text 等</li><li>表级锁</li></ol><blockquote><p>应用场景：</p><ol><li>等值查找热度较高数据；</li><li>查询结果在内存中进行计算，大多数都是采用这种存储引擎作为临时表存储需要计算的数据；</li></ol></blockquote></blockquote><p>工作中，使用内存管理这块，我们根本不需要考虑 Memory 这种存储引擎， Redis、Memcache 等它们不香吗？？Memory存储引擎更多的使用在 MySQL 优化器查询阶段。下面简单介绍一下：</p><p>在优化器查询阶段，会以生成一个 template 临时表的方式查询。它的内存数据表默认只有 16M，并不支持大数据类型的存储字段。在查询阶段，如果满足 Memory 存储引擎的所有条件，就会在优化器查询阶段使用 Memory 存储引擎。如果不满足条件，则会使用 MyISAM 引擎。</p><p>10.2.2 了解 Memory 硬盘存储方式</p><p>xxx.sdi：存储表结构信息</p><h4 id="10-4-Archive存储引擎">10.4 Archive存储引擎</h4><p>10.4.1 Archive介绍</p><blockquote><p>Archive存储引擎，是以<code>压缩协议</code>进行数据的存储</p><p><strong>特点：</strong></p><ol><li>只支持 insert 和 select 两种操作；<code>（缺点：不适用于对数据的处理操作）</code></li><li>只允许自增ID列建立索引<code>（缺点：还是不方便数据的处理）</code></li><li>支持行级锁</li><li>不支持事务</li><li>优点：数据占用磁盘少</li></ol><blockquote><p><strong>应用场景：</strong></p><ol><li>日志系统；</li><li>大量的设备数据采集；</li></ol></blockquote></blockquote><p>10.4.2 使用Archive存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `users_archive` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) DEFAULT NULL,</span><br><span class="line">  `age` int(11) DEFAULT NULL,</span><br><span class="line">  `address` varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`) USING BTREE</span><br><span class="line">) ENGINE=Archive;</span><br></pre></td></tr></table></figure><p>10.4.3 Archive对比InnoDB，使用函数批量存储1w条数据</p><p>Archive比InnoDB可以节省95%的容量。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//批量添加函数:</span><br><span class="line">CREATE DEFINER=`root`@`%` PROCEDURE `users_archive_batchAdd`()</span><br><span class="line">begin</span><br><span class="line">    declare i int;</span><br><span class="line">    set i=1;</span><br><span class="line">    while i&lt;10000 do</span><br><span class="line">				INSERT INTO users_archive(id,name,age,address) VALUES(i,concat(&#x27;James&#x27;,i),i,concat(&#x27;BeiJing&#x27;,i));</span><br><span class="line">        set i=i+1;</span><br><span class="line">     end while;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>10.4.3 查看数据所在硬盘位置</p><p>入到存储数据所在的硬盘下，便可以看到 users_archive 相关的表（<code>.frm</code> 为表结构文件；<code>.ARZ</code>为数据文件）</p><h4 id="10-5-CSV存储引擎">10.5 CSV存储引擎</h4><p>10.5.1 CSV介绍</p><blockquote><p>CSV存储引擎，数据是以CSV文件存储。</p><p>特点：</p><p>不能定义索引，列定义必须为NOT NULL，不能设置自增列；（缺点：不适用于大表或者数据查询、排序等处理操作）<br>CSV数据的存储需要用,逗号隔开，可直接编辑 CSV文件进行数据的编排（缺点：数据安全性低）可以对硬盘中保存的表文件数据进行直接编辑xxx.CSV文件，但是不能将该文件删除然后上传自己的同名.CSV文件(该文件中可能还有额外一些和表相关的数据)，我们只能对其中数据进行编辑操作。编辑之后，通过命令：flush table XXX表名的方式使其生效</p><blockquote><p><strong>应用场景：</strong></p><ol><li>数据的快速导入导出；</li><li>表格直接转换成CSV；</li></ol></blockquote></blockquote><p>10.5.2 使用CSV存储引擎建表语句</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `users_csv` (</span><br><span class="line">  `id` int(11) NOT NULL,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `age` int(11) NOT NULL,</span><br><span class="line">  `address` varchar(255) NOT NULL</span><br><span class="line">) ENGINE=csv;</span><br></pre></td></tr></table></figure><p>10.5.3 查看数据所在硬盘位置</p><p>进入到存储数据所在的硬盘下，便可以看到 users_csv 相关的表（<code>.frm</code> 为表结构文件；<code>.CSV</code>为数据文件，<code>.CSM</code>不了解是干嘛的）</p><ol start="4"><li><p>存储引擎的选择</p><p>在选择存储引擎时，应该根据应用系统的特点选择核实的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p><ul><li>InnoDB：是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。</li><li>MyISAM：如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常适合的。</li><li>MEMORY：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。</li></ul></li></ol><h3 id="2）索引">2）索引</h3><p>索引（index）是帮助MySQL高效获取数据的数据结构（有序）。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p><hr><h2 id="运维">运维</h2><h3 id="1）日志">1）日志</h3><h4 id="1-1-错误日志">1.1 错误日志</h4><p>错误日志是 MySQL 中最重要的日志之一，它记录了当 mysqld 启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。当数据库出现任故障导致无法正常使用时，建议首先查看此日志。</p><p>该日志是默认开启的，默认存放目录<code>/var/log/</code>，默认的日志文件名为 mysqld.log 。</p><ul><li><p>查看日志位置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_error%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​ <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108172911709.png" alt="image-20230108172911709"></p><h4 id="1-2-二进制日志">1.2 二进制日志</h4><p>二进制日志（BINLOG）记录了所有的DDL（数据定义语言）语句和 DML (数据库操纵语言)语句，但不包括数据查询（SELECT、SHOW）语句。</p><ul><li><p>作用：</p><p>①灾难时的数据恢复；</p><p>②MySQL的主从复制；</p></li><li><p>查看日志位置：</p><p>在MySQL8版本中，默认二进制日志是开启着的，参数如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_bin%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​ <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108174925535.png" alt="image-20230108174925535"></p><ul><li><p>日志格式</p><ul><li><p>查看当前日志格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_format%&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108175118768.png" alt="image-20230108175118768"></p></li></ul><ul><li><p>修改日志格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改参数</span></span><br><span class="line">binlog_format=STATEMENT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><table><thead><tr><th>日志格式</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td>STATEMENT</td><td style="text-align:left">基于SQL语句的日志记录，记录的是SQL语句，对数据进行修改的SQL都会记录在日志文件中。</td></tr><tr><td>ROW</td><td style="text-align:left">基于行的日志记录，记录的是每一行的数据变更。（默认）</td></tr><tr><td>MIXED</td><td style="text-align:left">混合了STATEMENT和ROW两种格式，默认采用STATEMENT，在某些特殊情况下回自动切换为ROW进行记录</td></tr></tbody></table></li></ul></li><li><p>日志查看</p><p>由于日志是以二进制方式存储的，不能直接读取，Linux 下需要通过二进制日志查询工具 mysqlbinlog 来查看，具体语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [参数选项] logfilename</span><br><span class="line"></span><br><span class="line">参数选项：</span><br><span class="line">-d 指定数据库名称，只列出指定的数据库相关操作</span><br><span class="line">-o 忽略掉日志中的前n行命令</span><br><span class="line">-v 将行事件（数据变更）重构为SQL语句</span><br><span class="line">-vv 将行事件（数据变更）重构为SQL语句，并输出注释信息</span><br></pre></td></tr></table></figure></li><li><p>日志删除</p><p>对于比较繁忙的业务系统，每天生成的binlog数据巨大，如果长时间不清除，将会占用大量磁盘空间。可以通过以下方式清理日志：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reset master    # 删除全部binlog日志，删除之后，日志编号，将从binlog.000001开始</span><br><span class="line">purge master logs to &#x27;binlog.******&#x27;   # 删除 ****** 编号之前的所有日志</span><br><span class="line">purge master logs before &#x27;yyyy-mm-dd hh24:mi:ss&#x27;   # 删除日之味&quot;yyy-mm-dd hh24:mi:ss&quot;之前产生的所有日志</span><br></pre></td></tr></table></figure><p>也可以在MySQL的配置文件中配置二进制日志的过期时间，设置了之后，二进制日志过期会自动删除。(默认单位为秒 30天)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%binlog_expire_logs_seconds%&#x27;;</span><br></pre></td></tr></table></figure></li></ul><p>​ <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108185211069.png" alt="image-20230108185211069"></p><h4 id="1-3-查询日志">1.3 查询日志</h4><p>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。默认情况下，查询日志是未开启的。如果需要开启查询日志，可以设置一下配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108185524882.png" alt="image-20230108185524882"></p><p>修改MySQL的配置文件<code>/etc/my.cnf</code>，添加如下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 该选项用来开启查询日志，可选值：0或1,0代表关闭。</span></span><br><span class="line">general_log=1</span><br><span class="line"><span class="comment"># 设置日志的文件名，如果没有指定，默认的文件名为 host_name.log</span></span><br><span class="line"><span class="comment"># general_log_file=mysql_query.log</span></span><br></pre></td></tr></table></figure><h4 id="1-4-慢查询日志">1.4 慢查询日志</h4><p>慢查询日志记录了所有执行事件超过参数 long_query_time 设置值并且扫描记录不小于 min_examined_row_limit 的所有的SQL语句日志，默认开启。 long_query_time 默认为10秒，最小为0，精度可以到微秒。</p><p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。可以使用 log_slow_admin_statements 和更改此行为 log_queries_not_using_indexes，如下所述。</p><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 慢查询日志</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment"># 执行时间参数(s)</span></span><br><span class="line">long_query_time=2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 较少使用</span></span><br><span class="line"><span class="comment"># 记录执行较慢的管理语句</span></span><br><span class="line">log_slow_admin_statements=1</span><br><span class="line"><span class="comment"># 记录执行较慢的未使用索引的语句</span></span><br><span class="line">log_queries_not_using_indexes=1</span><br></pre></td></tr></table></figure><h3 id="2）主从复制">2）主从复制</h3><h4 id="2-1-概述">2.1 概述</h4><p>主从复制是指将主数据库的 DDL 和 DML 操作通过二进制日志传到从服务器中，然后再从库上对这些日志重新执行（也叫重做），从而使得从库和主库的数据保持同步。</p><p>MySQL支持一台主库同时向多台从库进行复制，从库同时也可以作为其他从服务器的主库，实现链状复制。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108195118263.png" alt="image-20230108195118263"></p><ul><li><p>MySQL 复制的优点主要包含以下三个方面：</p><ol><li><p>主库出现问题，可以快速切换到从库提供服务。</p></li><li><p>实现读写分离，降低主库的访问压力。</p></li><li><p>可以在从库中执行备份，以避免备份期间影响主库服务。</p></li></ol></li></ul><h4 id="2-2-原理">2.2 原理</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108195630533.png" alt="image-20230108195630533"></p><p>从上图来看，复制分为三步：</p><ol><li><p>Master 主库在事务提交时，会把数据变更记录在二进制日志文件 Binlog 中。</p></li><li><p>从库读取主库的二进制日志文件 Binlog，写入到从库的中继日志 Relay Log。</p></li><li><p>slave 重做中继日志中的事件，将改变反应到它自己的数据。</p></li></ol><h4 id="2-3-搭建">2.3 搭建</h4><p>服务器准备：</p><ul><li><p>关闭防火墙：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure><p>或生产环境中开放指定的 3306 端口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3306/tcp -permanent</span><br><span class="line">firewall-cmd reload</span><br></pre></td></tr></table></figure></li><li><p>主库配置</p><ol><li><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 服务ID，保证整个集群环境中唯一，取值范围：1——(2^32-1),默认为1</span></span><br><span class="line">server-id=1</span><br><span class="line"><span class="comment"># 是否只读，1代表只读，0代表读写</span></span><br><span class="line">read-only=0</span><br><span class="line"><span class="comment"># 忽略的数据，指不需要同步的数据库</span></span><br><span class="line"><span class="comment"># binlog-ignore-db=mysql</span></span><br><span class="line"><span class="comment"># 指定同步的数据库</span></span><br><span class="line"><span class="comment"># binlog-do-db=db01</span></span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></li><li><p>登入mysql，创建远程连接的账号，并赋予主从复制的权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 创建niubb用户，并设置密码，该用户可以在热议主机连接该Mysql服务</span><br><span class="line">CREATE USER &#x27;niubb&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Root@123456&#x27;;</span><br><span class="line"># 为 &#x27;niubb&#x27;@&#x27;%&#x27; 用户分配主从复制权限</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#x27;niubb&#x27;@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>通过指令，查看二进制日志坐标</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108204046402.png" alt="image-20230108204046402"></p><p>字段的含义说明：</p><p>​ file：从那个日志文件开始推送日志文件</p><p>​ position： 从那个位置开始推送日志</p><p>​ binlog_ignore_db：指定不需要同步的数据库</p></li></ol></li><li><p>从库配置</p><ol><li><p>修改配置文件<code>/etc/my.cnf</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql 服务ID，保证整个集群环境中唯一，取值范围：1——(2^32-1),和主库不一样即可</span></span><br><span class="line">server-id=2</span><br><span class="line"><span class="comment"># 是否只读，1代表只读，0代表读写</span></span><br><span class="line">read-only=1</span><br><span class="line"><span class="comment"># （这里是对普通用户只读，如果有超级用户权限还是可以读写）如需想让超管只读</span></span><br><span class="line"><span class="comment"># super-read-only=1</span></span><br></pre></td></tr></table></figure></li><li><p>重启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><pre><code>   	3. 登入MySQL,设置主库配置
</code></pre><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE REPLICATION SOURCE TO SOURCE_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,SOURCE_USER=&#x27;xxx&#x27;,SOURCE_PASSWORD=&#x27;xxx&#x27;,SOURCE_LOG_FILE=&#x27;xxx&#x27;,SOURCE_LOG_POS=xxx;</span><br></pre></td></tr></table></figure><p>如果是8.0.23之前的版本，则执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE MASTER SOURCE TO MASTER_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,MASTER_USER=&#x27;xxx&#x27;,MASTER_PASSWORD=&#x27;xxx&#x27;,MASTER_LOG_FILE=&#x27;xxx&#x27;,MASTER_LOG_POS=xxx;</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th><th>8.0.23之前</th></tr></thead><tbody><tr><td>SOURCE_HOST</td><td>主库IP地址</td><td>MASTER_HOST</td></tr><tr><td>SOURCE_USER</td><td>连接主库的用户名</td><td></td></tr><tr><td>SOURCE_PASSWORD</td><td>连接主库的密码</td><td></td></tr><tr><td>SOURCE_LOG_FILE</td><td>binlog日志文件名</td><td></td></tr><tr><td>SOURCE_LOG_POS</td><td>binlog日志文件位置</td><td></td></tr></tbody></table><ul><li><p>ex.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHANGE REPLICATION SOURCE TO SOURCE_HOST=&#x27;xxx.xxx.xxx.xxx&#x27;,SOURCE_USER=&#x27;niubb&#x27;,SOURCE_PASSWORD=&#x27;Root@123456&#x27;,SOURCE_LOG_FILE=&#x27;binlog.000004&#x27;,SOURCE_LOG_POS=663;</span><br></pre></td></tr></table></figure><pre><code>  4. 开启同步操作
</code></pre></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start replica;	# 8.0.22之后</span><br><span class="line">start slave;	# 8.0.22之前</span><br></pre></td></tr></table></figure></li><li><p>查看主从状态</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show replica status\G;</span><br><span class="line">start slave status;	# 8.0.22之前</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108210823388.png" alt="image-20230108210823388"></p></li></ol></li><li><p>最后在主库里测试下从库能否同步。</p></li><li><p>注意：如果主库一开始有数据，应该备份后在从库里恢复后在进行主从连接。</p></li></ul><h3 id="3）分库分表">3）分库分表</h3><h4 id="3-1-概述">3.1 概述</h4><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108224641250.png" alt="image-20230108224641250"></p><p>随着互联网及移动互联网的发展，应用系统的数据量也是成指数式增长，若采用单数据库进行数据存储，存在以下性能瓶颈：</p><ol><li>IO瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO,效率较低。请求数据太多，带宽不够，网络IO瓶颈。</li><li>CPU瓶颈：排序、分组、链接查询、聚合统计等SQL会耗费大量的CPU资源，请求数太多，CPU出现瓶颈。</li></ol><p>$\textcolor{red}{分库分表的中心思想是将数据分散存储，使得单一数据库/表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。}$</p><ul><li><p>拆分策略</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108225426011.png" alt="image-20230108225426011"></p><ul><li><p>$\textcolor{orange}{垂直拆分}$</p><ul><li><p>$\textcolor{green}{垂直分库}$：以表为依据，根据业务将不同表拆分到不同库中。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108225546860.png" alt="image-20230108225546860"></p><p>特点：</p><ol><li>每个库的表结构都不一样。</li><li>每个库的数据也不一样。</li><li>所有库的并集是全量数据。</li></ol></li><li><p>$\textcolor{green}{垂直分表}$：以字段为依据，根据字段属性将不同字段拆分到不同表中。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108230215756.png" alt="image-20230108230215756"></p><p>特点：</p><ol><li>每个表的结构都不一样。</li><li>每个表的数据也不一样，一般通过一列（主键/外键）关联。</li><li>所有表的并集是全量数据。</li></ol></li></ul></li><li><p>$\textcolor{orange}{水平拆分}$</p><ul><li><p>$\textcolor{green}{水平分库}$：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108230833971.png" alt="image-20230108230833971"></p><p>特点：</p><ol><li>每个库的表结构都一样。</li><li>每个库的数据都不一样。</li><li>所有库的并集是全量数据。</li></ol></li><li><p>$\textcolor{green}{水平分表}$：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230108231035063.png" alt="image-20230108231035063"></p><p>特点：</p><ol><li>每个表的表结构都一样。</li><li>每个表的数据都不一样。</li><li>所有表的并集是全量数据。</li></ol></li></ul></li></ul></li><li><p>实现技术</p><ul><li>==shardingJDBC==：基于AOP原理，在应用程序中对本地执行的SQL进行拦截，解析、改写、路由处理。需要自行编码配置实现，只支持java语言，性能较高。</li><li>==MyCat==：数据库分库分表中间件，不用调整代码即可实现分库分表，支持多种语言，性能不及前者。</li></ul></li></ul><h4 id="3-2-MyCat">3.2 MyCat</h4><p>MyCat 是开源的、活跃的、基于 Java 语言编写的 MySQL 数据库中间件。（出自阿里巴巴）</p><p>优势：性能可靠稳定、强大的技术团队、体系完善、社区活跃</p><h5 id="3-2-1-安装-MyCat">3.2.1 安装 MyCat</h5><p><a target="_blank" rel="noopener" href="http://mycat.org.cn/">MyCat官网</a></p><ol><li><p>安装 Java 环境</p><p>a. yum 安装 jdk ：（默认的安装目录 <code>/usr/lib/jvm/java-1.8.0/</code>）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><p>b. 配置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><p>c. 添加以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#set java environment</span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0</span><br><span class="line">JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line">export JAVA_HOME JRE_HOME CLASS_PATH PATH</span><br></pre></td></tr></table></figure><p>d. 重新读取配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><p>e. 验证是否安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure></li><li><p>安装 MyCat</p><p>a.切换至opt目录，下载mycat安装包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget http://dl.mycat.org.cn/1.6.7.6/20210303094759/Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz</span><br></pre></td></tr></table></figure><p>b. 创建/apps文件夹，并解压mycat包至/apps下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /apps</span><br><span class="line">tar -zxvf Mycat-server-1.6.7.6-release-20210303094759-linux.tar.gz -C /apps/</span><br></pre></td></tr></table></figure><p>c. 设置环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PATH=/apps/mycat/bin:$PATH&#x27;</span> &gt; /etc/profile.d/mycat.sh</span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/mycat.sh</span><br></pre></td></tr></table></figure><p>d. 启动mycat</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意内存小于2G 起不来</span></span><br><span class="line">mycat start</span><br></pre></td></tr></table></figure><p>e. 查看日志 启动成功日志末尾会出现successfully</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /apps/mycat/logs/wrapper.log</span><br></pre></td></tr></table></figure></li></ol><h5 id="3-2-2-概念">3.2.2 概念</h5><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109003624302.png" alt="image-20230109003624302"></p><h5 id="3-2-3-配置">3.2.3 配置</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/huasan994520/article/details/125150929">参考1</a></p><p>修改 MyCat 配置文件 <code>/apps/mycat/conf/schema.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#vim  /apps/mycat/conf/schema.xml</span><br><span class="line">#删除所有内容，重新写入以下</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;DB01&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        #schema标签：数据库设置，此数据库为逻辑数据库，name与server.xml中schema对应。</span><br><span class="line">        #name:逻辑数据库名，与server.xml中的schema对应；</span><br><span class="line">        #checkSQLschema: 数据库前缀相关设置，这里为false；</span><br><span class="line">        #sqlMaxLimit:  select时默认的limit，避免查询全表，否则可能会遇到查询量特别大的情况造成卡 死；</span><br><span class="line">        #dataNode:表存储到哪些节点，多个节点用逗号分隔。节点为下文dataNode设置的name</span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">&quot;TB_ORDER&quot;</span> <span class="attr">dataNode</span>=<span class="string">&quot;dn1,dn2,dn3&quot;</span> <span class="attr">rule</span>=<span class="string">&quot;auto-sharding-long&quot;</span> /&gt;</span></span><br><span class="line">            #table标签: 逻辑表</span><br><span class="line">            #name: 逻辑表名</span><br><span class="line">            #dataNode:逻辑表关联的数据节点，表存储到哪些节点，多个节点用逗号分隔。节点为下文dataNode设置的name</span><br><span class="line">            #rule:分片规则</span><br><span class="line">    	<span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;db01&quot;</span> /&gt;</span></span><br><span class="line">        #dataNode标签: 定义mycat中的数据节点，也是通常说的数据分片，也就是分库相关配置</span><br><span class="line">        #name: 定义数据节点的名字，与table中dataNode对应</span><br><span class="line">        #datahost: 物理数据库名，与datahost中name对应，该属性用于定义该分片属于哪个数据库实例</span><br><span class="line">        #database: 物理数据库中数据库名，该属性用于定义该分片属性关联到物理数据库实例上的db01数据库</span><br><span class="line">        <span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;1&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span> <span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">        #dataHost标签： 物理数据库，真正存储数据的数据库</span><br><span class="line">        #name: 物理数据库名，与dataNode中dataHost对应</span><br><span class="line">        #maxCon属性指定每个读写实例连接池的最大连接。也就是说，标签内嵌套的writeHost、readHost标  签都会使用这个属性的值来实例化出连接池的最大连接数</span><br><span class="line">        #minCon属性指定每个读写实例连接池的最小连接，初始化连接池的大小</span><br><span class="line">        #balance: 均衡负载的方式</span><br><span class="line">        #writeType: 写入方式</span><br><span class="line">        #dbType: 数据库类型</span><br><span class="line">        #dbDriver指定连接后端数据库使用的 Driver，目前可选的值有 native 和 JDBC。用 native 的话，因为这个值执行的是二进制的 mysql 协议，所以可以使用 mysql 和maridb。其他类型的数据库则需要使用 JDBC 驱动来支持。</span><br><span class="line">        #switchType:  “-1” 表示不自动切换； “1” 默认值，自动切换； “2” 基于 MySQL主从同步的状态决定是否切换心跳语句为 show slave status； “3” 基于 MySQL galary cluster 的切换机制（适合集群）（1.4.1）心跳语句为 show status like ‘wsrep%’.</span><br><span class="line">                <span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line">                #heartbeat: 心跳检测语句，注意语句结尾的分号要加</span><br><span class="line">                <span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;host1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.59.113:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line">                #host：用于标识不同实例，一般 writeHost 我们使用*M1，readHost 我们用*S1。</span><br><span class="line">                #url：后端实例连接地址。Native：地址：端口 JDBC：jdbc的url</span><br><span class="line">                #user：后端存储实例需要的用户名字</span><br><span class="line">                #password:后端存储实例需要的密码</span><br><span class="line">                 	<span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;host2&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.59.112:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">					#readHost标签:从服务器设置</span><br><span class="line">                <span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#schema.xml文件中有三点需要注意：balance=&quot;1&quot;，writeType=&quot;0&quot; ,switchType=&quot;1&quot; </span><br><span class="line">#schema.xml中的balance的取值决定了负载均衡对非事务内的读操作的处理。balance 属性负载均衡类型，目前的取值有 4 种：</span><br><span class="line">##balance=&quot;0&quot;：不开启读写分离机制，所有读操作都发送到当前可用的writeHost上,即读请求仅            发送到writeHost上</span><br><span class="line">##balance=&quot;1&quot;：一般用此模式，读请求随机分发到当前writeHost对应的readHost和standby的writeHost上。即全部的readHost与stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1 -&gt;S1 ， M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下， M2,S1, S2 都参与 select 语句的负载均衡</span><br><span class="line">##balance=&quot;2&quot;：读请求随机分发到当前dataHost内所有的writeHost和readHost上。即所有读操作都随机的在writeHost、 readhost 上分发</span><br><span class="line">##balance=&quot;3&quot;：读请求随机分发到当前writeHost对应的readHost上。即所有读请求随机的分发wiriterHost 对应的 readhost 执行, writerHost 不负担读压力，注意 balance=3 只在 1.4 及其以后版本有，1.3 没有</span><br><span class="line"></span><br><span class="line">###writeHost和readHost标签，这两个标签都指定后端数据库的相关配置给mycat，用于实例化后端连接池。唯一不同的是：writeHost指定写实例、readHost指定读实例，组着这些读写实例来满足系统的要求。在一个dataHost内可以定义多个writeHost和eadHost。但是，如果writeHost指定的后端数据库宕机，那么这个writeHost绑定的所有readHost都将不可用。另一方面，由于这个writeHost宕机系统会自动的检测到，并切换到备用的writeHost上去   </span><br><span class="line">               </span><br><span class="line">#PS：Mycat主从分离只是在读的时候做了处理，写入数据的时候，只会写入到writehost，需要通过mycat的主从复制将数据复制到readhost</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改 MyCat 配置文件 <code>/apps/mycat/conf/server.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#去掉44行行注释，对应的在51行行末注释，删除50行行末注释，5 * 60 * 1000L; //连接空&gt;    闲检查</span><br><span class="line"></span><br><span class="line">#修改45行端口号为3306</span><br><span class="line">45 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;serverPort&quot;</span>&gt;</span>3306<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#配置Mycat的连接信息(账号密码)，在110 和111行， 可以修改，这边不修改了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####参数解释说明####</span><br><span class="line">110         <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span> <span class="attr">defaultAccount</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">111                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">112                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">113                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">116                 <span class="comment">&lt;!-- 表级 DML 权限设置 --&gt;</span></span><br><span class="line">117                 <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">118                 &lt;privileges check=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="comment">119                         &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</span></span><br><span class="line"><span class="comment">120                                 &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">121                                 &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</span></span><br><span class="line"><span class="comment">122                         &lt;/schema&gt;</span></span><br><span class="line"><span class="comment">123                 &lt;/privileges&gt;   </span></span><br><span class="line"><span class="comment">124                  --&gt;</span></span><br><span class="line"></span><br><span class="line">127         <span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">128                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>user<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">129                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>DB01<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">130                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">131                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultSchema&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">user    用户配置节点</span><br><span class="line">name    逻辑用户名，客户端登录MyCAT的用户名，也就是客户端用来连接Mycat的用户名。</span><br><span class="line">password     客户端登录MyCAT的密码</span><br><span class="line">schemas      数据库名，这里会和schema.xml中的配置关联，可配置多个，多个用逗号分开，例如:db1,db2</span><br><span class="line">privileges   配置用户针对表的增删改查的权限</span><br><span class="line">readOnly mycat   逻辑库所具有的权限。true为只读，false为读写都有，默认为false</span><br><span class="line"></span><br><span class="line">##注意</span><br><span class="line">#server.xml文件里登录mycat的用户名和密码可以任意定义，这个账号和密码是为客户机登录mycat时使用的账号信息</span><br><span class="line">#逻辑库名(如上面的TESTDB，也就是登录mycat后显示的库名，切换这个库之后，显示的就是代理的真实mysql数据库的表)要在schema.xml里面也定义，否则会导致mycat服务启动失败！这里只定义了一个标签，所以把多余的都注释了。如果定义多个标签，即设置多个连接mycat的用户名和密码，那么就需要在schema.xml文件中定义多个对应的库！</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-2-4-启动服务">3.2.4 启动服务</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">mycat start</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">mycat stop</span><br></pre></td></tr></table></figure><p>MyCat启动之后，占用端口号 <code>8066</code> 。</p><h5 id="3-2-5-登入">3.2.5 登入</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h localhost -P8066 -uroot -p123456</span><br></pre></td></tr></table></figure><h5 id="3-2-6-配置文件详解">3.2.6 配置文件详解</h5><ul><li><p><strong>schema.xml</strong></p><ul><li><p><code>&lt;schema&gt;</code> 标签</p><p>用于定义 MyCat 实例中的逻辑库，一个 MyCat 实例中，可以有多个逻辑库，可以通过 schema 标签来划分不同的逻辑库。 MyCat中的逻辑库的概念，等同于 MySQL 中的database概念，需要操作某个逻辑库下的表时，也需要切换逻辑库(use xxx)。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109224721920.png" alt="image-20230109224721920"></p><ul><li>name：指定自定义的逻辑库库名。</li><li>checkSQLschema：在 SQL 语句操作时指定了数据库名称，执行时是否自动去除；true-自动去除，false-不自动去除。</li><li>sqlMaxLimit：如果未指定 limit 进行查询，列表查询模式查询多少条记录。</li></ul></li><li><p><code>&lt;table&gt;</code> 标签（schema 中的 ）</p><p>table 标签定义了 MyCat 中逻辑库 schema 下的逻辑表，所有需要拆分的表都需要在 table 标签中定义。</p><ul><li>name：定义逻辑表表名，在该逻辑库下唯一。</li><li>dataNode：定义逻辑表所属的 dataNode，该属性需要与 dataNode 标签中 name 对应；多个 dataNode 逗号分割。</li><li>rule：分片规则的名字，分片规则名字是在 rule.xml 中定义的。</li><li>primaryKey：逻辑表对应真实表的主键。</li><li>type：逻辑表的类型，目前逻辑表只有全局表和普通表，如果未配置，就是普通表；全局表配置为 global。</li></ul></li><li><p><code>&lt;dataNode&gt;</code> 标签</p><p>dataNode 标签中定义了 MyCat 中的数据节点，也就是我们通常说的数据分片。一个 dataNode 标签就是一个独立的数据分片。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109233001717.png" alt="image-20230109233001717"></p><ul><li>name：定义数据节点名称。</li><li>dataHost：数据库实例主机名称，引用自 dataHost 标签中 name 属性。</li><li>database： 定义分片所属数据库。</li></ul></li><li><p><code>&lt;datahost&gt;</code> 标签</p><p>该标签在 MyCat 逻辑库中作为底层标签存在，直接定义了具体的数据实例、读写分离、心跳语句。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109233711722.png" alt="image-20230109233711722"></p><ul><li><p>name：唯一标识，供上层标签使用。</p></li><li><p>maxCon/minCon：最大链接数/最小连接数。</p></li><li><p>balance：负载均衡策略，取值 0,1,2,3。</p></li><li><p>writeType：写操作分发方式（0：写操作妆发到第一个 writeHost，第一个挂了切换到第二个；1：写操作随机分发到配置的 writeHost）。</p></li><li><p>dbDriver：数据库驱动，支持 native、jdbc。</p></li></ul></li></ul></li><li><p><strong>rule.xml</strong></p><p>rule.xml 定义所有拆分表的规则，在使用过程中可以灵活的使用分片算法，或者对同一个分片算法使用不同的参数，它让分片过程可配置化。主要包含两类标签：tableRule、Function。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230109235344485.png" alt="image-20230109235344485"></p></li><li><p><strong>server.xml</strong></p><p>server.xml 配置文件包含了 MyCat 的系统配置信息，主要有两个重要的标签：system、user。</p><ul><li><p><code>&lt;system&gt;</code> 标签</p><p>对应的系统配置项及其含义，参考资料。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230110000228552.png" alt="image-20230110000228552"></p></li><li><p><code>&lt;user&gt;</code> 标签</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/niiuu/images/raw/master/article_images/typora_images/image-20230110000636587.png" alt="image-20230110000636587"></p></li></ul></li></ul><h5 id="3-2-7-分片">3.2.7 分片</h5><h3 id="4）读写分离">4）读写分离</h3><h4 id="4-1-基于MyCat的读写分离">4.1 基于MyCat的读写分离</h4><p>修改<datahost>的balance(负载均衡)属性，通过此属性配置读写分离的类型</datahost></p><p><strong>balance(负载均衡)类型目前有4种：</strong></p><ul><li>balance=“0”：不开启读写分离机制，所有读操作都发送到当前可用的 writeHost上。</li><li>balance=“1”：全部的readHost与stand by writeHost参与select语句的负载均衡，简单的说，当双主双从 模式(M1-&gt;S1，M2-&gt;S2，并且M1与M2互为主备)，正常情况下，M2,S1,S2 都参与select语句的负载均衡。</li><li>balance=“2”：所有读操作都随机的在writeHost、readhost 上分发。</li><li>balance=“3”：所有读请求随机的分发到readhost执行，writerHost不负担读压力。</li></ul><h5 id="4-1-1-一主一从">4.1.1 一主一从</h5><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/2547829c773c415f8c2424bc266f3e57.jpeg" alt="在这里插入图片描述"></p><ol><li>搭建主从复制的过程（略）</li></ol><table><thead><tr><th>编号</th><th>角色</th><th><code>IP</code>地址</th><th>机器名</th></tr></thead><tbody><tr><td>1</td><td><code>Master</code></td><td>192.168.110.146</td><td><code>ubuntu-mysql-master</code></td></tr><tr><td>2</td><td><code>Slaver</code></td><td>192.168.110.147</td><td><code>ubuntu-mysql-slaver</code></td></tr></tbody></table><ol start="2"><li>修改mycat配置文件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;&gt;</span><br><span class="line">        &lt;/schema&gt;</span><br><span class="line">        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;testdb&quot; /&gt;</span><br><span class="line">        &lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot; writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.110.146:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.147:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">        &lt;/dataHost&gt;</span><br><span class="line">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure><h5 id="4-1-2-双主双从">4.1.2 双主双从</h5><blockquote><p>搭建参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41779565/article/details/125375231">https://blog.csdn.net/qq_41779565/article/details/125375231</a></p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://gitee.com/aceniu/images/raw/master/article_images/typora_images/f4d1c70368204ed0bedc2a7d1da18ca5.jpeg" alt="在这里插入图片描述"></p><ol><li>搭建主从复制的过程（略）</li></ol><table><thead><tr><th>编号</th><th>角色</th><th><code>IP</code>地址</th><th>机器名</th></tr></thead><tbody><tr><td>1</td><td><code>Master1</code></td><td>192.168.110.146</td><td><code>ubuntu-mysql-master</code></td></tr><tr><td>2</td><td><code>Slaver1</code></td><td>192.168.110.147</td><td><code>ubuntu-mysql-slaver</code></td></tr><tr><td>3</td><td><code>Master2</code></td><td>192.168.110.148</td><td><code>ubuntu-mysql-master2</code></td></tr><tr><td>4</td><td><code>Slaver2</code></td><td>192.168.110.149</td><td><code>ubuntu-mysql-slaver2</code></td></tr></tbody></table><ol start="2"><li>配置<code>Mycat</code>读写分离</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</span><br><span class="line">&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot; dataNode=&quot;dn1&quot;&gt;</span><br><span class="line">        &lt;/schema&gt;</span><br><span class="line">        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;testdb&quot; /&gt;</span><br><span class="line">        &lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot; writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</span><br><span class="line">                &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</span><br><span class="line">                &lt;!-- can have multi write hosts --&gt;</span><br><span class="line">                &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.110.146:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.147:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">               &lt;writeHost host=&quot;hostM2&quot; url=&quot;192.168.110.148:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</span><br><span class="line">                        &lt;!-- can have multi read hosts --&gt;</span><br><span class="line">                        &lt;readHost host=&quot;hostS1&quot; url=&quot;192.168.110.149:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</span><br><span class="line">                &lt;/writeHost&gt;</span><br><span class="line">        &lt;/dataHost&gt;</span><br><span class="line">&lt;/mycat:schema&gt;</span><br></pre></td></tr></table></figure><blockquote><ul><li>writeType=0：所有写操作发送到配置的第一个writeHost，第一个挂了切到还生存的第二个。</li><li>writeType=1：所有写操作都随机的发送到配置的writeHost，1.5以后废弃不推荐。</li><li>writeHost：重新启动后以切换后的为准，切换记录在配置文件中：dnindex.properties 。</li><li>switchType：<ul><li>1 默认值，自动切换。</li><li>-1 表示不自动切换。</li><li>2 基于MySQL主从同步的状态决定是否切换。</li></ul></li></ul></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz">aceniu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://blog.halfsummer.xyz/posts/520fef84.html">https://blog.halfsummer.xyz/posts/520fef84.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.halfsummer.xyz" target="_blank">艾斯牛 Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/fa17c65a.html" title="Redis 学习笔记"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis 学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/posts/edc1b716.html" title="Shell编程 学习笔记"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Shell编程 学习笔记</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://cos.halfsummer.xyz/pictures/niubb/2023/20230228-63fdc7d0ce7ba.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">aceniu</div><div class="author-info__description">Love 33 & Yilia</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/aceniu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/aceniu" target="_blank" title="Github"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_github-circle"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=123354319@qq.com" target="_blank" title="Email"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"></use></svg></a><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-Rss"></use></svg></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/289493392" target="_blank" title="BiliBili"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="social-icon faa-parent animated-hover" href="tencent://Message/?Uin=123354319&amp;amp;websiteName=local.edu.com:8888=&amp;amp;Menu=yes" target="_blank" title="QQ"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-icon_qq-circle"></use></svg></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL"><span class="toc-text">MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text">1）数据库知识点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">2）数据库相关概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%89MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="toc-text">3）MySQL数据库版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%89%E6%A6%82%E8%BF%B0"><span class="toc-text">4）概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%BC%89MySQL-%E4%B8%8B%E8%BD%BD%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD"><span class="toc-text">5）MySQL 下载、安装与卸载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Linux"><span class="toc-text">5.1 Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-MacOS%EF%BC%88%E6%9C%AA%E6%95%B4%E7%90%86%EF%BC%89"><span class="toc-text">5.2 MacOS（未整理）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Windows%EF%BC%88%E6%9C%AA%E6%95%B4%E7%90%86%EF%BC%89"><span class="toc-text">5.3 Windows（未整理）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Docker"><span class="toc-text">5.4 Docker</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89SQL"><span class="toc-text">1）SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80"><span class="toc-text">2）DDL数据定义语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-text">2.1 数据库操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">2.2 表操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%AD%97%E6%AE%B5%E6%93%8D%E4%BD%9C"><span class="toc-text">2.3 字段操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89DML%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80"><span class="toc-text">3）DML数据操纵语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-text">4）DQL数据查询语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89DCL%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80"><span class="toc-text">5）DCL数据控制语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-text">5.1 管理用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-text">5.2 权限控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E5%87%BD%E6%95%B0"><span class="toc-text">6）函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">6.1 字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-text">6.2 数值函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-text">6.3 日期函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-text">6.4 流程函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%89%E7%BA%A6%E6%9D%9F"><span class="toc-text">7）约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%89%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">8）多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">8.1 多表关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.2 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.2.1 连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-text">1. 内连接</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">2. 外连接</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-text">3. 自连接</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-2-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.2.2 联合查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-3-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.2.3 子查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%89%E4%BA%8B%E5%8A%A1"><span class="toc-text">9）事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7ACID"><span class="toc-text">9.1 事务的四大特性ACID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-text">9.2 事务操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6"><span class="toc-text">进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">1）存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-5-5%E5%90%8E%E9%BB%98%E8%AE%A4-%E9%87%8D%E8%A6%81"><span class="toc-text">10.1 InnoDB存储引擎(5.5后默认)(重要)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-MyISAM%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-%E6%97%A9%E6%9C%9F%E9%BB%98%E8%AE%A4"><span class="toc-text">10.2 MyISAM存储引擎(早期默认)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-MyISAM-%E5%92%8C-InnoDB-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">10.- MyISAM 和 InnoDB 的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-Memory%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">10.3 Memory存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-Archive%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">10.4 Archive存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-CSV%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">10.5 CSV存储引擎</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E7%B4%A2%E5%BC%95"><span class="toc-text">2）索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4"><span class="toc-text">运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E6%97%A5%E5%BF%97"><span class="toc-text">1）日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-text">1.1 错误日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-text">1.2 二进制日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">1.3 查询日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-text">1.4 慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">2）主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">2.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%8E%9F%E7%90%86"><span class="toc-text">2.2 原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%90%AD%E5%BB%BA"><span class="toc-text">2.3 搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-text">3）分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%A6%82%E8%BF%B0"><span class="toc-text">3.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-MyCat"><span class="toc-text">3.2 MyCat</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E5%AE%89%E8%A3%85-MyCat"><span class="toc-text">3.2.1 安装 MyCat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-2-%E6%A6%82%E5%BF%B5"><span class="toc-text">3.2.2 概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-3-%E9%85%8D%E7%BD%AE"><span class="toc-text">3.2.3 配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-4-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1"><span class="toc-text">3.2.4 启动服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-5-%E7%99%BB%E5%85%A5"><span class="toc-text">3.2.5 登入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-6-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">3.2.6 配置文件详解</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-7-%E5%88%86%E7%89%87"><span class="toc-text">3.2.7 分片</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-text">4）读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%9F%BA%E4%BA%8EMyCat%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-text">4.1 基于MyCat的读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-1-%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E"><span class="toc-text">4.1.1 一主一从</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-2-%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E"><span class="toc-text">4.1.2 双主双从</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/317ae1f5.html" title="Git删除暂存区或版本库中的文件">Git删除暂存区或版本库中的文件</a><time datetime="2023-03-14T01:17:28.000Z" title="发表于 2023-03-14 01:17:28">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/70fb250c.html" title="Git如何回滚代码?">Git如何回滚代码?</a><time datetime="2023-03-14T01:13:35.000Z" title="发表于 2023-03-14 01:13:35">2023-03-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1c5e0d7.html" title="Tomcat 学习笔记">Tomcat 学习笔记</a><time datetime="2023-03-13T23:19:24.000Z" title="发表于 2023-03-13 23:19:24">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c1020521.html" title="Nginx 学习笔记">Nginx 学习笔记</a><time datetime="2023-03-13T23:16:34.000Z" title="发表于 2023-03-13 23:16:34">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/fa17c65a.html" title="Redis 学习笔记">Redis 学习笔记</a><time datetime="2023-03-13T23:16:24.000Z" title="发表于 2023-03-13 23:16:24">2023-03-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By aceniu</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://hexo-twikoo.halfsummer.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>